import * as tslib_1 from "tslib";
import { Optional } from '@angular/core';
import * as DOMPurify from 'dompurify';
var SlickEmptyWarningComponent = /** @class */ (function () {
    function SlickEmptyWarningComponent(translate) {
        this.translate = translate;
    }
    Object.defineProperty(SlickEmptyWarningComponent.prototype, "gridOptions", {
        /** Getter for the Grid Options pulled through the Grid Object */
        get: function () {
            return (this._grid && this._grid.getOptions) ? this._grid.getOptions() : {};
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SlickEmptyWarningComponent.prototype, "grid", {
        set: function (slickGrid) {
            this._grid = slickGrid;
        },
        enumerable: true,
        configurable: true
    });
    SlickEmptyWarningComponent.prototype.dispose = function () {
        if (this._warningLeftElement && this._warningLeftElement.remove) {
            this._warningLeftElement.remove();
        }
        if (this._warningRightElement && this._warningRightElement.remove) {
            this._warningRightElement.remove();
        }
        this._warningLeftElement = null;
        this._warningRightElement = null;
    };
    /**
     * Display a warning of empty data when the filtered dataset is empty
     * NOTE: to make this code reusable, you could (should) move this code into a utility service
     * @param isShowing - are we showing the message?
     * @param options - any styling options you'd like to pass like the text color
     */
    SlickEmptyWarningComponent.prototype.showEmptyDataMessage = function (isShowing, options) {
        if (isShowing === void 0) { isShowing = true; }
        if (!this._grid || !this.gridOptions) {
            return false;
        }
        var gridUid = this._grid && this._grid.getUID();
        var defaultMessage = 'No data to display.';
        var mergedOptions = tslib_1.__assign({ message: defaultMessage }, this.gridOptions.emptyDataWarning, options);
        var emptyDataClassName = mergedOptions && mergedOptions.className || 'slick-empty-data-warning';
        this._warningLeftElement = document.querySelector("." + gridUid + " ." + emptyDataClassName);
        var gridCanvasLeftElm = document.querySelector("." + gridUid + " .grid-canvas.grid-canvas-left");
        var gridCanvasRightElm = document.querySelector("." + gridUid + " .grid-canvas.grid-canvas-right");
        var leftElementMarginLeft = mergedOptions.leftViewportMarginLeft || 0;
        var rightElementMarginLeft = mergedOptions.rightViewportMarginLeft || 0;
        var leftElementFrozenMarginLeft = mergedOptions.frozenLeftViewportMarginLeft || 0;
        var rightElementFrozenMarginLeft = mergedOptions.frozenRightViewportMarginLeft || 0;
        var isFrozenGrid = (this.gridOptions.frozenColumn !== undefined && this.gridOptions.frozenColumn >= 0);
        var leftViewportMarginLeft = typeof leftElementMarginLeft === 'string' ? leftElementMarginLeft : leftElementMarginLeft + "px";
        var rightViewportMarginLeft = typeof rightElementMarginLeft === 'string' ? rightElementMarginLeft : rightElementMarginLeft + "px";
        if (!this._warningLeftElement && !isShowing) {
            return false;
        }
        // warning message could come from a translation key or by the warning options
        var warningMessage = mergedOptions.message;
        if (this.gridOptions.enableTranslate && this.translate && this.translate.instant && mergedOptions && mergedOptions.messageKey) {
            warningMessage = this.translate.instant(mergedOptions.messageKey);
        }
        if (!this._warningLeftElement && gridCanvasLeftElm && gridCanvasRightElm) {
            var sanitizedOptions = this.gridOptions && this.gridOptions.sanitizeHtmlOptions || {};
            // sanitize any unauthorized html tags like script and others
            // for the remaining allowed tags we'll permit all attributes
            var sanitizedText = (DOMPurify.sanitize(warningMessage, sanitizedOptions) || '').toString();
            this._warningLeftElement = document.createElement('div');
            this._warningLeftElement.classList.add(emptyDataClassName);
            this._warningLeftElement.classList.add('left');
            this._warningLeftElement.innerHTML = sanitizedText;
            // clone the warning element and add the "right" class to it so we can distinguish
            this._warningRightElement = this._warningLeftElement.cloneNode(true);
            this._warningRightElement.classList.add('right');
            // append both warning elements to both left/right canvas
            gridCanvasRightElm.appendChild(this._warningRightElement);
            gridCanvasLeftElm.appendChild(this._warningLeftElement);
        }
        // if we did find the Slick-Empty-Warning element then we'll display/hide at the grid position with some margin offsets (we need to position under the headerRow and filterRow)
        // when using a frozen/pinned grid, we also have extra options to hide left/right message
        if (this._warningLeftElement) {
            // display/hide right/left messages
            var leftDisplay = isShowing ? 'block' : 'none';
            if (isFrozenGrid && isShowing) {
                leftDisplay = (mergedOptions.hideFrozenLeftWarning) ? 'none' : 'block';
            }
            this._warningLeftElement.style.display = leftDisplay;
            // use correct left margin (defaults to 40% on regular grid or 10px on frozen grid)
            var leftFrozenMarginLeft = typeof leftElementFrozenMarginLeft === 'string' ? leftElementFrozenMarginLeft : leftElementFrozenMarginLeft + "px";
            this._warningLeftElement.style.marginLeft = isFrozenGrid ? leftFrozenMarginLeft : leftViewportMarginLeft;
        }
        if (this._warningRightElement) {
            // use correct left margin (defaults to 40% on regular grid or 10px on frozen grid)
            var rightDisplay = isShowing ? 'block' : 'none';
            if (isFrozenGrid && isShowing) {
                rightDisplay = (mergedOptions.hideFrozenRightWarning) ? 'none' : 'block';
            }
            this._warningRightElement.style.display = rightDisplay;
            // use correct left margin (defaults to 40% on regular grid or 10px on frozen grid)
            var rightFrozenMarginLeft = typeof rightElementFrozenMarginLeft === 'string' ? rightElementFrozenMarginLeft : rightElementFrozenMarginLeft + "px";
            this._warningRightElement.style.marginLeft = isFrozenGrid ? rightFrozenMarginLeft : rightViewportMarginLeft;
        }
        return isShowing;
    };
    SlickEmptyWarningComponent = tslib_1.__decorate([
        tslib_1.__param(0, Optional())
    ], SlickEmptyWarningComponent);
    return SlickEmptyWarningComponent;
}());
export { SlickEmptyWarningComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2xpY2stZW1wdHktd2FybmluZy5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9hbmd1bGFyLXNsaWNrZ3JpZC8iLCJzb3VyY2VzIjpbImFwcC9tb2R1bGVzL2FuZ3VsYXItc2xpY2tncmlkL2NvbXBvbmVudHMvc2xpY2stZW1wdHktd2FybmluZy5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUNBLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFekMsT0FBTyxLQUFLLFNBQVMsTUFBTSxXQUFXLENBQUM7QUFJdkM7SUFjRSxvQ0FBZ0MsU0FBNEI7UUFBNUIsY0FBUyxHQUFULFNBQVMsQ0FBbUI7SUFBSSxDQUFDO0lBUmpFLHNCQUFJLG1EQUFXO1FBRGYsaUVBQWlFO2FBQ2pFO1lBQ0UsT0FBTyxDQUFDLElBQUksQ0FBQyxLQUFLLElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxVQUFVLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDO1FBQzlFLENBQUM7OztPQUFBO0lBRUQsc0JBQUksNENBQUk7YUFBUixVQUFTLFNBQWM7WUFDckIsSUFBSSxDQUFDLEtBQUssR0FBRyxTQUFTLENBQUM7UUFDekIsQ0FBQzs7O09BQUE7SUFJRCw0Q0FBTyxHQUFQO1FBQ0UsSUFBSSxJQUFJLENBQUMsbUJBQW1CLElBQUksSUFBSSxDQUFDLG1CQUFtQixDQUFDLE1BQU0sRUFBRTtZQUMvRCxJQUFJLENBQUMsbUJBQW1CLENBQUMsTUFBTSxFQUFFLENBQUM7U0FDbkM7UUFDRCxJQUFJLElBQUksQ0FBQyxvQkFBb0IsSUFBSSxJQUFJLENBQUMsb0JBQW9CLENBQUMsTUFBTSxFQUFFO1lBQ2pFLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxNQUFNLEVBQUUsQ0FBQztTQUNwQztRQUNELElBQUksQ0FBQyxtQkFBbUIsR0FBRyxJQUFJLENBQUM7UUFD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Z3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IFRyYW5zbGF0ZVNlcnZpY2UgfSBmcm9tICdAbmd4LXRyYW5zbGF0ZS9jb3JlJztcclxuaW1wb3J0ICogYXMgRE9NUHVyaWZ5IGZyb20gJ2RvbXB1cmlmeSc7XHJcblxyXG5pbXBvcnQgeyBFbXB0eVdhcm5pbmcsIEdyaWRPcHRpb24gfSBmcm9tICcuLi9tb2RlbHMvaW5kZXgnO1xyXG5cclxuZXhwb3J0IGNsYXNzIFNsaWNrRW1wdHlXYXJuaW5nQ29tcG9uZW50IHtcclxuICBwcml2YXRlIF9ncmlkOiBhbnk7XHJcbiAgcHJpdmF0ZSBfd2FybmluZ0xlZnRFbGVtZW50OiBIVE1MRGl2RWxlbWVudCB8IG51bGw7XHJcbiAgcHJpdmF0ZSBfd2FybmluZ1JpZ2h0RWxlbWVudDogSFRNTERpdkVsZW1lbnQgfCBudWxsO1xyXG5cclxuICAvKiogR2V0dGVyIGZvciB0aGUgR3JpZCBPcHRpb25zIHB1bGxlZCB0aHJvdWdoIHRoZSBHcmlkIE9iamVjdCAqL1xyXG4gIGdldCBncmlkT3B0aW9ucygpOiBHcmlkT3B0aW9uIHtcclxuICAgIHJldHVybiAodGhpcy5fZ3JpZCAmJiB0aGlzLl9ncmlkLmdldE9wdGlvbnMpID8gdGhpcy5fZ3JpZC5nZXRPcHRpb25zKCkgOiB7fTtcclxuICB9XHJcblxyXG4gIHNldCBncmlkKHNsaWNrR3JpZDogYW55KSB7XHJcbiAgICB0aGlzLl9ncmlkID0gc2xpY2tHcmlkO1xyXG4gIH1cclxuXHJcbiAgY29uc3RydWN0b3IoQE9wdGlvbmFsKCkgcHJpdmF0ZSB0cmFuc2xhdGU/OiBUcmFuc2xhdGVTZXJ2aWNlKSB7IH1cclxuXHJcbiAgZGlzcG9zZSgpIHtcclxuICAgIGlmICh0aGlzLl93YXJuaW5nTGVmdEVsZW1lbnQgJiYgdGhpcy5fd2FybmluZ0xlZnRFbGVtZW50LnJlbW92ZSkge1xyXG4gICAgICB0aGlzLl93YXJuaW5nTGVmdEVsZW1lbnQucmVtb3ZlKCk7XHJcbiAgICB9XHJcbiAgICBpZiAodGhpcy5fd2FybmluZ1JpZ2h0RWxlbWVudCAmJiB0aGlzLl93YXJuaW5nUmlnaHRFbGVtZW50LnJlbW92ZSkge1xyXG4gICAgICB0aGlzLl93YXJuaW5nUmlnaHRFbGVtZW50LnJlbW92ZSgpO1xyXG4gICAgfVxyXG4gICAgdGhpcy5fd2FybmluZ0xlZnRFbGVtZW50ID0gbnVsbDtcclxuICAgIHRoaXMuX3dhcm5pbmdSaWdodEVsZW1lbnQgPSBudWxsO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRGlzcGxheSBhIHdhcm5pbmcgb2YgZW1wdHkgZGF0YSB3aGVuIHRoZSBmaWx0ZXJlZCBkYXRhc2V0IGlzIGVtcHR5XHJcbiAgICogTk9URTogdG8gbWFrZSB0aGlzIGNvZGUgcmV1c2FibGUsIHlvdSBjb3VsZCAoc2hvdWxkKSBtb3ZlIHRoaXMgY29kZSBpbnRvIGEgdXRpbGl0eSBzZXJ2aWNlXHJcbiAgICogQHBhcmFtIGlzU2hvd2luZyAtIGFyZSB3ZSBzaG93aW5nIHRoZSBtZXNzYWdlP1xyXG4gICAqIEBwYXJhbSBvcHRpb25zIC0gYW55IHN0eWxpbmcgb3B0aW9ucyB5b3UnZCBsaWtlIHRvIHBhc3MgbGlrZSB0aGUgdGV4dCBjb2xvclxyXG4gICAqL1xyXG4gIHNob3dFbXB0eURhdGFNZXNzYWdlKGlzU2hvd2luZyA9IHRydWUsIG9wdGlvbnM/OiBFbXB0eVdhcm5pbmcpOiBib29sZWFuIHtcclxuICAgIGlmICghdGhpcy5fZ3JpZCB8fCAhdGhpcy5ncmlkT3B0aW9ucykge1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgICBjb25zdCBncmlkVWlkID0gdGhpcy5fZ3JpZCAmJiB0aGlzLl9ncmlkLmdldFVJRCgpO1xyXG4gICAgY29uc3QgZGVmYXVsdE1lc3NhZ2UgPSAnTm8gZGF0YSB0byBkaXNwbGF5Lic7XHJcbiAgICBjb25zdCBtZXJnZWRPcHRpb25zOiBFbXB0eVdhcm5pbmcgPSB7IG1lc3NhZ2U6IGRlZmF1bHRNZXNzYWdlLCAuLi50aGlzLmdyaWRPcHRpb25zLmVtcHR5RGF0YVdhcm5pbmcsIC4uLm9wdGlvbnMgfTtcclxuICAgIGNvbnN0IGVtcHR5RGF0YUNsYXNzTmFtZSA9IG1lcmdlZE9wdGlvbnMgJiYgbWVyZ2VkT3B0aW9ucy5jbGFzc05hbWUgfHwgJ3NsaWNrLWVtcHR5LWRhdGEtd2FybmluZyc7XHJcbiAgICB0aGlzLl93YXJuaW5nTGVmdEVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yPEhUTUxEaXZFbGVtZW50PihgLiR7Z3JpZFVpZH0gLiR7ZW1wdHlEYXRhQ2xhc3NOYW1lfWApO1xyXG4gICAgY29uc3QgZ3JpZENhbnZhc0xlZnRFbG0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yPEhUTUxEaXZFbGVtZW50PihgLiR7Z3JpZFVpZH0gLmdyaWQtY2FudmFzLmdyaWQtY2FudmFzLWxlZnRgKTtcclxuICAgIGNvbnN0IGdyaWRDYW52YXNSaWdodEVsbSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3I8SFRNTERpdkVsZW1lbnQ+KGAuJHtncmlkVWlkfSAuZ3JpZC1jYW52YXMuZ3JpZC1jYW52YXMtcmlnaHRgKTtcclxuICAgIGNvbnN0IGxlZnRFbGVtZW50TWFyZ2luTGVmdCA9IG1lcmdlZE9wdGlvbnMubGVmdFZpZXdwb3J0TWFyZ2luTGVmdCB8fCAwO1xyXG4gICAgY29uc3QgcmlnaHRFbGVtZW50TWFyZ2luTGVmdCA9IG1lcmdlZE9wdGlvbnMucmlnaHRWaWV3cG9ydE1hcmdpbkxlZnQgfHwgMDtcclxuICAgIGNvbnN0IGxlZnRFbGVtZW50RnJvemVuTWFyZ2luTGVmdCA9IG1lcmdlZE9wdGlvbnMuZnJvemVuTGVmdFZpZXdwb3J0TWFyZ2luTGVmdCB8fCAwO1xyXG4gICAgY29uc3QgcmlnaHRFbGVtZW50RnJvemVuTWFyZ2luTGVmdCA9IG1lcmdlZE9wdGlvbnMuZnJvemVuUmlnaHRWaWV3cG9ydE1hcmdpbkxlZnQgfHwgMDtcclxuICAgIGNvbnN0IGlzRnJvemVuR3JpZCA9ICh0aGlzLmdyaWRPcHRpb25zLmZyb3plbkNvbHVtbiAhPT0gdW5kZWZpbmVkICYmIHRoaXMuZ3JpZE9wdGlvbnMuZnJvemVuQ29sdW1uID49IDApO1xyXG4gICAgY29uc3QgbGVmdFZpZXdwb3J0TWFyZ2luTGVmdCA9IHR5cGVvZiBsZWZ0RWxlbWVudE1hcmdpbkxlZnQgPT09ICdzdHJpbmcnID8gbGVmdEVsZW1lbnRNYXJnaW5MZWZ0IDogYCR7bGVmdEVsZW1lbnRNYXJnaW5MZWZ0fXB4YDtcclxuICAgIGNvbnN0IHJpZ2h0Vmlld3BvcnRNYXJnaW5MZWZ0ID0gdHlwZW9mIHJpZ2h0RWxlbWVudE1hcmdpbkxlZnQgPT09ICdzdHJpbmcnID8gcmlnaHRFbGVtZW50TWFyZ2luTGVmdCA6IGAke3JpZ2h0RWxlbWVudE1hcmdpbkxlZnR9cHhgO1xyXG5cclxuICAgIGlmICghdGhpcy5fd2FybmluZ0xlZnRFbGVtZW50ICYmICFpc1Nob3dpbmcpIHtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIHdhcm5pbmcgbWVzc2FnZSBjb3VsZCBjb21lIGZyb20gYSB0cmFuc2xhdGlvbiBrZXkgb3IgYnkgdGhlIHdhcm5pbmcgb3B0aW9uc1xyXG4gICAgbGV0IHdhcm5pbmdNZXNzYWdlID0gbWVyZ2VkT3B0aW9ucy5tZXNzYWdlO1xyXG4gICAgaWYgKHRoaXMuZ3JpZE9wdGlvbnMuZW5hYmxlVHJhbnNsYXRlICYmIHRoaXMudHJhbnNsYXRlICYmIHRoaXMudHJhbnNsYXRlLmluc3RhbnQgJiYgbWVyZ2VkT3B0aW9ucyAmJiBtZXJnZWRPcHRpb25zLm1lc3NhZ2VLZXkpIHtcclxuICAgICAgd2FybmluZ01lc3NhZ2UgPSB0aGlzLnRyYW5zbGF0ZS5pbnN0YW50KG1lcmdlZE9wdGlvbnMubWVzc2FnZUtleSk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKCF0aGlzLl93YXJuaW5nTGVmdEVsZW1lbnQgJiYgZ3JpZENhbnZhc0xlZnRFbG0gJiYgZ3JpZENhbnZhc1JpZ2h0RWxtKSB7XHJcbiAgICAgIGNvbnN0IHNhbml0aXplZE9wdGlvbnMgPSB0aGlzLmdyaWRPcHRpb25zICYmIHRoaXMuZ3JpZE9wdGlvbnMuc2FuaXRpemVIdG1sT3B0aW9ucyB8fCB7fTtcclxuXHJcbiAgICAgIC8vIHNhbml0aXplIGFueSB1bmF1dGhvcml6ZWQgaHRtbCB0YWdzIGxpa2Ugc2NyaXB0IGFuZCBvdGhlcnNcclxuICAgICAgLy8gZm9yIHRoZSByZW1haW5pbmcgYWxsb3dlZCB0YWdzIHdlJ2xsIHBlcm1pdCBhbGwgYXR0cmlidXRlc1xyXG4gICAgICBjb25zdCBzYW5pdGl6ZWRUZXh0ID0gKERPTVB1cmlmeS5zYW5pdGl6ZSh3YXJuaW5nTWVzc2FnZSwgc2FuaXRpemVkT3B0aW9ucykgfHwgJycpLnRvU3RyaW5nKCk7XHJcblxyXG4gICAgICB0aGlzLl93YXJuaW5nTGVmdEVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgdGhpcy5fd2FybmluZ0xlZnRFbGVtZW50LmNsYXNzTGlzdC5hZGQoZW1wdHlEYXRhQ2xhc3NOYW1lKTtcclxuICAgICAgdGhpcy5fd2FybmluZ0xlZnRFbGVtZW50LmNsYXNzTGlzdC5hZGQoJ2xlZnQnKTtcclxuICAgICAgdGhpcy5fd2FybmluZ0xlZnRFbGVtZW50LmlubmVySFRNTCA9IHNhbml0aXplZFRleHQ7XHJcblxyXG4gICAgICAvLyBjbG9uZSB0aGUgd2FybmluZyBlbGVtZW50IGFuZCBhZGQgdGhlIFwicmlnaHRcIiBjbGFzcyB0byBpdCBzbyB3ZSBjYW4gZGlzdGluZ3Vpc2hcclxuICAgICAgdGhpcy5fd2FybmluZ1JpZ2h0RWxlbWVudCA9IHRoaXMuX3dhcm5pbmdMZWZ0RWxlbWVudC5jbG9uZU5vZGUodHJ1ZSkgYXMgSFRNTERpdkVsZW1lbnQ7XHJcbiAgICAgIHRoaXMuX3dhcm5pbmdSaWdodEVsZW1lbnQuY2xhc3NMaXN0LmFkZCgncmlnaHQnKTtcclxuXHJcbiAgICAgIC8vIGFwcGVuZCBib3RoIHdhcm5pbmcgZWxlbWVudHMgdG8gYm90aCBsZWZ0L3JpZ2h0IGNhbnZhc1xyXG4gICAgICBncmlkQ2FudmFzUmlnaHRFbG0uYXBwZW5kQ2hpbGQodGhpcy5fd2FybmluZ1JpZ2h0RWxlbWVudCk7XHJcbiAgICAgIGdyaWRDYW52YXNMZWZ0RWxtLmFwcGVuZENoaWxkKHRoaXMuX3dhcm5pbmdMZWZ0RWxlbWVudCk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gaWYgd2UgZGlkIGZpbmQgdGhlIFNsaWNrLUVtcHR5LVdhcm5pbmcgZWxlbWVudCB0aGVuIHdlJ2xsIGRpc3BsYXkvaGlkZSBhdCB0aGUgZ3JpZCBwb3NpdGlvbiB3aXRoIHNvbWUgbWFyZ2luIG9mZnNldHMgKHdlIG5lZWQgdG8gcG9zaXRpb24gdW5kZXIgdGhlIGhlYWRlclJvdyBhbmQgZmlsdGVyUm93KVxyXG4gICAgLy8gd2hlbiB1c2luZyBhIGZyb3plbi9waW5uZWQgZ3JpZCwgd2UgYWxzbyBoYXZlIGV4dHJhIG9wdGlvbnMgdG8gaGlkZSBsZWZ0L3JpZ2h0IG1lc3NhZ2VcclxuICAgIGlmICh0aGlzLl93YXJuaW5nTGVmdEVsZW1lbnQpIHtcclxuICAgICAgLy8gZGlzcGxheS9oaWRlIHJpZ2h0L2xlZnQgbWVzc2FnZXNcclxuICAgICAgbGV0IGxlZnREaXNwbGF5ID0gaXNTaG93aW5nID8gJ2Jsb2NrJyA6ICdub25lJztcclxuICAgICAgaWYgKGlzRnJvemVuR3JpZCAmJiBpc1Nob3dpbmcpIHtcclxuICAgICAgICBsZWZ0RGlzcGxheSA9IChtZXJnZWRPcHRpb25zLmhpZGVGcm96ZW5MZWZ0V2FybmluZykgPyAnbm9uZScgOiAnYmxvY2snO1xyXG4gICAgICB9XHJcbiAgICAgIHRoaXMuX3dhcm5pbmdMZWZ0RWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gbGVmdERpc3BsYXk7XHJcblxyXG4gICAgICAvLyB1c2UgY29ycmVjdCBsZWZ0IG1hcmdpbiAoZGVmYXVsdHMgdG8gNDAlIG9uIHJlZ3VsYXIgZ3JpZCBvciAxMHB4IG9uIGZyb3plbiBncmlkKVxyXG4gICAgICBjb25zdCBsZWZ0RnJvemVuTWFyZ2luTGVmdCA9IHR5cGVvZiBsZWZ0RWxlbWVudEZyb3plbk1hcmdpbkxlZnQgPT09ICdzdHJpbmcnID8gbGVmdEVsZW1lbnRGcm96ZW5NYXJnaW5MZWZ0IDogYCR7bGVmdEVsZW1lbnRGcm96ZW5NYXJnaW5MZWZ0fXB4YDtcclxuICAgICAgdGhpcy5fd2FybmluZ0xlZnRFbGVtZW50LnN0eWxlLm1hcmdpbkxlZnQgPSBpc0Zyb3plbkdyaWQgPyBsZWZ0RnJvemVuTWFyZ2luTGVmdCA6IGxlZnRWaWV3cG9ydE1hcmdpbkxlZnQ7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHRoaXMuX3dhcm5pbmdSaWdodEVsZW1lbnQpIHtcclxuICAgICAgLy8gdXNlIGNvcnJlY3QgbGVmdCBtYXJnaW4gKGRlZmF1bHRzIHRvIDQwJSBvbiByZWd1bGFyIGdyaWQgb3IgMTBweCBvbiBmcm96ZW4gZ3JpZClcclxuICAgICAgbGV0IHJpZ2h0RGlzcGxheSA9IGlzU2hvd2luZyA/ICdibG9jaycgOiAnbm9uZSc7XHJcbiAgICAgIGlmIChpc0Zyb3plbkdyaWQgJiYgaXNTaG93aW5nKSB7XHJcbiAgICAgICAgcmlnaHREaXNwbGF5ID0gKG1lcmdlZE9wdGlvbnMuaGlkZUZyb3plblJpZ2h0V2FybmluZykgPyAnbm9uZScgOiAnYmxvY2snO1xyXG4gICAgICB9XHJcbiAgICAgIHRoaXMuX3dhcm5pbmdSaWdodEVsZW1lbnQuc3R5bGUuZGlzcGxheSA9IHJpZ2h0RGlzcGxheTtcclxuXHJcbiAgICAgIC8vIHVzZSBjb3JyZWN0IGxlZnQgbWFyZ2luIChkZWZhdWx0cyB0byA0MCUgb24gcmVndWxhciBncmlkIG9yIDEwcHggb24gZnJvemVuIGdyaWQpXHJcbiAgICAgIGNvbnN0IHJpZ2h0RnJvemVuTWFyZ2luTGVmdCA9IHR5cGVvZiByaWdodEVsZW1lbnRGcm96ZW5NYXJnaW5MZWZ0ID09PSAnc3RyaW5nJyA/IHJpZ2h0RWxlbWVudEZyb3plbk1hcmdpbkxlZnQgOiBgJHtyaWdodEVsZW1lbnRGcm96ZW5NYXJnaW5MZWZ0fXB4YDtcclxuICAgICAgdGhpcy5fd2FybmluZ1JpZ2h0RWxlbWVudC5zdHlsZS5tYXJnaW5MZWZ0ID0gaXNGcm96ZW5HcmlkID8gcmlnaHRGcm96ZW5NYXJnaW5MZWZ0IDogcmlnaHRWaWV3cG9ydE1hcmdpbkxlZnQ7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIGlzU2hvd2luZztcclxuICB9XHJcbn1cclxuIl19