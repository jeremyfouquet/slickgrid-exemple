import * as tslib_1 from "tslib";
import { KeyCode, } from '../models/index';
import { BindingEventService } from '../services/bindingEvent.service';
import { getDescendantProperty, setDeepValue } from '../services/utilities';
import { floatValidator, integerValidator, textValidator } from '../editorValidators';
/*
 * An example of a 'detached' editor.
 * KeyDown events are also handled to provide handling for Tab, Shift-Tab, Esc and Ctrl-Enter.
 */
var DualInputEditor = /** @class */ (function () {
    function DualInputEditor(args) {
        var _this = this;
        this.args = args;
        this._isValueSaveCalled = false;
        if (!args) {
            throw new Error('[Angular-Slickgrid] Something is wrong with this grid, an Editor must always have valid arguments.');
        }
        this.grid = args.grid;
        this.gridOptions = (this.grid.getOptions() || {});
        this._eventHandler = new Slick.EventHandler();
        this._bindEventService = new BindingEventService();
        this.init();
        this._eventHandler.subscribe(this.grid.onValidationError, function () { return _this._isValueSaveCalled = true; });
    }
    Object.defineProperty(DualInputEditor.prototype, "columnDef", {
        /** Get Column Definition object */
        get: function () {
            return this.args && this.args.column;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DualInputEditor.prototype, "columnEditor", {
        /** Get Column Editor object */
        get: function () {
            return this.columnDef && this.columnDef.internalColumnEditor || {};
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DualInputEditor.prototype, "editorDomElement", {
        /** Get the Editor DOM Element */
        get: function () {
            return { leftInput: this._leftInput, rightInput: this._rightInput };
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DualInputEditor.prototype, "editorParams", {
        get: function () {
            return this.columnEditor.params || {};
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DualInputEditor.prototype, "eventHandler", {
        get: function () {
            return this._eventHandler;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DualInputEditor.prototype, "hasAutoCommitEdit", {
        get: function () {
            return this.grid.getOptions().autoCommitEdit;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DualInputEditor.prototype, "isValueSaveCalled", {
        get: function () {
            return this._isValueSaveCalled;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DualInputEditor.prototype, "validator", {
        /** Get the Shared Validator function, can be passed in Editor property or Column Definition */
        get: function () {
            return (this.columnEditor && this.columnEditor.validator) || (this.columnDef && this.columnDef.validator);
        },
        enumerable: true,
        configurable: true
    });
    DualInputEditor.prototype.init = function () {
        var _this = this;
        if (!this.editorParams || !this.editorParams.leftInput || !this.editorParams.leftInput.field || !this.editorParams.rightInput || !this.editorParams.rightInput.field) {
            throw new Error("[Angular-Slickgrid] Please make sure that your Combo Input Editor has params defined with \"leftInput\" and \"rightInput\" (example: { editor: { model: Editors.comboInput, params: { leftInput: { field: 'firstName' }, { rightSide: { field: 'lastName' } }}}");
        }
        this._leftFieldName = this.editorParams && this.editorParams.leftInput && this.editorParams.leftInput.field;
        this._rightFieldName = this.editorParams && this.editorParams.rightInput && this.editorParams.rightInput.field;
        this._leftInput = this.createInput('leftInput');
        this._rightInput = this.createInput('rightInput');
        var containerElm = this.args.container;
        if (containerElm && typeof containerElm.appendChild === 'function') {
            containerElm.appendChild(this._leftInput);
            containerElm.appendChild(this._rightInput);
        }
        this._leftInput.onkeydown = this.handleKeyDown.bind(this);
        this._rightInput.onkeydown = this.handleKeyDown.bind(this);
        // the lib does not get the focus out event for some reason, so register it here
        if (this.hasAutoCommitEdit) {
            this._bindEventService.bind(this._leftInput, 'focusout', function (event) { return _this.handleFocusOut(event, 'leftInput'); });
            this._bindEventService.bind(this._rightInput, 'focusout', function (event) { return _this.handleFocusOut(event, 'rightInput'); });
        }
        setTimeout(function () { return _this._leftInput.select(); }, 50);
    };
    DualInputEditor.prototype.handleFocusOut = function (event, position) {
        // when clicking outside the editable cell OR when focusing out of it
        var targetClassNames = event.relatedTarget && event.relatedTarget.className || '';
        if (targetClassNames.indexOf('dual-editor') === -1 && this._lastEventType !== 'focusout-right') {
            if (position === 'rightInput' || (position === 'leftInput' && this._lastEventType !== 'focusout-left')) {
                this.save();
            }
        }
        var side = (position === 'leftInput') ? 'left' : 'right';
        this._lastEventType = (event && event.type) + "-" + side;
    };
    DualInputEditor.prototype.handleKeyDown = function (event) {
        this._lastInputKeyEvent = event;
        if (event.keyCode === KeyCode.LEFT || event.keyCode === KeyCode.RIGHT || event.keyCode === KeyCode.TAB) {
            event.stopImmediatePropagation();
        }
    };
    DualInputEditor.prototype.destroy = function () {
        // unsubscribe all SlickGrid events
        this._eventHandler.unsubscribeAll();
        this._bindEventService.unbindAll();
    };
    DualInputEditor.prototype.createInput = function (position) {
        var editorSideParams = this.editorParams[position];
        var columnId = this.columnDef && this.columnDef.id;
        var idPropName = this.gridOptions.datasetIdPropertyName || 'id';
        var itemId = this.args && this.args.item && this.args.item[idPropName] || 0;
        var fieldType = editorSideParams.type || 'text';
        if (fieldType === 'float' || fieldType === 'integer') {
            fieldType = 'number';
        }
        var input = document.createElement('input');
        input.id = "item-" + itemId + "-" + position;
        input.className = "dual-editor-text editor-" + columnId + " " + position.replace(/input/gi, '');
        if (fieldType === 'readonly') {
            // when the custom type is defined as readonly, we'll make a readonly text input
            input.readOnly = true;
            fieldType = 'text';
        }
        input.type = fieldType || 'text';
        input.setAttribute('role', 'presentation');
        input.autocomplete = 'off';
        input.placeholder = editorSideParams.placeholder || '';
        input.title = editorSideParams.title || '';
        if (fieldType === 'number') {
            input.step = this.getInputDecimalSteps(position);
        }
        return input;
    };
    DualInputEditor.prototype.focus = function () {
        // do nothing since we have 2 inputs and we might focus on left/right depending on which is invalid and/or new
    };
    DualInputEditor.prototype.getValues = function () {
        var obj = {};
        var leftInputValue = this._leftInput.value;
        var rightInputValue = this._rightInput.value;
        var isLeftInputTypeNumber = (this.editorParams.leftInput && (this.editorParams.leftInput.type === 'float' || this.editorParams.leftInput.type === 'integer'));
        var isRightInputTypeNumber = (this.editorParams.rightInput && (this.editorParams.rightInput.type === 'float' || this.editorParams.rightInput.type === 'integer'));
        var resultLeftValue = (leftInputValue !== '' && isLeftInputTypeNumber) ? +this._leftInput.value : (leftInputValue || '');
        var resultRightValue = (rightInputValue !== '' && isRightInputTypeNumber) ? +this._rightInput.value : (rightInputValue || '');
        setDeepValue(obj, this._leftFieldName, resultLeftValue);
        setDeepValue(obj, this._rightFieldName, resultRightValue);
        return obj;
    };
    DualInputEditor.prototype.setValues = function (values) {
        if (Array.isArray(values) && values.length === 2) {
            this._leftInput.value = "" + values[0];
            this._rightInput.value = "" + values[1];
        }
    };
    DualInputEditor.prototype.applyValue = function (item, state) {
        this.applyValueByPosition(item, state, 'leftInput');
        this.applyValueByPosition(item, state, 'rightInput');
    };
    DualInputEditor.prototype.applyValueByPosition = function (item, state, position) {
        var fieldName = position === 'leftInput' ? this._leftFieldName : this._rightFieldName;
        if (fieldName !== undefined) {
            var isComplexObject = fieldName && fieldName.indexOf('.') > 0; // is the field a complex object, "address.streetNumber"
            var fieldNameToUse = fieldName;
            if (isComplexObject) {
                var complexFieldNames = fieldName.split(/\.(.*)/);
                fieldNameToUse = (complexFieldNames.length > 1 ? complexFieldNames[1] : complexFieldNames);
            }
            // validate the value before applying it (if not valid we'll set an empty string)
            var stateValue = isComplexObject ? getDescendantProperty(state, fieldNameToUse) : state[fieldName];
            var validation = this.validate({ position: position, inputValue: stateValue });
            // set the new value to the item datacontext
            if (isComplexObject) {
                var newValueFromComplex = getDescendantProperty(state, fieldNameToUse);
                var newValue = (validation && validation.valid) ? newValueFromComplex : '';
                setDeepValue(item, fieldName, newValue);
            }
            else if (fieldName) {
                item[fieldName] = (validation && validation.valid) ? state[fieldName] : '';
            }
        }
    };
    DualInputEditor.prototype.isValueChanged = function () {
        var leftElmValue = this._leftInput.value;
        var rightElmValue = this._rightInput.value;
        var leftEditorParams = this.editorParams && this.editorParams.leftInput;
        var rightEditorParams = this.editorParams && this.editorParams.rightInput;
        var lastKeyEvent = this._lastInputKeyEvent && this._lastInputKeyEvent.keyCode;
        if ((leftEditorParams && leftEditorParams.alwaysSaveOnEnterKey || rightEditorParams && rightEditorParams.alwaysSaveOnEnterKey) && lastKeyEvent === KeyCode.ENTER) {
            return true;
        }
        var leftResult = (!(leftElmValue === '' && (this.originalLeftValue === null || this.originalLeftValue === undefined))) && (leftElmValue !== this.originalLeftValue);
        var rightResult = (!(rightElmValue === '' && (this.originalRightValue === null || this.originalRightValue === undefined))) && (rightElmValue !== this.originalRightValue);
        return leftResult || rightResult;
    };
    DualInputEditor.prototype.loadValue = function (item) {
        this.loadValueByPosition(item, 'leftInput');
        this.loadValueByPosition(item, 'rightInput');
        this._leftInput.select();
    };
    DualInputEditor.prototype.loadValueByPosition = function (item, position) {
        // is the field a complex object, "address.streetNumber"
        var fieldName = (position === 'leftInput') ? this._leftFieldName : this._rightFieldName;
        var originalValuePosition = (position === 'leftInput') ? 'originalLeftValue' : 'originalRightValue';
        var inputVarPosition = (position === 'leftInput') ? '_leftInput' : '_rightInput';
        if (item && fieldName !== undefined) {
            var isComplexObject = fieldName && fieldName.indexOf('.') > 0;
            var itemValue = (isComplexObject) ? getDescendantProperty(item, fieldName) : (item.hasOwnProperty(fieldName) ? item[fieldName] : '');
            this[originalValuePosition] = itemValue;
            if (this.editorParams[position].type === 'float') {
                var decimalPlaces = this.getDecimalPlaces(position);
                if (decimalPlaces !== null && (this[originalValuePosition] || this[originalValuePosition] === 0) && (+this[originalValuePosition]).toFixed) {
                    this[originalValuePosition] = (+this[originalValuePosition]).toFixed(decimalPlaces);
                }
            }
            if (this[inputVarPosition]) {
                var originalValue = this[originalValuePosition];
                this[inputVarPosition].value = "" + originalValue;
            }
        }
    };
    DualInputEditor.prototype.save = function () {
        var validation = this.validate();
        var isValid = (validation && validation.valid) || false;
        if (!this._isValueSaveCalled) {
            if (this.hasAutoCommitEdit && isValid) {
                this.grid.getEditorLock().commitCurrentEdit();
            }
            else {
                this.args.commitChanges();
            }
            this._isValueSaveCalled = true;
        }
    };
    DualInputEditor.prototype.serializeValue = function () {
        var obj = {};
        var leftValue = this.serializeValueByPosition('leftInput');
        var rightValue = this.serializeValueByPosition('rightInput');
        setDeepValue(obj, this._leftFieldName, leftValue);
        setDeepValue(obj, this._rightFieldName, rightValue);
        return obj;
    };
    DualInputEditor.prototype.serializeValueByPosition = function (position) {
        var elmValue = position === 'leftInput' ? this._leftInput.value : this._rightInput.value;
        if (elmValue === '' || isNaN(+elmValue)) {
            return elmValue;
        }
        var rtn = parseFloat(elmValue);
        var decPlaces = this.getDecimalPlaces(position);
        if (decPlaces !== null && (rtn || rtn === 0) && rtn.toFixed) {
            rtn = parseFloat(rtn.toFixed(decPlaces));
        }
        return rtn;
    };
    DualInputEditor.prototype.getDecimalPlaces = function (position) {
        var defaultDecimalPlaces = 0; // TODO move into a constant
        // returns the number of fixed decimal places or null
        var positionSide = position === 'leftInput' ? 'leftInput' : 'rightInput';
        var sideParams = this.editorParams[positionSide];
        var rtn = sideParams && sideParams.decimal;
        if (rtn === undefined) {
            return defaultDecimalPlaces;
        }
        return rtn;
    };
    DualInputEditor.prototype.getInputDecimalSteps = function (position) {
        var decimals = this.getDecimalPlaces(position);
        var zeroString = '';
        for (var i = 1; i < decimals; i++) {
            zeroString += '0';
        }
        if (decimals > 0) {
            return "0." + zeroString + "1";
        }
        return '1';
    };
    DualInputEditor.prototype.validate = function (inputValidation) {
        if (inputValidation) {
            var posValidation = this.validateByPosition(inputValidation.position, inputValidation.inputValue);
            if (!posValidation.valid) {
                inputValidation.position === 'leftInput' ? this._leftInput.select() : this._rightInput.select();
                return posValidation;
            }
        }
        else {
            var leftValidation = this.validateByPosition('leftInput');
            var rightValidation = this.validateByPosition('rightInput');
            if (!leftValidation.valid) {
                this._leftInput.select();
                return leftValidation;
            }
            if (!rightValidation.valid) {
                this._rightInput.select();
                return rightValidation;
            }
        }
        return { valid: true, msg: '' };
    };
    DualInputEditor.prototype.validateByPosition = function (position, inputValue) {
        var positionEditorParams = this.editorParams[position];
        var currentVal = '';
        if (inputValue) {
            currentVal = inputValue;
        }
        else {
            var input = position === 'leftInput' ? this._leftInput : this._rightInput;
            currentVal = input && input.value;
        }
        // there are 2 ways of passing a Validator, 1-independent validator on each side, 2-shared validator
        var commonValidator = this.validator;
        currentVal = typeof commonValidator === 'function' ? this.getValues() : currentVal;
        var baseValidatorOptions = {
            editorArgs: this.args,
            errorMessage: positionEditorParams.errorMessage,
            required: positionEditorParams.required,
            validator: typeof commonValidator === 'function' ? commonValidator : positionEditorParams.validator,
        };
        switch (positionEditorParams.type) {
            case 'float':
                return floatValidator(currentVal, tslib_1.__assign({}, baseValidatorOptions, { decimal: this.getDecimalPlaces(position), minValue: positionEditorParams.minValue, maxValue: positionEditorParams.maxValue, operatorConditionalType: positionEditorParams.operatorConditionalType }));
            case 'integer':
                return integerValidator(currentVal, tslib_1.__assign({}, baseValidatorOptions, { minValue: positionEditorParams.minValue, maxValue: positionEditorParams.maxValue, operatorConditionalType: positionEditorParams.operatorConditionalType }));
            case 'text':
            case 'password':
            default:
                return textValidator(currentVal, baseValidatorOptions);
        }
    };
    return DualInputEditor;
}());
export { DualInputEditor };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHVhbElucHV0RWRpdG9yLmpzIiwic291cmNlUm9vdCI6Im5nOi8vYW5ndWxhci1zbGlja2dyaWQvIiwic291cmNlcyI6WyJhcHAvbW9kdWxlcy9hbmd1bGFyLXNsaWNrZ3JpZC9lZGl0b3JzL2R1YWxJbnB1dEVkaXRvci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQVVMLE9BQU8sR0FFUixNQUFNLGlCQUFpQixDQUFDO0FBQ3pCLE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLGtDQUFrQyxDQUFDO0FBQ3ZFLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxZQUFZLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUM1RSxPQUFPLEVBQUUsY0FBYyxFQUFFLGdCQUFnQixFQUFFLGFBQWEsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBS3RGOzs7R0FHRztBQUNIO0lBbUJFLHlCQUFvQixJQUFxQjtRQUF6QyxpQkFVQztRQVZtQixTQUFJLEdBQUosSUFBSSxDQUFpQjtRQWhCakMsdUJBQWtCLEdBQUcsS0FBSyxDQUFDO1FBaUJqQyxJQUFJLENBQUMsSUFBSSxFQUFFO1lBQ1QsTUFBTSxJQUFJLEtBQUssQ0FBQyxvR0FBb0csQ0FBQyxDQUFDO1NBQ3ZIO1FBQ0QsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDO1FBQ3RCLElBQUksQ0FBQyxXQUFXLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFVBQVUsRUFBRSxJQUFJLEVBQUUsQ0FBZSxDQUFDO1FBQ2hFLElBQUksQ0FBQyxhQUFhLEdBQUcsSUFBSSxLQUFLLENBQUMsWUFBWSxFQUFFLENBQUM7UUFDOUMsSUFBSSxDQUFDLGlCQUFpQixHQUFHLElBQUksbUJBQW1CLEVBQUUsQ0FBQztRQUNuRCxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDWixJQUFJLENBQUMsYUFBYSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLGlCQUFpQixFQUFFLGNBQU0sT0FB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b0IsQ0FBQyxZQUFZO1lBQy9DLFFBQVEsRUFBRSxvQkFBb0IsQ0FBQyxRQUFRO1lBQ3ZDLFNBQVMsRUFBRSxPQUFPLGVBQWUsS0FBSyxVQUFVLENBQUMsQ0FBQyxDQUFDLGVBQWUsQ0FBQyxDQUFDLENBQUMsb0JBQW9CLENBQUMsU0FBUztTQUNwRyxDQUFDO1FBRUYsUUFBUSxvQkFBb0IsQ0FBQyxJQUFJLEVBQUU7WUFDakMsS0FBSyxPQUFPO2dCQUNWLE9BQU8sY0FBYyxDQUFDLFVBQVUsdUJBQzNCLG9CQUFvQixJQUN2QixPQUFPLEVBQUUsSUFBSSxDQUFDLGdCQUFnQixDQUFDLFFBQVEsQ0FBQyxFQUN4QyxRQUFRLEVBQUUsb0JBQW9CLENBQUMsUUFBUSxFQUN2QyxRQUFRLEVBQUUsb0JBQW9CLENBQUMsUUFBUSxFQUN2Qyx1QkFBdUIsRUFBRSxvQkFBb0IsQ0FBQyx1QkFBdUIsSUFDckUsQ0FBQztZQUNMLEtBQUssU0FBUztnQkFDWixPQUFPLGdCQUFnQixDQUFDLFVBQVUsdUJBQzdCLG9CQUFvQixJQUN2QixRQUFRLEVBQUUsb0JBQW9CLENBQUMsUUFBUSxFQUN2QyxRQUFRLEVBQUUsb0JBQW9CLENBQUMsUUFBUSxFQUN2Qyx1QkFBdUIsRUFBRSxvQkFBb0IsQ0FBQyx1QkFBdUIsSUFDckUsQ0FBQztZQUNMLEtBQUssTUFBTSxDQUFDO1lBQ1osS0FBSyxVQUFVLENBQUM7WUFDaEI7Z0JBQ0UsT0FBTyxhQUFhLENBQUMsVUFBVSxFQUFFLG9CQUFvQixDQUFDLENBQUM7U0FDMUQ7SUFDSCxDQUFDO0lBQ0gsc0JBQUM7QUFBRCxDQUFDLEFBNVhELElBNFhDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcclxuICBET01FdmVudCxcclxuICBDb2x1bW4sXHJcbiAgQ29sdW1uRWRpdG9yLFxyXG4gIENvbHVtbkVkaXRvckR1YWxJbnB1dCxcclxuICBFZGl0b3IsXHJcbiAgRWRpdG9yQXJndW1lbnRzLFxyXG4gIEVkaXRvclZhbGlkYXRvcixcclxuICBFZGl0b3JWYWxpZGF0b3JPdXRwdXQsXHJcbiAgR3JpZE9wdGlvbixcclxuICBLZXlDb2RlLFxyXG4gIFNsaWNrRXZlbnRIYW5kbGVyLFxyXG59IGZyb20gJy4uL21vZGVscy9pbmRleCc7XHJcbmltcG9ydCB7IEJpbmRpbmdFdmVudFNlcnZpY2UgfSBmcm9tICcuLi9zZXJ2aWNlcy9iaW5kaW5nRXZlbnQuc2VydmljZSc7XHJcbmltcG9ydCB7IGdldERlc2NlbmRhbnRQcm9wZXJ0eSwgc2V0RGVlcFZhbHVlIH0gZnJvbSAnLi4vc2VydmljZXMvdXRpbGl0aWVzJztcclxuaW1wb3J0IHsgZmxvYXRWYWxpZGF0b3IsIGludGVnZXJWYWxpZGF0b3IsIHRleHRWYWxpZGF0b3IgfSBmcm9tICcuLi9lZGl0b3JWYWxpZGF0b3JzJztcclxuXHJcbi8vIHVzaW5nIGV4dGVybmFsIG5vbi10eXBlZCBqcyBsaWJyYXJpZXNcclxuZGVjbGFyZSBjb25zdCBTbGljazogYW55O1xyXG5cclxuLypcclxuICogQW4gZXhhbXBsZSBvZiBhICdkZXRhY2hlZCcgZWRpdG9yLlxyXG4gKiBLZXlEb3duIGV2ZW50cyBhcmUgYWxzbyBoYW5kbGVkIHRvIHByb3ZpZGUgaGFuZGxpbmcgZm9yIFRhYiwgU2hpZnQtVGFiLCBFc2MgYW5kIEN0cmwtRW50ZXIuXHJcbiAqL1xyXG5leHBvcnQgY2xhc3MgRHVhbElucHV0RWRpdG9yIGltcGxlbWVudHMgRWRpdG9yIHtcclxuICBwcml2YXRlIF9iaW5kRXZlbnRTZXJ2aWNlOiBCaW5kaW5nRXZlbnRTZXJ2aWNlO1xyXG4gIHByaXZhdGUgX2V2ZW50SGFuZGxlcjogU2xpY2tFdmVudEhhbmRsZXI7XHJcbiAgcHJpdmF0ZSBfaXNWYWx1ZVNhdmVDYWxsZWQgPSBmYWxzZTtcclxuICBwcml2YXRlIF9sYXN0RXZlbnRUeXBlOiBzdHJpbmcgfCB1bmRlZmluZWQ7XHJcbiAgcHJpdmF0ZSBfbGFzdElucHV0S2V5RXZlbnQ6IEpRdWVyeS5FdmVudDtcclxuICBwcml2YXRlIF9sZWZ0SW5wdXQ6IEhUTUxJbnB1dEVsZW1lbnQ7XHJcbiAgcHJpdmF0ZSBfcmlnaHRJbnB1dDogSFRNTElucHV0RWxlbWVudDtcclxuICBwcml2YXRlIF9sZWZ0RmllbGROYW1lOiBzdHJpbmc7XHJcbiAgcHJpdmF0ZSBfcmlnaHRGaWVsZE5hbWU6IHN0cmluZztcclxuICBvcmlnaW5hbExlZnRWYWx1ZTogc3RyaW5nIHwgbnVtYmVyO1xyXG4gIG9yaWdpbmFsUmlnaHRWYWx1ZTogc3RyaW5nIHwgbnVtYmVyO1xyXG5cclxuICAvKiogU2xpY2tHcmlkIEdyaWQgb2JqZWN0ICovXHJcbiAgZ3JpZDogYW55O1xyXG5cclxuICAvKiogR3JpZCBvcHRpb25zICovXHJcbiAgZ3JpZE9wdGlvbnM6IEdyaWRPcHRpb247XHJcblxyXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgYXJnczogRWRpdG9yQXJndW1lbnRzKSB7XHJcbiAgICBpZiAoIWFyZ3MpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdbQW5ndWxhci1TbGlja2dyaWRdIFNvbWV0aGluZyBpcyB3cm9uZyB3aXRoIHRoaXMgZ3JpZCwgYW4gRWRpdG9yIG11c3QgYWx3YXlzIGhhdmUgdmFsaWQgYXJndW1lbnRzLicpO1xyXG4gICAgfVxyXG4gICAgdGhpcy5ncmlkID0gYXJncy5ncmlkO1xyXG4gICAgdGhpcy5ncmlkT3B0aW9ucyA9ICh0aGlzLmdyaWQuZ2V0T3B0aW9ucygpIHx8IHt9KSBhcyBHcmlkT3B0aW9uO1xyXG4gICAgdGhpcy5fZXZlbnRIYW5kbGVyID0gbmV3IFNsaWNrLkV2ZW50SGFuZGxlcigpO1xyXG4gICAgdGhpcy5fYmluZEV2ZW50U2VydmljZSA9IG5ldyBCaW5kaW5nRXZlbnRTZXJ2aWNlKCk7XHJcbiAgICB0aGlzLmluaXQoKTtcclxuICAgIHRoaXMuX2V2ZW50SGFuZGxlci5zdWJzY3JpYmUodGhpcy5ncmlkLm9uVmFsaWRhdGlvbkVycm9yLCAoKSA9PiB0aGlzLl9pc1ZhbHVlU2F2ZUNhbGxlZCA9IHRydWUpO1xyXG4gIH1cclxuXHJcbiAgLyoqIEdldCBDb2x1bW4gRGVmaW5pdGlvbiBvYmplY3QgKi9cclxuICBnZXQgY29sdW1uRGVmKCk6IENvbHVtbiB8IHVuZGVmaW5lZCB7XHJcbiAgICByZXR1cm4gdGhpcy5hcmdzICYmIHRoaXMuYXJncy5jb2x1bW47XHJcbiAgfVxyXG5cclxuICAvKiogR2V0IENvbHVtbiBFZGl0b3Igb2JqZWN0ICovXHJcbiAgZ2V0IGNvbHVtbkVkaXRvcigpOiBDb2x1bW5FZGl0b3Ige1xyXG4gICAgcmV0dXJuIHRoaXMuY29sdW1uRGVmICYmIHRoaXMuY29sdW1uRGVmLmludGVybmFsQ29sdW1uRWRpdG9yIHx8IHt9O1xyXG4gIH1cclxuXHJcbiAgLyoqIEdldCB0aGUgRWRpdG9yIERPTSBFbGVtZW50ICovXHJcbiAgZ2V0IGVkaXRvckRvbUVsZW1lbnQoKTogeyBsZWZ0SW5wdXQ6IEhUTUxJbnB1dEVsZW1lbnQsIHJpZ2h0SW5wdXQ6IEhUTUxJbnB1dEVsZW1lbnQgfSB7XHJcbiAgICByZXR1cm4geyBsZWZ0SW5wdXQ6IHRoaXMuX2xlZnRJbnB1dCwgcmlnaHRJbnB1dDogdGhpcy5fcmlnaHRJbnB1dCB9O1xyXG4gIH1cclxuXHJcbiAgZ2V0IGVkaXRvclBhcmFtcygpOiBDb2x1bW5FZGl0b3JEdWFsSW5wdXQge1xyXG4gICAgcmV0dXJuIHRoaXMuY29sdW1uRWRpdG9yLnBhcmFtcyB8fCB7fTtcclxuICB9XHJcblxyXG4gIGdldCBldmVudEhhbmRsZXIoKTogU2xpY2tFdmVudEhhbmRsZXIge1xyXG4gICAgcmV0dXJuIHRoaXMuX2V2ZW50SGFuZGxlcjtcclxuICB9XHJcblxyXG4gIGdldCBoYXNBdXRvQ29tbWl0RWRpdCgpIHtcclxuICAgIHJldHVybiB0aGlzLmdyaWQuZ2V0T3B0aW9ucygpLmF1dG9Db21taXRFZGl0O1xyXG4gIH1cclxuXHJcbiAgZ2V0IGlzVmFsdWVTYXZlQ2FsbGVkKCk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIHRoaXMuX2lzVmFsdWVTYXZlQ2FsbGVkO1xyXG4gIH1cclxuXHJcbiAgLyoqIEdldCB0aGUgU2hhcmVkIFZhbGlkYXRvciBmdW5jdGlvbiwgY2FuIGJlIHBhc3NlZCBpbiBFZGl0b3IgcHJvcGVydHkgb3IgQ29sdW1uIERlZmluaXRpb24gKi9cclxuICBnZXQgdmFsaWRhdG9yKCk6IEVkaXRvclZhbGlkYXRvciB8IHVuZGVmaW5lZCB7XHJcbiAgICByZXR1cm4gKHRoaXMuY29sdW1uRWRpdG9yICYmIHRoaXMuY29sdW1uRWRpdG9yLnZhbGlkYXRvcikgfHwgKHRoaXMuY29sdW1uRGVmICYmIHRoaXMuY29sdW1uRGVmLnZhbGlkYXRvcik7XHJcbiAgfVxyXG5cclxuICBpbml0KCkge1xyXG4gICAgaWYgKCF0aGlzLmVkaXRvclBhcmFtcyB8fCAhdGhpcy5lZGl0b3JQYXJhbXMubGVmdElucHV0IHx8ICF0aGlzLmVkaXRvclBhcmFtcy5sZWZ0SW5wdXQuZmllbGQgfHwgIXRoaXMuZWRpdG9yUGFyYW1zLnJpZ2h0SW5wdXQgfHwgIXRoaXMuZWRpdG9yUGFyYW1zLnJpZ2h0SW5wdXQuZmllbGQpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKGBbQW5ndWxhci1TbGlja2dyaWRdIFBsZWFzZSBtYWtlIHN1cmUgdGhhdCB5b3VyIENvbWJvIElucHV0IEVkaXRvciBoYXMgcGFyYW1zIGRlZmluZWQgd2l0aCBcImxlZnRJbnB1dFwiIGFuZCBcInJpZ2h0SW5wdXRcIiAoZXhhbXBsZTogeyBlZGl0b3I6IHsgbW9kZWw6IEVkaXRvcnMuY29tYm9JbnB1dCwgcGFyYW1zOiB7IGxlZnRJbnB1dDogeyBmaWVsZDogJ2ZpcnN0TmFtZScgfSwgeyByaWdodFNpZGU6IHsgZmllbGQ6ICdsYXN0TmFtZScgfSB9fX1gKTtcclxuICAgIH1cclxuICAgIHRoaXMuX2xlZnRGaWVsZE5hbWUgPSB0aGlzLmVkaXRvclBhcmFtcyAmJiB0aGlzLmVkaXRvclBhcmFtcy5sZWZ0SW5wdXQgJiYgdGhpcy5lZGl0b3JQYXJhbXMubGVmdElucHV0LmZpZWxkO1xyXG4gICAgdGhpcy5fcmlnaHRGaWVsZE5hbWUgPSB0aGlzLmVkaXRvclBhcmFtcyAmJiB0aGlzLmVkaXRvclBhcmFtcy5yaWdodElucHV0ICYmIHRoaXMuZWRpdG9yUGFyYW1zLnJpZ2h0SW5wdXQuZmllbGQ7XHJcbiAgICB0aGlzLl9sZWZ0SW5wdXQgPSB0aGlzLmNyZWF0ZUlucHV0KCdsZWZ0SW5wdXQnKTtcclxuICAgIHRoaXMuX3JpZ2h0SW5wdXQgPSB0aGlzLmNyZWF0ZUlucHV0KCdyaWdodElucHV0Jyk7XHJcblxyXG4gICAgY29uc3QgY29udGFpbmVyRWxtID0gdGhpcy5hcmdzLmNvbnRhaW5lcjtcclxuICAgIGlmIChjb250YWluZXJFbG0gJiYgdHlwZW9mIGNvbnRhaW5lckVsbS5hcHBlbmRDaGlsZCA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICBjb250YWluZXJFbG0uYXBwZW5kQ2hpbGQodGhpcy5fbGVmdElucHV0KTtcclxuICAgICAgY29udGFpbmVyRWxtLmFwcGVuZENoaWxkKHRoaXMuX3JpZ2h0SW5wdXQpO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuX2xlZnRJbnB1dC5vbmtleWRvd24gPSB0aGlzLmhhbmRsZUtleURvd24uYmluZCh0aGlzKTtcclxuICAgIHRoaXMuX3JpZ2h0SW5wdXQub25rZXlkb3duID0gdGhpcy5oYW5kbGVLZXlEb3duLmJpbmQodGhpcyk7XHJcblxyXG4gICAgLy8gdGhlIGxpYiBkb2VzIG5vdCBnZXQgdGhlIGZvY3VzIG91dCBldmVudCBmb3Igc29tZSByZWFzb24sIHNvIHJlZ2lzdGVyIGl0IGhlcmVcclxuICAgIGlmICh0aGlzLmhhc0F1dG9Db21taXRFZGl0KSB7XHJcbiAgICAgIHRoaXMuX2JpbmRFdmVudFNlcnZpY2UuYmluZCh0aGlzLl9sZWZ0SW5wdXQsICdmb2N1c291dCcsIChldmVudDogRE9NRXZlbnQ8SFRNTElucHV0RWxlbWVudD4pID0+IHRoaXMuaGFuZGxlRm9jdXNPdXQoZXZlbnQsICdsZWZ0SW5wdXQnKSk7XHJcbiAgICAgIHRoaXMuX2JpbmRFdmVudFNlcnZpY2UuYmluZCh0aGlzLl9yaWdodElucHV0LCAnZm9jdXNvdXQnLCAoZXZlbnQ6IERPTUV2ZW50PEhUTUxJbnB1dEVsZW1lbnQ+KSA9PiB0aGlzLmhhbmRsZUZvY3VzT3V0KGV2ZW50LCAncmlnaHRJbnB1dCcpKTtcclxuICAgIH1cclxuXHJcbiAgICBzZXRUaW1lb3V0KCgpID0+IHRoaXMuX2xlZnRJbnB1dC5zZWxlY3QoKSwgNTApO1xyXG4gIH1cclxuXHJcbiAgaGFuZGxlRm9jdXNPdXQoZXZlbnQ6IERPTUV2ZW50PEhUTUxJbnB1dEVsZW1lbnQ+LCBwb3NpdGlvbjogJ2xlZnRJbnB1dCcgfCAncmlnaHRJbnB1dCcpIHtcclxuICAgIC8vIHdoZW4gY2xpY2tpbmcgb3V0c2lkZSB0aGUgZWRpdGFibGUgY2VsbCBPUiB3aGVuIGZvY3VzaW5nIG91dCBvZiBpdFxyXG4gICAgY29uc3QgdGFyZ2V0Q2xhc3NOYW1lcyA9IGV2ZW50LnJlbGF0ZWRUYXJnZXQgJiYgZXZlbnQucmVsYXRlZFRhcmdldC5jbGFzc05hbWUgfHwgJyc7XHJcbiAgICBpZiAodGFyZ2V0Q2xhc3NOYW1lcy5pbmRleE9mKCdkdWFsLWVkaXRvcicpID09PSAtMSAmJiB0aGlzLl9sYXN0RXZlbnRUeXBlICE9PSAnZm9jdXNvdXQtcmlnaHQnKSB7XHJcbiAgICAgIGlmIChwb3NpdGlvbiA9PT0gJ3JpZ2h0SW5wdXQnIHx8IChwb3NpdGlvbiA9PT0gJ2xlZnRJbnB1dCcgJiYgdGhpcy5fbGFzdEV2ZW50VHlwZSAhPT0gJ2ZvY3Vzb3V0LWxlZnQnKSkge1xyXG4gICAgICAgIHRoaXMuc2F2ZSgpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBjb25zdCBzaWRlID0gKHBvc2l0aW9uID09PSAnbGVmdElucHV0JykgPyAnbGVmdCcgOiAncmlnaHQnO1xyXG4gICAgdGhpcy5fbGFzdEV2ZW50VHlwZSA9IGAke2V2ZW50ICYmIGV2ZW50LnR5cGV9LSR7c2lkZX1gO1xyXG4gIH1cclxuXHJcbiAgaGFuZGxlS2V5RG93bihldmVudDogSlF1ZXJ5LkV2ZW50KSB7XHJcbiAgICB0aGlzLl9sYXN0SW5wdXRLZXlFdmVudCA9IGV2ZW50O1xyXG4gICAgaWYgKGV2ZW50LmtleUNvZGUgPT09IEtleUNvZGUuTEVGVCB8fCBldmVudC5rZXlDb2RlID09PSBLZXlDb2RlLlJJR0hUIHx8IGV2ZW50LmtleUNvZGUgPT09IEtleUNvZGUuVEFCKSB7XHJcbiAgICAgIGV2ZW50LnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgZGVzdHJveSgpIHtcclxuICAgIC8vIHVuc3Vic2NyaWJlIGFsbCBTbGlja0dyaWQgZXZlbnRzXHJcbiAgICB0aGlzLl9ldmVudEhhbmRsZXIudW5zdWJzY3JpYmVBbGwoKTtcclxuICAgIHRoaXMuX2JpbmRFdmVudFNlcnZpY2UudW5iaW5kQWxsKCk7XHJcbiAgfVxyXG5cclxuICBjcmVhdGVJbnB1dChwb3NpdGlvbjogJ2xlZnRJbnB1dCcgfCAncmlnaHRJbnB1dCcpOiBIVE1MSW5wdXRFbGVtZW50IHtcclxuICAgIGNvbnN0IGVkaXRvclNpZGVQYXJhbXMgPSB0aGlzLmVkaXRvclBhcmFtc1twb3NpdGlvbl07XHJcbiAgICBjb25zdCBjb2x1bW5JZCA9IHRoaXMuY29sdW1uRGVmICYmIHRoaXMuY29sdW1uRGVmLmlkO1xyXG4gICAgY29uc3QgaWRQcm9wTmFtZSA9IHRoaXMuZ3JpZE9wdGlvbnMuZGF0YXNldElkUHJvcGVydHlOYW1lIHx8ICdpZCc7XHJcbiAgICBjb25zdCBpdGVtSWQgPSB0aGlzLmFyZ3MgJiYgdGhpcy5hcmdzLml0ZW0gJiYgdGhpcy5hcmdzLml0ZW1baWRQcm9wTmFtZV0gfHwgMDtcclxuXHJcbiAgICBsZXQgZmllbGRUeXBlOiBzdHJpbmcgPSBlZGl0b3JTaWRlUGFyYW1zLnR5cGUgfHwgJ3RleHQnO1xyXG4gICAgaWYgKGZpZWxkVHlwZSA9PT0gJ2Zsb2F0JyB8fCBmaWVsZFR5cGUgPT09ICdpbnRlZ2VyJykge1xyXG4gICAgICBmaWVsZFR5cGUgPSAnbnVtYmVyJztcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBpbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0JykgYXMgSFRNTElucHV0RWxlbWVudDtcclxuICAgIGlucHV0LmlkID0gYGl0ZW0tJHtpdGVtSWR9LSR7cG9zaXRpb259YDtcclxuICAgIGlucHV0LmNsYXNzTmFtZSA9IGBkdWFsLWVkaXRvci10ZXh0IGVkaXRvci0ke2NvbHVtbklkfSAke3Bvc2l0aW9uLnJlcGxhY2UoL2lucHV0L2dpLCAnJyl9YDtcclxuICAgIGlmIChmaWVsZFR5cGUgPT09ICdyZWFkb25seScpIHtcclxuICAgICAgLy8gd2hlbiB0aGUgY3VzdG9tIHR5cGUgaXMgZGVmaW5lZCBhcyByZWFkb25seSwgd2UnbGwgbWFrZSBhIHJlYWRvbmx5IHRleHQgaW5wdXRcclxuICAgICAgaW5wdXQucmVhZE9ubHkgPSB0cnVlO1xyXG4gICAgICBmaWVsZFR5cGUgPSAndGV4dCc7XHJcbiAgICB9XHJcbiAgICBpbnB1dC50eXBlID0gZmllbGRUeXBlIHx8ICd0ZXh0JztcclxuICAgIGlucHV0LnNldEF0dHJpYnV0ZSgncm9sZScsICdwcmVzZW50YXRpb24nKTtcclxuICAgIGlucHV0LmF1dG9jb21wbGV0ZSA9ICdvZmYnO1xyXG4gICAgaW5wdXQucGxhY2Vob2xkZXIgPSBlZGl0b3JTaWRlUGFyYW1zLnBsYWNlaG9sZGVyIHx8ICcnO1xyXG4gICAgaW5wdXQudGl0bGUgPSBlZGl0b3JTaWRlUGFyYW1zLnRpdGxlIHx8ICcnO1xyXG4gICAgaWYgKGZpZWxkVHlwZSA9PT0gJ251bWJlcicpIHtcclxuICAgICAgaW5wdXQuc3RlcCA9IHRoaXMuZ2V0SW5wdXREZWNpbWFsU3RlcHMocG9zaXRpb24pO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGlucHV0O1xyXG4gIH1cclxuXHJcbiAgZm9jdXMoKSB7XHJcbiAgICAvLyBkbyBub3RoaW5nIHNpbmNlIHdlIGhhdmUgMiBpbnB1dHMgYW5kIHdlIG1pZ2h0IGZvY3VzIG9uIGxlZnQvcmlnaHQgZGVwZW5kaW5nIG9uIHdoaWNoIGlzIGludmFsaWQgYW5kL29yIG5ld1xyXG4gIH1cclxuXHJcbiAgZ2V0VmFsdWVzKCk6IHsgW2ZpZWxkTmFtZTogc3RyaW5nXTogc3RyaW5nIHwgbnVtYmVyIH0ge1xyXG4gICAgY29uc3Qgb2JqID0ge307XHJcbiAgICBjb25zdCBsZWZ0SW5wdXRWYWx1ZSA9IHRoaXMuX2xlZnRJbnB1dC52YWx1ZTtcclxuICAgIGNvbnN0IHJpZ2h0SW5wdXRWYWx1ZSA9IHRoaXMuX3JpZ2h0SW5wdXQudmFsdWU7XHJcbiAgICBjb25zdCBpc0xlZnRJbnB1dFR5cGVOdW1iZXIgPSAodGhpcy5lZGl0b3JQYXJhbXMubGVmdElucHV0ICYmICh0aGlzLmVkaXRvclBhcmFtcy5sZWZ0SW5wdXQudHlwZSA9PT0gJ2Zsb2F0JyB8fCB0aGlzLmVkaXRvclBhcmFtcy5sZWZ0SW5wdXQudHlwZSA9PT0gJ2ludGVnZXInKSk7XHJcbiAgICBjb25zdCBpc1JpZ2h0SW5wdXRUeXBlTnVtYmVyID0gKHRoaXMuZWRpdG9yUGFyYW1zLnJpZ2h0SW5wdXQgJiYgKHRoaXMuZWRpdG9yUGFyYW1zLnJpZ2h0SW5wdXQudHlwZSA9PT0gJ2Zsb2F0JyB8fCB0aGlzLmVkaXRvclBhcmFtcy5yaWdodElucHV0LnR5cGUgPT09ICdpbnRlZ2VyJykpO1xyXG4gICAgY29uc3QgcmVzdWx0TGVmdFZhbHVlID0gKGxlZnRJbnB1dFZhbHVlICE9PSAnJyAmJiBpc0xlZnRJbnB1dFR5cGVOdW1iZXIpID8gK3RoaXMuX2xlZnRJbnB1dC52YWx1ZSA6IChsZWZ0SW5wdXRWYWx1ZSB8fCAnJyk7XHJcbiAgICBjb25zdCByZXN1bHRSaWdodFZhbHVlID0gKHJpZ2h0SW5wdXRWYWx1ZSAhPT0gJycgJiYgaXNSaWdodElucHV0VHlwZU51bWJlcikgPyArdGhpcy5fcmlnaHRJbnB1dC52YWx1ZSA6IChyaWdodElucHV0VmFsdWUgfHwgJycpO1xyXG4gICAgc2V0RGVlcFZhbHVlKG9iaiwgdGhpcy5fbGVmdEZpZWxkTmFtZSwgcmVzdWx0TGVmdFZhbHVlKTtcclxuICAgIHNldERlZXBWYWx1ZShvYmosIHRoaXMuX3JpZ2h0RmllbGROYW1lLCByZXN1bHRSaWdodFZhbHVlKTtcclxuXHJcbiAgICByZXR1cm4gb2JqO1xyXG4gIH1cclxuXHJcbiAgc2V0VmFsdWVzKHZhbHVlczogQXJyYXk8bnVtYmVyIHwgc3RyaW5nPikge1xyXG4gICAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWVzKSAmJiB2YWx1ZXMubGVuZ3RoID09PSAyKSB7XHJcbiAgICAgIHRoaXMuX2xlZnRJbnB1dC52YWx1ZSA9IGAke3ZhbHVlc1swXX1gO1xyXG4gICAgICB0aGlzLl9yaWdodElucHV0LnZhbHVlID0gYCR7dmFsdWVzWzFdfWA7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBhcHBseVZhbHVlKGl0ZW06IGFueSwgc3RhdGU6IGFueSkge1xyXG4gICAgdGhpcy5hcHBseVZhbHVlQnlQb3NpdGlvbihpdGVtLCBzdGF0ZSwgJ2xlZnRJbnB1dCcpO1xyXG4gICAgdGhpcy5hcHBseVZhbHVlQnlQb3NpdGlvbihpdGVtLCBzdGF0ZSwgJ3JpZ2h0SW5wdXQnKTtcclxuICB9XHJcblxyXG4gIGFwcGx5VmFsdWVCeVBvc2l0aW9uKGl0ZW06IGFueSwgc3RhdGU6IGFueSwgcG9zaXRpb246ICdsZWZ0SW5wdXQnIHwgJ3JpZ2h0SW5wdXQnKSB7XHJcbiAgICBjb25zdCBmaWVsZE5hbWUgPSBwb3NpdGlvbiA9PT0gJ2xlZnRJbnB1dCcgPyB0aGlzLl9sZWZ0RmllbGROYW1lIDogdGhpcy5fcmlnaHRGaWVsZE5hbWU7XHJcbiAgICBpZiAoZmllbGROYW1lICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgY29uc3QgaXNDb21wbGV4T2JqZWN0ID0gZmllbGROYW1lICYmIGZpZWxkTmFtZS5pbmRleE9mKCcuJykgPiAwOyAvLyBpcyB0aGUgZmllbGQgYSBjb21wbGV4IG9iamVjdCwgXCJhZGRyZXNzLnN0cmVldE51bWJlclwiXHJcblxyXG4gICAgICBsZXQgZmllbGROYW1lVG9Vc2UgPSBmaWVsZE5hbWU7XHJcbiAgICAgIGlmIChpc0NvbXBsZXhPYmplY3QpIHtcclxuICAgICAgICBjb25zdCBjb21wbGV4RmllbGROYW1lcyA9IGZpZWxkTmFtZS5zcGxpdCgvXFwuKC4qKS8pO1xyXG4gICAgICAgIGZpZWxkTmFtZVRvVXNlID0gKGNvbXBsZXhGaWVsZE5hbWVzLmxlbmd0aCA+IDEgPyBjb21wbGV4RmllbGROYW1lc1sxXSA6IGNvbXBsZXhGaWVsZE5hbWVzKSBhcyBzdHJpbmc7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIHZhbGlkYXRlIHRoZSB2YWx1ZSBiZWZvcmUgYXBwbHlpbmcgaXQgKGlmIG5vdCB2YWxpZCB3ZSdsbCBzZXQgYW4gZW1wdHkgc3RyaW5nKVxyXG4gICAgICBjb25zdCBzdGF0ZVZhbHVlID0gaXNDb21wbGV4T2JqZWN0ID8gZ2V0RGVzY2VuZGFudFByb3BlcnR5KHN0YXRlLCBmaWVsZE5hbWVUb1VzZSkgOiBzdGF0ZVtmaWVsZE5hbWVdO1xyXG4gICAgICBjb25zdCB2YWxpZGF0aW9uID0gdGhpcy52YWxpZGF0ZSh7IHBvc2l0aW9uLCBpbnB1dFZhbHVlOiBzdGF0ZVZhbHVlIH0pO1xyXG5cclxuICAgICAgLy8gc2V0IHRoZSBuZXcgdmFsdWUgdG8gdGhlIGl0ZW0gZGF0YWNvbnRleHRcclxuICAgICAgaWYgKGlzQ29tcGxleE9iamVjdCkge1xyXG4gICAgICAgIGNvbnN0IG5ld1ZhbHVlRnJvbUNvbXBsZXggPSBnZXREZXNjZW5kYW50UHJvcGVydHkoc3RhdGUsIGZpZWxkTmFtZVRvVXNlKTtcclxuICAgICAgICBjb25zdCBuZXdWYWx1ZSA9ICh2YWxpZGF0aW9uICYmIHZhbGlkYXRpb24udmFsaWQpID8gbmV3VmFsdWVGcm9tQ29tcGxleCA6ICcnO1xyXG4gICAgICAgIHNldERlZXBWYWx1ZShpdGVtLCBmaWVsZE5hbWUsIG5ld1ZhbHVlKTtcclxuICAgICAgfSBlbHNlIGlmIChmaWVsZE5hbWUpIHtcclxuICAgICAgICBpdGVtW2ZpZWxkTmFtZV0gPSAodmFsaWRhdGlvbiAmJiB2YWxpZGF0aW9uLnZhbGlkKSA/IHN0YXRlW2ZpZWxkTmFtZV0gOiAnJztcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgaXNWYWx1ZUNoYW5nZWQoKTogYm9vbGVhbiB7XHJcbiAgICBjb25zdCBsZWZ0RWxtVmFsdWUgPSB0aGlzLl9sZWZ0SW5wdXQudmFsdWU7XHJcbiAgICBjb25zdCByaWdodEVsbVZhbHVlID0gdGhpcy5fcmlnaHRJbnB1dC52YWx1ZTtcclxuICAgIGNvbnN0IGxlZnRFZGl0b3JQYXJhbXMgPSB0aGlzLmVkaXRvclBhcmFtcyAmJiB0aGlzLmVkaXRvclBhcmFtcy5sZWZ0SW5wdXQ7XHJcbiAgICBjb25zdCByaWdodEVkaXRvclBhcmFtcyA9IHRoaXMuZWRpdG9yUGFyYW1zICYmIHRoaXMuZWRpdG9yUGFyYW1zLnJpZ2h0SW5wdXQ7XHJcbiAgICBjb25zdCBsYXN0S2V5RXZlbnQgPSB0aGlzLl9sYXN0SW5wdXRLZXlFdmVudCAmJiB0aGlzLl9sYXN0SW5wdXRLZXlFdmVudC5rZXlDb2RlO1xyXG4gICAgaWYgKChsZWZ0RWRpdG9yUGFyYW1zICYmIGxlZnRFZGl0b3JQYXJhbXMuYWx3YXlzU2F2ZU9uRW50ZXJLZXkgfHwgcmlnaHRFZGl0b3JQYXJhbXMgJiYgcmlnaHRFZGl0b3JQYXJhbXMuYWx3YXlzU2F2ZU9uRW50ZXJLZXkpICYmIGxhc3RLZXlFdmVudCA9PT0gS2V5Q29kZS5FTlRFUikge1xyXG4gICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuICAgIGNvbnN0IGxlZnRSZXN1bHQgPSAoIShsZWZ0RWxtVmFsdWUgPT09ICcnICYmICh0aGlzLm9yaWdpbmFsTGVmdFZhbHVlID09PSBudWxsIHx8IHRoaXMub3JpZ2luYWxMZWZ0VmFsdWUgPT09IHVuZGVmaW5lZCkpKSAmJiAobGVmdEVsbVZhbHVlICE9PSB0aGlzLm9yaWdpbmFsTGVmdFZhbHVlKTtcclxuICAgIGNvbnN0IHJpZ2h0UmVzdWx0ID0gKCEocmlnaHRFbG1WYWx1ZSA9PT0gJycgJiYgKHRoaXMub3JpZ2luYWxSaWdodFZhbHVlID09PSBudWxsIHx8IHRoaXMub3JpZ2luYWxSaWdodFZhbHVlID09PSB1bmRlZmluZWQpKSkgJiYgKHJpZ2h0RWxtVmFsdWUgIT09IHRoaXMub3JpZ2luYWxSaWdodFZhbHVlKTtcclxuICAgIHJldHVybiBsZWZ0UmVzdWx0IHx8IHJpZ2h0UmVzdWx0O1xyXG4gIH1cclxuXHJcbiAgbG9hZFZhbHVlKGl0ZW06IGFueSkge1xyXG4gICAgdGhpcy5sb2FkVmFsdWVCeVBvc2l0aW9uKGl0ZW0sICdsZWZ0SW5wdXQnKTtcclxuICAgIHRoaXMubG9hZFZhbHVlQnlQb3NpdGlvbihpdGVtLCAncmlnaHRJbnB1dCcpO1xyXG4gICAgdGhpcy5fbGVmdElucHV0LnNlbGVjdCgpO1xyXG4gIH1cclxuXHJcbiAgbG9hZFZhbHVlQnlQb3NpdGlvbihpdGVtOiBhbnksIHBvc2l0aW9uOiAnbGVmdElucHV0JyB8ICdyaWdodElucHV0Jykge1xyXG4gICAgLy8gaXMgdGhlIGZpZWxkIGEgY29tcGxleCBvYmplY3QsIFwiYWRkcmVzcy5zdHJlZXROdW1iZXJcIlxyXG4gICAgY29uc3QgZmllbGROYW1lID0gKHBvc2l0aW9uID09PSAnbGVmdElucHV0JykgPyB0aGlzLl9sZWZ0RmllbGROYW1lIDogdGhpcy5fcmlnaHRGaWVsZE5hbWU7XHJcbiAgICBjb25zdCBvcmlnaW5hbFZhbHVlUG9zaXRpb24gPSAocG9zaXRpb24gPT09ICdsZWZ0SW5wdXQnKSA/ICdvcmlnaW5hbExlZnRWYWx1ZScgOiAnb3JpZ2luYWxSaWdodFZhbHVlJztcclxuICAgIGNvbnN0IGlucHV0VmFyUG9zaXRpb24gPSAocG9zaXRpb24gPT09ICdsZWZ0SW5wdXQnKSA/ICdfbGVmdElucHV0JyA6ICdfcmlnaHRJbnB1dCc7XHJcblxyXG4gICAgaWYgKGl0ZW0gJiYgZmllbGROYW1lICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgY29uc3QgaXNDb21wbGV4T2JqZWN0ID0gZmllbGROYW1lICYmIGZpZWxkTmFtZS5pbmRleE9mKCcuJykgPiAwO1xyXG4gICAgICBjb25zdCBpdGVtVmFsdWUgPSAoaXNDb21wbGV4T2JqZWN0KSA/IGdldERlc2NlbmRhbnRQcm9wZXJ0eShpdGVtLCBmaWVsZE5hbWUpIDogKGl0ZW0uaGFzT3duUHJvcGVydHkoZmllbGROYW1lKSA/IGl0ZW1bZmllbGROYW1lXSA6ICcnKTtcclxuICAgICAgdGhpc1tvcmlnaW5hbFZhbHVlUG9zaXRpb25dID0gaXRlbVZhbHVlO1xyXG4gICAgICBpZiAodGhpcy5lZGl0b3JQYXJhbXNbcG9zaXRpb25dLnR5cGUgPT09ICdmbG9hdCcpIHtcclxuICAgICAgICBjb25zdCBkZWNpbWFsUGxhY2VzID0gdGhpcy5nZXREZWNpbWFsUGxhY2VzKHBvc2l0aW9uKTtcclxuICAgICAgICBpZiAoZGVjaW1hbFBsYWNlcyAhPT0gbnVsbCAmJiAodGhpc1tvcmlnaW5hbFZhbHVlUG9zaXRpb25dIHx8IHRoaXNbb3JpZ2luYWxWYWx1ZVBvc2l0aW9uXSA9PT0gMCkgJiYgKCt0aGlzW29yaWdpbmFsVmFsdWVQb3NpdGlvbl0pLnRvRml4ZWQpIHtcclxuICAgICAgICAgIHRoaXNbb3JpZ2luYWxWYWx1ZVBvc2l0aW9uXSA9ICgrdGhpc1tvcmlnaW5hbFZhbHVlUG9zaXRpb25dKS50b0ZpeGVkKGRlY2ltYWxQbGFjZXMpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICBpZiAodGhpc1tpbnB1dFZhclBvc2l0aW9uXSkge1xyXG4gICAgICAgIGNvbnN0IG9yaWdpbmFsVmFsdWUgPSB0aGlzW29yaWdpbmFsVmFsdWVQb3NpdGlvbl07XHJcbiAgICAgICAgdGhpc1tpbnB1dFZhclBvc2l0aW9uXS52YWx1ZSA9IGAke29yaWdpbmFsVmFsdWV9YDtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgc2F2ZSgpIHtcclxuICAgIGNvbnN0IHZhbGlkYXRpb24gPSB0aGlzLnZhbGlkYXRlKCk7XHJcbiAgICBjb25zdCBpc1ZhbGlkID0gKHZhbGlkYXRpb24gJiYgdmFsaWRhdGlvbi52YWxpZCkgfHwgZmFsc2U7XHJcblxyXG4gICAgaWYgKCF0aGlzLl9pc1ZhbHVlU2F2ZUNhbGxlZCkge1xyXG4gICAgICBpZiAodGhpcy5oYXNBdXRvQ29tbWl0RWRpdCAmJiBpc1ZhbGlkKSB7XHJcbiAgICAgICAgdGhpcy5ncmlkLmdldEVkaXRvckxvY2soKS5jb21taXRDdXJyZW50RWRpdCgpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRoaXMuYXJncy5jb21taXRDaGFuZ2VzKCk7XHJcbiAgICAgIH1cclxuICAgICAgdGhpcy5faXNWYWx1ZVNhdmVDYWxsZWQgPSB0cnVlO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgc2VyaWFsaXplVmFsdWUoKSB7XHJcbiAgICBjb25zdCBvYmogPSB7fTtcclxuICAgIGNvbnN0IGxlZnRWYWx1ZSA9IHRoaXMuc2VyaWFsaXplVmFsdWVCeVBvc2l0aW9uKCdsZWZ0SW5wdXQnKTtcclxuICAgIGNvbnN0IHJpZ2h0VmFsdWUgPSB0aGlzLnNlcmlhbGl6ZVZhbHVlQnlQb3NpdGlvbigncmlnaHRJbnB1dCcpO1xyXG5cclxuICAgIHNldERlZXBWYWx1ZShvYmosIHRoaXMuX2xlZnRGaWVsZE5hbWUsIGxlZnRWYWx1ZSk7XHJcbiAgICBzZXREZWVwVmFsdWUob2JqLCB0aGlzLl9yaWdodEZpZWxkTmFtZSwgcmlnaHRWYWx1ZSk7XHJcblxyXG4gICAgcmV0dXJuIG9iajtcclxuICB9XHJcblxyXG4gIHNlcmlhbGl6ZVZhbHVlQnlQb3NpdGlvbihwb3NpdGlvbjogJ2xlZnRJbnB1dCcgfCAncmlnaHRJbnB1dCcpIHtcclxuICAgIGNvbnN0IGVsbVZhbHVlID0gcG9zaXRpb24gPT09ICdsZWZ0SW5wdXQnID8gdGhpcy5fbGVmdElucHV0LnZhbHVlIDogdGhpcy5fcmlnaHRJbnB1dC52YWx1ZTtcclxuICAgIGlmIChlbG1WYWx1ZSA9PT0gJycgfHwgaXNOYU4oK2VsbVZhbHVlKSkge1xyXG4gICAgICByZXR1cm4gZWxtVmFsdWU7XHJcbiAgICB9XHJcblxyXG4gICAgbGV0IHJ0biA9IHBhcnNlRmxvYXQoZWxtVmFsdWUpO1xyXG4gICAgY29uc3QgZGVjUGxhY2VzID0gdGhpcy5nZXREZWNpbWFsUGxhY2VzKHBvc2l0aW9uKTtcclxuICAgIGlmIChkZWNQbGFjZXMgIT09IG51bGwgJiYgKHJ0biB8fCBydG4gPT09IDApICYmIHJ0bi50b0ZpeGVkKSB7XHJcbiAgICAgIHJ0biA9IHBhcnNlRmxvYXQocnRuLnRvRml4ZWQoZGVjUGxhY2VzKSk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHJ0bjtcclxuICB9XHJcblxyXG4gIGdldERlY2ltYWxQbGFjZXMocG9zaXRpb246ICdsZWZ0SW5wdXQnIHwgJ3JpZ2h0SW5wdXQnKTogbnVtYmVyIHtcclxuICAgIGNvbnN0IGRlZmF1bHREZWNpbWFsUGxhY2VzID0gMDsgLy8gVE9ETyBtb3ZlIGludG8gYSBjb25zdGFudFxyXG5cclxuICAgIC8vIHJldHVybnMgdGhlIG51bWJlciBvZiBmaXhlZCBkZWNpbWFsIHBsYWNlcyBvciBudWxsXHJcbiAgICBjb25zdCBwb3NpdGlvblNpZGUgPSBwb3NpdGlvbiA9PT0gJ2xlZnRJbnB1dCcgPyAnbGVmdElucHV0JyA6ICdyaWdodElucHV0JztcclxuICAgIGNvbnN0IHNpZGVQYXJhbXMgPSB0aGlzLmVkaXRvclBhcmFtc1twb3NpdGlvblNpZGVdO1xyXG4gICAgY29uc3QgcnRuOiBudW1iZXIgfCB1bmRlZmluZWQgPSBzaWRlUGFyYW1zICYmIHNpZGVQYXJhbXMuZGVjaW1hbDtcclxuXHJcbiAgICBpZiAocnRuID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgcmV0dXJuIGRlZmF1bHREZWNpbWFsUGxhY2VzO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHJ0bjtcclxuICB9XHJcblxyXG4gIGdldElucHV0RGVjaW1hbFN0ZXBzKHBvc2l0aW9uOiAnbGVmdElucHV0JyB8ICdyaWdodElucHV0Jyk6IHN0cmluZyB7XHJcbiAgICBjb25zdCBkZWNpbWFscyA9IHRoaXMuZ2V0RGVjaW1hbFBsYWNlcyhwb3NpdGlvbik7XHJcbiAgICBsZXQgemVyb1N0cmluZyA9ICcnO1xyXG4gICAgZm9yIChsZXQgaSA9IDE7IGkgPCBkZWNpbWFsczsgaSsrKSB7XHJcbiAgICAgIHplcm9TdHJpbmcgKz0gJzAnO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChkZWNpbWFscyA+IDApIHtcclxuICAgICAgcmV0dXJuIGAwLiR7emVyb1N0cmluZ30xYDtcclxuICAgIH1cclxuICAgIHJldHVybiAnMSc7XHJcbiAgfVxyXG5cclxuICB2YWxpZGF0ZShpbnB1dFZhbGlkYXRpb24/OiB7IHBvc2l0aW9uOiAnbGVmdElucHV0JyB8ICdyaWdodElucHV0JywgaW5wdXRWYWx1ZTogYW55IH0pOiBFZGl0b3JWYWxpZGF0b3JPdXRwdXQge1xyXG4gICAgaWYgKGlucHV0VmFsaWRhdGlvbikge1xyXG4gICAgICBjb25zdCBwb3NWYWxpZGF0aW9uID0gdGhpcy52YWxpZGF0ZUJ5UG9zaXRpb24oaW5wdXRWYWxpZGF0aW9uLnBvc2l0aW9uLCBpbnB1dFZhbGlkYXRpb24uaW5wdXRWYWx1ZSk7XHJcbiAgICAgIGlmICghcG9zVmFsaWRhdGlvbi52YWxpZCkge1xyXG4gICAgICAgIGlucHV0VmFsaWRhdGlvbi5wb3NpdGlvbiA9PT0gJ2xlZnRJbnB1dCcgPyB0aGlzLl9sZWZ0SW5wdXQuc2VsZWN0KCkgOiB0aGlzLl9yaWdodElucHV0LnNlbGVjdCgpO1xyXG4gICAgICAgIHJldHVybiBwb3NWYWxpZGF0aW9uO1xyXG4gICAgICB9XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBjb25zdCBsZWZ0VmFsaWRhdGlvbiA9IHRoaXMudmFsaWRhdGVCeVBvc2l0aW9uKCdsZWZ0SW5wdXQnKTtcclxuICAgICAgY29uc3QgcmlnaHRWYWxpZGF0aW9uID0gdGhpcy52YWxpZGF0ZUJ5UG9zaXRpb24oJ3JpZ2h0SW5wdXQnKTtcclxuXHJcbiAgICAgIGlmICghbGVmdFZhbGlkYXRpb24udmFsaWQpIHtcclxuICAgICAgICB0aGlzLl9sZWZ0SW5wdXQuc2VsZWN0KCk7XHJcbiAgICAgICAgcmV0dXJuIGxlZnRWYWxpZGF0aW9uO1xyXG4gICAgICB9XHJcbiAgICAgIGlmICghcmlnaHRWYWxpZGF0aW9uLnZhbGlkKSB7XHJcbiAgICAgICAgdGhpcy5fcmlnaHRJbnB1dC5zZWxlY3QoKTtcclxuICAgICAgICByZXR1cm4gcmlnaHRWYWxpZGF0aW9uO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4geyB2YWxpZDogdHJ1ZSwgbXNnOiAnJyB9O1xyXG4gIH1cclxuXHJcbiAgdmFsaWRhdGVCeVBvc2l0aW9uKHBvc2l0aW9uOiAnbGVmdElucHV0JyB8ICdyaWdodElucHV0JywgaW5wdXRWYWx1ZT86IGFueSk6IEVkaXRvclZhbGlkYXRvck91dHB1dCB7XHJcbiAgICBjb25zdCBwb3NpdGlvbkVkaXRvclBhcmFtcyA9IHRoaXMuZWRpdG9yUGFyYW1zW3Bvc2l0aW9uXTtcclxuICAgIGxldCBjdXJyZW50VmFsOiBhbnkgPSAnJztcclxuICAgIGlmIChpbnB1dFZhbHVlKSB7XHJcbiAgICAgIGN1cnJlbnRWYWwgPSBpbnB1dFZhbHVlO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgY29uc3QgaW5wdXQgPSBwb3NpdGlvbiA9PT0gJ2xlZnRJbnB1dCcgPyB0aGlzLl9sZWZ0SW5wdXQgOiB0aGlzLl9yaWdodElucHV0O1xyXG4gICAgICBjdXJyZW50VmFsID0gaW5wdXQgJiYgaW5wdXQudmFsdWU7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gdGhlcmUgYXJlIDIgd2F5cyBvZiBwYXNzaW5nIGEgVmFsaWRhdG9yLCAxLWluZGVwZW5kZW50IHZhbGlkYXRvciBvbiBlYWNoIHNpZGUsIDItc2hhcmVkIHZhbGlkYXRvclxyXG4gICAgY29uc3QgY29tbW9uVmFsaWRhdG9yID0gdGhpcy52YWxpZGF0b3I7XHJcbiAgICBjdXJyZW50VmFsID0gdHlwZW9mIGNvbW1vblZhbGlkYXRvciA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMuZ2V0VmFsdWVzKCkgOiBjdXJyZW50VmFsO1xyXG4gICAgY29uc3QgYmFzZVZhbGlkYXRvck9wdGlvbnMgPSB7XHJcbiAgICAgIGVkaXRvckFyZ3M6IHRoaXMuYXJncyxcclxuICAgICAgZXJyb3JNZXNzYWdlOiBwb3NpdGlvbkVkaXRvclBhcmFtcy5lcnJvck1lc3NhZ2UsXHJcbiAgICAgIHJlcXVpcmVkOiBwb3NpdGlvbkVkaXRvclBhcmFtcy5yZXF1aXJlZCxcclxuICAgICAgdmFsaWRhdG9yOiB0eXBlb2YgY29tbW9uVmFsaWRhdG9yID09PSAnZnVuY3Rpb24nID8gY29tbW9uVmFsaWRhdG9yIDogcG9zaXRpb25FZGl0b3JQYXJhbXMudmFsaWRhdG9yLFxyXG4gICAgfTtcclxuXHJcbiAgICBzd2l0Y2ggKHBvc2l0aW9uRWRpdG9yUGFyYW1zLnR5cGUpIHtcclxuICAgICAgY2FzZSAnZmxvYXQnOlxyXG4gICAgICAgIHJldHVybiBmbG9hdFZhbGlkYXRvcihjdXJyZW50VmFsLCB7XHJcbiAgICAgICAgICAuLi5iYXNlVmFsaWRhdG9yT3B0aW9ucyxcclxuICAgICAgICAgIGRlY2ltYWw6IHRoaXMuZ2V0RGVjaW1hbFBsYWNlcyhwb3NpdGlvbiksXHJcbiAgICAgICAgICBtaW5WYWx1ZTogcG9zaXRpb25FZGl0b3JQYXJhbXMubWluVmFsdWUsXHJcbiAgICAgICAgICBtYXhWYWx1ZTogcG9zaXRpb25FZGl0b3JQYXJhbXMubWF4VmFsdWUsXHJcbiAgICAgICAgICBvcGVyYXRvckNvbmRpdGlvbmFsVHlwZTogcG9zaXRpb25FZGl0b3JQYXJhbXMub3BlcmF0b3JDb25kaXRpb25hbFR5cGUsXHJcbiAgICAgICAgfSk7XHJcbiAgICAgIGNhc2UgJ2ludGVnZXInOlxyXG4gICAgICAgIHJldHVybiBpbnRlZ2VyVmFsaWRhdG9yKGN1cnJlbnRWYWwsIHtcclxuICAgICAgICAgIC4uLmJhc2VWYWxpZGF0b3JPcHRpb25zLFxyXG4gICAgICAgICAgbWluVmFsdWU6IHBvc2l0aW9uRWRpdG9yUGFyYW1zLm1pblZhbHVlLFxyXG4gICAgICAgICAgbWF4VmFsdWU6IHBvc2l0aW9uRWRpdG9yUGFyYW1zLm1heFZhbHVlLFxyXG4gICAgICAgICAgb3BlcmF0b3JDb25kaXRpb25hbFR5cGU6IHBvc2l0aW9uRWRpdG9yUGFyYW1zLm9wZXJhdG9yQ29uZGl0aW9uYWxUeXBlLFxyXG4gICAgICAgIH0pO1xyXG4gICAgICBjYXNlICd0ZXh0JzpcclxuICAgICAgY2FzZSAncGFzc3dvcmQnOlxyXG4gICAgICBkZWZhdWx0OlxyXG4gICAgICAgIHJldHVybiB0ZXh0VmFsaWRhdG9yKGN1cnJlbnRWYWwsIGJhc2VWYWxpZGF0b3JPcHRpb25zKTtcclxuICAgIH1cclxuICB9XHJcbn1cclxuIl19