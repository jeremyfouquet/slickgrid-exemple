import * as tslib_1 from "tslib";
import { OperatorType, } from '../models/index';
var DEFAULT_MIN_VALUE = 0;
var DEFAULT_MAX_VALUE = 100;
var DEFAULT_STEP = 1;
/** A Slider Range Filter which uses jQuery UI, this is only meant to be used as a range filter (with 2 handles lowest & highest values) */
var SliderRangeFilter = /** @class */ (function () {
    function SliderRangeFilter() {
        this._clearFilterTriggered = false;
        this._shouldTriggerQuery = true;
    }
    Object.defineProperty(SliderRangeFilter.prototype, "filterParams", {
        /** Getter for the Filter Generic Params */
        get: function () {
            return this.columnDef && this.columnDef.filter && this.columnDef.filter.params || {};
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SliderRangeFilter.prototype, "filterProperties", {
        /** Getter for the `filter` properties */
        get: function () {
            return this.columnDef && this.columnDef.filter;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SliderRangeFilter.prototype, "columnFilter", {
        /** Getter for the Column Filter */
        get: function () {
            return this.columnDef && this.columnDef.filter || {};
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SliderRangeFilter.prototype, "currentValues", {
        /** Getter for the Current Slider Values */
        get: function () {
            return this._currentValues;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SliderRangeFilter.prototype, "defaultOperator", {
        /** Getter to know what would be the default operator when none is specified */
        get: function () {
            return this.gridOptions.defaultFilterRangeOperator || OperatorType.rangeExclusive;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SliderRangeFilter.prototype, "gridOptions", {
        /** Getter for the Grid Options pulled through the Grid Object */
        get: function () {
            return (this.grid && this.grid.getOptions) ? this.grid.getOptions() : {};
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SliderRangeFilter.prototype, "sliderOptions", {
        /** Getter for the JQuery UI Slider Options */
        get: function () {
            return this._sliderOptions || {};
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SliderRangeFilter.prototype, "operator", {
        /** Getter of the Operator to use when doing the filter comparing */
        get: function () {
            return this.columnFilter && this.columnFilter.operator || this.defaultOperator;
        },
        /** Setter for the filter operator */
        set: function (operator) {
            if (this.columnFilter) {
                this.columnFilter.operator = operator;
            }
        },
        enumerable: true,
        configurable: true
    });
    /**
     * Initialize the Filter
     */
    SliderRangeFilter.prototype.init = function (args) {
        if (!args) {
            throw new Error('[Angular-SlickGrid] A filter must always have an "init()" with valid arguments.');
        }
        this.grid = args.grid;
        this.callback = args.callback;
        this.columnDef = args.columnDef;
        this.searchTerms = (args.hasOwnProperty('searchTerms') ? args.searchTerms : []) || [];
        // step 1, create the DOM Element of the filter & initialize it if searchTerm is filled
        this.$filterElm = this.createDomElement(this.searchTerms);
    };
    /**
     * Clear the filter value
     */
    SliderRangeFilter.prototype.clear = function (shouldTriggerQuery) {
        if (shouldTriggerQuery === void 0) { shouldTriggerQuery = true; }
        if (this.$filterElm) {
            this._clearFilterTriggered = true;
            this._shouldTriggerQuery = shouldTriggerQuery;
            this.searchTerms = [];
            var lowestValue = this.filterParams.hasOwnProperty('sliderStartValue') ? this.filterParams.sliderStartValue : DEFAULT_MIN_VALUE;
            var highestValue = this.filterParams.hasOwnProperty('sliderEndValue') ? this.filterParams.sliderEndValue : DEFAULT_MAX_VALUE;
            this._currentValues = [lowestValue, highestValue];
            this.$filterElm.slider('values', [lowestValue, highestValue]);
            if (!this.filterParams.hideSliderNumbers) {
                this.renderSliderValues(lowestValue, highestValue);
            }
            this.callback(null, { columnDef: this.columnDef, clearFilterTriggered: true, shouldTriggerQuery: shouldTriggerQuery });
            this.$filterContainerElm.removeClass('filled');
        }
    };
    /**
     * destroy the filter
     */
    SliderRangeFilter.prototype.destroy = function () {
        if (this.$filterElm) {
            this.$filterElm.off('change').remove();
            this.$filterContainerElm.remove();
        }
        this.$filterElm = null;
        this.$filterContainerElm = null;
        this.callback = null;
        this.onValueChanged = null;
    };
    /**
     * Render both slider values (low/high) on screen
     * @param lowestValue number
     * @param highestValue number
     */
    SliderRangeFilter.prototype.renderSliderValues = function (lowestValue, highestValue) {
        var columndId = this.columnDef && this.columnDef.id;
        var lowerElm = document.querySelector(".lowest-range-" + columndId);
        var highestElm = document.querySelector(".highest-range-" + columndId);
        if (lowerElm && lowerElm.innerHTML) {
            lowerElm.innerHTML = lowestValue.toString();
        }
        if (highestElm && highestElm.innerHTML) {
            highestElm.innerHTML = highestValue.toString();
        }
    };
    /**
     * Set value(s) on the DOM element
     * @params searchTerms
     */
    SliderRangeFilter.prototype.setValues = function (searchTerms, operator) {
        if (searchTerms) {
            var sliderValues = [];
            // get the slider values, if it's a string with the "..", we'll do the split else we'll use the array of search terms
            if (typeof searchTerms === 'string' || (Array.isArray(searchTerms) && typeof searchTerms[0] === 'string') && searchTerms[0].indexOf('..') > 0) {
                sliderValues = (typeof searchTerms === 'string') ? [searchTerms] : searchTerms[0].split('..');
            }
            else if (Array.isArray(searchTerms)) {
                sliderValues = searchTerms;
            }
            if (Array.isArray(sliderValues) && sliderValues.length === 2) {
                this.$filterElm.slider('values', sliderValues);
                if (!this.filterParams.hideSliderNumbers) {
                    this.renderSliderValues(sliderValues[0], sliderValues[1]);
                }
            }
        }
        // set the operator when defined
        this.operator = operator || this.defaultOperator;
    };
    //
    // private functions
    // ------------------
    /**
     * From the html template string, create a DOM element
     * @param searchTerm optional preset search terms
     */
    SliderRangeFilter.prototype.createDomElement = function (searchTerms) {
        var _this = this;
        if (this.columnFilter && this.columnFilter.filterOptions && (this.columnFilter.filterOptions.change || this.columnFilter.filterOptions.slide)) {
            throw new Error("[Angular-Slickgrid] You cannot override the \"change\" and/or the \"slide\" callback methods\n        since they are used in SliderRange Filter itself, however any other methods can be used for example the \"create\", \"start\", \"stop\" methods.");
        }
        var fieldId = this.columnDef && this.columnDef.id;
        var $headerElm = this.grid.getHeaderRowColumn(fieldId);
        var minValue = this.filterProperties.hasOwnProperty('minValue') ? this.filterProperties.minValue : DEFAULT_MIN_VALUE;
        var maxValue = this.filterProperties.hasOwnProperty('maxValue') ? this.filterProperties.maxValue : DEFAULT_MAX_VALUE;
        var step = this.filterProperties.hasOwnProperty('valueStep') ? this.filterProperties.valueStep : DEFAULT_STEP;
        var defaultStartValue = DEFAULT_MIN_VALUE;
        var defaultEndValue = DEFAULT_MAX_VALUE;
        if (Array.isArray(searchTerms) && searchTerms.length > 1) {
            defaultStartValue = +searchTerms[0];
            defaultEndValue = +searchTerms[1];
        }
        else {
            defaultStartValue = +(this.filterParams.hasOwnProperty('sliderStartValue') ? this.filterParams.sliderStartValue : minValue);
            defaultEndValue = +(this.filterParams.hasOwnProperty('sliderEndValue') ? this.filterParams.sliderEndValue : maxValue);
        }
        $($headerElm).empty();
        // create the DOM element & add an ID and filter class
        var $lowestSliderValueElm = $("\n    <div class=\"input-group-addon input-group-prepend slider-range-value\">\n      <span class=\"input-group-text lowest-range-" + fieldId + "\">" + defaultStartValue + "</span>\n    </div>");
        var $highestSliderValueElm = $("\n    <div class=\"input-group-addon input-group-append slider-range-value\">\n      <span class=\"input-group-text highest-range-" + fieldId + "\">" + defaultEndValue + "</span>\n    </div>");
        this.$filterElm = $("<div class=\"filter-input filter-" + fieldId + "\"></div>");
        this.$filterContainerElm = $("<div class=\"input-group form-control search-filter slider-range-container slider-values filter-" + fieldId + "\">");
        if (this.filterParams.hideSliderNumbers) {
            this.$filterContainerElm.append(this.$filterElm);
        }
        else {
            this.$filterContainerElm.append($lowestSliderValueElm);
            this.$filterContainerElm.append(this.$filterElm);
            this.$filterContainerElm.append($highestSliderValueElm);
        }
        // if we are preloading searchTerms, we'll keep them for reference
        this._currentValues = [defaultStartValue, defaultEndValue];
        var definedOptions = {
            range: true,
            min: +minValue,
            max: +maxValue,
            step: +step,
            values: [defaultStartValue, defaultEndValue],
            change: function (e, ui) { return _this.onValueChanged(e, ui); },
            slide: function (e, ui) {
                var values = ui.values;
                if (!_this.filterParams.hideSliderNumbers && Array.isArray(values)) {
                    _this.renderSliderValues(values[0], values[1]);
                }
            }
        };
        // merge options with optional user's custom options
        this._sliderOptions = tslib_1.__assign({}, definedOptions, this.columnFilter.filterOptions);
        this.$filterElm.slider(this._sliderOptions);
        // if there's a search term, we will add the "filled" class for styling purposes
        if (Array.isArray(searchTerms) && searchTerms.length > 0 && searchTerms[0] !== '') {
            this.$filterContainerElm.addClass('filled');
        }
        // append the new DOM element to the header row
        if (this.$filterContainerElm && typeof this.$filterContainerElm.appendTo === 'function') {
            this.$filterContainerElm.appendTo($headerElm);
        }
        return this.$filterElm;
    };
    /** On a value change event triggered */
    SliderRangeFilter.prototype.onValueChanged = function (e, ui) {
        var values = ui && Array.isArray(ui.values) ? ui.values : [];
        var value = values.join('..');
        if (this._clearFilterTriggered) {
            this.callback(e, { columnDef: this.columnDef, clearFilterTriggered: this._clearFilterTriggered, shouldTriggerQuery: this._shouldTriggerQuery });
            this.$filterContainerElm.removeClass('filled');
        }
        else {
            value === '' ? this.$filterContainerElm.removeClass('filled') : this.$filterContainerElm.addClass('filled');
            this.callback(e, { columnDef: this.columnDef, operator: this.operator, searchTerms: values, shouldTriggerQuery: this._shouldTriggerQuery });
        }
        // reset both flags for next use
        this._clearFilterTriggered = false;
        this._shouldTriggerQuery = true;
    };
    return SliderRangeFilter;
}());
export { SliderRangeFilter };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2xpZGVyUmFuZ2VGaWx0ZXIuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9hbmd1bGFyLXNsaWNrZ3JpZC8iLCJzb3VyY2VzIjpbImFwcC9tb2R1bGVzL2FuZ3VsYXItc2xpY2tncmlkL2ZpbHRlcnMvc2xpZGVyUmFuZ2VGaWx0ZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFTTCxZQUFZLEdBR2IsTUFBTSxpQkFBaUIsQ0FBQztBQUt6QixJQUFNLGlCQUFpQixHQUFHLENBQUMsQ0FBQztBQUM1QixJQUFNLGlCQUFpQixHQUFHLEdBQUcsQ0FBQztBQUM5QixJQUFNLFlBQVksR0FBRyxDQUFDLENBQUM7QUFFdkIsMklBQTJJO0FBQzNJO0lBQUE7UUFDVSwwQkFBcUIsR0FBRyxLQUFLLENBQUM7UUFFOUIsd0JBQW1CLEdBQUcsSUFBSSxDQUFDO0lBNFByQyxDQUFDO0lBbFBDLHNCQUFZLDJDQUFZO1FBRHhCLDJDQUEyQzthQUMzQztZQUNFLE9BQU8sSUFBSSxDQUFDLFNBQVMsSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLE1BQU0sSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxNQUFNLElBQUksRUFBRSxDQUFDO1FBQ3ZGLENBQUM7OztPQUFBO0lBR0Qsc0JBQVksK0NBQWdCO1FBRDVCLHlDQUF5QzthQUN6QztZQUNFLE9BQU8sSUFBSSxDQUFDLFNBQVMsSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQztRQUNqRCxDQUFDOzs7T0FBQTtJQUdELHNCQUFJLDJDQUFZO1FBRGhCLG1DQUFtQzthQUNuQztZQUNFLE9BQU8sSUFBSSxDQUFDLFNBQVMsSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLE1BQU0sSUFBSSxFQUFFLENBQUM7UUFDdkQsQ0FBQzs7O09BQUE7SUFHRCxzQkFBSSw0Q0FBYTtRQURqQiwyQ0FBMkM7YUFDM0M7WUFDRSxPQUFPLElBQUksQ0FBQyxjQUFjLENBQUM7UUFDN0IsQ0FBQzs7O09BQUE7SUFH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QUMsbUJBQW1CLEVBQUUsQ0FBQyxDQUFDO1lBQ2hKLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxXQUFXLENBQUMsUUFBUSxDQUFDLENBQUM7U0FDaEQ7YUFBTTtZQUNMLEtBQUssS0FBSyxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxXQUFXLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDNUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLEVBQUUsRUFBRSxTQUFTLEVBQUUsSUFBSSxDQUFDLFNBQVMsRUFBRSxRQUFRLEVBQUUsSUFBSSxDQUFDLFFBQVEsRUFBRSxXQUFXLEVBQUUsTUFBTSxFQUFFLGtCQUFrQixFQUFFLElBQUksQ0FBQyxtQkFBbUIsRUFBRSxDQUFDLENBQUM7U0FDN0k7UUFDRCxnQ0FBZ0M7UUFDaEMsSUFBSSxDQUFDLHFCQUFxQixHQUFHLEtBQUssQ0FBQztRQUNuQyxJQUFJLENBQUMsbUJBQW1CLEdBQUcsSUFBSSxDQUFDO0lBQ2xDLENBQUM7SUFDSCx3QkFBQztBQUFELENBQUMsQUEvUEQsSUErUEMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBDb2x1bW4sXG4gIENvbHVtbkZpbHRlcixcbiAgRmlsdGVyLFxuICBGaWx0ZXJBcmd1bWVudHMsXG4gIEZpbHRlckNhbGxiYWNrLFxuICBHcmlkT3B0aW9uLFxuICBKUXVlcnlVaVNsaWRlck9wdGlvbixcbiAgSlF1ZXJ5VWlTbGlkZXJSZXNwb25zZSxcbiAgT3BlcmF0b3JUeXBlLFxuICBPcGVyYXRvclN0cmluZyxcbiAgU2VhcmNoVGVybSxcbn0gZnJvbSAnLi4vbW9kZWxzL2luZGV4JztcblxuLy8gdXNpbmcgZXh0ZXJuYWwgbm9uLXR5cGVkIGpzIGxpYnJhcmllc1xuZGVjbGFyZSBjb25zdCAkOiBhbnk7XG5cbmNvbnN0IERFRkFVTFRfTUlOX1ZBTFVFID0gMDtcbmNvbnN0IERFRkFVTFRfTUFYX1ZBTFVFID0gMTAwO1xuY29uc3QgREVGQVVMVF9TVEVQID0gMTtcblxuLyoqIEEgU2xpZGVyIFJhbmdlIEZpbHRlciB3aGljaCB1c2VzIGpRdWVyeSBVSSwgdGhpcyBpcyBvbmx5IG1lYW50IHRvIGJlIHVzZWQgYXMgYSByYW5nZSBmaWx0ZXIgKHdpdGggMiBoYW5kbGVzIGxvd2VzdCAmIGhpZ2hlc3QgdmFsdWVzKSAqL1xuZXhwb3J0IGNsYXNzIFNsaWRlclJhbmdlRmlsdGVyIGltcGxlbWVudHMgRmlsdGVyIHtcbiAgcHJpdmF0ZSBfY2xlYXJGaWx0ZXJUcmlnZ2VyZWQgPSBmYWxzZTtcbiAgcHJpdmF0ZSBfY3VycmVudFZhbHVlczogbnVtYmVyW107XG4gIHByaXZhdGUgX3Nob3VsZFRyaWdnZXJRdWVyeSA9IHRydWU7XG4gIHByaXZhdGUgX3NsaWRlck9wdGlvbnM6IEpRdWVyeVVpU2xpZGVyT3B0aW9uO1xuICBwcml2YXRlICRmaWx0ZXJFbG06IGFueTtcbiAgcHJpdmF0ZSAkZmlsdGVyQ29udGFpbmVyRWxtOiBhbnk7XG4gIGdyaWQ6IGFueTtcbiAgc2VhcmNoVGVybXM6IFNlYXJjaFRlcm1bXTtcbiAgY29sdW1uRGVmOiBDb2x1bW47XG4gIGNhbGxiYWNrOiBGaWx0ZXJDYWxsYmFjaztcblxuICAvKiogR2V0dGVyIGZvciB0aGUgRmlsdGVyIEdlbmVyaWMgUGFyYW1zICovXG4gIHByaXZhdGUgZ2V0IGZpbHRlclBhcmFtcygpOiBhbnkge1xuICAgIHJldHVybiB0aGlzLmNvbHVtbkRlZiAmJiB0aGlzLmNvbHVtbkRlZi5maWx0ZXIgJiYgdGhpcy5jb2x1bW5EZWYuZmlsdGVyLnBhcmFtcyB8fCB7fTtcbiAgfVxuXG4gIC8qKiBHZXR0ZXIgZm9yIHRoZSBgZmlsdGVyYCBwcm9wZXJ0aWVzICovXG4gIHByaXZhdGUgZ2V0IGZpbHRlclByb3BlcnRpZXMoKTogQ29sdW1uRmlsdGVyIHtcbiAgICByZXR1cm4gdGhpcy5jb2x1bW5EZWYgJiYgdGhpcy5jb2x1bW5EZWYuZmlsdGVyO1xuICB9XG5cbiAgLyoqIEdldHRlciBmb3IgdGhlIENvbHVtbiBGaWx0ZXIgKi9cbiAgZ2V0IGNvbHVtbkZpbHRlcigpOiBDb2x1bW5GaWx0ZXIge1xuICAgIHJldHVybiB0aGlzLmNvbHVtbkRlZiAmJiB0aGlzLmNvbHVtbkRlZi5maWx0ZXIgfHwge307XG4gIH1cblxuICAvKiogR2V0dGVyIGZvciB0aGUgQ3VycmVudCBTbGlkZXIgVmFsdWVzICovXG4gIGdldCBjdXJyZW50VmFsdWVzKCk6IG51bWJlcltdIHtcbiAgICByZXR1cm4gdGhpcy5fY3VycmVudFZhbHVlcztcbiAgfVxuXG4gIC8qKiBHZXR0ZXIgdG8ga25vdyB3aGF0IHdvdWxkIGJlIHRoZSBkZWZhdWx0IG9wZXJhdG9yIHdoZW4gbm9uZSBpcyBzcGVjaWZpZWQgKi9cbiAgZ2V0IGRlZmF1bHRPcGVyYXRvcigpOiBPcGVyYXRvclR5cGUgfCBPcGVyYXRvclN0cmluZyB7XG4gICAgcmV0dXJuIHRoaXMuZ3JpZE9wdGlvbnMuZGVmYXVsdEZpbHRlclJhbmdlT3BlcmF0b3IgfHwgT3BlcmF0b3JUeXBlLnJhbmdlRXhjbHVzaXZlO1xuICB9XG5cbiAgLyoqIEdldHRlciBmb3IgdGhlIEdyaWQgT3B0aW9ucyBwdWxsZWQgdGhyb3VnaCB0aGUgR3JpZCBPYmplY3QgKi9cbiAgZ2V0IGdyaWRPcHRpb25zKCk6IEdyaWRPcHRpb24ge1xuICAgIHJldHVybiAodGhpcy5ncmlkICYmIHRoaXMuZ3JpZC5nZXRPcHRpb25zKSA/IHRoaXMuZ3JpZC5nZXRPcHRpb25zKCkgOiB7fTtcbiAgfVxuXG4gIC8qKiBHZXR0ZXIgZm9yIHRoZSBKUXVlcnkgVUkgU2xpZGVyIE9wdGlvbnMgKi9cbiAgZ2V0IHNsaWRlck9wdGlvbnMoKTogSlF1ZXJ5VWlTbGlkZXJPcHRpb24ge1xuICAgIHJldHVybiB0aGlzLl9zbGlkZXJPcHRpb25zIHx8IHt9O1xuICB9XG5cbiAgLyoqIEdldHRlciBvZiB0aGUgT3BlcmF0b3IgdG8gdXNlIHdoZW4gZG9pbmcgdGhlIGZpbHRlciBjb21wYXJpbmcgKi9cbiAgZ2V0IG9wZXJhdG9yKCk6IE9wZXJhdG9yVHlwZSB8IE9wZXJhdG9yU3RyaW5nIHtcbiAgICByZXR1cm4gdGhpcy5jb2x1bW5GaWx0ZXIgJiYgdGhpcy5jb2x1bW5GaWx0ZXIub3BlcmF0b3IgfHwgdGhpcy5kZWZhdWx0T3BlcmF0b3I7XG4gIH1cblxuICAvKiogU2V0dGVyIGZvciB0aGUgZmlsdGVyIG9wZXJhdG9yICovXG4gIHNldCBvcGVyYXRvcihvcGVyYXRvcjogT3BlcmF0b3JUeXBlIHwgT3BlcmF0b3JTdHJpbmcpIHtcbiAgICBpZiAodGhpcy5jb2x1bW5GaWx0ZXIpIHtcbiAgICAgIHRoaXMuY29sdW1uRmlsdGVyLm9wZXJhdG9yID0gb3BlcmF0b3I7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEluaXRpYWxpemUgdGhlIEZpbHRlclxuICAgKi9cbiAgaW5pdChhcmdzOiBGaWx0ZXJBcmd1bWVudHMpIHtcbiAgICBpZiAoIWFyZ3MpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignW0FuZ3VsYXItU2xpY2tHcmlkXSBBIGZpbHRlciBtdXN0IGFsd2F5cyBoYXZlIGFuIFwiaW5pdCgpXCIgd2l0aCB2YWxpZCBhcmd1bWVudHMuJyk7XG4gICAgfVxuICAgIHRoaXMuZ3JpZCA9IGFyZ3MuZ3JpZDtcbiAgICB0aGlzLmNhbGxiYWNrID0gYXJncy5jYWxsYmFjaztcbiAgICB0aGlzLmNvbHVtbkRlZiA9IGFyZ3MuY29sdW1uRGVmO1xuICAgIHRoaXMuc2VhcmNoVGVybXMgPSAoYXJncy5oYXNPd25Qcm9wZXJ0eSgnc2VhcmNoVGVybXMnKSA/IGFyZ3Muc2VhcmNoVGVybXMgOiBbXSkgfHwgW107XG5cbiAgICAvLyBzdGVwIDEsIGNyZWF0ZSB0aGUgRE9NIEVsZW1lbnQgb2YgdGhlIGZpbHRlciAmIGluaXRpYWxpemUgaXQgaWYgc2VhcmNoVGVybSBpcyBmaWxsZWRcbiAgICB0aGlzLiRmaWx0ZXJFbG0gPSB0aGlzLmNyZWF0ZURvbUVsZW1lbnQodGhpcy5zZWFyY2hUZXJtcyk7XG4gIH1cblxuICAvKipcbiAgICogQ2xlYXIgdGhlIGZpbHRlciB2YWx1ZVxuICAgKi9cbiAgY2xlYXIoc2hvdWxkVHJpZ2dlclF1ZXJ5ID0gdHJ1ZSkge1xuICAgIGlmICh0aGlzLiRmaWx0ZXJFbG0pIHtcbiAgICAgIHRoaXMuX2NsZWFyRmlsdGVyVHJpZ2dlcmVkID0gdHJ1ZTtcbiAgICAgIHRoaXMuX3Nob3VsZFRyaWdnZXJRdWVyeSA9IHNob3VsZFRyaWdnZXJRdWVyeTtcbiAgICAgIHRoaXMuc2VhcmNoVGVybXMgPSBbXTtcbiAgICAgIGNvbnN0IGxvd2VzdFZhbHVlID0gdGhpcy5maWx0ZXJQYXJhbXMuaGFzT3duUHJvcGVydHkoJ3NsaWRlclN0YXJ0VmFsdWUnKSA/IHRoaXMuZmlsdGVyUGFyYW1zLnNsaWRlclN0YXJ0VmFsdWUgOiBERUZBVUxUX01JTl9WQUxVRTtcbiAgICAgIGNvbnN0IGhpZ2hlc3RWYWx1ZSA9IHRoaXMuZmlsdGVyUGFyYW1zLmhhc093blByb3BlcnR5KCdzbGlkZXJFbmRWYWx1ZScpID8gdGhpcy5maWx0ZXJQYXJhbXMuc2xpZGVyRW5kVmFsdWUgOiBERUZBVUxUX01BWF9WQUxVRTtcbiAgICAgIHRoaXMuX2N1cnJlbnRWYWx1ZXMgPSBbbG93ZXN0VmFsdWUsIGhpZ2hlc3RWYWx1ZV07XG4gICAgICB0aGlzLiRmaWx0ZXJFbG0uc2xpZGVyKCd2YWx1ZXMnLCBbbG93ZXN0VmFsdWUsIGhpZ2hlc3RWYWx1ZV0pO1xuICAgICAgaWYgKCF0aGlzLmZpbHRlclBhcmFtcy5oaWRlU2xpZGVyTnVtYmVycykge1xuICAgICAgICB0aGlzLnJlbmRlclNsaWRlclZhbHVlcyhsb3dlc3RWYWx1ZSwgaGlnaGVzdFZhbHVlKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuY2FsbGJhY2sobnVsbCwgeyBjb2x1bW5EZWY6IHRoaXMuY29sdW1uRGVmLCBjbGVhckZpbHRlclRyaWdnZXJlZDogdHJ1ZSwgc2hvdWxkVHJpZ2dlclF1ZXJ5IH0pO1xuICAgICAgdGhpcy4kZmlsdGVyQ29udGFpbmVyRWxtLnJlbW92ZUNsYXNzKCdmaWxsZWQnKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogZGVzdHJveSB0aGUgZmlsdGVyXG4gICAqL1xuICBkZXN0cm95KCkge1xuICAgIGlmICh0aGlzLiRmaWx0ZXJFbG0pIHtcbiAgICAgIHRoaXMuJGZpbHRlckVsbS5vZmYoJ2NoYW5nZScpLnJlbW92ZSgpO1xuICAgICAgdGhpcy4kZmlsdGVyQ29udGFpbmVyRWxtLnJlbW92ZSgpO1xuICAgIH1cbiAgICB0aGlzLiRmaWx0ZXJFbG0gPSBudWxsO1xuICAgIHRoaXMuJGZpbHRlckNvbnRhaW5lckVsbSA9IG51bGw7XG4gICAgdGhpcy5jYWxsYmFjayA9IG51bGw7XG4gICAgdGhpcy5vblZhbHVlQ2hhbmdlZCA9IG51bGw7XG4gIH1cblxuICAvKipcbiAgICogUmVuZGVyIGJvdGggc2xpZGVyIHZhbHVlcyAobG93L2hpZ2gpIG9uIHNjcmVlblxuICAgKiBAcGFyYW0gbG93ZXN0VmFsdWUgbnVtYmVyXG4gICAqIEBwYXJhbSBoaWdoZXN0VmFsdWUgbnVtYmVyXG4gICAqL1xuICByZW5kZXJTbGlkZXJWYWx1ZXMobG93ZXN0VmFsdWU6IG51bWJlciB8IHN0cmluZywgaGlnaGVzdFZhbHVlOiBudW1iZXIgfCBzdHJpbmcpIHtcbiAgICBjb25zdCBjb2x1bW5kSWQgPSB0aGlzLmNvbHVtbkRlZiAmJiB0aGlzLmNvbHVtbkRlZi5pZDtcbiAgICBjb25zdCBsb3dlckVsbSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYC5sb3dlc3QtcmFuZ2UtJHtjb2x1bW5kSWR9YCk7XG4gICAgY29uc3QgaGlnaGVzdEVsbSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYC5oaWdoZXN0LXJhbmdlLSR7Y29sdW1uZElkfWApO1xuICAgIGlmIChsb3dlckVsbSAmJiBsb3dlckVsbS5pbm5lckhUTUwpIHtcbiAgICAgIGxvd2VyRWxtLmlubmVySFRNTCA9IGxvd2VzdFZhbHVlLnRvU3RyaW5nKCk7XG4gICAgfVxuICAgIGlmIChoaWdoZXN0RWxtICYmIGhpZ2hlc3RFbG0uaW5uZXJIVE1MKSB7XG4gICAgICBoaWdoZXN0RWxtLmlubmVySFRNTCA9IGhpZ2hlc3RWYWx1ZS50b1N0cmluZygpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBTZXQgdmFsdWUocykgb24gdGhlIERPTSBlbGVtZW50XG4gICAqIEBwYXJhbXMgc2VhcmNoVGVybXNcbiAgICovXG4gIHNldFZhbHVlcyhzZWFyY2hUZXJtczogU2VhcmNoVGVybSB8IFNlYXJjaFRlcm1bXSwgb3BlcmF0b3I/OiBPcGVyYXRvclR5cGUgfCBPcGVyYXRvclN0cmluZykge1xuICAgIGlmIChzZWFyY2hUZXJtcykge1xuICAgICAgbGV0IHNsaWRlclZhbHVlcyA9IFtdO1xuXG4gICAgICAvLyBnZXQgdGhlIHNsaWRlciB2YWx1ZXMsIGlmIGl0J3MgYSBzdHJpbmcgd2l0aCB0aGUgXCIuLlwiLCB3ZSdsbCBkbyB0aGUgc3BsaXQgZWxzZSB3ZSdsbCB1c2UgdGhlIGFycmF5IG9mIHNlYXJjaCB0ZXJtc1xuICAgICAgaWYgKHR5cGVvZiBzZWFyY2hUZXJtcyA9PT0gJ3N0cmluZycgfHwgKEFycmF5LmlzQXJyYXkoc2VhcmNoVGVybXMpICYmIHR5cGVvZiBzZWFyY2hUZXJtc1swXSA9PT0gJ3N0cmluZycpICYmIChzZWFyY2hUZXJtc1swXSBhcyBzdHJpbmcpLmluZGV4T2YoJy4uJykgPiAwKSB7XG4gICAgICAgIHNsaWRlclZhbHVlcyA9ICh0eXBlb2Ygc2VhcmNoVGVybXMgPT09ICdzdHJpbmcnKSA/IFsoc2VhcmNoVGVybXMgYXMgc3RyaW5nKV0gOiAoc2VhcmNoVGVybXNbMF0gYXMgc3RyaW5nKS5zcGxpdCgnLi4nKTtcbiAgICAgIH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShzZWFyY2hUZXJtcykpIHtcbiAgICAgICAgc2xpZGVyVmFsdWVzID0gc2VhcmNoVGVybXM7XG4gICAgICB9XG5cbiAgICAgIGlmIChBcnJheS5pc0FycmF5KHNsaWRlclZhbHVlcykgJiYgc2xpZGVyVmFsdWVzLmxlbmd0aCA9PT0gMikge1xuICAgICAgICB0aGlzLiRmaWx0ZXJFbG0uc2xpZGVyKCd2YWx1ZXMnLCBzbGlkZXJWYWx1ZXMpO1xuICAgICAgICBpZiAoIXRoaXMuZmlsdGVyUGFyYW1zLmhpZGVTbGlkZXJOdW1iZXJzKSB7XG4gICAgICAgICAgdGhpcy5yZW5kZXJTbGlkZXJWYWx1ZXMoc2xpZGVyVmFsdWVzWzBdLCBzbGlkZXJWYWx1ZXNbMV0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gc2V0IHRoZSBvcGVyYXRvciB3aGVuIGRlZmluZWRcbiAgICB0aGlzLm9wZXJhdG9yID0gb3BlcmF0b3IgfHwgdGhpcy5kZWZhdWx0T3BlcmF0b3I7XG4gIH1cblxuICAvL1xuICAvLyBwcml2YXRlIGZ1bmN0aW9uc1xuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS1cblxuICAvKipcbiAgICogRnJvbSB0aGUgaHRtbCB0ZW1wbGF0ZSBzdHJpbmcsIGNyZWF0ZSBhIERPTSBlbGVtZW50XG4gICAqIEBwYXJhbSBzZWFyY2hUZXJtIG9wdGlvbmFsIHByZXNldCBzZWFyY2ggdGVybXNcbiAgICovXG4gIHByaXZhdGUgY3JlYXRlRG9tRWxlbWVudChzZWFyY2hUZXJtcz86IFNlYXJjaFRlcm0gfCBTZWFyY2hUZXJtW10pIHtcbiAgICBpZiAodGhpcy5jb2x1bW5GaWx0ZXIgJiYgdGhpcy5jb2x1bW5GaWx0ZXIuZmlsdGVyT3B0aW9ucyAmJiAodGhpcy5jb2x1bW5GaWx0ZXIuZmlsdGVyT3B0aW9ucy5jaGFuZ2UgfHwgdGhpcy5jb2x1bW5GaWx0ZXIuZmlsdGVyT3B0aW9ucy5zbGlkZSkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgW0FuZ3VsYXItU2xpY2tncmlkXSBZb3UgY2Fubm90IG92ZXJyaWRlIHRoZSBcImNoYW5nZVwiIGFuZC9vciB0aGUgXCJzbGlkZVwiIGNhbGxiYWNrIG1ldGhvZHNcbiAgICAgICAgc2luY2UgdGhleSBhcmUgdXNlZCBpbiBTbGlkZXJSYW5nZSBGaWx0ZXIgaXRzZWxmLCBob3dldmVyIGFueSBvdGhlciBtZXRob2RzIGNhbiBiZSB1c2VkIGZvciBleGFtcGxlIHRoZSBcImNyZWF0ZVwiLCBcInN0YXJ0XCIsIFwic3RvcFwiIG1ldGhvZHMuYCk7XG4gICAgfVxuICAgIGNvbnN0IGZpZWxkSWQgPSB0aGlzLmNvbHVtbkRlZiAmJiB0aGlzLmNvbHVtbkRlZi5pZDtcbiAgICBjb25zdCAkaGVhZGVyRWxtID0gdGhpcy5ncmlkLmdldEhlYWRlclJvd0NvbHVtbihmaWVsZElkKTtcbiAgICBjb25zdCBtaW5WYWx1ZSA9IHRoaXMuZmlsdGVyUHJvcGVydGllcy5oYXNPd25Qcm9wZXJ0eSgnbWluVmFsdWUnKSA/IHRoaXMuZmlsdGVyUHJvcGVydGllcy5taW5WYWx1ZSA6IERFRkFVTFRfTUlOX1ZBTFVFO1xuICAgIGNvbnN0IG1heFZhbHVlID0gdGhpcy5maWx0ZXJQcm9wZXJ0aWVzLmhhc093blByb3BlcnR5KCdtYXhWYWx1ZScpID8gdGhpcy5maWx0ZXJQcm9wZXJ0aWVzLm1heFZhbHVlIDogREVGQVVMVF9NQVhfVkFMVUU7XG4gICAgY29uc3Qgc3RlcCA9IHRoaXMuZmlsdGVyUHJvcGVydGllcy5oYXNPd25Qcm9wZXJ0eSgndmFsdWVTdGVwJykgPyB0aGlzLmZpbHRlclByb3BlcnRpZXMudmFsdWVTdGVwIDogREVGQVVMVF9TVEVQO1xuXG4gICAgbGV0IGRlZmF1bHRTdGFydFZhbHVlOiBudW1iZXIgPSBERUZBVUxUX01JTl9WQUxVRTtcbiAgICBsZXQgZGVmYXVsdEVuZFZhbHVlOiBudW1iZXIgPSBERUZBVUxUX01BWF9WQUxVRTtcbiAgICBpZiAoQXJyYXkuaXNBcnJheShzZWFyY2hUZXJtcykgJiYgc2VhcmNoVGVybXMubGVuZ3RoID4gMSkge1xuICAgICAgZGVmYXVsdFN0YXJ0VmFsdWUgPSArc2VhcmNoVGVybXNbMF07XG4gICAgICBkZWZhdWx0RW5kVmFsdWUgPSArc2VhcmNoVGVybXNbMV07XG4gICAgfSBlbHNlIHtcbiAgICAgIGRlZmF1bHRTdGFydFZhbHVlID0gKyh0aGlzLmZpbHRlclBhcmFtcy5oYXNPd25Qcm9wZXJ0eSgnc2xpZGVyU3RhcnRWYWx1ZScpID8gdGhpcy5maWx0ZXJQYXJhbXMuc2xpZGVyU3RhcnRWYWx1ZSA6IG1pblZhbHVlKTtcbiAgICAgIGRlZmF1bHRFbmRWYWx1ZSA9ICsodGhpcy5maWx0ZXJQYXJhbXMuaGFzT3duUHJvcGVydHkoJ3NsaWRlckVuZFZhbHVlJykgPyB0aGlzLmZpbHRlclBhcmFtcy5zbGlkZXJFbmRWYWx1ZSA6IG1heFZhbHVlKTtcbiAgICB9XG5cbiAgICAkKCRoZWFkZXJFbG0pLmVtcHR5KCk7XG5cbiAgICAvLyBjcmVhdGUgdGhlIERPTSBlbGVtZW50ICYgYWRkIGFuIElEIGFuZCBmaWx0ZXIgY2xhc3NcbiAgICBjb25zdCAkbG93ZXN0U2xpZGVyVmFsdWVFbG0gPSAkKGBcbiAgICA8ZGl2IGNsYXNzPVwiaW5wdXQtZ3JvdXAtYWRkb24gaW5wdXQtZ3JvdXAtcHJlcGVuZCBzbGlkZXItcmFuZ2UtdmFsdWVcIj5cbiAgICAgIDxzcGFuIGNsYXNzPVwiaW5wdXQtZ3JvdXAtdGV4dCBsb3dlc3QtcmFuZ2UtJHtmaWVsZElkfVwiPiR7ZGVmYXVsdFN0YXJ0VmFsdWV9PC9zcGFuPlxuICAgIDwvZGl2PmApO1xuICAgIGNvbnN0ICRoaWdoZXN0U2xpZGVyVmFsdWVFbG0gPSAkKGBcbiAgICA8ZGl2IGNsYXNzPVwiaW5wdXQtZ3JvdXAtYWRkb24gaW5wdXQtZ3JvdXAtYXBwZW5kIHNsaWRlci1yYW5nZS12YWx1ZVwiPlxuICAgICAgPHNwYW4gY2xhc3M9XCJpbnB1dC1ncm91cC10ZXh0IGhpZ2hlc3QtcmFuZ2UtJHtmaWVsZElkfVwiPiR7ZGVmYXVsdEVuZFZhbHVlfTwvc3Bhbj5cbiAgICA8L2Rpdj5gKTtcbiAgICB0aGlzLiRmaWx0ZXJFbG0gPSAkKGA8ZGl2IGNsYXNzPVwiZmlsdGVyLWlucHV0IGZpbHRlci0ke2ZpZWxkSWR9XCI+PC9kaXY+YCk7XG4gICAgdGhpcy4kZmlsdGVyQ29udGFpbmVyRWxtID0gJChgPGRpdiBjbGFzcz1cImlucHV0LWdyb3VwIGZvcm0tY29udHJvbCBzZWFyY2gtZmlsdGVyIHNsaWRlci1yYW5nZS1jb250YWluZXIgc2xpZGVyLXZhbHVlcyBmaWx0ZXItJHtmaWVsZElkfVwiPmApO1xuXG4gICAgaWYgKHRoaXMuZmlsdGVyUGFyYW1zLmhpZGVTbGlkZXJOdW1iZXJzKSB7XG4gICAgICB0aGlzLiRmaWx0ZXJDb250YWluZXJFbG0uYXBwZW5kKHRoaXMuJGZpbHRlckVsbSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuJGZpbHRlckNvbnRhaW5lckVsbS5hcHBlbmQoJGxvd2VzdFNsaWRlclZhbHVlRWxtKTtcbiAgICAgIHRoaXMuJGZpbHRlckNvbnRhaW5lckVsbS5hcHBlbmQodGhpcy4kZmlsdGVyRWxtKTtcbiAgICAgIHRoaXMuJGZpbHRlckNvbnRhaW5lckVsbS5hcHBlbmQoJGhpZ2hlc3RTbGlkZXJWYWx1ZUVsbSk7XG4gICAgfVxuXG4gICAgLy8gaWYgd2UgYXJlIHByZWxvYWRpbmcgc2VhcmNoVGVybXMsIHdlJ2xsIGtlZXAgdGhlbSBmb3IgcmVmZXJlbmNlXG4gICAgdGhpcy5fY3VycmVudFZhbHVlcyA9IFtkZWZhdWx0U3RhcnRWYWx1ZSwgZGVmYXVsdEVuZFZhbHVlXTtcblxuICAgIGNvbnN0IGRlZmluZWRPcHRpb25zOiBKUXVlcnlVaVNsaWRlck9wdGlvbiA9IHtcbiAgICAgIHJhbmdlOiB0cnVlLFxuICAgICAgbWluOiArbWluVmFsdWUsXG4gICAgICBtYXg6ICttYXhWYWx1ZSxcbiAgICAgIHN0ZXA6ICtzdGVwLFxuICAgICAgdmFsdWVzOiBbZGVmYXVsdFN0YXJ0VmFsdWUsIGRlZmF1bHRFbmRWYWx1ZV0sXG4gICAgICBjaGFuZ2U6IChlOiBFdmVudCwgdWk6IEpRdWVyeVVpU2xpZGVyUmVzcG9uc2UpID0+IHRoaXMub25WYWx1ZUNoYW5nZWQoZSwgdWkpLFxuICAgICAgc2xpZGU6IChlOiBFdmVudCwgdWk6IEpRdWVyeVVpU2xpZGVyUmVzcG9uc2UpID0+IHtcbiAgICAgICAgY29uc3QgdmFsdWVzID0gdWkudmFsdWVzO1xuICAgICAgICBpZiAoIXRoaXMuZmlsdGVyUGFyYW1zLmhpZGVTbGlkZXJOdW1iZXJzICYmIEFycmF5LmlzQXJyYXkodmFsdWVzKSkge1xuICAgICAgICAgIHRoaXMucmVuZGVyU2xpZGVyVmFsdWVzKHZhbHVlc1swXSwgdmFsdWVzWzFdKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH07XG5cbiAgICAvLyBtZXJnZSBvcHRpb25zIHdpdGggb3B0aW9uYWwgdXNlcidzIGN1c3RvbSBvcHRpb25zXG4gICAgdGhpcy5fc2xpZGVyT3B0aW9ucyA9IHsgLi4uZGVmaW5lZE9wdGlvbnMsIC4uLih0aGlzLmNvbHVtbkZpbHRlci5maWx0ZXJPcHRpb25zIGFzIEpRdWVyeVVpU2xpZGVyT3B0aW9uKSB9O1xuICAgIHRoaXMuJGZpbHRlckVsbS5zbGlkZXIodGhpcy5fc2xpZGVyT3B0aW9ucyk7XG5cbiAgICAvLyBpZiB0aGVyZSdzIGEgc2VhcmNoIHRlcm0sIHdlIHdpbGwgYWRkIHRoZSBcImZpbGxlZFwiIGNsYXNzIGZvciBzdHlsaW5nIHB1cnBvc2VzXG4gICAgaWYgKEFycmF5LmlzQXJyYXkoc2VhcmNoVGVybXMpICYmIHNlYXJjaFRlcm1zLmxlbmd0aCA+IDAgJiYgc2VhcmNoVGVybXNbMF0gIT09ICcnKSB7XG4gICAgICB0aGlzLiRmaWx0ZXJDb250YWluZXJFbG0uYWRkQ2xhc3MoJ2ZpbGxlZCcpO1xuICAgIH1cblxuICAgIC8vIGFwcGVuZCB0aGUgbmV3IERPTSBlbGVtZW50IHRvIHRoZSBoZWFkZXIgcm93XG4gICAgaWYgKHRoaXMuJGZpbHRlckNvbnRhaW5lckVsbSAmJiB0eXBlb2YgdGhpcy4kZmlsdGVyQ29udGFpbmVyRWxtLmFwcGVuZFRvID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICB0aGlzLiRmaWx0ZXJDb250YWluZXJFbG0uYXBwZW5kVG8oJGhlYWRlckVsbSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMuJGZpbHRlckVsbTtcbiAgfVxuXG4gIC8qKiBPbiBhIHZhbHVlIGNoYW5nZSBldmVudCB0cmlnZ2VyZWQgKi9cbiAgcHJpdmF0ZSBvblZhbHVlQ2hhbmdlZChlOiBFdmVudCwgdWk6IEpRdWVyeVVpU2xpZGVyUmVzcG9uc2UpIHtcbiAgICBjb25zdCB2YWx1ZXMgPSB1aSAmJiBBcnJheS5pc0FycmF5KHVpLnZhbHVlcykgPyB1aS52YWx1ZXMgOiBbXTtcbiAgICBjb25zdCB2YWx1ZSA9IHZhbHVlcy5qb2luKCcuLicpO1xuXG4gICAgaWYgKHRoaXMuX2NsZWFyRmlsdGVyVHJpZ2dlcmVkKSB7XG4gICAgICB0aGlzLmNhbGxiYWNrKGUsIHsgY29sdW1uRGVmOiB0aGlzLmNvbHVtbkRlZiwgY2xlYXJGaWx0ZXJUcmlnZ2VyZWQ6IHRoaXMuX2NsZWFyRmlsdGVyVHJpZ2dlcmVkLCBzaG91bGRUcmlnZ2VyUXVlcnk6IHRoaXMuX3Nob3VsZFRyaWdnZXJRdWVyeSB9KTtcbiAgICAgIHRoaXMuJGZpbHRlckNvbnRhaW5lckVsbS5yZW1vdmVDbGFzcygnZmlsbGVkJyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHZhbHVlID09PSAnJyA/IHRoaXMuJGZpbHRlckNvbnRhaW5lckVsbS5yZW1vdmVDbGFzcygnZmlsbGVkJykgOiB0aGlzLiRmaWx0ZXJDb250YWluZXJFbG0uYWRkQ2xhc3MoJ2ZpbGxlZCcpO1xuICAgICAgdGhpcy5jYWxsYmFjayhlLCB7IGNvbHVtbkRlZjogdGhpcy5jb2x1bW5EZWYsIG9wZXJhdG9yOiB0aGlzLm9wZXJhdG9yLCBzZWFyY2hUZXJtczogdmFsdWVzLCBzaG91bGRUcmlnZ2VyUXVlcnk6IHRoaXMuX3Nob3VsZFRyaWdnZXJRdWVyeSB9KTtcbiAgICB9XG4gICAgLy8gcmVzZXQgYm90aCBmbGFncyBmb3IgbmV4dCB1c2VcbiAgICB0aGlzLl9jbGVhckZpbHRlclRyaWdnZXJlZCA9IGZhbHNlO1xuICAgIHRoaXMuX3Nob3VsZFRyaWdnZXJRdWVyeSA9IHRydWU7XG4gIH1cbn1cbiJdfQ==