import * as tslib_1 from "tslib";
import { SharedService } from './shared.service';
import { Injectable } from '@angular/core';
var TreeDataService = /** @class */ (function () {
    function TreeDataService(sharedService) {
        this.sharedService = sharedService;
        this._eventHandler = new Slick.EventHandler();
    }
    Object.defineProperty(TreeDataService.prototype, "dataset", {
        get: function () {
            return this.dataView && this.dataView.getItems && this.dataView.getItems();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(TreeDataService.prototype, "datasetHierarchical", {
        get: function () {
            return this.sharedService.hierarchicalDataset;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(TreeDataService.prototype, "dataView", {
        get: function () {
            return this._grid && this._grid.getData && this._grid.getData();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(TreeDataService.prototype, "gridOptions", {
        get: function () {
            return this._grid && this._grid.getOptions && this._grid.getOptions() || {};
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(TreeDataService.prototype, "eventHandler", {
        /** Getter of the SlickGrid Event Handler */
        get: function () {
            return this._eventHandler;
        },
        enumerable: true,
        configurable: true
    });
    TreeDataService.prototype.dispose = function () {
        // unsubscribe all SlickGrid events
        if (this._eventHandler && this._eventHandler.unsubscribeAll) {
            this._eventHandler.unsubscribeAll();
        }
    };
    TreeDataService.prototype.init = function (grid) {
        this._grid = grid;
        // subscribe to the SlickGrid event and call the backend execution
        this._eventHandler.subscribe(grid.onClick, this.handleOnCellClick.bind(this));
    };
    TreeDataService.prototype.handleOnCellClick = function (event, args) {
        if (event && args) {
            var targetElm = event.target || {};
            var treeDataOptions = this.gridOptions.treeDataOptions;
            var collapsedPropName = treeDataOptions && treeDataOptions.collapsedPropName || '__collapsed';
            var idPropName = this.gridOptions.datasetIdPropertyName || 'id';
            if (targetElm && targetElm.className) {
                var hasToggleClass = targetElm.className.indexOf('toggle') >= 0 || false;
                if (hasToggleClass) {
                    var item = this.dataView.getItem(args.row);
                    if (item) {
                        item[collapsedPropName] = !item[collapsedPropName] ? true : false;
                        this.dataView.updateItem(item[idPropName], item);
                        this._grid.invalidate();
                    }
                    event.stopImmediatePropagation();
                }
            }
        }
    };
    TreeDataService.prototype.toggleTreeDataCollapse = function (collapsing) {
        if (this.gridOptions) {
            var treeDataOptions = this.gridOptions.treeDataOptions;
            if (this.gridOptions.enableTreeData) {
                var items = this.dataView.getItems() || [];
                var collapsedPropName_1 = treeDataOptions && treeDataOptions.collapsedPropName || '__collapsed';
                items.forEach(function (item) { return item[collapsedPropName_1] = collapsing; });
                this.dataView.setItems(items);
                this._grid.invalidate();
            }
        }
    };
    TreeDataService.ctorParameters = function () { return [
        { type: SharedService }
    ]; };
    TreeDataService = tslib_1.__decorate([
        Injectable()
    ], TreeDataService);
    return TreeDataService;
}());
export { TreeDataService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHJlZURhdGEuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL2FuZ3VsYXItc2xpY2tncmlkLyIsInNvdXJjZXMiOlsiYXBwL21vZHVsZXMvYW5ndWxhci1zbGlja2dyaWQvc2VydmljZXMvdHJlZURhdGEuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQ0EsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBQ2pELE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFNM0M7SUFJRSx5QkFBb0IsYUFBNEI7UUFBNUIsa0JBQWEsR0FBYixhQUFhLENBQWU7UUFDOUMsSUFBSSxDQUFDLGFBQWEsR0FBRyxJQUFJLEtBQUssQ0FBQyxZQUFZLEVBQUUsQ0FBQztJQUNoRCxDQUFDO0lBRUQsc0JBQUksb0NBQU87YUFBWDtZQUNFLE9BQU8sSUFBSSxDQUFDLFFBQVEsSUFBSSxJQUFJLENBQUMsUUFBUSxDQUFDLFFBQVEsSUFBSSxJQUFJLENBQUMsUUFBUSxDQUFDLFFBQVEsRUFBRSxDQUFDO1FBQzdFLENBQUM7OztPQUFBO0lBRUQsc0JBQUksZ0RBQW1CO2FBQXZCO1lBQ0UsT0FBTyxJQUFJLENBQUMsYUFBYSxDQUFDLG1CQUFtQixDQUFDO1FBQ2hELENBQUM7OztPQUFBO0lBRUQsc0JBQUkscUNBQVE7YUFBWjtZQUNFLE9BQU8sSUFBSSxDQUFDLEtBQUssSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sRUFBRSxDQUFDO1FBQ2xFLENBQUM7OztPQUFBO0lBRUQsc0JBQUksd0NBQVc7YUFBZjtZQUNFLE9BQU8sSUFBSSxDQUFDLEtBQUssSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLFVBQVUsSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLFVBQVUsRUFBRSxJQUFJLEVBQUUsQ0FBQztRQUM5RSxDQUFDOzs7T0FBQTtJQUdELHNCQUFJLHlDQUFZO1FBRGhC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QjtJQUFELHNCQUFDO0NBQUEsQUE5RUQsSUE4RUM7U0E5RVksZUFBZSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEdyaWRPcHRpb24sIFNsaWNrRXZlbnRIYW5kbGVyIH0gZnJvbSAnLi4vbW9kZWxzL2luZGV4JztcclxuaW1wb3J0IHsgU2hhcmVkU2VydmljZSB9IGZyb20gJy4vc2hhcmVkLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcblxyXG4vLyB1c2luZyBleHRlcm5hbCBub24tdHlwZWQganMgbGlicmFyaWVzXHJcbmRlY2xhcmUgY29uc3QgU2xpY2s6IGFueTtcclxuXHJcbkBJbmplY3RhYmxlKClcclxuZXhwb3J0IGNsYXNzIFRyZWVEYXRhU2VydmljZSB7XHJcbiAgcHJpdmF0ZSBfZ3JpZDogYW55O1xyXG4gIHByaXZhdGUgX2V2ZW50SGFuZGxlcjogU2xpY2tFdmVudEhhbmRsZXI7XHJcblxyXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgc2hhcmVkU2VydmljZTogU2hhcmVkU2VydmljZSkge1xyXG4gICAgdGhpcy5fZXZlbnRIYW5kbGVyID0gbmV3IFNsaWNrLkV2ZW50SGFuZGxlcigpO1xyXG4gIH1cclxuXHJcbiAgZ2V0IGRhdGFzZXQoKTogYW55W10ge1xyXG4gICAgcmV0dXJuIHRoaXMuZGF0YVZpZXcgJiYgdGhpcy5kYXRhVmlldy5nZXRJdGVtcyAmJiB0aGlzLmRhdGFWaWV3LmdldEl0ZW1zKCk7XHJcbiAgfVxyXG5cclxuICBnZXQgZGF0YXNldEhpZXJhcmNoaWNhbCgpOiBhbnlbXSB8IG51bGwge1xyXG4gICAgcmV0dXJuIHRoaXMuc2hhcmVkU2VydmljZS5oaWVyYXJjaGljYWxEYXRhc2V0O1xyXG4gIH1cclxuXHJcbiAgZ2V0IGRhdGFWaWV3KCk6IGFueSB7XHJcbiAgICByZXR1cm4gdGhpcy5fZ3JpZCAmJiB0aGlzLl9ncmlkLmdldERhdGEgJiYgdGhpcy5fZ3JpZC5nZXREYXRhKCk7XHJcbiAgfVxyXG5cclxuICBnZXQgZ3JpZE9wdGlvbnMoKTogR3JpZE9wdGlvbiB7XHJcbiAgICByZXR1cm4gdGhpcy5fZ3JpZCAmJiB0aGlzLl9ncmlkLmdldE9wdGlvbnMgJiYgdGhpcy5fZ3JpZC5nZXRPcHRpb25zKCkgfHwge307XHJcbiAgfVxyXG5cclxuICAvKiogR2V0dGVyIG9mIHRoZSBTbGlja0dyaWQgRXZlbnQgSGFuZGxlciAqL1xyXG4gIGdldCBldmVudEhhbmRsZXIoKTogU2xpY2tFdmVudEhhbmRsZXIge1xyXG4gICAgcmV0dXJuIHRoaXMuX2V2ZW50SGFuZGxlcjtcclxuICB9XHJcblxyXG4gIGRpc3Bvc2UoKSB7XHJcbiAgICAvLyB1bnN1YnNjcmliZSBhbGwgU2xpY2tHcmlkIGV2ZW50c1xyXG4gICAgaWYgKHRoaXMuX2V2ZW50SGFuZGxlciAmJiB0aGlzLl9ldmVudEhhbmRsZXIudW5zdWJzY3JpYmVBbGwpIHtcclxuICAgICAgdGhpcy5fZXZlbnRIYW5kbGVyLnVuc3Vic2NyaWJlQWxsKCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBpbml0KGdyaWQ6IGFueSkge1xyXG4gICAgdGhpcy5fZ3JpZCA9IGdyaWQ7XHJcblxyXG4gICAgLy8gc3Vic2NyaWJlIHRvIHRoZSBTbGlja0dyaWQgZXZlbnQgYW5kIGNhbGwgdGhlIGJhY2tlbmQgZXhlY3V0aW9uXHJcbiAgICB0aGlzLl9ldmVudEhhbmRsZXIuc3Vic2NyaWJlKGdyaWQub25DbGljaywgdGhpcy5oYW5kbGVPbkNlbGxDbGljay5iaW5kKHRoaXMpKTtcclxuICB9XHJcblxyXG4gIGhhbmRsZU9uQ2VsbENsaWNrKGV2ZW50OiBhbnksIGFyZ3M6IGFueSkge1xyXG4gICAgaWYgKGV2ZW50ICYmIGFyZ3MpIHtcclxuICAgICAgY29uc3QgdGFyZ2V0RWxtID0gZXZlbnQudGFyZ2V0IHx8IHt9O1xyXG4gICAgICBjb25zdCB0cmVlRGF0YU9wdGlvbnMgPSB0aGlzLmdyaWRPcHRpb25zLnRyZWVEYXRhT3B0aW9ucztcclxuICAgICAgY29uc3QgY29sbGFwc2VkUHJvcE5hbWUgPSB0cmVlRGF0YU9wdGlvbnMgJiYgdHJlZURhdGFPcHRpb25zLmNvbGxhcHNlZFByb3BOYW1lIHx8ICdfX2NvbGxhcHNlZCc7XHJcbiAgICAgIGNvbnN0IGlkUHJvcE5hbWUgPSB0aGlzLmdyaWRPcHRpb25zLmRhdGFzZXRJZFByb3BlcnR5TmFtZSB8fCAnaWQnO1xyXG5cclxuICAgICAgaWYgKHRhcmdldEVsbSAmJiB0YXJnZXRFbG0uY2xhc3NOYW1lKSB7XHJcbiAgICAgICAgY29uc3QgaGFzVG9nZ2xlQ2xhc3MgPSB0YXJnZXRFbG0uY2xhc3NOYW1lLmluZGV4T2YoJ3RvZ2dsZScpID49IDAgfHwgZmFsc2U7XHJcbiAgICAgICAgaWYgKGhhc1RvZ2dsZUNsYXNzKSB7XHJcbiAgICAgICAgICBjb25zdCBpdGVtID0gdGhpcy5kYXRhVmlldy5nZXRJdGVtKGFyZ3Mucm93KTtcclxuICAgICAgICAgIGlmIChpdGVtKSB7XHJcbiAgICAgICAgICAgIGl0ZW1bY29sbGFwc2VkUHJvcE5hbWVdID0gIWl0ZW1bY29sbGFwc2VkUHJvcE5hbWVdID8gdHJ1ZSA6IGZhbHNlO1xyXG4gICAgICAgICAgICB0aGlzLmRhdGFWaWV3LnVwZGF0ZUl0ZW0oaXRlbVtpZFByb3BOYW1lXSwgaXRlbSk7XHJcbiAgICAgICAgICAgIHRoaXMuX2dyaWQuaW52YWxpZGF0ZSgpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgZXZlbnQuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICB0b2dnbGVUcmVlRGF0YUNvbGxhcHNlKGNvbGxhcHNpbmc6IGJvb2xlYW4pIHtcclxuICAgIGlmICh0aGlzLmdyaWRPcHRpb25zKSB7XHJcbiAgICAgIGNvbnN0IHRyZWVEYXRhT3B0aW9ucyA9IHRoaXMuZ3JpZE9wdGlvbnMudHJlZURhdGFPcHRpb25zO1xyXG5cclxuICAgICAgaWYgKHRoaXMuZ3JpZE9wdGlvbnMuZW5hYmxlVHJlZURhdGEpIHtcclxuICAgICAgICBjb25zdCBpdGVtczogYW55W10gPSB0aGlzLmRhdGFWaWV3LmdldEl0ZW1zKCkgfHwgW107XHJcbiAgICAgICAgY29uc3QgY29sbGFwc2VkUHJvcE5hbWUgPSB0cmVlRGF0YU9wdGlvbnMgJiYgdHJlZURhdGFPcHRpb25zLmNvbGxhcHNlZFByb3BOYW1lIHx8ICdfX2NvbGxhcHNlZCc7XHJcbiAgICAgICAgaXRlbXMuZm9yRWFjaCgoaXRlbTogYW55KSA9PiBpdGVtW2NvbGxhcHNlZFByb3BOYW1lXSA9IGNvbGxhcHNpbmcpO1xyXG4gICAgICAgIHRoaXMuZGF0YVZpZXcuc2V0SXRlbXMoaXRlbXMpO1xyXG4gICAgICAgIHRoaXMuX2dyaWQuaW52YWxpZGF0ZSgpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcbiJdfQ==