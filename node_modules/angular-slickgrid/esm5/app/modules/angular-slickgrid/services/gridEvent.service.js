import * as ɵngcc0 from '@angular/core';
var GridEventService = /** @class */ (function () {
    function GridEventService() {
        this._eventHandler = new Slick.EventHandler();
    }
    Object.defineProperty(GridEventService.prototype, "eventHandler", {
        get: function () {
            return this._eventHandler;
        },
        enumerable: true,
        configurable: true
    });
    GridEventService.prototype.dispose = function () {
        this._eventHandler.unsubscribeAll();
        this.handleOnCellChange = null;
        this.handleOnCellClick = null;
    };
    /* OnCellChange Event */
    GridEventService.prototype.bindOnCellChange = function (grid, dataView) {
        var _this = this;
        // subscribe to this Slickgrid event of onCellChange
        this._eventHandler.subscribe(grid.onCellChange, function (e, args) {
            _this.handleOnCellChange.call(_this, grid, dataView, e, args);
        });
    };
    /* OnClick Event */
    GridEventService.prototype.bindOnClick = function (grid, dataView) {
        var _this = this;
        this._eventHandler.subscribe(grid.onClick, function (e, args) {
            _this.handleOnCellClick.call(_this, grid, dataView, e, args);
        });
    };
    //
    // private functions
    // ------------------
    /* OnCellChange Event Handler */
    GridEventService.prototype.handleOnCellChange = function (grid, dataView, e, args) {
        if (!e || !args || !grid || args.cell === undefined || !grid.getColumns || !grid.getDataItem) {
            return;
        }
        var column = grid.getColumns()[args.cell];
        // if the column definition has a onCellChange property (a callback function), then run it
        if (typeof column.onCellChange === 'function') {
            // add to the output gridOptions & dataView since we'll need them inside the AJAX column.onCellChange
            var returnedArgs = {
                row: args.row,
                cell: args.cell,
                dataView: dataView,
                grid: grid,
                columnDef: column,
                dataContext: grid.getDataItem(args.row)
            };
            // finally call up the Slick.column.onCellChanges.... function
            column.onCellChange(e, returnedArgs);
        }
    };
    /* OnCellClick Event Handler */
    GridEventService.prototype.handleOnCellClick = function (grid, dataView, e, args) {
        if (!e || !args || !grid || args.cell === undefined || !grid.getColumns || !grid.getDataItem) {
            return;
        }
        var column = grid && grid.getColumns && grid.getColumns()[args.cell];
        var gridOptions = grid && grid.getOptions && grid.getOptions() || {};
        // only when using autoCommitEdit, we will make the cell active (in focus) when clicked
        // setting the cell as active as a side effect and if autoCommitEdit is set to false then the Editors won't save correctly
        if (gridOptions.enableCellNavigation && (!gridOptions.editable || (gridOptions.editable && gridOptions.autoCommitEdit))) {
            grid.setActiveCell(args.row, args.cell);
        }
        // if the column definition has a onCellClick property (a callback function), then run it
        if (typeof column.onCellClick === 'function') {
            // add to the output gridOptions & dataView since we'll need them inside the AJAX column.onClick
            var returnedArgs = {
                row: args.row,
                cell: args.cell,
                dataView: dataView,
                grid: grid,
                columnDef: column,
                dataContext: grid.getDataItem(args.row)
            };
            // finally call up the Slick.column.onCellClick.... function
            column.onCellClick(e, returnedArgs);
        }
    };
GridEventService.ɵfac = function GridEventService_Factory(t) { return new (t || GridEventService)(); };
GridEventService.ɵprov = ɵngcc0.ɵɵdefineInjectable({ token: GridEventService, factory: function (t) { return GridEventService.ɵfac(t); } });

    return GridEventService;
}());
export { GridEventService };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ3JpZEV2ZW50LnNlcnZpY2UuanMiLCJzb3VyY2VzIjpbIm5nOi9hbmd1bGFyLXNsaWNrZ3JpZC9hcHAvbW9kdWxlcy9hbmd1bGFyLXNsaWNrZ3JpZC9zZXJ2aWNlcy9ncmlkRXZlbnQuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBS0E7QUFDb0IsSUFNbEI7QUFDWSxRQUFWLElBQUksQ0FBQyxhQUFhLEdBQUcsSUFBSSxLQUFLLENBQUMsWUFBWSxFQUFFLENBQUM7QUFDbEQsSUFBRSxDQUFDO0FBQ0gsSUFQRSxzQkFBSSwwQ0FBWTtBQUFJLGFBQXBCO0FBQWMsWUFDWixPQUFPLElBQUksQ0FBQyxhQUFhLENBQUM7QUFDOUIsUUFBRSxDQUFDO0FBRUg7QUFDUTtBQUEyQixPQUhoQztBQUNILElBS0Usa0NBQU8sR0FBUDtBQUNBLFFBQUUsSUFBSSxDQUFDLGFBQWEsQ0FBQyxjQUFjLEVBQUUsQ0FBQztBQUN4QyxRQUFJLElBQUksQ0FBQyxrQkFBa0IsR0FBRyxJQUFJLENBQUM7QUFDbkMsUUFBSSxJQUFJLENBQUMsaUJBQWlCLEdBQUcsSUFBSSxDQUFDO0FBQ2xDLElBQUUsQ0FBQztBQUVILElBQUUsd0JBQXdCO0FBQzFCLElBQUUsMkNBQWdCLEdBQWhCLFVBQWlCLElBQVMsRUFBRSxRQUFhO0FBQzNDLFFBREUsaUJBS0M7QUFDSCxRQUxJLG9EQUFvRDtBQUN4RCxRQUFJLElBQUksQ0FBQyxhQUFhLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxZQUFZLEVBQUUsVUFBQyxDQUE2QixFQUFFLElBQWM7QUFBSSxZQUNoRyxLQUFJLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDLEtBQUksRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQztBQUNsRSxRQUFJLENBQUMsQ0FBQyxDQUFDO0FBQ1AsSUFBRSxDQUFDO0FBRUgsSUFBRSxtQkFBbUI7QUFDckIsSUFBRSxzQ0FBVyxHQUFYLFVBQVksSUFBUyxFQUFF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QSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBSUEsQUFIQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFFQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBMUZBLEFBMEZBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ2VsbEFyZ3MsIENvbHVtbiwgR3JpZE9wdGlvbiwgT25FdmVudEFyZ3MsIFNsaWNrRXZlbnRIYW5kbGVyIH0gZnJvbSAnLi8uLi9tb2RlbHMvaW5kZXgnO1xyXG5cclxuLy8gdXNpbmcgZXh0ZXJuYWwgbm9uLXR5cGVkIGpzIGxpYnJhcmllc1xyXG5kZWNsYXJlIGNvbnN0IFNsaWNrOiBhbnk7XHJcblxyXG5leHBvcnQgY2xhc3MgR3JpZEV2ZW50U2VydmljZSB7XHJcbiAgcHJpdmF0ZSBfZXZlbnRIYW5kbGVyOiBTbGlja0V2ZW50SGFuZGxlcjtcclxuXHJcbiAgZ2V0IGV2ZW50SGFuZGxlcigpOiBTbGlja0V2ZW50SGFuZGxlciB7XHJcbiAgICByZXR1cm4gdGhpcy5fZXZlbnRIYW5kbGVyO1xyXG4gIH1cclxuXHJcbiAgY29uc3RydWN0b3IoKSB7XHJcbiAgICB0aGlzLl9ldmVudEhhbmRsZXIgPSBuZXcgU2xpY2suRXZlbnRIYW5kbGVyKCk7XHJcbiAgfVxyXG5cclxuICBkaXNwb3NlKCkge1xyXG4gICAgdGhpcy5fZXZlbnRIYW5kbGVyLnVuc3Vic2NyaWJlQWxsKCk7XHJcbiAgICB0aGlzLmhhbmRsZU9uQ2VsbENoYW5nZSA9IG51bGw7XHJcbiAgICB0aGlzLmhhbmRsZU9uQ2VsbENsaWNrID0gbnVsbDtcclxuICB9XHJcblxyXG4gIC8qIE9uQ2VsbENoYW5nZSBFdmVudCAqL1xyXG4gIGJpbmRPbkNlbGxDaGFuZ2UoZ3JpZDogYW55LCBkYXRhVmlldzogYW55KSB7XHJcbiAgICAvLyBzdWJzY3JpYmUgdG8gdGhpcyBTbGlja2dyaWQgZXZlbnQgb2Ygb25DZWxsQ2hhbmdlXHJcbiAgICB0aGlzLl9ldmVudEhhbmRsZXIuc3Vic2NyaWJlKGdyaWQub25DZWxsQ2hhbmdlLCAoZTogS2V5Ym9hcmRFdmVudCB8IE1vdXNlRXZlbnQsIGFyZ3M6IENlbGxBcmdzKSA9PiB7XHJcbiAgICAgIHRoaXMuaGFuZGxlT25DZWxsQ2hhbmdlLmNhbGwodGhpcywgZ3JpZCwgZGF0YVZpZXcsIGUsIGFyZ3MpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKiBPbkNsaWNrIEV2ZW50ICovXHJcbiAgYmluZE9uQ2xpY2soZ3JpZDogYW55LCBkYXRhVmlldzogYW55KSB7XHJcbiAgICB0aGlzLl9ldmVudEhhbmRsZXIuc3Vic2NyaWJlKGdyaWQub25DbGljaywgKGU6IEtleWJvYXJkRXZlbnQgfCBNb3VzZUV2ZW50LCBhcmdzOiBDZWxsQXJncykgPT4ge1xyXG4gICAgICB0aGlzLmhhbmRsZU9uQ2VsbENsaWNrLmNhbGwodGhpcywgZ3JpZCwgZGF0YVZpZXcsIGUsIGFyZ3MpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvL1xyXG4gIC8vIHByaXZhdGUgZnVuY3Rpb25zXHJcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tXHJcblxyXG4gIC8qIE9uQ2VsbENoYW5nZSBFdmVudCBIYW5kbGVyICovXHJcbiAgaGFuZGxlT25DZWxsQ2hhbmdlKGdyaWQ6IGFueSwgZGF0YVZpZXc6IGFueSwgZTogS2V5Ym9hcmRFdmVudCB8IE1vdXNlRXZlbnQsIGFyZ3M6IENlbGxBcmdzKSB7XHJcbiAgICBpZiAoIWUgfHwgIWFyZ3MgfHwgIWdyaWQgfHwgYXJncy5jZWxsID09PSB1bmRlZmluZWQgfHwgIWdyaWQuZ2V0Q29sdW1ucyB8fCAhZ3JpZC5nZXREYXRhSXRlbSkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBjb25zdCBjb2x1bW46IENvbHVtbiA9IGdyaWQuZ2V0Q29sdW1ucygpW2FyZ3MuY2VsbF07XHJcblxyXG4gICAgLy8gaWYgdGhlIGNvbHVtbiBkZWZpbml0aW9uIGhhcyBhIG9uQ2VsbENoYW5nZSBwcm9wZXJ0eSAoYSBjYWxsYmFjayBmdW5jdGlvbiksIHRoZW4gcnVuIGl0XHJcbiAgICBpZiAodHlwZW9mIGNvbHVtbi5vbkNlbGxDaGFuZ2UgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgLy8gYWRkIHRvIHRoZSBvdXRwdXQgZ3JpZE9wdGlvbnMgJiBkYXRhVmlldyBzaW5jZSB3ZSdsbCBuZWVkIHRoZW0gaW5zaWRlIHRoZSBBSkFYIGNvbHVtbi5vbkNlbGxDaGFuZ2VcclxuICAgICAgY29uc3QgcmV0dXJuZWRBcmdzOiBPbkV2ZW50QXJncyA9IHtcclxuICAgICAgICByb3c6IGFyZ3Mucm93LFxyXG4gICAgICAgIGNlbGw6IGFyZ3MuY2VsbCxcclxuICAgICAgICBkYXRhVmlldyxcclxuICAgICAgICBncmlkLFxyXG4gICAgICAgIGNvbHVtbkRlZjogY29sdW1uLFxyXG4gICAgICAgIGRhdGFDb250ZXh0OiBncmlkLmdldERhdGFJdGVtKGFyZ3Mucm93KVxyXG4gICAgICB9O1xyXG5cclxuICAgICAgLy8gZmluYWxseSBjYWxsIHVwIHRoZSBTbGljay5jb2x1bW4ub25DZWxsQ2hhbmdlcy4uLi4gZnVuY3Rpb25cclxuICAgICAgY29sdW1uLm9uQ2VsbENoYW5nZShlLCByZXR1cm5lZEFyZ3MpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyogT25DZWxsQ2xpY2sgRXZlbnQgSGFuZGxlciAqL1xyXG4gIHByaXZhdGUgaGFuZGxlT25DZWxsQ2xpY2soZ3JpZDogYW55LCBkYXRhVmlldzogYW55LCBlOiBLZXlib2FyZEV2ZW50IHwgTW91c2VFdmVudCwgYXJnczogQ2VsbEFyZ3MpIHtcclxuICAgIGlmICghZSB8fCAhYXJncyB8fCAhZ3JpZCB8fCBhcmdzLmNlbGwgPT09IHVuZGVmaW5lZCB8fCAhZ3JpZC5nZXRDb2x1bW5zIHx8ICFncmlkLmdldERhdGFJdGVtKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGNvbnN0IGNvbHVtbjogQ29sdW1uID0gZ3JpZCAmJiBncmlkLmdldENvbHVtbnMgJiYgZ3JpZC5nZXRDb2x1bW5zKClbYXJncy5jZWxsXTtcclxuICAgIGNvbnN0IGdyaWRPcHRpb25zOiBHcmlkT3B0aW9uID0gZ3JpZCAmJiBncmlkLmdldE9wdGlvbnMgJiYgZ3JpZC5nZXRPcHRpb25zKCkgfHwge307XHJcblxyXG4gICAgLy8gb25seSB3aGVuIHVzaW5nIGF1dG9Db21taXRFZGl0LCB3ZSB3aWxsIG1ha2UgdGhlIGNlbGwgYWN0aXZlIChpbiBmb2N1cykgd2hlbiBjbGlja2VkXHJcbiAgICAvLyBzZXR0aW5nIHRoZSBjZWxsIGFzIGFjdGl2ZSBhcyBhIHNpZGUgZWZmZWN0IGFuZCBpZiBhdXRvQ29tbWl0RWRpdCBpcyBzZXQgdG8gZmFsc2UgdGhlbiB0aGUgRWRpdG9ycyB3b24ndCBzYXZlIGNvcnJlY3RseVxyXG4gICAgaWYgKGdyaWRPcHRpb25zLmVuYWJsZUNlbGxOYXZpZ2F0aW9uICYmICghZ3JpZE9wdGlvbnMuZWRpdGFibGUgfHwgKGdyaWRPcHRpb25zLmVkaXRhYmxlICYmIGdyaWRPcHRpb25zLmF1dG9Db21taXRFZGl0KSkpIHtcclxuICAgICAgZ3JpZC5zZXRBY3RpdmVDZWxsKGFyZ3Mucm93LCBhcmdzLmNlbGwpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIGlmIHRoZSBjb2x1bW4gZGVmaW5pdGlvbiBoYXMgYSBvbkNlbGxDbGljayBwcm9wZXJ0eSAoYSBjYWxsYmFjayBmdW5jdGlvbiksIHRoZW4gcnVuIGl0XHJcbiAgICBpZiAodHlwZW9mIGNvbHVtbi5vbkNlbGxDbGljayA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAvLyBhZGQgdG8gdGhlIG91dHB1dCBncmlkT3B0aW9ucyAmIGRhdGFWaWV3IHNpbmNlIHdlJ2xsIG5lZWQgdGhlbSBpbnNpZGUgdGhlIEFKQVggY29sdW1uLm9uQ2xpY2tcclxuICAgICAgY29uc3QgcmV0dXJuZWRBcmdzOiBPbkV2ZW50QXJncyA9IHtcclxuICAgICAgICByb3c6IGFyZ3Mucm93LFxyXG4gICAgICAgIGNlbGw6IGFyZ3MuY2VsbCxcclxuICAgICAgICBkYXRhVmlldyxcclxuICAgICAgICBncmlkLFxyXG4gICAgICAgIGNvbHVtbkRlZjogY29sdW1uLFxyXG4gICAgICAgIGRhdGFDb250ZXh0OiBncmlkLmdldERhdGFJdGVtKGFyZ3Mucm93KVxyXG4gICAgICB9O1xyXG5cclxuICAgICAgLy8gZmluYWxseSBjYWxsIHVwIHRoZSBTbGljay5jb2x1bW4ub25DZWxsQ2xpY2suLi4uIGZ1bmN0aW9uXHJcbiAgICAgIGNvbHVtbi5vbkNlbGxDbGljayhlLCByZXR1cm5lZEFyZ3MpO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG4iXX0=