import * as tslib_1 from "tslib";
import { Injectable } from '@angular/core';
import { ExtensionName } from './../models/index';
import { ExtensionUtility } from '../extensions/extensionUtility';
import { ExtensionService } from './extension.service';
import { ResizerService } from './resizer.service';
import { unsubscribeAllObservables } from './utilities';
import { SharedService } from './shared.service';
import * as ɵngcc0 from '@angular/core';
var GroupingAndColspanService = /** @class */ (function () {
    function GroupingAndColspanService(extensionUtility, extensionService, resizerService, sharedService) {
        this.extensionUtility = extensionUtility;
        this.extensionService = extensionService;
        this.resizerService = resizerService;
        this.sharedService = sharedService;
        this.subscriptions = [];
        this._eventHandler = new Slick.EventHandler();
    }
    Object.defineProperty(GroupingAndColspanService.prototype, "eventHandler", {
        /** Getter of the SlickGrid Event Handler */
        get: function () {
            return this._eventHandler;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(GroupingAndColspanService.prototype, "_gridOptions", {
        /** Getter for the Grid Options pulled through the Grid Object */
        get: function () {
            return (this._grid && this._grid.getOptions) ? this._grid.getOptions() : {};
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(GroupingAndColspanService.prototype, "_columnDefinitions", {
        /** Getter for the Column Definitions pulled through the Grid Object */
        get: function () {
            return (this._grid && this._grid.getColumns) ? this._grid.getColumns() : [];
        },
        enumerable: true,
        configurable: true
    });
    GroupingAndColspanService.prototype.init = function (grid, dataView) {
        var _this = this;
        this._grid = grid;
        if (grid && this._gridOptions) {
            // When dealing with Pre-Header Grouping colspan, we need to re-create the pre-header in multiple occasions
            // for all these events, we have to trigger a re-create
            if (this._gridOptions.createPreHeaderPanel) {
                // on all following events, call the
                this._eventHandler.subscribe(grid.onSort, function () { return _this.renderPreHeaderRowGroupingTitles(); });
                this._eventHandler.subscribe(grid.onColumnsResized, function () { return _this.renderPreHeaderRowGroupingTitles(); });
                this._eventHandler.subscribe(grid.onColumnsReordered, function () { return _this.renderPreHeaderRowGroupingTitles(); });
                this._eventHandler.subscribe(dataView.onRowCountChanged, function () { return _this.renderPreHeaderRowGroupingTitles(); });
                this.subscriptions.push(this.resizerService.onGridAfterResize.subscribe(function () { return _this.renderPreHeaderRowGroupingTitles(); }), this.sharedService.onHeaderMenuHideColumns.subscribe(function () { return _this.delayRenderPreHeaderRowGroupingTitles(0); }));
                this._eventHandler.subscribe(grid.onSetOptions, function (_e, args) {
                    // when user changes frozen columns dynamically (e.g. from header menu), we need to re-render the pre-header of the grouping titles
                    if (args && args.optionsBefore && args.optionsAfter && args.optionsBefore.frozenColumn !== args.optionsAfter.frozenColumn) {
                        _this.delayRenderPreHeaderRowGroupingTitles(0);
                    }
                });
                // for both picker (columnPicker/gridMenu) we also need to re-create after hiding/showing columns
                var columnPickerExtension = this.extensionService.getExtensionByName(ExtensionName.columnPicker);
                if (columnPickerExtension && columnPickerExtension.instance && columnPickerExtension.instance.onColumnsChanged) {
                    this._eventHandler.subscribe(columnPickerExtension.instance.onColumnsChanged, function () { return _this.renderPreHeaderRowGroupingTitles(); });
                }
                var gridMenuExtension = this.extensionService.getExtensionByName(ExtensionName.gridMenu);
                if (gridMenuExtension && gridMenuExtension.instance && gridMenuExtension.instance.onColumnsChanged && gridMenuExtension.instance.onMenuClose) {
                    this._eventHandler.subscribe(gridMenuExtension.instance.onColumnsChanged, function () { return _this.renderPreHeaderRowGroupingTitles(); });
                    this._eventHandler.subscribe(gridMenuExtension.instance.onMenuClose, function () { return _this.renderPreHeaderRowGroupingTitles(); });
                }
                // also not sure why at this point, but it seems that I need to call the 1st create in a delayed execution
                // probably some kind of timing issues and delaying it until the grid is fully ready fixes this problem
                this.delayRenderPreHeaderRowGroupingTitles(50);
            }
        }
    };
    GroupingAndColspanService.prototype.dispose = function () {
        // unsubscribe all SlickGrid events
        this._eventHandler.unsubscribeAll();
        // also unsubscribe all Angular Subscriptions
        this.subscriptions = unsubscribeAllObservables(this.subscriptions);
    };
    /** call "renderPreHeaderRowGroupingTitles()" with a setTimeout delay */
    GroupingAndColspanService.prototype.delayRenderPreHeaderRowGroupingTitles = function (delay) {
        var _this = this;
        if (delay === void 0) { delay = 0; }
        setTimeout(function () { return _this.renderPreHeaderRowGroupingTitles(); }, delay);
    };
    /** Create or Render the Pre-Header Row Grouping Titles */
    GroupingAndColspanService.prototype.renderPreHeaderRowGroupingTitles = function () {
        if (this._gridOptions && this._gridOptions.frozenColumn !== undefined && this._gridOptions.frozenColumn >= 0) {
            // Add column groups to left panel
            var $preHeaderPanel = $(this._grid.getPreHeaderPanelLeft());
            this.renderHeaderGroups($preHeaderPanel, 0, this._gridOptions.frozenColumn + 1);
            // Add column groups to right panel
            $preHeaderPanel = $(this._grid.getPreHeaderPanelRight());
            this.renderHeaderGroups($preHeaderPanel, this._gridOptions.frozenColumn + 1, this._columnDefinitions.length);
        }
        else {
            // regular grid (not a frozen grid)
            var $preHeaderPanel = $(this._grid.getPreHeaderPanel());
            this.renderHeaderGroups($preHeaderPanel, 0, this._columnDefinitions.length);
        }
    };
    GroupingAndColspanService.prototype.renderHeaderGroups = function (preHeaderPanel, start, end) {
        preHeaderPanel.empty()
            .addClass('slick-header-columns')
            .css('left', '-1000px')
            .width(this._grid.getHeadersWidth());
        preHeaderPanel.parent().addClass('slick-header');
        var headerColumnWidthDiff = this._grid.getHeaderColumnWidthDiff();
        var colDef;
        var header;
        var lastColumnGroup = '';
        var widthTotal = 0;
        var frozenHeaderWidthCalcDifferential = this._gridOptions && this._gridOptions.frozenHeaderWidthCalcDifferential || 0;
        var isFrozenGrid = (this._gridOptions && (this._gridOptions.frozenColumn !== undefined && this._gridOptions.frozenColumn >= 0));
        for (var i = start; i < end; i++) {
            colDef = this._columnDefinitions[i];
            if (colDef) {
                if (lastColumnGroup === colDef.columnGroup && i > 0) {
                    widthTotal += colDef.width || 0;
                    if (header && header.width) {
                        header.width(widthTotal - headerColumnWidthDiff - frozenHeaderWidthCalcDifferential); // remove possible frozen border
                    }
                }
                else {
                    widthTotal = colDef.width || 0;
                    header = $("<div class=\"ui-state-default slick-header-column " + (isFrozenGrid ? 'frozen' : '') + "\" />")
                        .html("<span class=\"slick-column-name\">" + (colDef.columnGroup || '') + "</span>")
                        .width(widthTotal - headerColumnWidthDiff)
                        .appendTo(preHeaderPanel);
                }
                lastColumnGroup = colDef.columnGroup || '';
            }
        }
    };
    /** Translate Column Group texts and re-render them afterward. */
    GroupingAndColspanService.prototype.translateGroupingAndColSpan = function () {
        var currentColumnDefinitions = this._grid.getColumns();
        this.extensionUtility.translateItems(currentColumnDefinitions, 'columnGroupKey', 'columnGroup');
        this._grid.setColumns(currentColumnDefinitions);
        this.renderPreHeaderRowGroupingTitles();
    };
    GroupingAndColspanService.ctorParameters = function () { return [
        { type: ExtensionUtility },
        { type: ExtensionService },
        { type: ResizerService },
        { type: SharedService }
    ]; };
GroupingAndColspanService.ɵfac = function GroupingAndColspanService_Factory(t) { return new (t || GroupingAndColspanService)(ɵngcc0.ɵɵinject(ExtensionUtility), ɵngcc0.ɵɵinject(ExtensionService), ɵngcc0.ɵɵinject(ResizerService), ɵngcc0.ɵɵinject(SharedService)); };
GroupingAndColspanService.ɵprov = ɵngcc0.ɵɵdefineInjectable({ token: GroupingAndColspanService, factory: function (t) { return GroupingAndColspanService.ɵfac(t); } });
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(GroupingAndColspanService, [{
        type: Injectable
    }], function () { return [{ type: ExtensionUtility }, { type: ExtensionService }, { type: ResizerService }, { type: SharedService }]; }, null); })();
    return GroupingAndColspanService;
}());
export { GroupingAndColspanService };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ3JvdXBpbmdBbmRDb2xzcGFuLnNlcnZpY2UuanMiLCJzb3VyY2VzIjpbIm5nOi9hbmd1bGFyLXNsaWNrZ3JpZC9hcHAvbW9kdWxlcy9hbmd1bGFyLXNsaWNrZ3JpZC9zZXJ2aWNlcy9ncm91cGluZ0FuZENvbHNwYW4uc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUczQyxPQUFPLEVBQXlDLGFBQWEsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQ3pGLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLGdDQUFnQyxDQUFDO0FBQ2xFLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ3ZELE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUNuRCxPQUFPLEVBQUUseUJBQXlCLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFDeEQsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLGtCQUFrQixDQUFDOztBQVNqRDtBQUNvQixJQUlsQixtQ0FBb0IsZ0JBQWtDLEVBQVUsZ0JBQWtDLEVBQVUsY0FBOEIsRUFBVSxhQUE0QjtBQUNsTCxRQURzQixxQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQWtCO0FBQUMsUUFBUyxxQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQWtCO0FBQUMsUUFBUyxtQkFBYyxHQUFkLGNBQWMsQ0FBZ0I7QUFBQyxRQUFTLGtCQUFhLEdBQWIsYUFBYSxDQUFlO0FBQUMsUUFGekssa0JBQWEsR0FBbUIsRUFBRSxDQUFDO0FBQzdDLFFBRUksSUFBSSxDQUFDLGFBQWEsR0FBRyxJQUFJLEtBQUssQ0FBQyxZQUFZLEVBQUUsQ0FBQztBQUNsRCxJQUFFLENBQUM7QUFDSCxJQUVFLHNCQUFJLG1EQUFZO0FBQUksUUFEcEIsNENBQTRDO0FBQzlDLGFBQUU7QUFBYyxZQUNaLE9BQU8sSUFBSSxDQUFDLGFBQWEsQ0FBQztBQUM5QixRQUFFLENBQUM7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QUEsQUFBQSxBQUFBLEFBQUEsQUFGQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBR0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFHQSxBQUFBLEFBQUEsQUFEQSxBQUFBLEFBQ0EsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFHQSxBQUFBLEFBQUEsQUFEQSxBQUFBLEFBQ0EsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFHQSxBQUFBLEFBQUEsQUFEQSxBQUFBLEFBQ0EsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBeUNBLEFBeENBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUVBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFFQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUNBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBRUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBRUEsQUFGQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUVBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFDQSxBQUNBLEFBQUEsQUFHQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUF2SUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUxBLEFBQUEsQUFEQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBNklBLEFBQUEsQUFBQSxBQUFBLEFBN0lBLEFBNklBLEFBN0lBLEFBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnO1xyXG5cclxuaW1wb3J0IHsgQ29sdW1uLCBHcmlkT3B0aW9uLCBTbGlja0V2ZW50SGFuZGxlciwgRXh0ZW5zaW9uTmFtZSB9IGZyb20gJy4vLi4vbW9kZWxzL2luZGV4JztcclxuaW1wb3J0IHsgRXh0ZW5zaW9uVXRpbGl0eSB9IGZyb20gJy4uL2V4dGVuc2lvbnMvZXh0ZW5zaW9uVXRpbGl0eSc7XHJcbmltcG9ydCB7IEV4dGVuc2lvblNlcnZpY2UgfSBmcm9tICcuL2V4dGVuc2lvbi5zZXJ2aWNlJztcclxuaW1wb3J0IHsgUmVzaXplclNlcnZpY2UgfSBmcm9tICcuL3Jlc2l6ZXIuc2VydmljZSc7XHJcbmltcG9ydCB7IHVuc3Vic2NyaWJlQWxsT2JzZXJ2YWJsZXMgfSBmcm9tICcuL3V0aWxpdGllcyc7XHJcbmltcG9ydCB7IFNoYXJlZFNlcnZpY2UgfSBmcm9tICcuL3NoYXJlZC5zZXJ2aWNlJztcclxuXHJcbi8vIHVzaW5nIGV4dGVybmFsIG5vbi10eXBlZCBqcyBsaWJyYXJpZXNcclxuZGVjbGFyZSBsZXQgJDogYW55O1xyXG5cclxuLy8gdXNpbmcgZXh0ZXJuYWwgbm9uLXR5cGVkIGpzIGxpYnJhcmllc1xyXG5kZWNsYXJlIGNvbnN0IFNsaWNrOiBhbnk7XHJcblxyXG5ASW5qZWN0YWJsZSgpXHJcbmV4cG9ydCBjbGFzcyBHcm91cGluZ0FuZENvbHNwYW5TZXJ2aWNlIHtcclxuICBwcml2YXRlIF9ldmVudEhhbmRsZXI6IFNsaWNrRXZlbnRIYW5kbGVyO1xyXG4gIHByaXZhdGUgX2dyaWQ6IGFueTtcclxuICBwcml2YXRlIHN1YnNjcmlwdGlvbnM6IFN1YnNjcmlwdGlvbltdID0gW107XHJcblxyXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgZXh0ZW5zaW9uVXRpbGl0eTogRXh0ZW5zaW9uVXRpbGl0eSwgcHJpdmF0ZSBleHRlbnNpb25TZXJ2aWNlOiBFeHRlbnNpb25TZXJ2aWNlLCBwcml2YXRlIHJlc2l6ZXJTZXJ2aWNlOiBSZXNpemVyU2VydmljZSwgcHJpdmF0ZSBzaGFyZWRTZXJ2aWNlOiBTaGFyZWRTZXJ2aWNlKSB7XHJcbiAgICB0aGlzLl9ldmVudEhhbmRsZXIgPSBuZXcgU2xpY2suRXZlbnRIYW5kbGVyKCk7XHJcbiAgfVxyXG5cclxuICAvKiogR2V0dGVyIG9mIHRoZSBTbGlja0dyaWQgRXZlbnQgSGFuZGxlciAqL1xyXG4gIGdldCBldmVudEhhbmRsZXIoKTogU2xpY2tFdmVudEhhbmRsZXIge1xyXG4gICAgcmV0dXJuIHRoaXMuX2V2ZW50SGFuZGxlcjtcclxuICB9XHJcblxyXG4gIC8qKiBHZXR0ZXIgZm9yIHRoZSBHcmlkIE9wdGlvbnMgcHVsbGVkIHRocm91Z2ggdGhlIEdyaWQgT2JqZWN0ICovXHJcbiAgcHJpdmF0ZSBnZXQgX2dyaWRPcHRpb25zKCk6IEdyaWRPcHRpb24ge1xyXG4gICAgcmV0dXJuICh0aGlzLl9ncmlkICYmIHRoaXMuX2dyaWQuZ2V0T3B0aW9ucykgPyB0aGlzLl9ncmlkLmdldE9wdGlvbnMoKSA6IHt9O1xyXG4gIH1cclxuXHJcbiAgLyoqIEdldHRlciBmb3IgdGhlIENvbHVtbiBEZWZpbml0aW9ucyBwdWxsZWQgdGhyb3VnaCB0aGUgR3JpZCBPYmplY3QgKi9cclxuICBwcml2YXRlIGdldCBfY29sdW1uRGVmaW5pdGlvbnMoKTogQ29sdW1uW10ge1xyXG4gICAgcmV0dXJuICh0aGlzLl9ncmlkICYmIHRoaXMuX2dyaWQuZ2V0Q29sdW1ucykgPyB0aGlzLl9ncmlkLmdldENvbHVtbnMoKSA6IFtdO1xyXG4gIH1cclxuXHJcbiAgaW5pdChncmlkOiBhbnksIGRhdGFWaWV3OiBhbnkpIHtcclxuICAgIHRoaXMuX2dyaWQgPSBncmlkO1xyXG5cclxuICAgIGlmIChncmlkICYmIHRoaXMuX2dyaWRPcHRpb25zKSB7XHJcbiAgICAgIC8vIFdoZW4gZGVhbGluZyB3aXRoIFByZS1IZWFkZXIgR3JvdXBpbmcgY29sc3Bhbiwgd2UgbmVlZCB0byByZS1jcmVhdGUgdGhlIHByZS1oZWFkZXIgaW4gbXVsdGlwbGUgb2NjYXNpb25zXHJcbiAgICAgIC8vIGZvciBhbGwgdGhlc2UgZXZlbnRzLCB3ZSBoYXZlIHRvIHRyaWdnZXIgYSByZS1jcmVhdGVcclxuICAgICAgaWYgKHRoaXMuX2dyaWRPcHRpb25zLmNyZWF0ZVByZUhlYWRlclBhbmVsKSB7XHJcbiAgICAgICAgLy8gb24gYWxsIGZvbGxvd2luZyBldmVudHMsIGNhbGwgdGhlXHJcbiAgICAgICAgdGhpcy5fZXZlbnRIYW5kbGVyLnN1YnNjcmliZShncmlkLm9uU29ydCwgKCkgPT4gdGhpcy5yZW5kZXJQcmVIZWFkZXJSb3dHcm91cGluZ1RpdGxlcygpKTtcclxuICAgICAgICB0aGlzLl9ldmVudEhhbmRsZXIuc3Vic2NyaWJlKGdyaWQub25Db2x1bW5zUmVzaXplZCwgKCkgPT4gdGhpcy5yZW5kZXJQcmVIZWFkZXJSb3dHcm91cGluZ1RpdGxlcygpKTtcclxuICAgICAgICB0aGlzLl9ldmVudEhhbmRsZXIuc3Vic2NyaWJlKGdyaWQub25Db2x1bW5zUmVvcmRlcmVkLCAoKSA9PiB0aGlzLnJlbmRlclByZUhlYWRlclJvd0dyb3VwaW5nVGl0bGVzKCkpO1xyXG4gICAgICAgIHRoaXMuX2V2ZW50SGFuZGxlci5zdWJzY3JpYmUoZGF0YVZpZXcub25Sb3dDb3VudENoYW5nZWQsICgpID0+IHRoaXMucmVuZGVyUHJlSGVhZGVyUm93R3JvdXBpbmdUaXRsZXMoKSk7XHJcbiAgICAgICAgdGhpcy5zdWJzY3JpcHRpb25zLnB1c2goXHJcbiAgICAgICAgICB0aGlzLnJlc2l6ZXJTZXJ2aWNlLm9uR3JpZEFmdGVyUmVzaXplLnN1YnNjcmliZSgoKSA9PiB0aGlzLnJlbmRlclByZUhlYWRlclJvd0dyb3VwaW5nVGl0bGVzKCkpLFxyXG4gICAgICAgICAgdGhpcy5zaGFyZWRTZXJ2aWNlLm9uSGVhZGVyTWVudUhpZGVDb2x1bW5zLnN1YnNjcmliZSgoKSA9PiB0aGlzLmRlbGF5UmVuZGVyUHJlSGVhZGVyUm93R3JvdXBpbmdUaXRsZXMoMCkpXHJcbiAgICAgICAgKTtcclxuXHJcbiAgICAgICAgdGhpcy5fZXZlbnRIYW5kbGVyLnN1YnNjcmliZShncmlkLm9uU2V0T3B0aW9ucywgKF9lLCBhcmdzKSA9PiB7XHJcbiAgICAgICAgICAvLyB3aGVuIHVzZXIgY2hhbmdlcyBmcm96ZW4gY29sdW1ucyBkeW5hbWljYWxseSAoZS5nLiBmcm9tIGhlYWRlciBtZW51KSwgd2UgbmVlZCB0byByZS1yZW5kZXIgdGhlIHByZS1oZWFkZXIgb2YgdGhlIGdyb3VwaW5nIHRpdGxlc1xyXG4gICAgICAgICAgaWYgKGFyZ3MgJiYgYXJncy5vcHRpb25zQmVmb3JlICYmIGFyZ3Mub3B0aW9uc0FmdGVyICYmIGFyZ3Mub3B0aW9uc0JlZm9yZS5mcm96ZW5Db2x1bW4gIT09IGFyZ3Mub3B0aW9uc0FmdGVyLmZyb3plbkNvbHVtbikge1xyXG4gICAgICAgICAgICB0aGlzLmRlbGF5UmVuZGVyUHJlSGVhZGVyUm93R3JvdXBpbmdUaXRsZXMoMCk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vIGZvciBib3RoIHBpY2tlciAoY29sdW1uUGlja2VyL2dyaWRNZW51KSB3ZSBhbHNvIG5lZWQgdG8gcmUtY3JlYXRlIGFmdGVyIGhpZGluZy9zaG93aW5nIGNvbHVtbnNcclxuICAgICAgICBjb25zdCBjb2x1bW5QaWNrZXJFeHRlbnNpb24gPSB0aGlzLmV4dGVuc2lvblNlcnZpY2UuZ2V0RXh0ZW5zaW9uQnlOYW1lKEV4dGVuc2lvbk5hbWUuY29sdW1uUGlja2VyKTtcclxuICAgICAgICBpZiAoY29sdW1uUGlja2VyRXh0ZW5zaW9uICYmIGNvbHVtblBpY2tlckV4dGVuc2lvbi5pbnN0YW5jZSAmJiBjb2x1bW5QaWNrZXJFeHRlbnNpb24uaW5zdGFuY2Uub25Db2x1bW5zQ2hhbmdlZCkge1xyXG4gICAgICAgICAgdGhpcy5fZXZlbnRIYW5kbGVyLnN1YnNjcmliZShjb2x1bW5QaWNrZXJFeHRlbnNpb24uaW5zdGFuY2Uub25Db2x1bW5zQ2hhbmdlZCwgKCkgPT4gdGhpcy5yZW5kZXJQcmVIZWFkZXJSb3dHcm91cGluZ1RpdGxlcygpKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IGdyaWRNZW51RXh0ZW5zaW9uID0gdGhpcy5leHRlbnNpb25TZXJ2aWNlLmdldEV4dGVuc2lvbkJ5TmFtZShFeHRlbnNpb25OYW1lLmdyaWRNZW51KTtcclxuICAgICAgICBpZiAoZ3JpZE1lbnVFeHRlbnNpb24gJiYgZ3JpZE1lbnVFeHRlbnNpb24uaW5zdGFuY2UgJiYgZ3JpZE1lbnVFeHRlbnNpb24uaW5zdGFuY2Uub25Db2x1bW5zQ2hhbmdlZCAmJiBncmlkTWVudUV4dGVuc2lvbi5pbnN0YW5jZS5vbk1lbnVDbG9zZSkge1xyXG4gICAgICAgICAgdGhpcy5fZXZlbnRIYW5kbGVyLnN1YnNjcmliZShncmlkTWVudUV4dGVuc2lvbi5pbnN0YW5jZS5vbkNvbHVtbnNDaGFuZ2VkLCAoKSA9PiB0aGlzLnJlbmRlclByZUhlYWRlclJvd0dyb3VwaW5nVGl0bGVzKCkpO1xyXG4gICAgICAgICAgdGhpcy5fZXZlbnRIYW5kbGVyLnN1YnNjcmliZShncmlkTWVudUV4dGVuc2lvbi5pbnN0YW5jZS5vbk1lbnVDbG9zZSwgKCkgPT4gdGhpcy5yZW5kZXJQcmVIZWFkZXJSb3dHcm91cGluZ1RpdGxlcygpKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIGFsc28gbm90IHN1cmUgd2h5IGF0IHRoaXMgcG9pbnQsIGJ1dCBpdCBzZWVtcyB0aGF0IEkgbmVlZCB0byBjYWxsIHRoZSAxc3QgY3JlYXRlIGluIGEgZGVsYXllZCBleGVjdXRpb25cclxuICAgICAgICAvLyBwcm9iYWJseSBzb21lIGtpbmQgb2YgdGltaW5nIGlzc3VlcyBhbmQgZGVsYXlpbmcgaXQgdW50aWwgdGhlIGdyaWQgaXMgZnVsbHkgcmVhZHkgZml4ZXMgdGhpcyBwcm9ibGVtXHJcbiAgICAgICAgdGhpcy5kZWxheVJlbmRlclByZUhlYWRlclJvd0dyb3VwaW5nVGl0bGVzKDUwKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgZGlzcG9zZSgpIHtcclxuICAgIC8vIHVuc3Vic2NyaWJlIGFsbCBTbGlja0dyaWQgZXZlbnRzXHJcbiAgICB0aGlzLl9ldmVudEhhbmRsZXIudW5zdWJzY3JpYmVBbGwoKTtcclxuXHJcbiAgICAvLyBhbHNvIHVuc3Vic2NyaWJlIGFsbCBBbmd1bGFyIFN1YnNjcmlwdGlvbnNcclxuICAgIHRoaXMuc3Vic2NyaXB0aW9ucyA9IHVuc3Vic2NyaWJlQWxsT2JzZXJ2YWJsZXModGhpcy5zdWJzY3JpcHRpb25zKTtcclxuICB9XHJcblxyXG4gIC8qKiBjYWxsIFwicmVuZGVyUHJlSGVhZGVyUm93R3JvdXBpbmdUaXRsZXMoKVwiIHdpdGggYSBzZXRUaW1lb3V0IGRlbGF5ICovXHJcbiAgZGVsYXlSZW5kZXJQcmVIZWFkZXJSb3dHcm91cGluZ1RpdGxlcyhkZWxheSA9IDApIHtcclxuICAgIHNldFRpbWVvdXQoKCkgPT4gdGhpcy5yZW5kZXJQcmVIZWFkZXJSb3dHcm91cGluZ1RpdGxlcygpLCBkZWxheSk7XHJcbiAgfVxyXG5cclxuICAvKiogQ3JlYXRlIG9yIFJlbmRlciB0aGUgUHJlLUhlYWRlciBSb3cgR3JvdXBpbmcgVGl0bGVzICovXHJcbiAgcmVuZGVyUHJlSGVhZGVyUm93R3JvdXBpbmdUaXRsZXMoKSB7XHJcbiAgICBpZiAodGhpcy5fZ3JpZE9wdGlvbnMgJiYgdGhpcy5fZ3JpZE9wdGlvbnMuZnJvemVuQ29sdW1uICE9PSB1bmRlZmluZWQgJiYgdGhpcy5fZ3JpZE9wdGlvbnMuZnJvemVuQ29sdW1uID49IDApIHtcclxuICAgICAgLy8gQWRkIGNvbHVtbiBncm91cHMgdG8gbGVmdCBwYW5lbFxyXG4gICAgICBsZXQgJHByZUhlYWRlclBhbmVsID0gJCh0aGlzLl9ncmlkLmdldFByZUhlYWRlclBhbmVsTGVmdCgpKTtcclxuICAgICAgdGhpcy5yZW5kZXJIZWFkZXJHcm91cHMoJHByZUhlYWRlclBhbmVsLCAwLCB0aGlzLl9ncmlkT3B0aW9ucy5mcm96ZW5Db2x1bW4gKyAxKTtcclxuXHJcbiAgICAgIC8vIEFkZCBjb2x1bW4gZ3JvdXBzIHRvIHJpZ2h0IHBhbmVsXHJcbiAgICAgICRwcmVIZWFkZXJQYW5lbCA9ICQodGhpcy5fZ3JpZC5nZXRQcmVIZWFkZXJQYW5lbFJpZ2h0KCkpO1xyXG4gICAgICB0aGlzLnJlbmRlckhlYWRlckdyb3VwcygkcHJlSGVhZGVyUGFuZWwsIHRoaXMuX2dyaWRPcHRpb25zLmZyb3plbkNvbHVtbiArIDEsIHRoaXMuX2NvbHVtbkRlZmluaXRpb25zLmxlbmd0aCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAvLyByZWd1bGFyIGdyaWQgKG5vdCBhIGZyb3plbiBncmlkKVxyXG4gICAgICBjb25zdCAkcHJlSGVhZGVyUGFuZWwgPSAkKHRoaXMuX2dyaWQuZ2V0UHJlSGVhZGVyUGFuZWwoKSk7XHJcbiAgICAgIHRoaXMucmVuZGVySGVhZGVyR3JvdXBzKCRwcmVIZWFkZXJQYW5lbCwgMCwgdGhpcy5fY29sdW1uRGVmaW5pdGlvbnMubGVuZ3RoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHJlbmRlckhlYWRlckdyb3VwcyhwcmVIZWFkZXJQYW5lbDogYW55LCBzdGFydDogbnVtYmVyLCBlbmQ6IG51bWJlcikge1xyXG4gICAgcHJlSGVhZGVyUGFuZWwuZW1wdHkoKVxyXG4gICAgICAuYWRkQ2xhc3MoJ3NsaWNrLWhlYWRlci1jb2x1bW5zJylcclxuICAgICAgLmNzcygnbGVmdCcsICctMTAwMHB4JylcclxuICAgICAgLndpZHRoKHRoaXMuX2dyaWQuZ2V0SGVhZGVyc1dpZHRoKCkpO1xyXG4gICAgcHJlSGVhZGVyUGFuZWwucGFyZW50KCkuYWRkQ2xhc3MoJ3NsaWNrLWhlYWRlcicpO1xyXG5cclxuICAgIGNvbnN0IGhlYWRlckNvbHVtbldpZHRoRGlmZiA9IHRoaXMuX2dyaWQuZ2V0SGVhZGVyQ29sdW1uV2lkdGhEaWZmKCk7XHJcblxyXG4gICAgbGV0IGNvbERlZjtcclxuICAgIGxldCBoZWFkZXI7XHJcbiAgICBsZXQgbGFzdENvbHVtbkdyb3VwID0gJyc7XHJcbiAgICBsZXQgd2lkdGhUb3RhbCA9IDA7XHJcbiAgICBjb25zdCBmcm96ZW5IZWFkZXJXaWR0aENhbGNEaWZmZXJlbnRpYWwgPSB0aGlzLl9ncmlkT3B0aW9ucyAmJiB0aGlzLl9ncmlkT3B0aW9ucy5mcm96ZW5IZWFkZXJXaWR0aENhbGNEaWZmZXJlbnRpYWwgfHwgMDtcclxuICAgIGNvbnN0IGlzRnJvemVuR3JpZCA9ICh0aGlzLl9ncmlkT3B0aW9ucyAmJiAodGhpcy5fZ3JpZE9wdGlvbnMuZnJvemVuQ29sdW1uICE9PSB1bmRlZmluZWQgJiYgdGhpcy5fZ3JpZE9wdGlvbnMuZnJvemVuQ29sdW1uID49IDApKTtcclxuXHJcbiAgICBmb3IgKGxldCBpID0gc3RhcnQ7IGkgPCBlbmQ7IGkrKykge1xyXG4gICAgICBjb2xEZWYgPSB0aGlzLl9jb2x1bW5EZWZpbml0aW9uc1tpXTtcclxuICAgICAgaWYgKGNvbERlZikge1xyXG4gICAgICAgIGlmIChsYXN0Q29sdW1uR3JvdXAgPT09IGNvbERlZi5jb2x1bW5Hcm91cCAmJiBpID4gMCkge1xyXG4gICAgICAgICAgd2lkdGhUb3RhbCArPSBjb2xEZWYud2lkdGggfHwgMDtcclxuICAgICAgICAgIGlmIChoZWFkZXIgJiYgaGVhZGVyLndpZHRoKSB7XHJcbiAgICAgICAgICAgIGhlYWRlci53aWR0aCh3aWR0aFRvdGFsIC0gaGVhZGVyQ29sdW1uV2lkdGhEaWZmIC0gZnJvemVuSGVhZGVyV2lkdGhDYWxjRGlmZmVyZW50aWFsKTsgLy8gcmVtb3ZlIHBvc3NpYmxlIGZyb3plbiBib3JkZXJcclxuICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgd2lkdGhUb3RhbCA9IGNvbERlZi53aWR0aCB8fCAwO1xyXG4gICAgICAgICAgaGVhZGVyID0gJChgPGRpdiBjbGFzcz1cInVpLXN0YXRlLWRlZmF1bHQgc2xpY2staGVhZGVyLWNvbHVtbiAke2lzRnJvemVuR3JpZCA/ICdmcm96ZW4nIDogJyd9XCIgLz5gKVxyXG4gICAgICAgICAgICAuaHRtbChgPHNwYW4gY2xhc3M9XCJzbGljay1jb2x1bW4tbmFtZVwiPiR7Y29sRGVmLmNvbHVtbkdyb3VwIHx8ICcnfTwvc3Bhbj5gKVxyXG4gICAgICAgICAgICAud2lkdGgod2lkdGhUb3RhbCAtIGhlYWRlckNvbHVtbldpZHRoRGlmZilcclxuICAgICAgICAgICAgLmFwcGVuZFRvKHByZUhlYWRlclBhbmVsKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgbGFzdENvbHVtbkdyb3VwID0gY29sRGVmLmNvbHVtbkdyb3VwIHx8ICcnO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuXHJcbiAgLyoqIFRyYW5zbGF0ZSBDb2x1bW4gR3JvdXAgdGV4dHMgYW5kIHJlLXJlbmRlciB0aGVtIGFmdGVyd2FyZC4gKi9cclxuICB0cmFuc2xhdGVHcm91cGluZ0FuZENvbFNwYW4oKSB7XHJcbiAgICBjb25zdCBjdXJyZW50Q29sdW1uRGVmaW5pdGlvbnMgPSB0aGlzLl9ncmlkLmdldENvbHVtbnMoKTtcclxuICAgIHRoaXMuZXh0ZW5zaW9uVXRpbGl0eS50cmFuc2xhdGVJdGVtcyhjdXJyZW50Q29sdW1uRGVmaW5pdGlvbnMsICdjb2x1bW5Hcm91cEtleScsICdjb2x1bW5Hcm91cCcpO1xyXG4gICAgdGhpcy5fZ3JpZC5zZXRDb2x1bW5zKGN1cnJlbnRDb2x1bW5EZWZpbml0aW9ucyk7XHJcbiAgICB0aGlzLnJlbmRlclByZUhlYWRlclJvd0dyb3VwaW5nVGl0bGVzKCk7XHJcbiAgfVxyXG59XHJcbiJdfQ==