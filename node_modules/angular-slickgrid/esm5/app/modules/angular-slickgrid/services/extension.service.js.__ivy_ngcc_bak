import * as tslib_1 from "tslib";
// import common 3rd party SlickGrid plugins/libs
import 'slickgrid/plugins/slick.cellrangedecorator';
import 'slickgrid/plugins/slick.cellrangeselector';
import 'slickgrid/plugins/slick.cellselectionmodel';
import { Injectable, Optional } from '@angular/core';
import { TranslateService } from '@ngx-translate/core';
import { ExtensionName, } from '../models/index';
import { AutoTooltipExtension, CellExternalCopyManagerExtension, CellMenuExtension, CheckboxSelectorExtension, ColumnPickerExtension, ContextMenuExtension, DraggableGroupingExtension, GridMenuExtension, GroupItemMetaProviderExtension, HeaderButtonExtension, HeaderMenuExtension, RowDetailViewExtension, RowMoveManagerExtension, RowSelectionExtension, } from '../extensions/index';
import { SharedService } from './shared.service';
var ExtensionService = /** @class */ (function () {
    function ExtensionService(autoTooltipExtension, cellExternalCopyExtension, cellMenuExtension, checkboxSelectorExtension, columnPickerExtension, contextMenuExtension, draggableGroupingExtension, gridMenuExtension, groupItemMetaExtension, headerButtonExtension, headerMenuExtension, rowDetailViewExtension, rowMoveManagerExtension, rowSelectionExtension, sharedService, translate) {
        this.autoTooltipExtension = autoTooltipExtension;
        this.cellExternalCopyExtension = cellExternalCopyExtension;
        this.cellMenuExtension = cellMenuExtension;
        this.checkboxSelectorExtension = checkboxSelectorExtension;
        this.columnPickerExtension = columnPickerExtension;
        this.contextMenuExtension = contextMenuExtension;
        this.draggableGroupingExtension = draggableGroupingExtension;
        this.gridMenuExtension = gridMenuExtension;
        this.groupItemMetaExtension = groupItemMetaExtension;
        this.headerButtonExtension = headerButtonExtension;
        this.headerMenuExtension = headerMenuExtension;
        this.rowDetailViewExtension = rowDetailViewExtension;
        this.rowMoveManagerExtension = rowMoveManagerExtension;
        this.rowSelectionExtension = rowSelectionExtension;
        this.sharedService = sharedService;
        this.translate = translate;
        this._extensionCreatedList = {};
        this._extensionList = {};
    }
    Object.defineProperty(ExtensionService.prototype, "extensionList", {
        get: function () {
            return this._extensionList;
        },
        enumerable: true,
        configurable: true
    });
    /** Dispose of all the controls & plugins */
    ExtensionService.prototype.dispose = function () {
        var e_1, _a, e_2, _b;
        this.sharedService.grid = null;
        this.sharedService.visibleColumns = [];
        try {
            // dispose of each control/plugin & reset the list
            for (var _c = tslib_1.__values(Object.keys(this._extensionList)), _d = _c.next(); !_d.done; _d = _c.next()) {
                var extensionName = _d.value;
                if (this._extensionList.hasOwnProperty(extensionName)) {
                    var extension = this._extensionList[extensionName];
                    if (extension && extension.class && extension.class.dispose) {
                        extension.class.dispose();
                    }
                }
            }
        }
        catch (e_1_1) { e_1 = { error: e_1_1 }; }
        finally {
            try {
                if (_d && !_d.done && (_a = _c.return)) _a.call(_c);
            }
            finally { if (e_1) throw e_1.error; }
        }
        try {
            for (var _e = tslib_1.__values(Object.keys(this._extensionList)), _f = _e.next(); !_f.done; _f = _e.next()) {
                var key = _f.value;
                delete this._extensionList[key];
            }
        }
        catch (e_2_1) { e_2 = { error: e_2_1 }; }
        finally {
            try {
                if (_f && !_f.done && (_b = _e.return)) _b.call(_e);
            }
            finally { if (e_2) throw e_2.error; }
        }
    };
    /** Get all columns (includes visible and non-visible) */
    ExtensionService.prototype.getAllColumns = function () {
        return this.sharedService.allColumns || [];
    };
    /** Get only visible columns */
    ExtensionService.prototype.getVisibleColumns = function () {
        return this.sharedService.visibleColumns || [];
    };
    /**
     * Get an Extension by it's name
     *  @param name
     */
    ExtensionService.prototype.getExtensionByName = function (name) {
        if (this._extensionList && this._extensionList[name]) {
            return this._extensionList[name];
        }
        return undefined;
    };
    /**
     * Get the instance of the SlickGrid addon (control or plugin).
     * This is the raw addon coming directly from SlickGrid itself, not to confuse with Angular-Slickgrid extension
     *  @param name
     */
    ExtensionService.prototype.getSlickgridAddonInstance = function (name) {
        var extension = this.getExtensionByName(name);
        if (extension && extension.class && (extension.instance || extension.addon)) {
            if (extension.class && extension.class.getAddonInstance) {
                return extension.class.getAddonInstance();
            }
            return extension.instance;
        }
        return null;
    };
    /** Auto-resize all the column in the grid to fit the grid width */
    ExtensionService.prototype.autoResizeColumns = function () {
        this.sharedService.grid.autosizeColumns();
    };
    /** Bind/Create different Controls or Plugins after the Grid is created */
    ExtensionService.prototype.bindDifferentExtensions = function () {
        var _this = this;
        if (this.sharedService && this.sharedService.gridOptions) {
            // make sure all columns are translated before creating ColumnPicker/GridMenu Controls
            // this is to avoid having hidden columns not being translated on first load
            if (this.sharedService.gridOptions.enableTranslate) {
                // eventually deprecate the "headerKey" and use only the "nameKey"
                this.translateItems(this.sharedService.allColumns, 'headerKey', 'name');
                this.translateItems(this.sharedService.allColumns, 'nameKey', 'name');
            }
            // Auto Tooltip Plugin
            if (this.sharedService.gridOptions.enableAutoTooltip) {
                if (this.autoTooltipExtension && this.autoTooltipExtension.register) {
                    var instance = this.autoTooltipExtension.register();
                    this._extensionList[ExtensionName.autoTooltip] = { name: ExtensionName.autoTooltip, class: this.autoTooltipExtension, addon: instance, instance: instance };
                }
            }
            // Cell External Copy Manager Plugin (Excel Like)
            if (this.sharedService.gridOptions.enableExcelCopyBuffer) {
                if (this.cellExternalCopyExtension && this.cellExternalCopyExtension.register) {
                    var instance = this.cellExternalCopyExtension.register();
                    this._extensionList[ExtensionName.cellExternalCopyManager] = { name: ExtensionName.cellExternalCopyManager, class: this.cellExternalCopyExtension, addon: instance, instance: instance };
                }
            }
            // (Action) Cell Menu Plugin
            if (this.sharedService.gridOptions.enableCellMenu) {
                if (this.cellMenuExtension && this.cellMenuExtension.register) {
                    var instance = this.cellMenuExtension.register();
                    this._extensionList[ExtensionName.cellMenu] = { name: ExtensionName.cellMenu, class: this.cellMenuExtension, addon: instance, instance: instance };
                }
            }
            // Row Selection Plugin
            // this extension should be registered BEFORE the CheckboxSelector, RowDetail or RowMoveManager since it can be use by these 2 plugins
            if (!this.getExtensionByName(ExtensionName.rowSelection) && (this.sharedService.gridOptions.enableRowSelection || this.sharedService.gridOptions.enableCheckboxSelector || this.sharedService.gridOptions.enableRowDetailView || this.sharedService.gridOptions.enableRowMoveManager)) {
                if (this.rowSelectionExtension && this.rowSelectionExtension.register) {
                    var instance = this.rowSelectionExtension.register();
                    this._extensionList[ExtensionName.rowSelection] = { name: ExtensionName.rowSelection, class: this.rowSelectionExtension, addon: instance, instance: instance };
                }
            }
            // Checkbox Selector Plugin
            if (this.sharedService.gridOptions.enableCheckboxSelector) {
                if (this.checkboxSelectorExtension && this.checkboxSelectorExtension.register) {
                    var rowSelectionExtension = this.getExtensionByName(ExtensionName.rowSelection);
                    this.checkboxSelectorExtension.register(rowSelectionExtension);
                    var createdExtension = this.getCreatedExtensionByName(ExtensionName.checkboxSelector); // get the instance from when it was really created earlier
                    var instance = createdExtension && createdExtension.instance;
                    this._extensionList[ExtensionName.checkboxSelector] = { name: ExtensionName.checkboxSelector, class: this.checkboxSelectorExtension, addon: instance, instance: instance };
                }
            }
            // Column Picker Control
            if (this.sharedService.gridOptions.enableColumnPicker) {
                if (this.columnPickerExtension && this.columnPickerExtension.register) {
                    var instance = this.columnPickerExtension.register();
                    this._extensionList[ExtensionName.columnPicker] = { name: ExtensionName.columnPicker, class: this.columnPickerExtension, addon: instance, instance: instance };
                }
            }
            // Context Menu Control
            if (this.sharedService.gridOptions.enableContextMenu) {
                if (this.contextMenuExtension && this.contextMenuExtension.register) {
                    var instance = this.contextMenuExtension.register();
                    this._extensionList[ExtensionName.contextMenu] = { name: ExtensionName.contextMenu, class: this.contextMenuExtension, addon: instance, instance: instance };
                }
            }
            // Draggable Grouping Plugin
            if (this.sharedService.gridOptions.enableDraggableGrouping) {
                if (this.draggableGroupingExtension && this.draggableGroupingExtension.register) {
                    var instance = this.draggableGroupingExtension.register();
                    this._extensionList[ExtensionName.draggableGrouping] = { name: ExtensionName.draggableGrouping, class: this.draggableGroupingExtension, addon: instance, instance: instance };
                }
            }
            // Grid Menu Control
            if (this.sharedService.gridOptions.enableGridMenu) {
                if (this.gridMenuExtension && this.gridMenuExtension.register) {
                    var instance = this.gridMenuExtension.register();
                    this._extensionList[ExtensionName.gridMenu] = { name: ExtensionName.gridMenu, class: this.gridMenuExtension, addon: instance, instance: instance };
                }
            }
            // Grouping Plugin
            // register the group item metadata provider to add expand/collapse group handlers
            if (this.sharedService.gridOptions.enableDraggableGrouping || this.sharedService.gridOptions.enableGrouping) {
                if (this.groupItemMetaExtension && this.groupItemMetaExtension.register) {
                    var instance = this.groupItemMetaExtension.register();
                    this._extensionList[ExtensionName.groupItemMetaProvider] = { name: ExtensionName.groupItemMetaProvider, class: this.groupItemMetaExtension, addon: instance, instance: instance };
                }
            }
            // Header Button Plugin
            if (this.sharedService.gridOptions.enableHeaderButton) {
                if (this.headerButtonExtension && this.headerButtonExtension.register) {
                    var instance = this.headerButtonExtension.register();
                    this._extensionList[ExtensionName.headerButton] = { name: ExtensionName.headerButton, class: this.headerButtonExtension, addon: instance, instance: instance };
                }
            }
            // Header Menu Plugin
            if (this.sharedService.gridOptions.enableHeaderMenu) {
                if (this.headerMenuExtension && this.headerMenuExtension.register) {
                    var instance = this.headerMenuExtension.register();
                    this._extensionList[ExtensionName.headerMenu] = { name: ExtensionName.headerMenu, class: this.headerMenuExtension, addon: instance, instance: instance };
                }
            }
            // Row Detail View Plugin
            if (this.sharedService.gridOptions.enableRowDetailView) {
                if (this.rowDetailViewExtension && this.rowDetailViewExtension.register) {
                    var rowSelectionExtension = this.getExtensionByName(ExtensionName.rowSelection);
                    this.rowDetailViewExtension.register(rowSelectionExtension);
                    var createdExtension = this.getCreatedExtensionByName(ExtensionName.rowDetailView); // get the plugin from when it was really created earlier
                    var instance = createdExtension && createdExtension.instance;
                    this._extensionList[ExtensionName.rowDetailView] = { name: ExtensionName.rowDetailView, class: this.rowDetailViewExtension, addon: instance, instance: instance };
                }
            }
            // Row Move Manager Plugin
            if (this.sharedService.gridOptions.enableRowMoveManager && this.rowMoveManagerExtension && this.rowMoveManagerExtension.register) {
                var rowSelectionExtension = this.getExtensionByName(ExtensionName.rowSelection);
                this.rowMoveManagerExtension.register(rowSelectionExtension);
                var createdExtension = this.getCreatedExtensionByName(ExtensionName.rowMoveManager); // get the instance from when it was really created earlier
                var instance = createdExtension && createdExtension.instance;
                this._extensionList[ExtensionName.rowMoveManager] = { name: ExtensionName.rowMoveManager, class: this.rowMoveManagerExtension, addon: instance, instance: instance };
            }
            // manually register other plugins
            if (this.sharedService.gridOptions.registerPlugins !== undefined) {
                var grid_1 = this.sharedService.grid;
                var gridOptions = this.sharedService.gridOptions;
                if (Array.isArray(gridOptions.registerPlugins)) {
                    gridOptions.registerPlugins.forEach(function (plugin) {
                        grid_1.registerPlugin(plugin);
                        var instance = grid_1.getPluginByName(plugin && plugin.name || '');
                        _this._extensionList[ExtensionName.noname] = { name: ExtensionName.noname, class: null, addon: instance, instance: instance };
                    });
                }
                else {
                    var plugin = gridOptions.registerPlugins;
                    grid_1.registerPlugin(plugin);
                    var instance = grid_1.getPluginByName(plugin && plugin.name || '');
                    this._extensionList[ExtensionName.noname] = { name: ExtensionName.noname, class: null, addon: instance, instance: instance };
                }
            }
        }
    };
    /**
     * Bind/Create certain plugins before the Grid creation to avoid having odd behaviors.
     * Mostly because the column definitions might change after the grid creation, so we want to make sure to add it before then
     * @param columnDefinitions
     * @param options
     */
    ExtensionService.prototype.createExtensionsBeforeGridCreation = function (columnDefinitions, options) {
        if (options.enableCheckboxSelector) {
            if (!this.getCreatedExtensionByName(ExtensionName.checkboxSelector)) {
                var checkboxInstance = this.checkboxSelectorExtension.create(columnDefinitions, options);
                this._extensionCreatedList[ExtensionName.checkboxSelector] = { name: ExtensionName.checkboxSelector, addon: checkboxInstance, instance: checkboxInstance, class: this.checkboxSelectorExtension };
            }
        }
        if (options.enableRowMoveManager) {
            if (!this.getCreatedExtensionByName(ExtensionName.rowMoveManager)) {
                var rowMoveInstance = this.rowMoveManagerExtension.create(columnDefinitions, options);
                this._extensionCreatedList[ExtensionName.rowMoveManager] = { name: ExtensionName.rowMoveManager, addon: rowMoveInstance, instance: rowMoveInstance, class: this.rowMoveManagerExtension };
            }
        }
        if (options.enableRowDetailView) {
            if (!this.getCreatedExtensionByName(ExtensionName.rowDetailView)) {
                var rowDetailInstance = this.rowDetailViewExtension.create(columnDefinitions, options);
                this._extensionCreatedList[ExtensionName.rowDetailView] = { name: ExtensionName.rowDetailView, addon: rowDetailInstance, instance: rowDetailInstance, class: this.rowDetailViewExtension };
            }
        }
        if (options.enableDraggableGrouping) {
            if (!this.getCreatedExtensionByName(ExtensionName.draggableGrouping)) {
                var draggableInstance = this.draggableGroupingExtension.create(options);
                options.enableColumnReorder = draggableInstance.getSetupColumnReorder;
                this._extensionCreatedList[ExtensionName.draggableGrouping] = { name: ExtensionName.draggableGrouping, addon: draggableInstance, instance: draggableInstance, class: draggableInstance.getSetupColumnReorder };
            }
        }
    };
    /** Hide a column from the grid */
    ExtensionService.prototype.hideColumn = function (column) {
        if (this.sharedService && this.sharedService.grid && this.sharedService.grid.getColumns && this.sharedService.grid.setColumns) {
            var columnIndex = this.sharedService.grid.getColumnIndex(column.id);
            this.sharedService.visibleColumns = this.removeColumnByIndex(this.sharedService.grid.getColumns(), columnIndex);
            this.sharedService.grid.setColumns(this.sharedService.visibleColumns);
        }
    };
    /** Refresh the dataset through the Backend Service */
    ExtensionService.prototype.refreshBackendDataset = function (gridOptions) {
        this.gridMenuExtension.refreshBackendDataset(gridOptions);
    };
    /**
     * Remove a column from the grid by it's index in the grid
     * @param columns input
     * @param index
     */
    ExtensionService.prototype.removeColumnByIndex = function (columns, index) {
        if (Array.isArray(columns)) {
            return columns.filter(function (el, i) { return index !== i; });
        }
        return columns;
    };
    /** Translate the Cell Menu titles, we need to loop through all column definition to re-translate them */
    ExtensionService.prototype.translateCellMenu = function () {
        if (this.cellMenuExtension && this.cellMenuExtension.translateCellMenu) {
            this.cellMenuExtension.translateCellMenu();
        }
    };
    /** Translate the Column Picker and it's last 2 checkboxes */
    ExtensionService.prototype.translateColumnPicker = function () {
        if (this.columnPickerExtension && this.columnPickerExtension.translateColumnPicker) {
            this.columnPickerExtension.translateColumnPicker();
        }
    };
    /** Translate the Context Menu titles, we need to loop through all column definition to re-translate them */
    ExtensionService.prototype.translateContextMenu = function () {
        if (this.contextMenuExtension && this.contextMenuExtension.translateContextMenu) {
            this.contextMenuExtension.translateContextMenu();
        }
    };
    /**
     * Translate the Header Menu titles, we need to loop through all column definition to re-translate them
     */
    ExtensionService.prototype.translateGridMenu = function () {
        if (this.gridMenuExtension && this.gridMenuExtension.translateGridMenu) {
            this.gridMenuExtension.translateGridMenu();
        }
    };
    /**
     * Translate the Header Menu titles, we need to loop through all column definition to re-translate them
     */
    ExtensionService.prototype.translateHeaderMenu = function () {
        if (this.headerMenuExtension && this.headerMenuExtension.translateHeaderMenu) {
            this.headerMenuExtension.translateHeaderMenu();
        }
    };
    /**
     * Translate manually the header titles.
     * We could optionally pass a locale (that will change currently loaded locale), else it will use current locale
     * @param locale to use
     * @param new column definitions (optional)
     */
    ExtensionService.prototype.translateColumnHeaders = function (locale, newColumnDefinitions) {
        if (this.sharedService && this.sharedService.gridOptions && this.sharedService.gridOptions.enableTranslate && (!this.translate || !this.translate.instant)) {
            throw new Error('[Angular-Slickgrid] requires "ngx-translate" to be installed and configured when the grid option "enableTranslate" is enabled.');
        }
        if (locale) {
            this.translate.use(locale);
        }
        var columnDefinitions = newColumnDefinitions;
        if (!columnDefinitions) {
            columnDefinitions = this.sharedService.columnDefinitions;
        }
        // eventually deprecate the "headerKey" and use only the "nameKey"
        this.translateItems(columnDefinitions, 'headerKey', 'name');
        this.translateItems(this.sharedService.allColumns, 'headerKey', 'name');
        this.translateItems(columnDefinitions, 'nameKey', 'name');
        this.translateItems(this.sharedService.allColumns, 'nameKey', 'name');
        // re-render the column headers
        this.renderColumnHeaders(columnDefinitions, Array.isArray(newColumnDefinitions));
        this.gridMenuExtension.translateGridMenu();
    };
    /**
     * Render (or re-render) the column headers from column definitions.
     * calling setColumns() will trigger a grid re-render
     */
    ExtensionService.prototype.renderColumnHeaders = function (newColumnDefinitions, forceColumnDefinitionsOverwrite) {
        if (forceColumnDefinitionsOverwrite === void 0) { forceColumnDefinitionsOverwrite = false; }
        var collection = newColumnDefinitions;
        if (!collection) {
            collection = this.sharedService.columnDefinitions;
        }
        if (Array.isArray(collection) && this.sharedService.grid && this.sharedService.grid.setColumns) {
            if (collection.length > this.sharedService.allColumns.length || forceColumnDefinitionsOverwrite) {
                this.sharedService.allColumns = collection;
            }
            this.sharedService.grid.setColumns(collection);
        }
        // dispose of previous Column Picker instance, then re-register it and don't forget to overwrite previous instance ref
        if (this.sharedService.gridOptions.enableColumnPicker) {
            this.columnPickerExtension.dispose();
            var instance = this.columnPickerExtension.register();
            var extension = this.getExtensionByName(ExtensionName.columnPicker);
            if (extension) {
                extension.addon = instance;
                extension.instance = instance;
            }
        }
        // dispose of previous Grid Menu instance, then re-register it and don't forget to overwrite previous instance ref
        if (this.sharedService.gridOptions.enableGridMenu) {
            this.gridMenuExtension.dispose();
            var instance = this.gridMenuExtension.register();
            var extension = this.getExtensionByName(ExtensionName.gridMenu);
            if (extension) {
                extension.addon = instance;
                extension.instance = instance;
            }
        }
    };
    //
    // private functions
    // -------------------
    /**
     * Get an Extension that was created by calling its "create" method (there are only 3 extensions which uses this method)
     *  @param name
     */
    ExtensionService.prototype.getCreatedExtensionByName = function (name) {
        if (this._extensionCreatedList && this._extensionCreatedList.hasOwnProperty(name)) {
            return this._extensionCreatedList[name];
        }
        return undefined;
    };
    /** Translate an array of items from an input key and assign translated value to the output key */
    ExtensionService.prototype.translateItems = function (items, inputKey, outputKey) {
        var e_3, _a;
        if (this.sharedService.gridOptions && this.sharedService.gridOptions.enableTranslate && (!this.translate || !this.translate.instant)) {
            throw new Error('[Angular-Slickgrid] requires "ngx-translate" to be installed and configured when the grid option "enableTranslate" is enabled.');
        }
        if (Array.isArray(items)) {
            try {
                for (var items_1 = tslib_1.__values(items), items_1_1 = items_1.next(); !items_1_1.done; items_1_1 = items_1.next()) {
                    var item = items_1_1.value;
                    if (item[inputKey]) {
                        item[outputKey] = this.translate && this.translate.currentLang && this.translate.instant(item[inputKey]);
                    }
                }
            }
            catch (e_3_1) { e_3 = { error: e_3_1 }; }
            finally {
                try {
                    if (items_1_1 && !items_1_1.done && (_a = items_1.return)) _a.call(items_1);
                }
                finally { if (e_3) throw e_3.error; }
            }
        }
    };
    ExtensionService.ctorParameters = function () { return [
        { type: AutoTooltipExtension },
        { type: CellExternalCopyManagerExtension },
        { type: CellMenuExtension },
        { type: CheckboxSelectorExtension },
        { type: ColumnPickerExtension },
        { type: ContextMenuExtension },
        { type: DraggableGroupingExtension },
        { type: GridMenuExtension },
        { type: GroupItemMetaProviderExtension },
        { type: HeaderButtonExtension },
        { type: HeaderMenuExtension },
        { type: RowDetailViewExtension },
        { type: RowMoveManagerExtension },
        { type: RowSelectionExtension },
        { type: SharedService },
        { type: TranslateService, decorators: [{ type: Optional }] }
    ]; };
    ExtensionService = tslib_1.__decorate([
        Injectable(),
        tslib_1.__param(15, Optional())
    ], ExtensionService);
    return ExtensionService;
}());
export { ExtensionService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXh0ZW5zaW9uLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9hbmd1bGFyLXNsaWNrZ3JpZC8iLCJzb3VyY2VzIjpbImFwcC9tb2R1bGVzL2FuZ3VsYXItc2xpY2tncmlkL3NlcnZpY2VzL2V4dGVuc2lvbi5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxpREFBaUQ7QUFDakQsT0FBTyw0Q0FBNEMsQ0FBQztBQUNwRCxPQUFPLDJDQUEyQyxDQUFDO0FBQ25ELE9BQU8sNENBQTRDLENBQUM7QUFFcEQsT0FBTyxFQUFFLFVBQVUsRUFBRSxRQUFRLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDckQsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDdkQsT0FBTyxFQUlMLGFBQWEsR0FFZCxNQUFNLGlCQUFpQixDQUFDO0FBQ3pCLE9BQU8sRUFDTCxvQkFBb0IsRUFDcEIsZ0NBQWdDLEVBQ2hDLGlCQUFpQixFQUNqQix5QkFBeUIsRUFDekIscUJBQXFCLEVBQ3JCLG9CQUFvQixFQUNwQiwwQkFBMEIsRUFDMUIsaUJBQWlCLEVBQ2pCLDhCQUE4QixFQUM5QixxQkFBcUIsRUFDckIsbUJBQW1CLEVBQ25CLHNCQUFzQixFQUN0Qix1QkFBdUIsRUFDdkIscUJBQXFCLEdBQ3RCLE1BQU0scUJBQXFCLENBQUM7QUFDN0IsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBR2pEO0lBUUUsMEJBQ1Usb0JBQTBDLEVBQzFDLHlCQUEyRCxFQUMzRCxpQkFBb0MsRUFDcEMseUJBQW9ELEVBQ3BELHFCQUE0QyxFQUM1QyxvQkFBMEMsRUFDMUMsMEJBQXNELEVBQ3RELGlCQUFvQyxFQUNwQyxzQkFBc0QsRUFDdEQscUJBQTRDLEVBQzVDLG1CQUF3QyxFQUN4QyxzQkFBOEMsRUFDOUMsdUJBQWdELEVBQ2hELHFCQUE0QyxFQUM1QyxhQUE0QixFQUNoQixTQUEyQjtRQWZ2Qyx5QkFBb0IsR0FBcEIsb0JBQW9CLENBQXNCO1FBQzFDLDhCQUF5QixHQUF6Qix5QkFBeUIsQ0FBa0M7UUFDM0Qsc0JBQWlCLEdBQWpCLGlCQUFpQixDQUFtQjtRQUNwQyw4QkFBeUIsR0FBekIseUJBQXlCLENBQTJCO1FBQ3BELDBCQUFxQixHQUFyQixxQkFBcUIsQ0FBdUI7UUFDNUMseUJBQW9CLEdBQXBCLG9CQUFvQixDQUFzQjtRQUMxQywrQkFBMEIsR0FBMUIsMEJBQTBCLENBQTRCO1FBQ3RELHNCQUFpQixHQUFqQixpQkFBaUIsQ0FBbUI7UUFDcEMsMkJBQXNCLEdBQXRCLHNCQUFzQixDQUFnQztRQUN0RCwwQkFBcUIsR0FBckIscUJBQXFCLENBQXVCO1FBQzVDLHdCQUFtQixHQUFuQixtQkFBbUIsQ0FBcUI7UUFDeEMsMkJBQXNCLEdBQXRCLHNCQUFzQixDQUF3QjtRQUM5Qyw0QkFBdUIsR0FBdkIsdUJBQXVCLENBQXlCO1FBQ2hELDBCQUFxQixHQUFyQixxQkFBcUIsQ0FBdUI7UUFDNUMsa0JBQWEsR0FBYixhQUFhLENBQWU7UUFDaEIsY0FBUyxHQUFULFNBQVMsQ0FBa0I7UUF2QnpDLDBCQUFxQixHQUFrQixFQUFtQixDQUFDO1FBQzNELG1CQUFjLEdBQWtCLEVBQW1CLENBQUM7SUF1QnhELENBQUM7SUFyQkwsc0JBQUksMkNBQWE7YUFBakI7WUFDRSxPQUFPLElBQUksQ0FBQyxjQUFjLENBQUM7UUFDN0IsQ0FBQzs7O09BQUE7SUFxQkQsNENBQTRDO0lBQzVDLGtDQUFPLEdBQVA7O1FBQ0UsSUFBSSxDQUFDLGFBQWEsQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDO1FBQy9CLElBQUksQ0FBQyxhQUFhLENBQUMsY0FBYyxHQUFHLEVBQUUsQ0FBQzs7WUFFdkMsa0RBQWtEO1lBQ2xELEtBQTRCLElBQUEsS0FBQSxpQkFBQSxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsQ0FBQSxnQkFBQSw0QkFBRTtnQkFBekQsSUFBTSxhQUFhLFdBQUE7Z0JBQ3RCLElBQUksSUFBSSxDQUFDLGNBQWMsQ0FBQyxjQUFjLENBQUMsYUFBYSxDQUFDLEVBQUU7b0JBQ3JELElBQU0sU0FBUyxHQUFHLElBQUksQ0FBQyxjQUFjLENBQUMsYUFBYSxDQUFtQixDQUFDO29CQUN2RSxJQUFJLFNBQVMsSUFBSSxTQUFTLENBQUMsS0FBSyxJQUFJLFNBQVMsQ0FBQyxLQUFLLENBQUMsT0FBTyxFQUFFO3dCQUMzRCxTQUFTLENBQUMsS0FBSyxDQUFDLE9BQU8sRUFBRSxDQUFDO3FCQUMzQjtpQkFDRjthQUNGOzs7Ozs7Ozs7O1lBQ0QsS0FBa0IsSUFBQSxLQUFBLGlCQUFBLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFBLGdCQUFBLDRCQUFFO2dCQUEvQyxJQUFNLEdBQUcsV0FBQTtnQkFDWixPQUFPLElBQUksQ0FBQyxjQUFjLENBQUMsR0FBRyxDQUFDLENBQUM7YUFDakM7Ozs7Ozs7OztJQUNILENBQUM7SUFFRCx5REFBeUQ7SUFDekQsd0NBQWEsR0FBYjtRQUNFLE9BQU8sSUFBSSxDQUFDLGFBQWEsQ0FBQyxVQUFVLElBQUksRUFBRSxDQUFDO0lBQzdDLENBQUM7SUFFRCwrQkFBK0I7SUFDL0IsNENBQWlCLEdBQWpCO1FBQ0UsT0FBTyxJQUFJLENBQUMsYUFBYSxDQUFDLGNBQWMsSUFBSSxFQUFFLENBQUM7SUFDakQsQ0FBQztJQUVEOzs7T0FHRztJQUNILDZDQUFrQixHQUFsQixVQUFtQixJQUFtQjtRQUNwQyxJQUFJLElBQUksQ0FBQyxjQUFjLElBQUksSUFBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsRUFBRTtZQUNwRCxPQUFPLElBQUksQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLENBQUM7U0FDbEM7UUFDRCxPQUFPLFNBQVMsQ0FBQztJQUNuQixDQUFDO0lBRUQ7Ozs7T0FJRztJQUNILG9EQUF5QixHQUF6QixVQUEwQixJQUFtQjtRQUMzQyxJQUFNLFNBQVMsR0FBRyxJQUFJLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDaEQsSUFBSSxTQUFTLElBQUksU0FBUyxDQUFDLEtBQUssSUFBSSxDQUFDLFNBQVMsQ0FBQyxRQUFRLElBQUksU0FBUyxDQUFDLEtBQUssQ0FBQyxFQUFFO1lBQzNFLElBQUksU0FBUyxDQUFDLEtBQUssSUFBSSxTQUFTLENBQUMsS0FBSyxDQUFDLGdCQUFnQixFQUFFO2dCQUN2RCxPQUFPLFNBQVMsQ0FBQyxLQUFLLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQzthQUMzQztZQUNELE9BQU8sU0FBUyxDQUFDLFFBQVEsQ0FBQztTQUMzQjtRQUNELE9BQU8sSUFBSSxDQUFDO0lBQ2QsQ0FBQztJQUVELG1FQUFtRTtJQUNuRSw0Q0FBaUIsR0FBakI7UUFDRSxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxlQUFlLEVBQUUsQ0FBQztJQUM1QyxDQUFDO0lBRUQsMEVBQTBFO0lBQzFFLGtEQUF1QixHQUF2QjtRQUFBLGlCQXNKQztRQXJKQyxJQUFJLElBQUksQ0FBQyxhQUFhLElBQUksSUFBSSxDQUFDLGFBQWEsQ0FBQyxXQUFXLEVBQUU7WUFDeEQsc0ZBQXNGO1lBQ3RGLDRFQUE0RTtZQUM1RSxJQUFJLElBQUksQ0FBQyxhQUFhLENBQUMsV0FBVyxDQUFDLGVBQWUsRUFBRTtnQkFDbEQsa0VBQWtFO2dCQUNsRSxJQUFJLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsVUFBVSxFQUFFLFdBQVcsRUFBRSxNQUFNLENBQUMsQ0FBQztnQkFDeEUsSUFBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLFVBQVUsRUFBRSxTQUFTLEVBQUUsTUFBTSxDQUFDLENBQUM7YUFDdkU7WUFFRCxzQkFBc0I7WUFDdEIsSUFBSSxJQUFJLENBQUMsYUFBYSxDQUFDLFdBQVcsQ0FBQyxpQkFBaUIsRUFBRTtnQkFDcEQsSUFBSSxJQUFJLENBQUMsb0JBQW9CLElBQUksSUFBSSxDQUFDLG9CQUFvQixDQUFDLFFBQVEsRUFBRTtvQkFDbkUsSUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLG9CQUFvQixDQUFDLFFBQVEsRUFBRSxDQUFDO29CQUN0RCxJQUFJLENBQUMsY0FBYyxDQUFDLGFBQWEsQ0FBQyxXQUFXLENBQUMsR0FBRyxFQUFFLElBQUksRUFBRSxhQUFhLENBQUMsV0FBVyxFQUFFLEtBQUssRUFBRSxJQUFJLENBQUMsb0JBQW9CLEVBQUUsS0FBSyxFQUFFLFFBQVEsRUFBRSxRQUFRLFVBQUEsRUFBRSxDQUFDO2lCQUNuSjthQUNGO1lBRUQsaURBQWlEO1lBQ2pELElBQUksSUFBSSxDQUFDLGFBQWEsQ0FBQyxXQUFXLENBQUMscUJBQXFCLEVBQUU7Z0JBQ3hELElBQUksSUFBSSxDQUFDLHlCQUF5QixJQUFJLElBQUksQ0FBQyx5QkFBeUIsQ0FBQyxRQUFRLEVBQUU7b0JBQzdFLElBQU0sUUFBUSxHQUFHLElBQUksQ0FBQyx5QkFBeUIsQ0FBQyxRQUFRLEVBQUUsQ0FBQztvQkFDM0QsSUFBSSxDQUFDLGNBQWMsQ0FBQyxhQUFhLENBQUMsdUJBQXVCLENBQUMsR0FBRyxFQUFFLElBQUksRUFBRSxhQUFhLENBQUMsdUJBQXVCLEVBQUUsS0FBSyxFQUFFLElBQUksQ0FBQyx5QkFBeUIsRUFBRSxLQUFLLEVBQUUsUUFBUSxFQUFFLFFBQVEsVUFBQSxFQUFFLENBQUM7aUJBQ2hMO2FBQ0Y7WUFFRCw0QkFBNEI7WUFDNUIsSUFBSSxJQUFJLENBQUMsYUFBYSxDQUFDLFdBQVcsQ0FBQyxjQUFjLEVBQUU7Z0JBQ2pELElBQUksSUFBSSxDQUFDLGlCQUFpQixJQUFJLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxRQUFRLEVBQUU7b0JBQzdELElBQU0sUUFBUSxHQUFHLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxRQUFRLEVBQUUsQ0FBQztvQkFDbkQsSUFBSSxDQUFDLGNBQWMsQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLEdBQUcsRUFBRSxJQUFJLEVBQUUsYUFBYSxDQUFDLFFBQVEsRUFBRSxLQUFLLEVBQUUsSUFBSSxDQUFDLGlCQUFpQixFQUFFLEtBQUssRUFBRSxRQUFRLEVBQUUsUUFBUSxVQUFBLEVBQUUsQ0FBQztpQkFDMUk7YUFDRjtZQUVELHVCQUF1QjtZQUN2QixzSUFBc0k7WUFDdEksSUFBSSxDQUFDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxhQUFhLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLFdBQVcsQ0FBQyxrQkFBa0IsSUFBSSxJQUFJLENBQUMsYUFBYSxDQUFDLFdBQVcsQ0FBQyxzQkFBc0IsSUFBSSxJQUFJLENBQUMsYUFBYSxDQUFDLFdBQVcsQ0FBQyxtQkFBbUIsSUFBSSxJQUFJLENBQUMsYUFBYSxDQUFDLFdBQVcsQ0FBQyxvQkFBb0IsQ0FBQyxFQUFFO2dCQUNyUixJQUFJLElBQUksQ0FBQyxxQkFBcUIsSUFBSSxJQUFJLENBQUMscUJBQXFCLENBQUMsUUFBUSxFQUFFO29CQUNyRSxJQUFNLFFBQVEsR0FBRyxJQUFJLENBQUMscUJBQXFCLENBQUMsUUFBUSxFQUFFLENBQUM7b0JBQ3ZELElBQUksQ0FBQyxjQUFjLENBQUMsYUFBYSxDQUFDLFlBQVksQ0FBQyxHQUFHLEVBQUUsSUFBSSxFQUFFLGFBQWEsQ0FBQyxZQUFZLEVBQUUsS0FBSyxFQUFFLElBQUksQ0FBQyxxQkFBcUIsRUFBRSxLQUFLLEVBQUUsUUFBUSxFQUFFLFFBQVEsVUFBQSxFQUFFLENBQUM7aUJBQ3RKO2FBQ0Y7WUFFRCwyQkFBMkI7WUFDM0IsSUFBSSxJQUFJLENBQUMsYUFBYSxDQUFDLFdBQVcsQ0FBQyxzQkFBc0IsRUFBRTtnQkFDekQsSUFBSSxJQUFJLENBQUMseUJBQXlCLElBQUksSUFBSSxDQUFDLHlCQUF5QixDQUFDLFFBQVEsRUFBRTtvQkFDN0UsSUFBTSxxQkFBcUIsR0FBRyxJQUFJLENBQUMsa0JBQWtCLENBQUMsYUFBYSxDQUFDLFlBQVksQ0FBQyxDQUFDO29CQUNsRixJQUFJLENBQUMseUJBQXlCLENBQUMsUUFBUSxDQUFDLHFCQUFxQixDQUFDLENBQUM7b0JBQy9ELElBQU0sZ0JBQWdCLEdBQUcsSUFBSSxDQUFDLHlCQUF5QixDQUFDLGFBQWEsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLENBQUMsMkRBQTJEO29CQUNwSixJQUFNLFFBQVEsR0FBRyxnQkFBZ0IsSUFBSSxnQkFBZ0IsQ0FBQyxRQUFRLENBQUM7b0JBQy9ELElBQUksQ0FBQyxjQUFjLENBQUMsYUFBYSxDQUFDLGdCQUFnQixDQUFDLEdBQUcsRUFBRSxJQUFJLEVBQUUsYUFBYSxDQUFDLGdCQUFnQixFQUFFLEtBQUssRUFBRSxJQUFJLENBQUMseUJBQXlCLEVBQUUsS0FBSyxFQUFFLFFBQVEsRUFBRSxRQUFRLFVBQUEsRUFBRSxDQUFDO2lCQUNsSzthQUNGO1lBRUQsd0JBQXdCO1lBQ3hCLElBQUksSUFBSSxDQUFDLGFBQWEsQ0FBQyxXQUFXLENBQUMsa0JBQWtCLEVBQUU7Z0JBQ3JELElBQUksSUFBSSxDQUFDLHFCQUFxQixJQUFJLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxRQUFRLEVBQUU7b0JBQ3JFLElBQU0sUUFBUSxHQUFHLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxRQUFRLEVBQUUsQ0FBQztvQkFDdkQsSUFBSSxDQUFDLGNBQWMsQ0FBQyxhQUFhLENBQUMsWUFBWSxDQUFDLEdBQUcsRUFBRSxJQUFJLEVBQUUsYUFBYSxDQUFDLFlBQVksRUFBRSxLQUFLLEVBQUUsSUFBSSxDQUFDLHFCQUFxQixFQUFFLEtBQUssRUFBRSxRQUFRLEVBQUUsUUFBUSxVQUFBLEVBQUUsQ0FBQztpQkFDdEo7YUFDRjtZQUVELHVCQUF1QjtZQUN2QixJQUFJLElBQUksQ0FBQyxhQUFhLENBQUMsV0FBVyxDQUFDLGlCQUFpQixFQUFFO2dCQUNwRCxJQUFJLElBQUksQ0FBQyxvQkFBb0IsSUFBSSxJQUFJLENBQUMsb0JBQW9CLENBQUMsUUFBUSxFQUFFO29CQUNuRSxJQUFNLFFBQVEsR0FBRyxJQUFJLENBQUMsb0JBQW9CLENBQUMsUUFBUSxFQUFFLENBQUM7b0JBQ3RELElBQUksQ0FBQyxjQUFjLENBQUMsYUFBYSxDQUFDLFdBQVcsQ0FBQyxHQUFHLEVBQUUsSUFBSSxFQUFFLGFBQWEsQ0FBQyxXQUFXLEVBQUUsS0FBSyxFQUFFLElBQUksQ0FBQyxvQkFBb0IsRUFBRSxLQUFLLEVBQUUsUUFBUSxFQUFFLFFBQVEsVUFBQSxFQUFFLENBQUM7aUJBQ25KO2FBQ0Y7WUFFRCw0QkFBNEI7WUFDNUIsSUFBSSxJQUFJLENBQUMsYUFBYSxDQUFDLFdBQVcsQ0FBQyx1QkFBdUIsRUFBRTtnQkFDMUQsSUFBSSxJQUFJLENBQUMsMEJBQTBCLElBQUksSUFBSSxDQUFDLDBCQUEwQixDQUFDLFFBQVEsRUFBRTtvQkFDL0UsSUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLDBCQUEwQixDQUFDLFFBQVEsRUFBRSxDQUFDO29CQUM1RCxJQUFJLENBQUMsY0FBYyxDQUFDLGFBQWEsQ0FBQyxpQkFBaUIsQ0FBQyxHQUFHLEVBQUUsSUFBSSxFQUFFLGFBQWEsQ0FBQyxpQkFBaUIsRUFBRSxLQUFLLEVBQUUsSUFBSSxDQUFDLDBCQUEwQixFQUFFLEtBQUssRUFBRSxRQUFRLEVBQUUsUUFBUSxVQUFBLEVBQUUsQ0FBQztpQkFDcks7YUFDRjtZQUVELG9CQUFvQjtZQUNwQixJQUFJLElBQUksQ0FBQyxhQUFhLENBQUMsV0FBVyxDQUFDLGNBQWMsRUFBRTtnQkFDakQsSUFBSSxJQUFJLENBQUMsaUJBQWlCLElBQUksSUFBSSxDQUFDLGlCQUFpQixDQUFDLFFBQVEsRUFBRTtvQkFDN0QsSUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLGlCQUFpQixDQUFDLFFBQVEsRUFBRSxDQUFDO29CQUNuRCxJQUFJLENBQUMsY0FBYyxDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUMsR0FBRyxFQUFFLElBQUksRUFBRSxhQUFhLENBQUMsUUFBUSxFQUFFLEtBQUssRUFBRSxJQUFJLENBQUMsaUJBQWlCLEVBQUUsS0FBSyxFQUFFLFFBQVEsRUFBRSxRQUFRLFVBQUEsRUFBRSxDQUFDO2lCQUMxSTthQUNGO1lBRUQsa0JBQWtCO1lBQ2xCLGtGQUFrRjtZQUNsRixJQUFJLElBQUksQ0FBQyxhQUFhLENBQUMsV0FBVyxDQUFDLHVCQUF1QixJQUFJLElBQUksQ0FBQyxhQUFhLENBQUMsV0FBVyxDQUFDLGNBQWMsRUFBRTtnQkFDM0csSUFBSSxJQUFJLENBQUMsc0JBQXNCLElBQUksSUFBSSxDQUFDLHNCQUFzQixDQUFDLFFBQVEsRUFBRTtvQkFDdkUsSUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLHNCQUFzQixDQUFDLFFBQVEsRUFBRSxDQUFDO29CQUN4RCxJQUFJLENBQUMsY0FBYyxDQUFDLGFBQWEsQ0FBQyxxQkFBcUIsQ0FBQyxHQUFHLEVBQUUsSUFBSSxFQUFFLGFBQWEsQ0FBQyxxQkFBcUIsRUFBRSxLQUFLLEVBQUUsSUFBSSxDQUFDLHNCQUFzQixFQUFFLEtBQUssRUFBRSxRQUFRLEVBQUUsUUFBUSxVQUFBLEVBQUUsQ0FBQztpQkFDeks7YUFDRjtZQUVELHVCQUF1QjtZQUN2QixJQUFJLElBQUksQ0FBQyxhQUFhLENBQUMsV0FBVyxDQUFDLGtCQUFrQixFQUFFO2dCQUNyRCxJQUFJLElBQUksQ0FBQyxxQkFBcUIsSUFBSSxJQUFJLENBQUMscUJBQXFCLENBQUMsUUFBUSxFQUFFO29CQUNyRSxJQUFNLFFBQVEsR0FBRyxJQUFJLENBQUMscUJBQXFCLENBQUMsUUFBUSxFQUFFLENBQUM7b0JBQ3ZELElBQUksQ0FBQyxjQUFjLENBQUMsYUFBYSxDQUFDLFlBQVksQ0FBQyxHQUFHLEVBQUUsSUFBSSxFQUFFLGFBQWEsQ0FBQyxZQUFZLEVBQUUsS0FBSyxFQUFFLElBQUksQ0FBQyxxQkFBcUIsRUFBRSxLQUFLLEVBQUUsUUFBUSxFQUFFLFFBQVEsVUFBQSxFQUFFLENBQUM7aUJBQ3RKO2FBQ0Y7WUFFRCxxQkFBcUI7WUFDckIsSUFBSSxJQUFJLENBQUMsYUFBYSxDQUFDLFdBQVcsQ0FBQyxnQkFBZ0IsRUFBRTtnQkFDbkQsSUFBSSxJQUFJLENBQUMsbUJBQW1CLElBQUksSUFBSSxDQUFDLG1CQUFtQixDQUFDLFFBQVEsRUFBRTtvQkFDakUsSUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLG1CQUFtQixDQUFDLFFBQVEsRUFBRSxDQUFDO29CQUNyRCxJQUFJLENBQUMsY0FBYyxDQUFDLGFBQWEsQ0FBQyxVQUFVLENBQUMsR0FBRyxFQUFFLElBQUksRUFBRSxhQUFhLENBQUMsVUFBVSxFQUFFLEtBQUssRUFBRSxJQUFJLENBQUMsbUJBQW1CLEVBQUUsS0FBSyxFQUFFLFFBQVEsRUFBRSxRQUFRLFVBQUEsRUFBRSxDQUFDO2lCQUNoSjthQUNGO1lBRUQseUJBQXlCO1lBQ3pCLElBQUksSUFBSSxDQUFDLGFBQWEsQ0FBQyxXQUFXLENBQUMsbUJBQW1CLEVBQUU7Z0JBQ3RELElBQUksSUFBSSxDQUFDLHNCQUFzQixJQUFJLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxRQUFRLEVBQUU7b0JBQ3ZFLElBQU0scUJBQXFCLEdBQUcsSUFBSSxDQUFDLGtCQUFrQixDQUFDLGFBQWEsQ0FBQyxZQUFZLENBQUMsQ0FBQztvQkFDbEYsSUFBSSxDQUFDLHNCQUFzQixDQUFDLFFBQVEsQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO29CQUM1RCxJQUFNLGdCQUFnQixHQUFHLElBQUksQ0FBQyx5QkFBeUIsQ0FBQyxhQUFhLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQyx5REFBeUQ7b0JBQy9JLElBQU0sUUFBUSxHQUFHLGdCQUFnQixJQUFJLGdCQUFnQixDQUFDLFFBQVEsQ0FBQztvQkFDL0QsSUFBSSxDQUFDLGNBQWMsQ0FBQyxhQUFhLENBQUMsYUFBYSxDQUFDLEdBQUcsRUFBRSxJQUFJLEVBQUUsYUFBYSxDQUFDLGFBQWEsRUFBRSxLQUFLLEVBQUUsSUFBSSxDQUFDLHNCQUFzQixFQUFFLEtBQUssRUFBRSxRQUFRLEVBQUUsUUFBUSxVQUFBLEVBQUUsQ0FBQztpQkFDeko7YUFDRjtZQUVELDBCQUEwQjtZQUMxQixJQUFJLElBQUksQ0FBQyxhQUFhLENBQUMsV0FBVyxDQUFDLG9CQUFvQixJQUFJLElBQUksQ0FBQyx1QkFBdUIsSUFBSSxJQUFJLENBQUMsdUJBQXVCLENBQUMsUUFBUSxFQUFFO2dCQUNoSSxJQUFNLHFCQUFxQixHQUFHLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxhQUFhLENBQUMsWUFBWSxDQUFDLENBQUM7Z0JBQ2xGLElBQUksQ0FBQyx1QkFBdUIsQ0FBQyxRQUFRLENBQUMscUJBQXFCLENBQUMsQ0FBQztnQkFDN0QsSUFBTSxnQkFBZ0IsR0FBRyxJQUFJLENBQUMseUJBQXlCLENBQUMsYUFBYSxDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUMsMkRBQTJEO2dCQUNsSixJQUFNLFFBQVEsR0FBRyxnQkFBZ0IsSUFBSSxnQkFBZ0IsQ0FBQyxRQUFRLENBQUM7Z0JBQy9ELElBQUksQ0FBQyxjQUFjLENBQUMsYUFBYSxDQUFDLGNBQWMsQ0FBQyxHQUFHLEVBQUUsSUFBSSxFQUFFLGFBQWEsQ0FBQyxjQUFjLEVBQUUsS0FBSyxFQUFFLElBQUksQ0FBQyx1QkFBdUIsRUFBRSxLQUFLLEVBQUUsUUFBUSxFQUFFLFFBQVEsVUFBQSxFQUFFLENBQUM7YUFDNUo7WUFFRCxrQ0FBa0M7WUFDbEMsSUFBSSxJQUFJLENBQUMsYUFBYSxDQUFDLFdBQVcsQ0FBQyxlQUFlLEtBQUssU0FBUyxFQUFFO2dCQUNoRSxJQUFNLE1BQUksR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQztnQkFDckMsSUFBTSxXQUFXLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxXQUFXLENBQUM7Z0JBRW5ELElBQUksS0FBSyxDQUFDLE9BQU8sQ0FBQyxXQUFXLENBQUMsZUFBZSxDQUFDLEVBQUU7b0JBQzlDLFdBQVcsQ0FBQyxlQUFlLENBQUMsT0FBTyxDQUFDLFVBQUMsTUFBVzt3QkFDOUMsTUFBSSxDQUFDLGNBQWMsQ0FBQyxNQUFNLENBQUMsQ0FBQzt3QkFDNUIsSUFBTSxRQUFRLEdBQUcsTUFBSSxDQUFDLGVBQWUsQ0FBQyxNQUFNLElBQUksTUFBTSxDQUFDLElBQUksSUFBSSxFQUFFLENBQUMsQ0FBQzt3QkFDbkUsS0FBSSxDQUFDLGNBQWMsQ0FBQyxhQUFhLENBQUMsTUFBTSxDQUFDLEdBQUcsRUFBRSxJQUFJLEVBQUUsYUFBYSxDQUFDLE1BQU0sRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxRQUFRLEVBQUUsUUFBUSxVQUFBLEVBQUUsQ0FBQztvQkFDckgsQ0FBQyxDQUFDLENBQUM7aUJBQ0o7cUJBQU07b0JBQ0wsSUFBTSxNQUFNLEdBQUcsV0FBVyxDQUFDLGVBQWUsQ0FBQztvQkFDM0MsTUFBSSxDQUFDLGNBQWMsQ0FBQyxNQUFNLENBQUMsQ0FBQztvQkFDNUIsSUFBTSxRQUFRLEdBQUcsTUFBSSxDQUFDLGVBQWUsQ0FBQyxNQUFNLElBQUksTUFBTSxDQUFDLElBQUksSUFBSSxFQUFFLENBQUMsQ0FBQztvQkFDbkUsSUFBSSxDQUFDLGNBQWMsQ0FBQyxhQUFhLENBQUMsTUFBTSxDQUFDLEdBQUcsRUFBRSxJQUFJLEVBQUUsYUFBYSxDQUFDLE1BQU0sRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxRQUFRLEVBQUUsUUFBUSxVQUFBLEVBQUUsQ0FBQztpQkFDcEg7YUFDRjtTQUNGO0lBQ0gsQ0FBQztJQUVEOzs7OztPQUtHO0lBQ0gsNkRBQWtDLEdBQWxDLFVBQW1DLGlCQUEyQixFQUFFLE9BQW1CO1FBQ2pGLElBQUksT0FBTyxDQUFDLHNCQUFzQixFQUFFO1lBQ2xDLElBQUksQ0FBQyxJQUFJLENBQUMseUJBQXlCLENBQUMsYUFBYSxDQUFDLGdCQUFnQixDQUFDLEVBQUU7Z0JBQ25FLElBQU0sZ0JBQWdCLEdBQUcsSUFBSSxDQUFDLHlCQUF5QixDQUFDLE1BQU0sQ0FBQyxpQkFBaUIsRUFBRSxPQUFPLENBQUMsQ0FBQztnQkFDM0YsSUFBSSxDQUFDLHFCQUFxQixDQUFDLGFBQWEsQ0FBQyxnQkFBZ0IsQ0FBQyxHQUFHLEVBQUUsSUFBSSxFQUFFLGFBQWEsQ0FBQyxnQkFBZ0IsRUFBRSxLQUFLLEVBQUUsZ0JBQWdCLEVBQUUsUUFBUSxFQUFFLGdCQUFnQixFQUFFLEtBQUssRUFBRSxJQUFJLENBQUMseUJBQXlCLEVBQUUsQ0FBQzthQUNuTTtTQUNGO1FBQ0QsSUFBSSxPQUFPLENBQUMsb0JBQW9CLEVBQUU7WUFDaEMsSUFBSSxDQUFDLElBQUksQ0FBQyx5QkFBeUIsQ0FBQyxhQUFhLENBQUMsY0FBYyxDQUFDLEVBQUU7Z0JBQ2pFLElBQU0sZUFBZSxHQUFHLElBQUksQ0FBQyx1QkFBdUIsQ0FBQyxNQUFNLENBQUMsaUJBQWlCLEVBQUUsT0FBTyxDQUFDLENBQUM7Z0JBQ3hGLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxhQUFhLENBQUMsY0FBYyxDQUFDLEdBQUcsRUFBRSxJQUFJLEVBQUUsYUFBYSxDQUFDLGNBQWMsRUFBRSxLQUFLLEVBQUUsZUFBZSxFQUFFLFFBQVEsRUFBRSxlQUFlLEVBQUUsS0FBSyxFQUFFLElBQUksQ0FBQyx1QkFBdUIsRUFBRSxDQUFDO2FBQzNMO1NBQ0Y7UUFDRCxJQUFJLE9BQU8sQ0FBQyxtQkFBbUIsRUFBRTtZQUMvQixJQUFJLENBQUMsSUFBSSxDQUFDLHlCQUF5QixDQUFDLGFBQWEsQ0FBQyxhQUFhLENBQUMsRUFBRTtnQkFDaEUsSUFBTSxpQkFBaUIsR0FBRyxJQUFJLENBQUMsc0JBQXNCLENBQUMsTUFBTSxDQUFDLGlCQUFpQixFQUFFLE9BQU8sQ0FBQyxDQUFDO2dCQUN6RixJQUFJLENBQUMscUJBQXFCLENBQUMsYUFBYSxDQUFDLGFBQWEsQ0FBQyxHQUFHLEVBQUUsSUFBSSxFQUFFLGFBQWEsQ0FBQyxhQUFhLEVBQUUsS0FBSyxFQUFFLGlCQUFpQixFQUFFLFFBQVEsRUFBRSxpQkFBaUIsRUFBRSxLQUFLLEVBQUUsSUFBSSxDQUFDLHNCQUFzQixFQUFFLENBQUM7YUFDNUw7U0FDRjtRQUNELElBQUksT0FBTyxDQUFDLHVCQUF1QixFQUFFO1lBQ25DLElBQUksQ0FBQyxJQUFJLENBQUMseUJBQXlCLENBQUMsYUFBYSxDQUFDLGlCQUFpQixDQUFDLEVBQUU7Z0JBQ3BFLElBQU0saUJBQWlCLEdBQUcsSUFBSSxDQUFDLDBCQUEwQixDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQztnQkFDMUUsT0FBTyxDQUFDLG1CQUFtQixHQUFHLGlCQUFpQixDQUFDLHFCQUFxQixDQUFDO2dCQUN0RSxJQUFJLENBQUMscUJBQXFCLENBQUMsYUFBYSxDQUFDLGlCQUFpQixDQUFDLEdBQUcsRUFBRSxJQUFJLEVBQUUsYUFBYSxDQUFDLGlCQUFpQixFQUFFLEtBQUssRUFBRSxpQkFBaUIsRUFBRSxRQUFRLEVBQUUsaUJBQWlCLEVBQUUsS0FBSyxFQUFFLGlCQUFpQixDQUFDLHFCQUFxQixFQUFFLENBQUM7YUFDaE47U0FDRjtJQUNILENBQUM7SUFFRCxrQ0FBa0M7SUFDbEMscUNBQVUsR0FBVixVQUFXLE1BQWM7UUFDdkIsSUFBSSxJQUFJLENBQUMsYUFBYSxJQUFJLElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxJQUFJLElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLFVBQVUsSUFBSSxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxVQUFVLEVBQUU7WUFDN0gsSUFBTSxXQUFXLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUN0RSxJQUFJLENBQUMsYUFBYSxDQUFDLGNBQWMsR0FBRyxJQUFJLENBQUMsbUJBQW1CLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsVUFBVSxFQUFFLEVBQUUsV0FBVyxDQUFDLENBQUM7WUFDaEgsSUFBSSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsY0FBYyxDQUFDLENBQUM7U0FDdkU7SUFDSCxDQUFDO0lBRUQsc0RBQXNEO0lBQ3RELGdEQUFxQixHQUFyQixVQUFzQixXQUF3QjtRQUM1QyxJQUFJLENBQUMsaUJBQWlCLENBQUMscUJBQXFCLENBQUMsV0FBVyxDQUFDLENBQUM7SUFDNUQsQ0FBQztJQUVEOzs7O09BSUc7SUFDSCw4Q0FBbUIsR0FBbkIsVUFBb0IsT0FBaUIsRUFBRSxLQUFhO1FBQ2xELElBQUksS0FBSyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsRUFBRTtZQUMxQixPQUFPLE9BQU8sQ0FBQyxNQUFNLENBQUMsVUFBQyxFQUFVLEVBQUUsQ0FBUyxJQUFLLE9BQUEsS0FBSyxLQUFLLENBQUMsRUFBWCxDQUFXLENBQUMsQ0FBQztTQUMvRDtRQUNELE9BQU8sT0FBTyxDQUFDO0lBQ2pCLENBQUM7SUFFRCx5R0FBeUc7SUFDekcsNENBQWlCLEdBQWpCO1FBQ0UsSUFBSSxJQUFJLENBQUMsaUJBQWlCLElBQUksSUFBSSxDQUFDLGlCQUFpQixDQUFDLGlCQUFpQixFQUFFO1lBQ3RFLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO1NBQzVDO0lBQ0gsQ0FBQztJQUVELDZEQUE2RDtJQUM3RCxnREFBcUIsR0FBckI7UUFDRSxJQUFJLElBQUksQ0FBQyxxQkFBcUIsSUFBSSxJQUFJLENBQUMscUJBQXFCLENBQUMscUJBQXFCLEVBQUU7WUFDbEYsSUFBSSxDQUFDLHFCQUFxQixDQUFDLHFCQUFxQixFQUFFLENBQUM7U0FDcEQ7SUFDSCxDQUFDO0lBRUQsNEdBQTRHO0lBQzVHLCtDQUFvQixHQUFwQjtRQUNFLElBQUksSUFBSSxDQUFDLG9CQUFvQixJQUFJLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxvQkFBb0IsRUFBRTtZQUMvRSxJQUFJLENBQUMsb0JBQW9CLENBQUMsb0JBQW9CLEVBQUUsQ0FBQztTQUNsRDtJQUNILENBQUM7SUFFRDs7T0FFRztJQUNILDRDQUFpQixHQUFqQjtRQUNFLElBQUksSUFBSSxDQUFDLGlCQUFpQixJQUFJLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxpQkFBaUIsRUFBRTtZQUN0RSxJQUFJLENBQUMsaUJBQWlCLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztTQUM1QztJQUNILENBQUM7SUFFRDs7T0FFRztJQUNILDhDQUFtQixHQUFuQjtRQUNFLElBQUksSUFBSSxDQUFDLG1CQUFtQixJQUFJLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxtQkFBbUIsRUFBRTtZQUM1RSxJQUFJLENBQUMsbUJBQW1CLENBQUMsbUJBQW1CLEVBQUUsQ0FBQztTQUNoRDtJQUNILENBQUM7SUFFRDs7Ozs7T0FLRztJQUNILGlEQUFzQixHQUF0QixVQUF1QixNQUF5QixFQUFFLG9CQUErQjtRQUMvRSxJQUFJLElBQUksQ0FBQyxhQUFhLElBQUksSUFBSSxDQUFDLGFBQWEsQ0FBQyxXQUFXLElBQUksSUFBSSxDQUFDLGFBQWEsQ0FBQyxXQUFXLENBQUMsZUFBZSxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsU0FBUyxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsRUFBRTtZQUMxSixNQUFNLElBQUksS0FBSyxDQUFDLGdJQUFnSSxDQUFDLENBQUM7U0FDbko7UUFFRCxJQUFJLE1BQU0sRUFBRTtZQUNWLElBQUksQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLE1BQWdCLENBQUMsQ0FBQztTQUN0QztRQUVELElBQUksaUJBQWlCLEdBQUcsb0JBQW9CLENBQUM7UUFDN0MsSUFBSSxDQUFDLGlCQUFpQixFQUFFO1lBQ3RCLGlCQUFpQixHQUFHLElBQUksQ0FBQyxhQUFhLENBQUMsaUJBQWlCLENBQUM7U0FDMUQ7UUFFRCxrRUFBa0U7UUFDbEUsSUFBSSxDQUFDLGNBQWMsQ0FBQyxpQkFBaUIsRUFBRSxXQUFXLEVBQUUsTUFBTSxDQUFDLENBQUM7UUFDNUQsSUFBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLFVBQVUsRUFBRSxXQUFXLEVBQUUsTUFBTSxDQUFDLENBQUM7UUFDeEUsSUFBSSxDQUFDLGNBQWMsQ0FBQyxpQkFBaUIsRUFBRSxTQUFTLEVBQUUsTUFBTSxDQUFDLENBQUM7UUFDMUQsSUFBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLFVBQVUsRUFBRSxTQUFTLEVBQUUsTUFBTSxDQUFDLENBQUM7UUFFdEUsK0JBQStCO1FBQy9CLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxpQkFBaUIsRUFBRSxLQUFLLENBQUMsT0FBTyxDQUFDLG9CQUFvQixDQUFDLENBQUMsQ0FBQztRQUNqRixJQUFJLENBQUMsaUJBQWlCLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztJQUM3QyxDQUFDO0lBRUQ7OztPQUdHO0lBQ0gsOENBQW1CLEdBQW5CLFVBQW9CLG9CQUErQixFQUFFLCtCQUF1QztRQUF2QyxnREFBQSxFQUFBLHVDQUF1QztRQUMxRixJQUFJLFVBQVUsR0FBRyxvQkFBb0IsQ0FBQztRQUN0QyxJQUFJLENBQUMsVUFBVSxFQUFFO1lBQ2YsVUFBVSxHQUFHLElBQUksQ0FBQyxhQUFhLENBQUMsaUJBQWlCLENBQUM7U0FDbkQ7UUFDRCxJQUFJLEtBQUssQ0FBQyxPQUFPLENBQUMsVUFBVSxDQUFDLElBQUksSUFBSSxDQUFDLGFBQWEsQ0FBQyxJQUFJLElBQUksSUFBSSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsVUFBVSxFQUFFO1lBQzlGLElBQUksVUFBVSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLFVBQVUsQ0FBQyxNQUFNLElBQUksK0JBQStCLEVBQUU7Z0JBQy9GLElBQUksQ0FBQyxhQUFhLENBQUMsVUFBVSxHQUFHLFVBQVUsQ0FBQzthQUM1QztZQUNELElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxVQUFVLENBQUMsQ0FBQztTQUNoRDtRQUVELHNIQUFzSDtRQUN0SCxJQUFJLElBQUksQ0FBQyxhQUFhLENBQUMsV0FBVyxDQUFDLGtCQUFrQixFQUFFO1lBQ3JELElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxPQUFPLEVBQUUsQ0FBQztZQUNyQyxJQUFNLFFBQVEsR0FBRyxJQUFJLENBQUMscUJBQXFCLENBQUMsUUFBUSxFQUFFLENBQUM7WUFDdkQsSUFBTSxTQUFTLEdBQUcsSUFBSSxDQUFDLGtCQUFrQixDQUFDLGFBQWEsQ0FBQyxZQUFZLENBQUMsQ0FBQztZQUN0RSxJQUFJLFNBQVMsRUFBRTtnQkFDYixTQUFTLENBQUMsS0FBSyxHQUFHLFFBQVEsQ0FBQztnQkFDM0IsU0FBUyxDQUFDLFFBQVEsR0FBRyxRQUFRLENBQUM7YUFDL0I7U0FDRjtRQUVELGtIQUFrSDtRQUNsSCxJQUFJLElBQUksQ0FBQyxhQUFhLENBQUMsV0FBVyxDQUFDLGNBQWMsRUFBRTtZQUNqRCxJQUFJLENBQUMsaUJBQWlCLENBQUMsT0FBTyxFQUFFLENBQUM7WUFDakMsSUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLGlCQUFpQixDQUFDLFFBQVEsRUFBRSxDQUFDO1lBQ25ELElBQU0sU0FBUyxHQUFHLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDbEUsSUFBSSxTQUFTLEVBQUU7Z0JBQ2IsU0FBUyxDQUFDLEtBQUssR0FBRyxRQUFRLENBQUM7Z0JBQzNCLFNBQVMsQ0FBQyxRQUFRLEdBQUcsUUFBUSxDQUFDO2FBQy9CO1NBQ0Y7SUFDSCxDQUFDO0lBRUQsRUFBRTtJQUNGLG9CQUFvQjtJQUNwQixzQkFBc0I7SUFFdEI7OztPQUdHO0lBQ0ssb0RBQXlCLEdBQWpDLFVBQWtDLElBQW1CO1FBQ25ELElBQUksSUFBSSxDQUFDLHFCQUFxQixJQUFJLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLEVBQUU7WUFDakYsT0FBTyxJQUFJLENBQUMscUJBQXFCLENBQUMsSUFBSSxDQUFDLENBQUM7U0FDekM7UUFDRCxPQUFPLFNBQVMsQ0FBQztJQUNuQixDQUFDO0lBRUQsa0dBQWtHO0lBQzFGLHlDQUFjLEdBQXRCLFVBQXVCLEtBQVksRUFBRSxRQUFnQixFQUFFLFNBQWlCOztRQUN0RSxJQUFJLElBQUksQ0FBQyxhQUFhLENBQUMsV0FBVyxJQUFJLElBQUksQ0FBQyxhQUFhLENBQUMsV0FBVyxDQUFDLGVBQWUsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLFNBQVMsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLEVBQUU7WUFDcEksTUFBTSxJQUFJLEtBQUssQ0FBQyxnSUFBZ0ksQ0FBQyxDQUFDO1NBQ25KO1FBRUQsSUFBSSxLQUFLLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxFQUFFOztnQkFDeEIsS0FBbUIsSUFBQSxVQUFBLGlCQUFBLEtBQUssQ0FBQSw0QkFBQSwrQ0FBRTtvQkFBckIsSUFBTSxJQUFJLGtCQUFBO29CQUNiLElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxFQUFFO3dCQUNsQixJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsSUFBSSxDQUFDLFNBQVMsSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLFdBQVcsSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQztxQkFDMUc7aUJBQ0Y7Ozs7Ozs7OztTQUNGO0lBQ0gsQ0FBQzs7Z0JBN2ErQixvQkFBb0I7Z0JBQ2YsZ0NBQWdDO2dCQUN4QyxpQkFBaUI7Z0JBQ1QseUJBQXlCO2dCQUM3QixxQkFBcUI7Z0JBQ3RCLG9CQUFvQjtnQkFDZCwwQkFBMEI7Z0JBQ25DLGlCQUFpQjtnQkFDWiw4QkFBOEI7Z0JBQy9CLHFCQUFxQjtnQkFDdkIsbUJBQW1CO2dCQUNoQixzQkFBc0I7Z0JBQ3JCLHVCQUF1QjtnQkFDekIscUJBQXFCO2dCQUM3QixhQUFhO2dCQUNMLGdCQUFnQix1QkFBOUMsUUFBUTs7SUF4QkEsZ0JBQWdCO1FBRDVCLFVBQVUsRUFBRTtRQXlCUixvQkFBQSxRQUFRLEVBQUUsQ0FBQTtPQXhCRixnQkFBZ0IsQ0F1YjVCO0lBQUQsdUJBQUM7Q0FBQSxBQXZiRCxJQXViQztTQXZiWSxnQkFBZ0IiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBpbXBvcnQgY29tbW9uIDNyZCBwYXJ0eSBTbGlja0dyaWQgcGx1Z2lucy9saWJzXHJcbmltcG9ydCAnc2xpY2tncmlkL3BsdWdpbnMvc2xpY2suY2VsbHJhbmdlZGVjb3JhdG9yJztcclxuaW1wb3J0ICdzbGlja2dyaWQvcGx1Z2lucy9zbGljay5jZWxscmFuZ2VzZWxlY3Rvcic7XHJcbmltcG9ydCAnc2xpY2tncmlkL3BsdWdpbnMvc2xpY2suY2VsbHNlbGVjdGlvbm1vZGVsJztcclxuXHJcbmltcG9ydCB7IEluamVjdGFibGUsIE9wdGlvbmFsIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IFRyYW5zbGF0ZVNlcnZpY2UgfSBmcm9tICdAbmd4LXRyYW5zbGF0ZS9jb3JlJztcclxuaW1wb3J0IHtcclxuICBDb2x1bW4sXHJcbiAgRXh0ZW5zaW9uTGlzdCxcclxuICBFeHRlbnNpb25Nb2RlbCxcclxuICBFeHRlbnNpb25OYW1lLFxyXG4gIEdyaWRPcHRpb24sXHJcbn0gZnJvbSAnLi4vbW9kZWxzL2luZGV4JztcclxuaW1wb3J0IHtcclxuICBBdXRvVG9vbHRpcEV4dGVuc2lvbixcclxuICBDZWxsRXh0ZXJuYWxDb3B5TWFuYWdlckV4dGVuc2lvbixcclxuICBDZWxsTWVudUV4dGVuc2lvbixcclxuICBDaGVja2JveFNlbGVjdG9yRXh0ZW5zaW9uLFxyXG4gIENvbHVtblBpY2tlckV4dGVuc2lvbixcclxuICBDb250ZXh0TWVudUV4dGVuc2lvbixcclxuICBEcmFnZ2FibGVHcm91cGluZ0V4dGVuc2lvbixcclxuICBHcmlkTWVudUV4dGVuc2lvbixcclxuICBHcm91cEl0ZW1NZXRhUHJvdmlkZXJFeHRlbnNpb24sXHJcbiAgSGVhZGVyQnV0dG9uRXh0ZW5zaW9uLFxyXG4gIEhlYWRlck1lbnVFeHRlbnNpb24sXHJcbiAgUm93RGV0YWlsVmlld0V4dGVuc2lvbixcclxuICBSb3dNb3ZlTWFuYWdlckV4dGVuc2lvbixcclxuICBSb3dTZWxlY3Rpb25FeHRlbnNpb24sXHJcbn0gZnJvbSAnLi4vZXh0ZW5zaW9ucy9pbmRleCc7XHJcbmltcG9ydCB7IFNoYXJlZFNlcnZpY2UgfSBmcm9tICcuL3NoYXJlZC5zZXJ2aWNlJztcclxuXHJcbkBJbmplY3RhYmxlKClcclxuZXhwb3J0IGNsYXNzIEV4dGVuc2lvblNlcnZpY2Uge1xyXG4gIHByaXZhdGUgX2V4dGVuc2lvbkNyZWF0ZWRMaXN0OiBFeHRlbnNpb25MaXN0ID0ge30gYXMgRXh0ZW5zaW9uTGlzdDtcclxuICBwcml2YXRlIF9leHRlbnNpb25MaXN0OiBFeHRlbnNpb25MaXN0ID0ge30gYXMgRXh0ZW5zaW9uTGlzdDtcclxuXHJcbiAgZ2V0IGV4dGVuc2lvbkxpc3QoKTogRXh0ZW5zaW9uTGlzdCB7XHJcbiAgICByZXR1cm4gdGhpcy5fZXh0ZW5zaW9uTGlzdDtcclxuICB9XHJcblxyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgcHJpdmF0ZSBhdXRvVG9vbHRpcEV4dGVuc2lvbjogQXV0b1Rvb2x0aXBFeHRlbnNpb24sXHJcbiAgICBwcml2YXRlIGNlbGxFeHRlcm5hbENvcHlFeHRlbnNpb246IENlbGxFeHRlcm5hbENvcHlNYW5hZ2VyRXh0ZW5zaW9uLFxyXG4gICAgcHJpdmF0ZSBjZWxsTWVudUV4dGVuc2lvbjogQ2VsbE1lbnVFeHRlbnNpb24sXHJcbiAgICBwcml2YXRlIGNoZWNrYm94U2VsZWN0b3JFeHRlbnNpb246IENoZWNrYm94U2VsZWN0b3JFeHRlbnNpb24sXHJcbiAgICBwcml2YXRlIGNvbHVtblBpY2tlckV4dGVuc2lvbjogQ29sdW1uUGlja2VyRXh0ZW5zaW9uLFxyXG4gICAgcHJpdmF0ZSBjb250ZXh0TWVudUV4dGVuc2lvbjogQ29udGV4dE1lbnVFeHRlbnNpb24sXHJcbiAgICBwcml2YXRlIGRyYWdnYWJsZUdyb3VwaW5nRXh0ZW5zaW9uOiBEcmFnZ2FibGVHcm91cGluZ0V4dGVuc2lvbixcclxuICAgIHByaXZhdGUgZ3JpZE1lbnVFeHRlbnNpb246IEdyaWRNZW51RXh0ZW5zaW9uLFxyXG4gICAgcHJpdmF0ZSBncm91cEl0ZW1NZXRhRXh0ZW5zaW9uOiBHcm91cEl0ZW1NZXRhUHJvdmlkZXJFeHRlbnNpb24sXHJcbiAgICBwcml2YXRlIGhlYWRlckJ1dHRvbkV4dGVuc2lvbjogSGVhZGVyQnV0dG9uRXh0ZW5zaW9uLFxyXG4gICAgcHJpdmF0ZSBoZWFkZXJNZW51RXh0ZW5zaW9uOiBIZWFkZXJNZW51RXh0ZW5zaW9uLFxyXG4gICAgcHJpdmF0ZSByb3dEZXRhaWxWaWV3RXh0ZW5zaW9uOiBSb3dEZXRhaWxWaWV3RXh0ZW5zaW9uLFxyXG4gICAgcHJpdmF0ZSByb3dNb3ZlTWFuYWdlckV4dGVuc2lvbjogUm93TW92ZU1hbmFnZXJFeHRlbnNpb24sXHJcbiAgICBwcml2YXRlIHJvd1NlbGVjdGlvbkV4dGVuc2lvbjogUm93U2VsZWN0aW9uRXh0ZW5zaW9uLFxyXG4gICAgcHJpdmF0ZSBzaGFyZWRTZXJ2aWNlOiBTaGFyZWRTZXJ2aWNlLFxyXG4gICAgQE9wdGlvbmFsKCkgcHJpdmF0ZSB0cmFuc2xhdGU6IFRyYW5zbGF0ZVNlcnZpY2UsXHJcbiAgKSB7IH1cclxuXHJcbiAgLyoqIERpc3Bvc2Ugb2YgYWxsIHRoZSBjb250cm9scyAmIHBsdWdpbnMgKi9cclxuICBkaXNwb3NlKCkge1xyXG4gICAgdGhpcy5zaGFyZWRTZXJ2aWNlLmdyaWQgPSBudWxsO1xyXG4gICAgdGhpcy5zaGFyZWRTZXJ2aWNlLnZpc2libGVDb2x1bW5zID0gW107XHJcblxyXG4gICAgLy8gZGlzcG9zZSBvZiBlYWNoIGNvbnRyb2wvcGx1Z2luICYgcmVzZXQgdGhlIGxpc3RcclxuICAgIGZvciAoY29uc3QgZXh0ZW5zaW9uTmFtZSBvZiBPYmplY3Qua2V5cyh0aGlzLl9leHRlbnNpb25MaXN0KSkge1xyXG4gICAgICBpZiAodGhpcy5fZXh0ZW5zaW9uTGlzdC5oYXNPd25Qcm9wZXJ0eShleHRlbnNpb25OYW1lKSkge1xyXG4gICAgICAgIGNvbnN0IGV4dGVuc2lvbiA9IHRoaXMuX2V4dGVuc2lvbkxpc3RbZXh0ZW5zaW9uTmFtZV0gYXMgRXh0ZW5zaW9uTW9kZWw7XHJcbiAgICAgICAgaWYgKGV4dGVuc2lvbiAmJiBleHRlbnNpb24uY2xhc3MgJiYgZXh0ZW5zaW9uLmNsYXNzLmRpc3Bvc2UpIHtcclxuICAgICAgICAgIGV4dGVuc2lvbi5jbGFzcy5kaXNwb3NlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBmb3IgKGNvbnN0IGtleSBvZiBPYmplY3Qua2V5cyh0aGlzLl9leHRlbnNpb25MaXN0KSkge1xyXG4gICAgICBkZWxldGUgdGhpcy5fZXh0ZW5zaW9uTGlzdFtrZXldO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqIEdldCBhbGwgY29sdW1ucyAoaW5jbHVkZXMgdmlzaWJsZSBhbmQgbm9uLXZpc2libGUpICovXHJcbiAgZ2V0QWxsQ29sdW1ucygpOiBDb2x1bW5bXSB7XHJcbiAgICByZXR1cm4gdGhpcy5zaGFyZWRTZXJ2aWNlLmFsbENvbHVtbnMgfHwgW107XHJcbiAgfVxyXG5cclxuICAvKiogR2V0IG9ubHkgdmlzaWJsZSBjb2x1bW5zICovXHJcbiAgZ2V0VmlzaWJsZUNvbHVtbnMoKTogQ29sdW1uW10ge1xyXG4gICAgcmV0dXJuIHRoaXMuc2hhcmVkU2VydmljZS52aXNpYmxlQ29sdW1ucyB8fCBbXTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdldCBhbiBFeHRlbnNpb24gYnkgaXQncyBuYW1lXHJcbiAgICogIEBwYXJhbSBuYW1lXHJcbiAgICovXHJcbiAgZ2V0RXh0ZW5zaW9uQnlOYW1lKG5hbWU6IEV4dGVuc2lvbk5hbWUpOiBFeHRlbnNpb25Nb2RlbCB8IHVuZGVmaW5lZCB7XHJcbiAgICBpZiAodGhpcy5fZXh0ZW5zaW9uTGlzdCAmJiB0aGlzLl9leHRlbnNpb25MaXN0W25hbWVdKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLl9leHRlbnNpb25MaXN0W25hbWVdO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdldCB0aGUgaW5zdGFuY2Ugb2YgdGhlIFNsaWNrR3JpZCBhZGRvbiAoY29udHJvbCBvciBwbHVnaW4pLlxyXG4gICAqIFRoaXMgaXMgdGhlIHJhdyBhZGRvbiBjb21pbmcgZGlyZWN0bHkgZnJvbSBTbGlja0dyaWQgaXRzZWxmLCBub3QgdG8gY29uZnVzZSB3aXRoIEFuZ3VsYXItU2xpY2tncmlkIGV4dGVuc2lvblxyXG4gICAqICBAcGFyYW0gbmFtZVxyXG4gICAqL1xyXG4gIGdldFNsaWNrZ3JpZEFkZG9uSW5zdGFuY2UobmFtZTogRXh0ZW5zaW9uTmFtZSk6IGFueSB7XHJcbiAgICBjb25zdCBleHRlbnNpb24gPSB0aGlzLmdldEV4dGVuc2lvbkJ5TmFtZShuYW1lKTtcclxuICAgIGlmIChleHRlbnNpb24gJiYgZXh0ZW5zaW9uLmNsYXNzICYmIChleHRlbnNpb24uaW5zdGFuY2UgfHwgZXh0ZW5zaW9uLmFkZG9uKSkge1xyXG4gICAgICBpZiAoZXh0ZW5zaW9uLmNsYXNzICYmIGV4dGVuc2lvbi5jbGFzcy5nZXRBZGRvbkluc3RhbmNlKSB7XHJcbiAgICAgICAgcmV0dXJuIGV4dGVuc2lvbi5jbGFzcy5nZXRBZGRvbkluc3RhbmNlKCk7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIGV4dGVuc2lvbi5pbnN0YW5jZTtcclxuICAgIH1cclxuICAgIHJldHVybiBudWxsO1xyXG4gIH1cclxuXHJcbiAgLyoqIEF1dG8tcmVzaXplIGFsbCB0aGUgY29sdW1uIGluIHRoZSBncmlkIHRvIGZpdCB0aGUgZ3JpZCB3aWR0aCAqL1xyXG4gIGF1dG9SZXNpemVDb2x1bW5zKCkge1xyXG4gICAgdGhpcy5zaGFyZWRTZXJ2aWNlLmdyaWQuYXV0b3NpemVDb2x1bW5zKCk7XHJcbiAgfVxyXG5cclxuICAvKiogQmluZC9DcmVhdGUgZGlmZmVyZW50IENvbnRyb2xzIG9yIFBsdWdpbnMgYWZ0ZXIgdGhlIEdyaWQgaXMgY3JlYXRlZCAqL1xyXG4gIGJpbmREaWZmZXJlbnRFeHRlbnNpb25zKCkge1xyXG4gICAgaWYgKHRoaXMuc2hhcmVkU2VydmljZSAmJiB0aGlzLnNoYXJlZFNlcnZpY2UuZ3JpZE9wdGlvbnMpIHtcclxuICAgICAgLy8gbWFrZSBzdXJlIGFsbCBjb2x1bW5zIGFyZSB0cmFuc2xhdGVkIGJlZm9yZSBjcmVhdGluZyBDb2x1bW5QaWNrZXIvR3JpZE1lbnUgQ29udHJvbHNcclxuICAgICAgLy8gdGhpcyBpcyB0byBhdm9pZCBoYXZpbmcgaGlkZGVuIGNvbHVtbnMgbm90IGJlaW5nIHRyYW5zbGF0ZWQgb24gZmlyc3QgbG9hZFxyXG4gICAgICBpZiAodGhpcy5zaGFyZWRTZXJ2aWNlLmdyaWRPcHRpb25zLmVuYWJsZVRyYW5zbGF0ZSkge1xyXG4gICAgICAgIC8vIGV2ZW50dWFsbHkgZGVwcmVjYXRlIHRoZSBcImhlYWRlcktleVwiIGFuZCB1c2Ugb25seSB0aGUgXCJuYW1lS2V5XCJcclxuICAgICAgICB0aGlzLnRyYW5zbGF0ZUl0ZW1zKHRoaXMuc2hhcmVkU2VydmljZS5hbGxDb2x1bW5zLCAnaGVhZGVyS2V5JywgJ25hbWUnKTtcclxuICAgICAgICB0aGlzLnRyYW5zbGF0ZUl0ZW1zKHRoaXMuc2hhcmVkU2VydmljZS5hbGxDb2x1bW5zLCAnbmFtZUtleScsICduYW1lJyk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIEF1dG8gVG9vbHRpcCBQbHVnaW5cclxuICAgICAgaWYgKHRoaXMuc2hhcmVkU2VydmljZS5ncmlkT3B0aW9ucy5lbmFibGVBdXRvVG9vbHRpcCkge1xyXG4gICAgICAgIGlmICh0aGlzLmF1dG9Ub29sdGlwRXh0ZW5zaW9uICYmIHRoaXMuYXV0b1Rvb2x0aXBFeHRlbnNpb24ucmVnaXN0ZXIpIHtcclxuICAgICAgICAgIGNvbnN0IGluc3RhbmNlID0gdGhpcy5hdXRvVG9vbHRpcEV4dGVuc2lvbi5yZWdpc3RlcigpO1xyXG4gICAgICAgICAgdGhpcy5fZXh0ZW5zaW9uTGlzdFtFeHRlbnNpb25OYW1lLmF1dG9Ub29sdGlwXSA9IHsgbmFtZTogRXh0ZW5zaW9uTmFtZS5hdXRvVG9vbHRpcCwgY2xhc3M6IHRoaXMuYXV0b1Rvb2x0aXBFeHRlbnNpb24sIGFkZG9uOiBpbnN0YW5jZSwgaW5zdGFuY2UgfTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIENlbGwgRXh0ZXJuYWwgQ29weSBNYW5hZ2VyIFBsdWdpbiAoRXhjZWwgTGlrZSlcclxuICAgICAgaWYgKHRoaXMuc2hhcmVkU2VydmljZS5ncmlkT3B0aW9ucy5lbmFibGVFeGNlbENvcHlCdWZmZXIpIHtcclxuICAgICAgICBpZiAodGhpcy5jZWxsRXh0ZXJuYWxDb3B5RXh0ZW5zaW9uICYmIHRoaXMuY2VsbEV4dGVybmFsQ29weUV4dGVuc2lvbi5yZWdpc3Rlcikge1xyXG4gICAgICAgICAgY29uc3QgaW5zdGFuY2UgPSB0aGlzLmNlbGxFeHRlcm5hbENvcHlFeHRlbnNpb24ucmVnaXN0ZXIoKTtcclxuICAgICAgICAgIHRoaXMuX2V4dGVuc2lvbkxpc3RbRXh0ZW5zaW9uTmFtZS5jZWxsRXh0ZXJuYWxDb3B5TWFuYWdlcl0gPSB7IG5hbWU6IEV4dGVuc2lvbk5hbWUuY2VsbEV4dGVybmFsQ29weU1hbmFnZXIsIGNsYXNzOiB0aGlzLmNlbGxFeHRlcm5hbENvcHlFeHRlbnNpb24sIGFkZG9uOiBpbnN0YW5jZSwgaW5zdGFuY2UgfTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIChBY3Rpb24pIENlbGwgTWVudSBQbHVnaW5cclxuICAgICAgaWYgKHRoaXMuc2hhcmVkU2VydmljZS5ncmlkT3B0aW9ucy5lbmFibGVDZWxsTWVudSkge1xyXG4gICAgICAgIGlmICh0aGlzLmNlbGxNZW51RXh0ZW5zaW9uICYmIHRoaXMuY2VsbE1lbnVFeHRlbnNpb24ucmVnaXN0ZXIpIHtcclxuICAgICAgICAgIGNvbnN0IGluc3RhbmNlID0gdGhpcy5jZWxsTWVudUV4dGVuc2lvbi5yZWdpc3RlcigpO1xyXG4gICAgICAgICAgdGhpcy5fZXh0ZW5zaW9uTGlzdFtFeHRlbnNpb25OYW1lLmNlbGxNZW51XSA9IHsgbmFtZTogRXh0ZW5zaW9uTmFtZS5jZWxsTWVudSwgY2xhc3M6IHRoaXMuY2VsbE1lbnVFeHRlbnNpb24sIGFkZG9uOiBpbnN0YW5jZSwgaW5zdGFuY2UgfTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIFJvdyBTZWxlY3Rpb24gUGx1Z2luXHJcbiAgICAgIC8vIHRoaXMgZXh0ZW5zaW9uIHNob3VsZCBiZSByZWdpc3RlcmVkIEJFRk9SRSB0aGUgQ2hlY2tib3hTZWxlY3RvciwgUm93RGV0YWlsIG9yIFJvd01vdmVNYW5hZ2VyIHNpbmNlIGl0IGNhbiBiZSB1c2UgYnkgdGhlc2UgMiBwbHVnaW5zXHJcbiAgICAgIGlmICghdGhpcy5nZXRFeHRlbnNpb25CeU5hbWUoRXh0ZW5zaW9uTmFtZS5yb3dTZWxlY3Rpb24pICYmICh0aGlzLnNoYXJlZFNlcnZpY2UuZ3JpZE9wdGlvbnMuZW5hYmxlUm93U2VsZWN0aW9uIHx8IHRoaXMuc2hhcmVkU2VydmljZS5ncmlkT3B0aW9ucy5lbmFibGVDaGVja2JveFNlbGVjdG9yIHx8IHRoaXMuc2hhcmVkU2VydmljZS5ncmlkT3B0aW9ucy5lbmFibGVSb3dEZXRhaWxWaWV3IHx8IHRoaXMuc2hhcmVkU2VydmljZS5ncmlkT3B0aW9ucy5lbmFibGVSb3dNb3ZlTWFuYWdlcikpIHtcclxuICAgICAgICBpZiAodGhpcy5yb3dTZWxlY3Rpb25FeHRlbnNpb24gJiYgdGhpcy5yb3dTZWxlY3Rpb25FeHRlbnNpb24ucmVnaXN0ZXIpIHtcclxuICAgICAgICAgIGNvbnN0IGluc3RhbmNlID0gdGhpcy5yb3dTZWxlY3Rpb25FeHRlbnNpb24ucmVnaXN0ZXIoKTtcclxuICAgICAgICAgIHRoaXMuX2V4dGVuc2lvbkxpc3RbRXh0ZW5zaW9uTmFtZS5yb3dTZWxlY3Rpb25dID0geyBuYW1lOiBFeHRlbnNpb25OYW1lLnJvd1NlbGVjdGlvbiwgY2xhc3M6IHRoaXMucm93U2VsZWN0aW9uRXh0ZW5zaW9uLCBhZGRvbjogaW5zdGFuY2UsIGluc3RhbmNlIH07XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBDaGVja2JveCBTZWxlY3RvciBQbHVnaW5cclxuICAgICAgaWYgKHRoaXMuc2hhcmVkU2VydmljZS5ncmlkT3B0aW9ucy5lbmFibGVDaGVja2JveFNlbGVjdG9yKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuY2hlY2tib3hTZWxlY3RvckV4dGVuc2lvbiAmJiB0aGlzLmNoZWNrYm94U2VsZWN0b3JFeHRlbnNpb24ucmVnaXN0ZXIpIHtcclxuICAgICAgICAgIGNvbnN0IHJvd1NlbGVjdGlvbkV4dGVuc2lvbiA9IHRoaXMuZ2V0RXh0ZW5zaW9uQnlOYW1lKEV4dGVuc2lvbk5hbWUucm93U2VsZWN0aW9uKTtcclxuICAgICAgICAgIHRoaXMuY2hlY2tib3hTZWxlY3RvckV4dGVuc2lvbi5yZWdpc3Rlcihyb3dTZWxlY3Rpb25FeHRlbnNpb24pO1xyXG4gICAgICAgICAgY29uc3QgY3JlYXRlZEV4dGVuc2lvbiA9IHRoaXMuZ2V0Q3JlYXRlZEV4dGVuc2lvbkJ5TmFtZShFeHRlbnNpb25OYW1lLmNoZWNrYm94U2VsZWN0b3IpOyAvLyBnZXQgdGhlIGluc3RhbmNlIGZyb20gd2hlbiBpdCB3YXMgcmVhbGx5IGNyZWF0ZWQgZWFybGllclxyXG4gICAgICAgICAgY29uc3QgaW5zdGFuY2UgPSBjcmVhdGVkRXh0ZW5zaW9uICYmIGNyZWF0ZWRFeHRlbnNpb24uaW5zdGFuY2U7XHJcbiAgICAgICAgICB0aGlzLl9leHRlbnNpb25MaXN0W0V4dGVuc2lvbk5hbWUuY2hlY2tib3hTZWxlY3Rvcl0gPSB7IG5hbWU6IEV4dGVuc2lvbk5hbWUuY2hlY2tib3hTZWxlY3RvciwgY2xhc3M6IHRoaXMuY2hlY2tib3hTZWxlY3RvckV4dGVuc2lvbiwgYWRkb246IGluc3RhbmNlLCBpbnN0YW5jZSB9O1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gQ29sdW1uIFBpY2tlciBDb250cm9sXHJcbiAgICAgIGlmICh0aGlzLnNoYXJlZFNlcnZpY2UuZ3JpZE9wdGlvbnMuZW5hYmxlQ29sdW1uUGlja2VyKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuY29sdW1uUGlja2VyRXh0ZW5zaW9uICYmIHRoaXMuY29sdW1uUGlja2VyRXh0ZW5zaW9uLnJlZ2lzdGVyKSB7XHJcbiAgICAgICAgICBjb25zdCBpbnN0YW5jZSA9IHRoaXMuY29sdW1uUGlja2VyRXh0ZW5zaW9uLnJlZ2lzdGVyKCk7XHJcbiAgICAgICAgICB0aGlzLl9leHRlbnNpb25MaXN0W0V4dGVuc2lvbk5hbWUuY29sdW1uUGlja2VyXSA9IHsgbmFtZTogRXh0ZW5zaW9uTmFtZS5jb2x1bW5QaWNrZXIsIGNsYXNzOiB0aGlzLmNvbHVtblBpY2tlckV4dGVuc2lvbiwgYWRkb246IGluc3RhbmNlLCBpbnN0YW5jZSB9O1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gQ29udGV4dCBNZW51IENvbnRyb2xcclxuICAgICAgaWYgKHRoaXMuc2hhcmVkU2VydmljZS5ncmlkT3B0aW9ucy5lbmFibGVDb250ZXh0TWVudSkge1xyXG4gICAgICAgIGlmICh0aGlzLmNvbnRleHRNZW51RXh0ZW5zaW9uICYmIHRoaXMuY29udGV4dE1lbnVFeHRlbnNpb24ucmVnaXN0ZXIpIHtcclxuICAgICAgICAgIGNvbnN0IGluc3RhbmNlID0gdGhpcy5jb250ZXh0TWVudUV4dGVuc2lvbi5yZWdpc3RlcigpO1xyXG4gICAgICAgICAgdGhpcy5fZXh0ZW5zaW9uTGlzdFtFeHRlbnNpb25OYW1lLmNvbnRleHRNZW51XSA9IHsgbmFtZTogRXh0ZW5zaW9uTmFtZS5jb250ZXh0TWVudSwgY2xhc3M6IHRoaXMuY29udGV4dE1lbnVFeHRlbnNpb24sIGFkZG9uOiBpbnN0YW5jZSwgaW5zdGFuY2UgfTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIERyYWdnYWJsZSBHcm91cGluZyBQbHVnaW5cclxuICAgICAgaWYgKHRoaXMuc2hhcmVkU2VydmljZS5ncmlkT3B0aW9ucy5lbmFibGVEcmFnZ2FibGVHcm91cGluZykge1xyXG4gICAgICAgIGlmICh0aGlzLmRyYWdnYWJsZUdyb3VwaW5nRXh0ZW5zaW9uICYmIHRoaXMuZHJhZ2dhYmxlR3JvdXBpbmdFeHRlbnNpb24ucmVnaXN0ZXIpIHtcclxuICAgICAgICAgIGNvbnN0IGluc3RhbmNlID0gdGhpcy5kcmFnZ2FibGVHcm91cGluZ0V4dGVuc2lvbi5yZWdpc3RlcigpO1xyXG4gICAgICAgICAgdGhpcy5fZXh0ZW5zaW9uTGlzdFtFeHRlbnNpb25OYW1lLmRyYWdnYWJsZUdyb3VwaW5nXSA9IHsgbmFtZTogRXh0ZW5zaW9uTmFtZS5kcmFnZ2FibGVHcm91cGluZywgY2xhc3M6IHRoaXMuZHJhZ2dhYmxlR3JvdXBpbmdFeHRlbnNpb24sIGFkZG9uOiBpbnN0YW5jZSwgaW5zdGFuY2UgfTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIEdyaWQgTWVudSBDb250cm9sXHJcbiAgICAgIGlmICh0aGlzLnNoYXJlZFNlcnZpY2UuZ3JpZE9wdGlvbnMuZW5hYmxlR3JpZE1lbnUpIHtcclxuICAgICAgICBpZiAodGhpcy5ncmlkTWVudUV4dGVuc2lvbiAmJiB0aGlzLmdyaWRNZW51RXh0ZW5zaW9uLnJlZ2lzdGVyKSB7XHJcbiAgICAgICAgICBjb25zdCBpbnN0YW5jZSA9IHRoaXMuZ3JpZE1lbnVFeHRlbnNpb24ucmVnaXN0ZXIoKTtcclxuICAgICAgICAgIHRoaXMuX2V4dGVuc2lvbkxpc3RbRXh0ZW5zaW9uTmFtZS5ncmlkTWVudV0gPSB7IG5hbWU6IEV4dGVuc2lvbk5hbWUuZ3JpZE1lbnUsIGNsYXNzOiB0aGlzLmdyaWRNZW51RXh0ZW5zaW9uLCBhZGRvbjogaW5zdGFuY2UsIGluc3RhbmNlIH07XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBHcm91cGluZyBQbHVnaW5cclxuICAgICAgLy8gcmVnaXN0ZXIgdGhlIGdyb3VwIGl0ZW0gbWV0YWRhdGEgcHJvdmlkZXIgdG8gYWRkIGV4cGFuZC9jb2xsYXBzZSBncm91cCBoYW5kbGVyc1xyXG4gICAgICBpZiAodGhpcy5zaGFyZWRTZXJ2aWNlLmdyaWRPcHRpb25zLmVuYWJsZURyYWdnYWJsZUdyb3VwaW5nIHx8IHRoaXMuc2hhcmVkU2VydmljZS5ncmlkT3B0aW9ucy5lbmFibGVHcm91cGluZykge1xyXG4gICAgICAgIGlmICh0aGlzLmdyb3VwSXRlbU1ldGFFeHRlbnNpb24gJiYgdGhpcy5ncm91cEl0ZW1NZXRhRXh0ZW5zaW9uLnJlZ2lzdGVyKSB7XHJcbiAgICAgICAgICBjb25zdCBpbnN0YW5jZSA9IHRoaXMuZ3JvdXBJdGVtTWV0YUV4dGVuc2lvbi5yZWdpc3RlcigpO1xyXG4gICAgICAgICAgdGhpcy5fZXh0ZW5zaW9uTGlzdFtFeHRlbnNpb25OYW1lLmdyb3VwSXRlbU1ldGFQcm92aWRlcl0gPSB7IG5hbWU6IEV4dGVuc2lvbk5hbWUuZ3JvdXBJdGVtTWV0YVByb3ZpZGVyLCBjbGFzczogdGhpcy5ncm91cEl0ZW1NZXRhRXh0ZW5zaW9uLCBhZGRvbjogaW5zdGFuY2UsIGluc3RhbmNlIH07XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBIZWFkZXIgQnV0dG9uIFBsdWdpblxyXG4gICAgICBpZiAodGhpcy5zaGFyZWRTZXJ2aWNlLmdyaWRPcHRpb25zLmVuYWJsZUhlYWRlckJ1dHRvbikge1xyXG4gICAgICAgIGlmICh0aGlzLmhlYWRlckJ1dHRvbkV4dGVuc2lvbiAmJiB0aGlzLmhlYWRlckJ1dHRvbkV4dGVuc2lvbi5yZWdpc3Rlcikge1xyXG4gICAgICAgICAgY29uc3QgaW5zdGFuY2UgPSB0aGlzLmhlYWRlckJ1dHRvbkV4dGVuc2lvbi5yZWdpc3RlcigpO1xyXG4gICAgICAgICAgdGhpcy5fZXh0ZW5zaW9uTGlzdFtFeHRlbnNpb25OYW1lLmhlYWRlckJ1dHRvbl0gPSB7IG5hbWU6IEV4dGVuc2lvbk5hbWUuaGVhZGVyQnV0dG9uLCBjbGFzczogdGhpcy5oZWFkZXJCdXR0b25FeHRlbnNpb24sIGFkZG9uOiBpbnN0YW5jZSwgaW5zdGFuY2UgfTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIEhlYWRlciBNZW51IFBsdWdpblxyXG4gICAgICBpZiAodGhpcy5zaGFyZWRTZXJ2aWNlLmdyaWRPcHRpb25zLmVuYWJsZUhlYWRlck1lbnUpIHtcclxuICAgICAgICBpZiAodGhpcy5oZWFkZXJNZW51RXh0ZW5zaW9uICYmIHRoaXMuaGVhZGVyTWVudUV4dGVuc2lvbi5yZWdpc3Rlcikge1xyXG4gICAgICAgICAgY29uc3QgaW5zdGFuY2UgPSB0aGlzLmhlYWRlck1lbnVFeHRlbnNpb24ucmVnaXN0ZXIoKTtcclxuICAgICAgICAgIHRoaXMuX2V4dGVuc2lvbkxpc3RbRXh0ZW5zaW9uTmFtZS5oZWFkZXJNZW51XSA9IHsgbmFtZTogRXh0ZW5zaW9uTmFtZS5oZWFkZXJNZW51LCBjbGFzczogdGhpcy5oZWFkZXJNZW51RXh0ZW5zaW9uLCBhZGRvbjogaW5zdGFuY2UsIGluc3RhbmNlIH07XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBSb3cgRGV0YWlsIFZpZXcgUGx1Z2luXHJcbiAgICAgIGlmICh0aGlzLnNoYXJlZFNlcnZpY2UuZ3JpZE9wdGlvbnMuZW5hYmxlUm93RGV0YWlsVmlldykge1xyXG4gICAgICAgIGlmICh0aGlzLnJvd0RldGFpbFZpZXdFeHRlbnNpb24gJiYgdGhpcy5yb3dEZXRhaWxWaWV3RXh0ZW5zaW9uLnJlZ2lzdGVyKSB7XHJcbiAgICAgICAgICBjb25zdCByb3dTZWxlY3Rpb25FeHRlbnNpb24gPSB0aGlzLmdldEV4dGVuc2lvbkJ5TmFtZShFeHRlbnNpb25OYW1lLnJvd1NlbGVjdGlvbik7XHJcbiAgICAgICAgICB0aGlzLnJvd0RldGFpbFZpZXdFeHRlbnNpb24ucmVnaXN0ZXIocm93U2VsZWN0aW9uRXh0ZW5zaW9uKTtcclxuICAgICAgICAgIGNvbnN0IGNyZWF0ZWRFeHRlbnNpb24gPSB0aGlzLmdldENyZWF0ZWRFeHRlbnNpb25CeU5hbWUoRXh0ZW5zaW9uTmFtZS5yb3dEZXRhaWxWaWV3KTsgLy8gZ2V0IHRoZSBwbHVnaW4gZnJvbSB3aGVuIGl0IHdhcyByZWFsbHkgY3JlYXRlZCBlYXJsaWVyXHJcbiAgICAgICAgICBjb25zdCBpbnN0YW5jZSA9IGNyZWF0ZWRFeHRlbnNpb24gJiYgY3JlYXRlZEV4dGVuc2lvbi5pbnN0YW5jZTtcclxuICAgICAgICAgIHRoaXMuX2V4dGVuc2lvbkxpc3RbRXh0ZW5zaW9uTmFtZS5yb3dEZXRhaWxWaWV3XSA9IHsgbmFtZTogRXh0ZW5zaW9uTmFtZS5yb3dEZXRhaWxWaWV3LCBjbGFzczogdGhpcy5yb3dEZXRhaWxWaWV3RXh0ZW5zaW9uLCBhZGRvbjogaW5zdGFuY2UsIGluc3RhbmNlIH07XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBSb3cgTW92ZSBNYW5hZ2VyIFBsdWdpblxyXG4gICAgICBpZiAodGhpcy5zaGFyZWRTZXJ2aWNlLmdyaWRPcHRpb25zLmVuYWJsZVJvd01vdmVNYW5hZ2VyICYmIHRoaXMucm93TW92ZU1hbmFnZXJFeHRlbnNpb24gJiYgdGhpcy5yb3dNb3ZlTWFuYWdlckV4dGVuc2lvbi5yZWdpc3Rlcikge1xyXG4gICAgICAgIGNvbnN0IHJvd1NlbGVjdGlvbkV4dGVuc2lvbiA9IHRoaXMuZ2V0RXh0ZW5zaW9uQnlOYW1lKEV4dGVuc2lvbk5hbWUucm93U2VsZWN0aW9uKTtcclxuICAgICAgICB0aGlzLnJvd01vdmVNYW5hZ2VyRXh0ZW5zaW9uLnJlZ2lzdGVyKHJvd1NlbGVjdGlvbkV4dGVuc2lvbik7XHJcbiAgICAgICAgY29uc3QgY3JlYXRlZEV4dGVuc2lvbiA9IHRoaXMuZ2V0Q3JlYXRlZEV4dGVuc2lvbkJ5TmFtZShFeHRlbnNpb25OYW1lLnJvd01vdmVNYW5hZ2VyKTsgLy8gZ2V0IHRoZSBpbnN0YW5jZSBmcm9tIHdoZW4gaXQgd2FzIHJlYWxseSBjcmVhdGVkIGVhcmxpZXJcclxuICAgICAgICBjb25zdCBpbnN0YW5jZSA9IGNyZWF0ZWRFeHRlbnNpb24gJiYgY3JlYXRlZEV4dGVuc2lvbi5pbnN0YW5jZTtcclxuICAgICAgICB0aGlzLl9leHRlbnNpb25MaXN0W0V4dGVuc2lvbk5hbWUucm93TW92ZU1hbmFnZXJdID0geyBuYW1lOiBFeHRlbnNpb25OYW1lLnJvd01vdmVNYW5hZ2VyLCBjbGFzczogdGhpcy5yb3dNb3ZlTWFuYWdlckV4dGVuc2lvbiwgYWRkb246IGluc3RhbmNlLCBpbnN0YW5jZSB9O1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBtYW51YWxseSByZWdpc3RlciBvdGhlciBwbHVnaW5zXHJcbiAgICAgIGlmICh0aGlzLnNoYXJlZFNlcnZpY2UuZ3JpZE9wdGlvbnMucmVnaXN0ZXJQbHVnaW5zICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICBjb25zdCBncmlkID0gdGhpcy5zaGFyZWRTZXJ2aWNlLmdyaWQ7XHJcbiAgICAgICAgY29uc3QgZ3JpZE9wdGlvbnMgPSB0aGlzLnNoYXJlZFNlcnZpY2UuZ3JpZE9wdGlvbnM7XHJcblxyXG4gICAgICAgIGlmIChBcnJheS5pc0FycmF5KGdyaWRPcHRpb25zLnJlZ2lzdGVyUGx1Z2lucykpIHtcclxuICAgICAgICAgIGdyaWRPcHRpb25zLnJlZ2lzdGVyUGx1Z2lucy5mb3JFYWNoKChwbHVnaW46IGFueSkgPT4ge1xyXG4gICAgICAgICAgICBncmlkLnJlZ2lzdGVyUGx1Z2luKHBsdWdpbik7XHJcbiAgICAgICAgICAgIGNvbnN0IGluc3RhbmNlID0gZ3JpZC5nZXRQbHVnaW5CeU5hbWUocGx1Z2luICYmIHBsdWdpbi5uYW1lIHx8ICcnKTtcclxuICAgICAgICAgICAgdGhpcy5fZXh0ZW5zaW9uTGlzdFtFeHRlbnNpb25OYW1lLm5vbmFtZV0gPSB7IG5hbWU6IEV4dGVuc2lvbk5hbWUubm9uYW1lLCBjbGFzczogbnVsbCwgYWRkb246IGluc3RhbmNlLCBpbnN0YW5jZSB9O1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIGNvbnN0IHBsdWdpbiA9IGdyaWRPcHRpb25zLnJlZ2lzdGVyUGx1Z2lucztcclxuICAgICAgICAgIGdyaWQucmVnaXN0ZXJQbHVnaW4ocGx1Z2luKTtcclxuICAgICAgICAgIGNvbnN0IGluc3RhbmNlID0gZ3JpZC5nZXRQbHVnaW5CeU5hbWUocGx1Z2luICYmIHBsdWdpbi5uYW1lIHx8ICcnKTtcclxuICAgICAgICAgIHRoaXMuX2V4dGVuc2lvbkxpc3RbRXh0ZW5zaW9uTmFtZS5ub25hbWVdID0geyBuYW1lOiBFeHRlbnNpb25OYW1lLm5vbmFtZSwgY2xhc3M6IG51bGwsIGFkZG9uOiBpbnN0YW5jZSwgaW5zdGFuY2UgfTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEJpbmQvQ3JlYXRlIGNlcnRhaW4gcGx1Z2lucyBiZWZvcmUgdGhlIEdyaWQgY3JlYXRpb24gdG8gYXZvaWQgaGF2aW5nIG9kZCBiZWhhdmlvcnMuXHJcbiAgICogTW9zdGx5IGJlY2F1c2UgdGhlIGNvbHVtbiBkZWZpbml0aW9ucyBtaWdodCBjaGFuZ2UgYWZ0ZXIgdGhlIGdyaWQgY3JlYXRpb24sIHNvIHdlIHdhbnQgdG8gbWFrZSBzdXJlIHRvIGFkZCBpdCBiZWZvcmUgdGhlblxyXG4gICAqIEBwYXJhbSBjb2x1bW5EZWZpbml0aW9uc1xyXG4gICAqIEBwYXJhbSBvcHRpb25zXHJcbiAgICovXHJcbiAgY3JlYXRlRXh0ZW5zaW9uc0JlZm9yZUdyaWRDcmVhdGlvbihjb2x1bW5EZWZpbml0aW9uczogQ29sdW1uW10sIG9wdGlvbnM6IEdyaWRPcHRpb24pIHtcclxuICAgIGlmIChvcHRpb25zLmVuYWJsZUNoZWNrYm94U2VsZWN0b3IpIHtcclxuICAgICAgaWYgKCF0aGlzLmdldENyZWF0ZWRFeHRlbnNpb25CeU5hbWUoRXh0ZW5zaW9uTmFtZS5jaGVja2JveFNlbGVjdG9yKSkge1xyXG4gICAgICAgIGNvbnN0IGNoZWNrYm94SW5zdGFuY2UgPSB0aGlzLmNoZWNrYm94U2VsZWN0b3JFeHRlbnNpb24uY3JlYXRlKGNvbHVtbkRlZmluaXRpb25zLCBvcHRpb25zKTtcclxuICAgICAgICB0aGlzLl9leHRlbnNpb25DcmVhdGVkTGlzdFtFeHRlbnNpb25OYW1lLmNoZWNrYm94U2VsZWN0b3JdID0geyBuYW1lOiBFeHRlbnNpb25OYW1lLmNoZWNrYm94U2VsZWN0b3IsIGFkZG9uOiBjaGVja2JveEluc3RhbmNlLCBpbnN0YW5jZTogY2hlY2tib3hJbnN0YW5jZSwgY2xhc3M6IHRoaXMuY2hlY2tib3hTZWxlY3RvckV4dGVuc2lvbiB9O1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBpZiAob3B0aW9ucy5lbmFibGVSb3dNb3ZlTWFuYWdlcikge1xyXG4gICAgICBpZiAoIXRoaXMuZ2V0Q3JlYXRlZEV4dGVuc2lvbkJ5TmFtZShFeHRlbnNpb25OYW1lLnJvd01vdmVNYW5hZ2VyKSkge1xyXG4gICAgICAgIGNvbnN0IHJvd01vdmVJbnN0YW5jZSA9IHRoaXMucm93TW92ZU1hbmFnZXJFeHRlbnNpb24uY3JlYXRlKGNvbHVtbkRlZmluaXRpb25zLCBvcHRpb25zKTtcclxuICAgICAgICB0aGlzLl9leHRlbnNpb25DcmVhdGVkTGlzdFtFeHRlbnNpb25OYW1lLnJvd01vdmVNYW5hZ2VyXSA9IHsgbmFtZTogRXh0ZW5zaW9uTmFtZS5yb3dNb3ZlTWFuYWdlciwgYWRkb246IHJvd01vdmVJbnN0YW5jZSwgaW5zdGFuY2U6IHJvd01vdmVJbnN0YW5jZSwgY2xhc3M6IHRoaXMucm93TW92ZU1hbmFnZXJFeHRlbnNpb24gfTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgaWYgKG9wdGlvbnMuZW5hYmxlUm93RGV0YWlsVmlldykge1xyXG4gICAgICBpZiAoIXRoaXMuZ2V0Q3JlYXRlZEV4dGVuc2lvbkJ5TmFtZShFeHRlbnNpb25OYW1lLnJvd0RldGFpbFZpZXcpKSB7XHJcbiAgICAgICAgY29uc3Qgcm93RGV0YWlsSW5zdGFuY2UgPSB0aGlzLnJvd0RldGFpbFZpZXdFeHRlbnNpb24uY3JlYXRlKGNvbHVtbkRlZmluaXRpb25zLCBvcHRpb25zKTtcclxuICAgICAgICB0aGlzLl9leHRlbnNpb25DcmVhdGVkTGlzdFtFeHRlbnNpb25OYW1lLnJvd0RldGFpbFZpZXddID0geyBuYW1lOiBFeHRlbnNpb25OYW1lLnJvd0RldGFpbFZpZXcsIGFkZG9uOiByb3dEZXRhaWxJbnN0YW5jZSwgaW5zdGFuY2U6IHJvd0RldGFpbEluc3RhbmNlLCBjbGFzczogdGhpcy5yb3dEZXRhaWxWaWV3RXh0ZW5zaW9uIH07XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGlmIChvcHRpb25zLmVuYWJsZURyYWdnYWJsZUdyb3VwaW5nKSB7XHJcbiAgICAgIGlmICghdGhpcy5nZXRDcmVhdGVkRXh0ZW5zaW9uQnlOYW1lKEV4dGVuc2lvbk5hbWUuZHJhZ2dhYmxlR3JvdXBpbmcpKSB7XHJcbiAgICAgICAgY29uc3QgZHJhZ2dhYmxlSW5zdGFuY2UgPSB0aGlzLmRyYWdnYWJsZUdyb3VwaW5nRXh0ZW5zaW9uLmNyZWF0ZShvcHRpb25zKTtcclxuICAgICAgICBvcHRpb25zLmVuYWJsZUNvbHVtblJlb3JkZXIgPSBkcmFnZ2FibGVJbnN0YW5jZS5nZXRTZXR1cENvbHVtblJlb3JkZXI7XHJcbiAgICAgICAgdGhpcy5fZXh0ZW5zaW9uQ3JlYXRlZExpc3RbRXh0ZW5zaW9uTmFtZS5kcmFnZ2FibGVHcm91cGluZ10gPSB7IG5hbWU6IEV4dGVuc2lvbk5hbWUuZHJhZ2dhYmxlR3JvdXBpbmcsIGFkZG9uOiBkcmFnZ2FibGVJbnN0YW5jZSwgaW5zdGFuY2U6IGRyYWdnYWJsZUluc3RhbmNlLCBjbGFzczogZHJhZ2dhYmxlSW5zdGFuY2UuZ2V0U2V0dXBDb2x1bW5SZW9yZGVyIH07XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKiBIaWRlIGEgY29sdW1uIGZyb20gdGhlIGdyaWQgKi9cclxuICBoaWRlQ29sdW1uKGNvbHVtbjogQ29sdW1uKSB7XHJcbiAgICBpZiAodGhpcy5zaGFyZWRTZXJ2aWNlICYmIHRoaXMuc2hhcmVkU2VydmljZS5ncmlkICYmIHRoaXMuc2hhcmVkU2VydmljZS5ncmlkLmdldENvbHVtbnMgJiYgdGhpcy5zaGFyZWRTZXJ2aWNlLmdyaWQuc2V0Q29sdW1ucykge1xyXG4gICAgICBjb25zdCBjb2x1bW5JbmRleCA9IHRoaXMuc2hhcmVkU2VydmljZS5ncmlkLmdldENvbHVtbkluZGV4KGNvbHVtbi5pZCk7XHJcbiAgICAgIHRoaXMuc2hhcmVkU2VydmljZS52aXNpYmxlQ29sdW1ucyA9IHRoaXMucmVtb3ZlQ29sdW1uQnlJbmRleCh0aGlzLnNoYXJlZFNlcnZpY2UuZ3JpZC5nZXRDb2x1bW5zKCksIGNvbHVtbkluZGV4KTtcclxuICAgICAgdGhpcy5zaGFyZWRTZXJ2aWNlLmdyaWQuc2V0Q29sdW1ucyh0aGlzLnNoYXJlZFNlcnZpY2UudmlzaWJsZUNvbHVtbnMpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqIFJlZnJlc2ggdGhlIGRhdGFzZXQgdGhyb3VnaCB0aGUgQmFja2VuZCBTZXJ2aWNlICovXHJcbiAgcmVmcmVzaEJhY2tlbmREYXRhc2V0KGdyaWRPcHRpb25zPzogR3JpZE9wdGlvbikge1xyXG4gICAgdGhpcy5ncmlkTWVudUV4dGVuc2lvbi5yZWZyZXNoQmFja2VuZERhdGFzZXQoZ3JpZE9wdGlvbnMpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVtb3ZlIGEgY29sdW1uIGZyb20gdGhlIGdyaWQgYnkgaXQncyBpbmRleCBpbiB0aGUgZ3JpZFxyXG4gICAqIEBwYXJhbSBjb2x1bW5zIGlucHV0XHJcbiAgICogQHBhcmFtIGluZGV4XHJcbiAgICovXHJcbiAgcmVtb3ZlQ29sdW1uQnlJbmRleChjb2x1bW5zOiBDb2x1bW5bXSwgaW5kZXg6IG51bWJlcik6IENvbHVtbltdIHtcclxuICAgIGlmIChBcnJheS5pc0FycmF5KGNvbHVtbnMpKSB7XHJcbiAgICAgIHJldHVybiBjb2x1bW5zLmZpbHRlcigoZWw6IENvbHVtbiwgaTogbnVtYmVyKSA9PiBpbmRleCAhPT0gaSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gY29sdW1ucztcclxuICB9XHJcblxyXG4gIC8qKiBUcmFuc2xhdGUgdGhlIENlbGwgTWVudSB0aXRsZXMsIHdlIG5lZWQgdG8gbG9vcCB0aHJvdWdoIGFsbCBjb2x1bW4gZGVmaW5pdGlvbiB0byByZS10cmFuc2xhdGUgdGhlbSAqL1xyXG4gIHRyYW5zbGF0ZUNlbGxNZW51KCkge1xyXG4gICAgaWYgKHRoaXMuY2VsbE1lbnVFeHRlbnNpb24gJiYgdGhpcy5jZWxsTWVudUV4dGVuc2lvbi50cmFuc2xhdGVDZWxsTWVudSkge1xyXG4gICAgICB0aGlzLmNlbGxNZW51RXh0ZW5zaW9uLnRyYW5zbGF0ZUNlbGxNZW51KCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKiogVHJhbnNsYXRlIHRoZSBDb2x1bW4gUGlja2VyIGFuZCBpdCdzIGxhc3QgMiBjaGVja2JveGVzICovXHJcbiAgdHJhbnNsYXRlQ29sdW1uUGlja2VyKCkge1xyXG4gICAgaWYgKHRoaXMuY29sdW1uUGlja2VyRXh0ZW5zaW9uICYmIHRoaXMuY29sdW1uUGlja2VyRXh0ZW5zaW9uLnRyYW5zbGF0ZUNvbHVtblBpY2tlcikge1xyXG4gICAgICB0aGlzLmNvbHVtblBpY2tlckV4dGVuc2lvbi50cmFuc2xhdGVDb2x1bW5QaWNrZXIoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKiBUcmFuc2xhdGUgdGhlIENvbnRleHQgTWVudSB0aXRsZXMsIHdlIG5lZWQgdG8gbG9vcCB0aHJvdWdoIGFsbCBjb2x1bW4gZGVmaW5pdGlvbiB0byByZS10cmFuc2xhdGUgdGhlbSAqL1xyXG4gIHRyYW5zbGF0ZUNvbnRleHRNZW51KCkge1xyXG4gICAgaWYgKHRoaXMuY29udGV4dE1lbnVFeHRlbnNpb24gJiYgdGhpcy5jb250ZXh0TWVudUV4dGVuc2lvbi50cmFuc2xhdGVDb250ZXh0TWVudSkge1xyXG4gICAgICB0aGlzLmNvbnRleHRNZW51RXh0ZW5zaW9uLnRyYW5zbGF0ZUNvbnRleHRNZW51KCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBUcmFuc2xhdGUgdGhlIEhlYWRlciBNZW51IHRpdGxlcywgd2UgbmVlZCB0byBsb29wIHRocm91Z2ggYWxsIGNvbHVtbiBkZWZpbml0aW9uIHRvIHJlLXRyYW5zbGF0ZSB0aGVtXHJcbiAgICovXHJcbiAgdHJhbnNsYXRlR3JpZE1lbnUoKSB7XHJcbiAgICBpZiAodGhpcy5ncmlkTWVudUV4dGVuc2lvbiAmJiB0aGlzLmdyaWRNZW51RXh0ZW5zaW9uLnRyYW5zbGF0ZUdyaWRNZW51KSB7XHJcbiAgICAgIHRoaXMuZ3JpZE1lbnVFeHRlbnNpb24udHJhbnNsYXRlR3JpZE1lbnUoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFRyYW5zbGF0ZSB0aGUgSGVhZGVyIE1lbnUgdGl0bGVzLCB3ZSBuZWVkIHRvIGxvb3AgdGhyb3VnaCBhbGwgY29sdW1uIGRlZmluaXRpb24gdG8gcmUtdHJhbnNsYXRlIHRoZW1cclxuICAgKi9cclxuICB0cmFuc2xhdGVIZWFkZXJNZW51KCkge1xyXG4gICAgaWYgKHRoaXMuaGVhZGVyTWVudUV4dGVuc2lvbiAmJiB0aGlzLmhlYWRlck1lbnVFeHRlbnNpb24udHJhbnNsYXRlSGVhZGVyTWVudSkge1xyXG4gICAgICB0aGlzLmhlYWRlck1lbnVFeHRlbnNpb24udHJhbnNsYXRlSGVhZGVyTWVudSgpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogVHJhbnNsYXRlIG1hbnVhbGx5IHRoZSBoZWFkZXIgdGl0bGVzLlxyXG4gICAqIFdlIGNvdWxkIG9wdGlvbmFsbHkgcGFzcyBhIGxvY2FsZSAodGhhdCB3aWxsIGNoYW5nZSBjdXJyZW50bHkgbG9hZGVkIGxvY2FsZSksIGVsc2UgaXQgd2lsbCB1c2UgY3VycmVudCBsb2NhbGVcclxuICAgKiBAcGFyYW0gbG9jYWxlIHRvIHVzZVxyXG4gICAqIEBwYXJhbSBuZXcgY29sdW1uIGRlZmluaXRpb25zIChvcHRpb25hbClcclxuICAgKi9cclxuICB0cmFuc2xhdGVDb2x1bW5IZWFkZXJzKGxvY2FsZT86IGJvb2xlYW4gfCBzdHJpbmcsIG5ld0NvbHVtbkRlZmluaXRpb25zPzogQ29sdW1uW10pIHtcclxuICAgIGlmICh0aGlzLnNoYXJlZFNlcnZpY2UgJiYgdGhpcy5zaGFyZWRTZXJ2aWNlLmdyaWRPcHRpb25zICYmIHRoaXMuc2hhcmVkU2VydmljZS5ncmlkT3B0aW9ucy5lbmFibGVUcmFuc2xhdGUgJiYgKCF0aGlzLnRyYW5zbGF0ZSB8fCAhdGhpcy50cmFuc2xhdGUuaW5zdGFudCkpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdbQW5ndWxhci1TbGlja2dyaWRdIHJlcXVpcmVzIFwibmd4LXRyYW5zbGF0ZVwiIHRvIGJlIGluc3RhbGxlZCBhbmQgY29uZmlndXJlZCB3aGVuIHRoZSBncmlkIG9wdGlvbiBcImVuYWJsZVRyYW5zbGF0ZVwiIGlzIGVuYWJsZWQuJyk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKGxvY2FsZSkge1xyXG4gICAgICB0aGlzLnRyYW5zbGF0ZS51c2UobG9jYWxlIGFzIHN0cmluZyk7XHJcbiAgICB9XHJcblxyXG4gICAgbGV0IGNvbHVtbkRlZmluaXRpb25zID0gbmV3Q29sdW1uRGVmaW5pdGlvbnM7XHJcbiAgICBpZiAoIWNvbHVtbkRlZmluaXRpb25zKSB7XHJcbiAgICAgIGNvbHVtbkRlZmluaXRpb25zID0gdGhpcy5zaGFyZWRTZXJ2aWNlLmNvbHVtbkRlZmluaXRpb25zO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIGV2ZW50dWFsbHkgZGVwcmVjYXRlIHRoZSBcImhlYWRlcktleVwiIGFuZCB1c2Ugb25seSB0aGUgXCJuYW1lS2V5XCJcclxuICAgIHRoaXMudHJhbnNsYXRlSXRlbXMoY29sdW1uRGVmaW5pdGlvbnMsICdoZWFkZXJLZXknLCAnbmFtZScpO1xyXG4gICAgdGhpcy50cmFuc2xhdGVJdGVtcyh0aGlzLnNoYXJlZFNlcnZpY2UuYWxsQ29sdW1ucywgJ2hlYWRlcktleScsICduYW1lJyk7XHJcbiAgICB0aGlzLnRyYW5zbGF0ZUl0ZW1zKGNvbHVtbkRlZmluaXRpb25zLCAnbmFtZUtleScsICduYW1lJyk7XHJcbiAgICB0aGlzLnRyYW5zbGF0ZUl0ZW1zKHRoaXMuc2hhcmVkU2VydmljZS5hbGxDb2x1bW5zLCAnbmFtZUtleScsICduYW1lJyk7XHJcblxyXG4gICAgLy8gcmUtcmVuZGVyIHRoZSBjb2x1bW4gaGVhZGVyc1xyXG4gICAgdGhpcy5yZW5kZXJDb2x1bW5IZWFkZXJzKGNvbHVtbkRlZmluaXRpb25zLCBBcnJheS5pc0FycmF5KG5ld0NvbHVtbkRlZmluaXRpb25zKSk7XHJcbiAgICB0aGlzLmdyaWRNZW51RXh0ZW5zaW9uLnRyYW5zbGF0ZUdyaWRNZW51KCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZW5kZXIgKG9yIHJlLXJlbmRlcikgdGhlIGNvbHVtbiBoZWFkZXJzIGZyb20gY29sdW1uIGRlZmluaXRpb25zLlxyXG4gICAqIGNhbGxpbmcgc2V0Q29sdW1ucygpIHdpbGwgdHJpZ2dlciBhIGdyaWQgcmUtcmVuZGVyXHJcbiAgICovXHJcbiAgcmVuZGVyQ29sdW1uSGVhZGVycyhuZXdDb2x1bW5EZWZpbml0aW9ucz86IENvbHVtbltdLCBmb3JjZUNvbHVtbkRlZmluaXRpb25zT3ZlcndyaXRlID0gZmFsc2UpIHtcclxuICAgIGxldCBjb2xsZWN0aW9uID0gbmV3Q29sdW1uRGVmaW5pdGlvbnM7XHJcbiAgICBpZiAoIWNvbGxlY3Rpb24pIHtcclxuICAgICAgY29sbGVjdGlvbiA9IHRoaXMuc2hhcmVkU2VydmljZS5jb2x1bW5EZWZpbml0aW9ucztcclxuICAgIH1cclxuICAgIGlmIChBcnJheS5pc0FycmF5KGNvbGxlY3Rpb24pICYmIHRoaXMuc2hhcmVkU2VydmljZS5ncmlkICYmIHRoaXMuc2hhcmVkU2VydmljZS5ncmlkLnNldENvbHVtbnMpIHtcclxuICAgICAgaWYgKGNvbGxlY3Rpb24ubGVuZ3RoID4gdGhpcy5zaGFyZWRTZXJ2aWNlLmFsbENvbHVtbnMubGVuZ3RoIHx8IGZvcmNlQ29sdW1uRGVmaW5pdGlvbnNPdmVyd3JpdGUpIHtcclxuICAgICAgICB0aGlzLnNoYXJlZFNlcnZpY2UuYWxsQ29sdW1ucyA9IGNvbGxlY3Rpb247XHJcbiAgICAgIH1cclxuICAgICAgdGhpcy5zaGFyZWRTZXJ2aWNlLmdyaWQuc2V0Q29sdW1ucyhjb2xsZWN0aW9uKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBkaXNwb3NlIG9mIHByZXZpb3VzIENvbHVtbiBQaWNrZXIgaW5zdGFuY2UsIHRoZW4gcmUtcmVnaXN0ZXIgaXQgYW5kIGRvbid0IGZvcmdldCB0byBvdmVyd3JpdGUgcHJldmlvdXMgaW5zdGFuY2UgcmVmXHJcbiAgICBpZiAodGhpcy5zaGFyZWRTZXJ2aWNlLmdyaWRPcHRpb25zLmVuYWJsZUNvbHVtblBpY2tlcikge1xyXG4gICAgICB0aGlzLmNvbHVtblBpY2tlckV4dGVuc2lvbi5kaXNwb3NlKCk7XHJcbiAgICAgIGNvbnN0IGluc3RhbmNlID0gdGhpcy5jb2x1bW5QaWNrZXJFeHRlbnNpb24ucmVnaXN0ZXIoKTtcclxuICAgICAgY29uc3QgZXh0ZW5zaW9uID0gdGhpcy5nZXRFeHRlbnNpb25CeU5hbWUoRXh0ZW5zaW9uTmFtZS5jb2x1bW5QaWNrZXIpO1xyXG4gICAgICBpZiAoZXh0ZW5zaW9uKSB7XHJcbiAgICAgICAgZXh0ZW5zaW9uLmFkZG9uID0gaW5zdGFuY2U7XHJcbiAgICAgICAgZXh0ZW5zaW9uLmluc3RhbmNlID0gaW5zdGFuY2U7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyBkaXNwb3NlIG9mIHByZXZpb3VzIEdyaWQgTWVudSBpbnN0YW5jZSwgdGhlbiByZS1yZWdpc3RlciBpdCBhbmQgZG9uJ3QgZm9yZ2V0IHRvIG92ZXJ3cml0ZSBwcmV2aW91cyBpbnN0YW5jZSByZWZcclxuICAgIGlmICh0aGlzLnNoYXJlZFNlcnZpY2UuZ3JpZE9wdGlvbnMuZW5hYmxlR3JpZE1lbnUpIHtcclxuICAgICAgdGhpcy5ncmlkTWVudUV4dGVuc2lvbi5kaXNwb3NlKCk7XHJcbiAgICAgIGNvbnN0IGluc3RhbmNlID0gdGhpcy5ncmlkTWVudUV4dGVuc2lvbi5yZWdpc3RlcigpO1xyXG4gICAgICBjb25zdCBleHRlbnNpb24gPSB0aGlzLmdldEV4dGVuc2lvbkJ5TmFtZShFeHRlbnNpb25OYW1lLmdyaWRNZW51KTtcclxuICAgICAgaWYgKGV4dGVuc2lvbikge1xyXG4gICAgICAgIGV4dGVuc2lvbi5hZGRvbiA9IGluc3RhbmNlO1xyXG4gICAgICAgIGV4dGVuc2lvbi5pbnN0YW5jZSA9IGluc3RhbmNlO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvL1xyXG4gIC8vIHByaXZhdGUgZnVuY3Rpb25zXHJcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG5cclxuICAvKipcclxuICAgKiBHZXQgYW4gRXh0ZW5zaW9uIHRoYXQgd2FzIGNyZWF0ZWQgYnkgY2FsbGluZyBpdHMgXCJjcmVhdGVcIiBtZXRob2QgKHRoZXJlIGFyZSBvbmx5IDMgZXh0ZW5zaW9ucyB3aGljaCB1c2VzIHRoaXMgbWV0aG9kKVxyXG4gICAqICBAcGFyYW0gbmFtZVxyXG4gICAqL1xyXG4gIHByaXZhdGUgZ2V0Q3JlYXRlZEV4dGVuc2lvbkJ5TmFtZShuYW1lOiBFeHRlbnNpb25OYW1lKTogRXh0ZW5zaW9uTW9kZWwgfCB1bmRlZmluZWQge1xyXG4gICAgaWYgKHRoaXMuX2V4dGVuc2lvbkNyZWF0ZWRMaXN0ICYmIHRoaXMuX2V4dGVuc2lvbkNyZWF0ZWRMaXN0Lmhhc093blByb3BlcnR5KG5hbWUpKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLl9leHRlbnNpb25DcmVhdGVkTGlzdFtuYW1lXTtcclxuICAgIH1cclxuICAgIHJldHVybiB1bmRlZmluZWQ7XHJcbiAgfVxyXG5cclxuICAvKiogVHJhbnNsYXRlIGFuIGFycmF5IG9mIGl0ZW1zIGZyb20gYW4gaW5wdXQga2V5IGFuZCBhc3NpZ24gdHJhbnNsYXRlZCB2YWx1ZSB0byB0aGUgb3V0cHV0IGtleSAqL1xyXG4gIHByaXZhdGUgdHJhbnNsYXRlSXRlbXMoaXRlbXM6IGFueVtdLCBpbnB1dEtleTogc3RyaW5nLCBvdXRwdXRLZXk6IHN0cmluZykge1xyXG4gICAgaWYgKHRoaXMuc2hhcmVkU2VydmljZS5ncmlkT3B0aW9ucyAmJiB0aGlzLnNoYXJlZFNlcnZpY2UuZ3JpZE9wdGlvbnMuZW5hYmxlVHJhbnNsYXRlICYmICghdGhpcy50cmFuc2xhdGUgfHwgIXRoaXMudHJhbnNsYXRlLmluc3RhbnQpKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcignW0FuZ3VsYXItU2xpY2tncmlkXSByZXF1aXJlcyBcIm5neC10cmFuc2xhdGVcIiB0byBiZSBpbnN0YWxsZWQgYW5kIGNvbmZpZ3VyZWQgd2hlbiB0aGUgZ3JpZCBvcHRpb24gXCJlbmFibGVUcmFuc2xhdGVcIiBpcyBlbmFibGVkLicpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChBcnJheS5pc0FycmF5KGl0ZW1zKSkge1xyXG4gICAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgaXRlbXMpIHtcclxuICAgICAgICBpZiAoaXRlbVtpbnB1dEtleV0pIHtcclxuICAgICAgICAgIGl0ZW1bb3V0cHV0S2V5XSA9IHRoaXMudHJhbnNsYXRlICYmIHRoaXMudHJhbnNsYXRlLmN1cnJlbnRMYW5nICYmIHRoaXMudHJhbnNsYXRlLmluc3RhbnQoaXRlbVtpbnB1dEtleV0pO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxufVxyXG4iXX0=