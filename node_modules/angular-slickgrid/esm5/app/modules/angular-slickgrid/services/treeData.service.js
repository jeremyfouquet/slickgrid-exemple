import * as tslib_1 from "tslib";
import { SharedService } from './shared.service';
import { Injectable } from '@angular/core';
import * as ɵngcc0 from '@angular/core';
var TreeDataService = /** @class */ (function () {
    function TreeDataService(sharedService) {
        this.sharedService = sharedService;
        this._eventHandler = new Slick.EventHandler();
    }
    Object.defineProperty(TreeDataService.prototype, "dataset", {
        get: function () {
            return this.dataView && this.dataView.getItems && this.dataView.getItems();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(TreeDataService.prototype, "datasetHierarchical", {
        get: function () {
            return this.sharedService.hierarchicalDataset;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(TreeDataService.prototype, "dataView", {
        get: function () {
            return this._grid && this._grid.getData && this._grid.getData();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(TreeDataService.prototype, "gridOptions", {
        get: function () {
            return this._grid && this._grid.getOptions && this._grid.getOptions() || {};
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(TreeDataService.prototype, "eventHandler", {
        /** Getter of the SlickGrid Event Handler */
        get: function () {
            return this._eventHandler;
        },
        enumerable: true,
        configurable: true
    });
    TreeDataService.prototype.dispose = function () {
        // unsubscribe all SlickGrid events
        if (this._eventHandler && this._eventHandler.unsubscribeAll) {
            this._eventHandler.unsubscribeAll();
        }
    };
    TreeDataService.prototype.init = function (grid) {
        this._grid = grid;
        // subscribe to the SlickGrid event and call the backend execution
        this._eventHandler.subscribe(grid.onClick, this.handleOnCellClick.bind(this));
    };
    TreeDataService.prototype.handleOnCellClick = function (event, args) {
        if (event && args) {
            var targetElm = event.target || {};
            var treeDataOptions = this.gridOptions.treeDataOptions;
            var collapsedPropName = treeDataOptions && treeDataOptions.collapsedPropName || '__collapsed';
            var idPropName = this.gridOptions.datasetIdPropertyName || 'id';
            if (targetElm && targetElm.className) {
                var hasToggleClass = targetElm.className.indexOf('toggle') >= 0 || false;
                if (hasToggleClass) {
                    var item = this.dataView.getItem(args.row);
                    if (item) {
                        item[collapsedPropName] = !item[collapsedPropName] ? true : false;
                        this.dataView.updateItem(item[idPropName], item);
                        this._grid.invalidate();
                    }
                    event.stopImmediatePropagation();
                }
            }
        }
    };
    TreeDataService.prototype.toggleTreeDataCollapse = function (collapsing) {
        if (this.gridOptions) {
            var treeDataOptions = this.gridOptions.treeDataOptions;
            if (this.gridOptions.enableTreeData) {
                var items = this.dataView.getItems() || [];
                var collapsedPropName_1 = treeDataOptions && treeDataOptions.collapsedPropName || '__collapsed';
                items.forEach(function (item) { return item[collapsedPropName_1] = collapsing; });
                this.dataView.setItems(items);
                this._grid.invalidate();
            }
        }
    };
    TreeDataService.ctorParameters = function () { return [
        { type: SharedService }
    ]; };
TreeDataService.ɵfac = function TreeDataService_Factory(t) { return new (t || TreeDataService)(ɵngcc0.ɵɵinject(SharedService)); };
TreeDataService.ɵprov = ɵngcc0.ɵɵdefineInjectable({ token: TreeDataService, factory: function (t) { return TreeDataService.ɵfac(t); } });
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(TreeDataService, [{
        type: Injectable
    }], function () { return [{ type: SharedService }]; }, null); })();
    return TreeDataService;
}());
export { TreeDataService };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHJlZURhdGEuc2VydmljZS5qcyIsInNvdXJjZXMiOlsibmc6L2FuZ3VsYXItc2xpY2tncmlkL2FwcC9tb2R1bGVzL2FuZ3VsYXItc2xpY2tncmlkL3NlcnZpY2VzL3RyZWVEYXRhLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUNBLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUNqRCxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDOztBQU0zQztBQUNvQixJQUdsQix5QkFBb0IsYUFBNEI7QUFDbEQsUUFEc0Isa0JBQWEsR0FBYixhQUFhLENBQWU7QUFBQyxRQUMvQyxJQUFJLENBQUMsYUFBYSxHQUFHLElBQUksS0FBSyxDQUFDLFlBQVksRUFBRSxDQUFDO0FBQ2xELElBQUUsQ0FBQztBQUNILElBQ0Usc0JBQUksb0NBQU87QUFBSSxhQUFmO0FBQWMsWUFDWixPQUFPLElBQUksQ0FBQyxRQUFRLElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxRQUFRLElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxRQUFRLEVBQUUsQ0FBQztBQUMvRSxRQUFFLENBQUM7QUFFSDtBQUEwQjtBQUNqQixPQUhOO0FBQ0gsSUFDRSxzQkFBSSxnREFBbUI7QUFBSSxhQUEzQjtBQUFjLFlBQ1osT0FBTyxJQUFJLENBQUMsYUFBYSxDQUFDLG1CQUFtQixDQUFDO0FBQ2xELFFBQUUsQ0FBQztBQUVIO0FBQ0U7QUFBMkIsT0FIMUI7QUFDSCxJQUNFLHNCQUFJLHFDQUFRO0FBQUksYUFBaEI7QUFBYyxZQUNaLE9BQU8sSUFBSSxDQUFDLEtBQUssSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sRUFBRSxDQUFDO0FBQ3BFLFFBQUUsQ0FBQztBQUVIO0FBQTBCO0FBQ1AsT0FIaEI7QUFDSCxJQUNFLHNCQUFJLHdDQUFXO0FBQUksYUFBbkI7QUFBYyxZQUNaLE9BQU8sSUFBSSxD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QSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFHQSxBQUFBLEFBQUEsQUFEQSxBQUFBLEFBQ0EsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUVBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQ0EsQUFDQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQ0EsQUFDQSxBQUFBLEFBekVBLEFBQUEsQUFKQSxBQUFBLEFBREEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQThFQSxBQUFBLEFBQUEsQUFBQSxBQTlFQSxBQThFQSxBQTlFQSxBQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgR3JpZE9wdGlvbiwgU2xpY2tFdmVudEhhbmRsZXIgfSBmcm9tICcuLi9tb2RlbHMvaW5kZXgnO1xyXG5pbXBvcnQgeyBTaGFyZWRTZXJ2aWNlIH0gZnJvbSAnLi9zaGFyZWQuc2VydmljZSc7XHJcbmltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuXHJcbi8vIHVzaW5nIGV4dGVybmFsIG5vbi10eXBlZCBqcyBsaWJyYXJpZXNcclxuZGVjbGFyZSBjb25zdCBTbGljazogYW55O1xyXG5cclxuQEluamVjdGFibGUoKVxyXG5leHBvcnQgY2xhc3MgVHJlZURhdGFTZXJ2aWNlIHtcclxuICBwcml2YXRlIF9ncmlkOiBhbnk7XHJcbiAgcHJpdmF0ZSBfZXZlbnRIYW5kbGVyOiBTbGlja0V2ZW50SGFuZGxlcjtcclxuXHJcbiAgY29uc3RydWN0b3IocHJpdmF0ZSBzaGFyZWRTZXJ2aWNlOiBTaGFyZWRTZXJ2aWNlKSB7XHJcbiAgICB0aGlzLl9ldmVudEhhbmRsZXIgPSBuZXcgU2xpY2suRXZlbnRIYW5kbGVyKCk7XHJcbiAgfVxyXG5cclxuICBnZXQgZGF0YXNldCgpOiBhbnlbXSB7XHJcbiAgICByZXR1cm4gdGhpcy5kYXRhVmlldyAmJiB0aGlzLmRhdGFWaWV3LmdldEl0ZW1zICYmIHRoaXMuZGF0YVZpZXcuZ2V0SXRlbXMoKTtcclxuICB9XHJcblxyXG4gIGdldCBkYXRhc2V0SGllcmFyY2hpY2FsKCk6IGFueVtdIHwgbnVsbCB7XHJcbiAgICByZXR1cm4gdGhpcy5zaGFyZWRTZXJ2aWNlLmhpZXJhcmNoaWNhbERhdGFzZXQ7XHJcbiAgfVxyXG5cclxuICBnZXQgZGF0YVZpZXcoKTogYW55IHtcclxuICAgIHJldHVybiB0aGlzLl9ncmlkICYmIHRoaXMuX2dyaWQuZ2V0RGF0YSAmJiB0aGlzLl9ncmlkLmdldERhdGEoKTtcclxuICB9XHJcblxyXG4gIGdldCBncmlkT3B0aW9ucygpOiBHcmlkT3B0aW9uIHtcclxuICAgIHJldHVybiB0aGlzLl9ncmlkICYmIHRoaXMuX2dyaWQuZ2V0T3B0aW9ucyAmJiB0aGlzLl9ncmlkLmdldE9wdGlvbnMoKSB8fCB7fTtcclxuICB9XHJcblxyXG4gIC8qKiBHZXR0ZXIgb2YgdGhlIFNsaWNrR3JpZCBFdmVudCBIYW5kbGVyICovXHJcbiAgZ2V0IGV2ZW50SGFuZGxlcigpOiBTbGlja0V2ZW50SGFuZGxlciB7XHJcbiAgICByZXR1cm4gdGhpcy5fZXZlbnRIYW5kbGVyO1xyXG4gIH1cclxuXHJcbiAgZGlzcG9zZSgpIHtcclxuICAgIC8vIHVuc3Vic2NyaWJlIGFsbCBTbGlja0dyaWQgZXZlbnRzXHJcbiAgICBpZiAodGhpcy5fZXZlbnRIYW5kbGVyICYmIHRoaXMuX2V2ZW50SGFuZGxlci51bnN1YnNjcmliZUFsbCkge1xyXG4gICAgICB0aGlzLl9ldmVudEhhbmRsZXIudW5zdWJzY3JpYmVBbGwoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGluaXQoZ3JpZDogYW55KSB7XHJcbiAgICB0aGlzLl9ncmlkID0gZ3JpZDtcclxuXHJcbiAgICAvLyBzdWJzY3JpYmUgdG8gdGhlIFNsaWNrR3JpZCBldmVudCBhbmQgY2FsbCB0aGUgYmFja2VuZCBleGVjdXRpb25cclxuICAgIHRoaXMuX2V2ZW50SGFuZGxlci5zdWJzY3JpYmUoZ3JpZC5vbkNsaWNrLCB0aGlzLmhhbmRsZU9uQ2VsbENsaWNrLmJpbmQodGhpcykpO1xyXG4gIH1cclxuXHJcbiAgaGFuZGxlT25DZWxsQ2xpY2soZXZlbnQ6IGFueSwgYXJnczogYW55KSB7XHJcbiAgICBpZiAoZXZlbnQgJiYgYXJncykge1xyXG4gICAgICBjb25zdCB0YXJnZXRFbG0gPSBldmVudC50YXJnZXQgfHwge307XHJcbiAgICAgIGNvbnN0IHRyZWVEYXRhT3B0aW9ucyA9IHRoaXMuZ3JpZE9wdGlvbnMudHJlZURhdGFPcHRpb25zO1xyXG4gICAgICBjb25zdCBjb2xsYXBzZWRQcm9wTmFtZSA9IHRyZWVEYXRhT3B0aW9ucyAmJiB0cmVlRGF0YU9wdGlvbnMuY29sbGFwc2VkUHJvcE5hbWUgfHwgJ19fY29sbGFwc2VkJztcclxuICAgICAgY29uc3QgaWRQcm9wTmFtZSA9IHRoaXMuZ3JpZE9wdGlvbnMuZGF0YXNldElkUHJvcGVydHlOYW1lIHx8ICdpZCc7XHJcblxyXG4gICAgICBpZiAodGFyZ2V0RWxtICYmIHRhcmdldEVsbS5jbGFzc05hbWUpIHtcclxuICAgICAgICBjb25zdCBoYXNUb2dnbGVDbGFzcyA9IHRhcmdldEVsbS5jbGFzc05hbWUuaW5kZXhPZigndG9nZ2xlJykgPj0gMCB8fCBmYWxzZTtcclxuICAgICAgICBpZiAoaGFzVG9nZ2xlQ2xhc3MpIHtcclxuICAgICAgICAgIGNvbnN0IGl0ZW0gPSB0aGlzLmRhdGFWaWV3LmdldEl0ZW0oYXJncy5yb3cpO1xyXG4gICAgICAgICAgaWYgKGl0ZW0pIHtcclxuICAgICAgICAgICAgaXRlbVtjb2xsYXBzZWRQcm9wTmFtZV0gPSAhaXRlbVtjb2xsYXBzZWRQcm9wTmFtZV0gPyB0cnVlIDogZmFsc2U7XHJcbiAgICAgICAgICAgIHRoaXMuZGF0YVZpZXcudXBkYXRlSXRlbShpdGVtW2lkUHJvcE5hbWVdLCBpdGVtKTtcclxuICAgICAgICAgICAgdGhpcy5fZ3JpZC5pbnZhbGlkYXRlKCk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBldmVudC5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIHRvZ2dsZVRyZWVEYXRhQ29sbGFwc2UoY29sbGFwc2luZzogYm9vbGVhbikge1xyXG4gICAgaWYgKHRoaXMuZ3JpZE9wdGlvbnMpIHtcclxuICAgICAgY29uc3QgdHJlZURhdGFPcHRpb25zID0gdGhpcy5ncmlkT3B0aW9ucy50cmVlRGF0YU9wdGlvbnM7XHJcblxyXG4gICAgICBpZiAodGhpcy5ncmlkT3B0aW9ucy5lbmFibGVUcmVlRGF0YSkge1xyXG4gICAgICAgIGNvbnN0IGl0ZW1zOiBhbnlbXSA9IHRoaXMuZGF0YVZpZXcuZ2V0SXRlbXMoKSB8fCBbXTtcclxuICAgICAgICBjb25zdCBjb2xsYXBzZWRQcm9wTmFtZSA9IHRyZWVEYXRhT3B0aW9ucyAmJiB0cmVlRGF0YU9wdGlvbnMuY29sbGFwc2VkUHJvcE5hbWUgfHwgJ19fY29sbGFwc2VkJztcclxuICAgICAgICBpdGVtcy5mb3JFYWNoKChpdGVtOiBhbnkpID0+IGl0ZW1bY29sbGFwc2VkUHJvcE5hbWVdID0gY29sbGFwc2luZyk7XHJcbiAgICAgICAgdGhpcy5kYXRhVmlldy5zZXRJdGVtcyhpdGVtcyk7XHJcbiAgICAgICAgdGhpcy5fZ3JpZC5pbnZhbGlkYXRlKCk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcbn1cclxuIl19