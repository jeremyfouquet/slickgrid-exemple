import * as tslib_1 from "tslib";
import { Optional } from '@angular/core';
import * as DOMPurify from 'dompurify';
let SlickEmptyWarningComponent = class SlickEmptyWarningComponent {
    constructor(translate) {
        this.translate = translate;
    }
    /** Getter for the Grid Options pulled through the Grid Object */
    get gridOptions() {
        return (this._grid && this._grid.getOptions) ? this._grid.getOptions() : {};
    }
    set grid(slickGrid) {
        this._grid = slickGrid;
    }
    dispose() {
        if (this._warningLeftElement && this._warningLeftElement.remove) {
            this._warningLeftElement.remove();
        }
        if (this._warningRightElement && this._warningRightElement.remove) {
            this._warningRightElement.remove();
        }
        this._warningLeftElement = null;
        this._warningRightElement = null;
    }
    /**
     * Display a warning of empty data when the filtered dataset is empty
     * NOTE: to make this code reusable, you could (should) move this code into a utility service
     * @param isShowing - are we showing the message?
     * @param options - any styling options you'd like to pass like the text color
     */
    showEmptyDataMessage(isShowing = true, options) {
        if (!this._grid || !this.gridOptions) {
            return false;
        }
        const gridUid = this._grid && this._grid.getUID();
        const defaultMessage = 'No data to display.';
        const mergedOptions = Object.assign({ message: defaultMessage }, this.gridOptions.emptyDataWarning, options);
        const emptyDataClassName = mergedOptions && mergedOptions.className || 'slick-empty-data-warning';
        this._warningLeftElement = document.querySelector(`.${gridUid} .${emptyDataClassName}`);
        const gridCanvasLeftElm = document.querySelector(`.${gridUid} .grid-canvas.grid-canvas-left`);
        const gridCanvasRightElm = document.querySelector(`.${gridUid} .grid-canvas.grid-canvas-right`);
        const leftElementMarginLeft = mergedOptions.leftViewportMarginLeft || 0;
        const rightElementMarginLeft = mergedOptions.rightViewportMarginLeft || 0;
        const leftElementFrozenMarginLeft = mergedOptions.frozenLeftViewportMarginLeft || 0;
        const rightElementFrozenMarginLeft = mergedOptions.frozenRightViewportMarginLeft || 0;
        const isFrozenGrid = (this.gridOptions.frozenColumn !== undefined && this.gridOptions.frozenColumn >= 0);
        const leftViewportMarginLeft = typeof leftElementMarginLeft === 'string' ? leftElementMarginLeft : `${leftElementMarginLeft}px`;
        const rightViewportMarginLeft = typeof rightElementMarginLeft === 'string' ? rightElementMarginLeft : `${rightElementMarginLeft}px`;
        if (!this._warningLeftElement && !isShowing) {
            return false;
        }
        // warning message could come from a translation key or by the warning options
        let warningMessage = mergedOptions.message;
        if (this.gridOptions.enableTranslate && this.translate && this.translate.instant && mergedOptions && mergedOptions.messageKey) {
            warningMessage = this.translate.instant(mergedOptions.messageKey);
        }
        if (!this._warningLeftElement && gridCanvasLeftElm && gridCanvasRightElm) {
            const sanitizedOptions = this.gridOptions && this.gridOptions.sanitizeHtmlOptions || {};
            // sanitize any unauthorized html tags like script and others
            // for the remaining allowed tags we'll permit all attributes
            const sanitizedText = (DOMPurify.sanitize(warningMessage, sanitizedOptions) || '').toString();
            this._warningLeftElement = document.createElement('div');
            this._warningLeftElement.classList.add(emptyDataClassName);
            this._warningLeftElement.classList.add('left');
            this._warningLeftElement.innerHTML = sanitizedText;
            // clone the warning element and add the "right" class to it so we can distinguish
            this._warningRightElement = this._warningLeftElement.cloneNode(true);
            this._warningRightElement.classList.add('right');
            // append both warning elements to both left/right canvas
            gridCanvasRightElm.appendChild(this._warningRightElement);
            gridCanvasLeftElm.appendChild(this._warningLeftElement);
        }
        // if we did find the Slick-Empty-Warning element then we'll display/hide at the grid position with some margin offsets (we need to position under the headerRow and filterRow)
        // when using a frozen/pinned grid, we also have extra options to hide left/right message
        if (this._warningLeftElement) {
            // display/hide right/left messages
            let leftDisplay = isShowing ? 'block' : 'none';
            if (isFrozenGrid && isShowing) {
                leftDisplay = (mergedOptions.hideFrozenLeftWarning) ? 'none' : 'block';
            }
            this._warningLeftElement.style.display = leftDisplay;
            // use correct left margin (defaults to 40% on regular grid or 10px on frozen grid)
            const leftFrozenMarginLeft = typeof leftElementFrozenMarginLeft === 'string' ? leftElementFrozenMarginLeft : `${leftElementFrozenMarginLeft}px`;
            this._warningLeftElement.style.marginLeft = isFrozenGrid ? leftFrozenMarginLeft : leftViewportMarginLeft;
        }
        if (this._warningRightElement) {
            // use correct left margin (defaults to 40% on regular grid or 10px on frozen grid)
            let rightDisplay = isShowing ? 'block' : 'none';
            if (isFrozenGrid && isShowing) {
                rightDisplay = (mergedOptions.hideFrozenRightWarning) ? 'none' : 'block';
            }
            this._warningRightElement.style.display = rightDisplay;
            // use correct left margin (defaults to 40% on regular grid or 10px on frozen grid)
            const rightFrozenMarginLeft = typeof rightElementFrozenMarginLeft === 'string' ? rightElementFrozenMarginLeft : `${rightElementFrozenMarginLeft}px`;
            this._warningRightElement.style.marginLeft = isFrozenGrid ? rightFrozenMarginLeft : rightViewportMarginLeft;
        }
        return isShowing;
    }
};
SlickEmptyWarningComponent = tslib_1.__decorate([
    tslib_1.__param(0, Optional())
], SlickEmptyWarningComponent);
export { SlickEmptyWarningComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2xpY2stZW1wdHktd2FybmluZy5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9hbmd1bGFyLXNsaWNrZ3JpZC8iLCJzb3VyY2VzIjpbImFwcC9tb2R1bGVzL2FuZ3VsYXItc2xpY2tncmlkL2NvbXBvbmVudHMvc2xpY2stZW1wdHktd2FybmluZy5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUNBLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFekMsT0FBTyxLQUFLLFNBQVMsTUFBTSxXQUFXLENBQUM7QUFJdkMsSUFBYSwwQkFBMEIsR0FBdkMsTUFBYSwwQkFBMEI7SUFjckMsWUFBZ0MsU0FBNEI7UUFBNUIsY0FBUyxHQUFULFNBQVMsQ0FBbUI7SUFBSSxDQUFDO0lBVGpFLGlFQUFpRTtJQUNqRSxJQUFJLFdBQVc7UUFDYixPQUFPLENBQUMsSUFBSSxDQUFDLEtBQUssSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLFVBQVUsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7SUFDOUUsQ0FBQztJQUVELElBQUksSUFBSSxDQUFDLFNBQWM7UUFDckIsSUFBSSxDQUFDLEtBQUssR0FBRyxTQUFTLENBQUM7SUFDekIsQ0FBQztJQUlELE9BQU87UUFDTCxJQUFJLElBQUksQ0FBQyxtQkFBbUIsSUFBSSxJQUFJLENBQUMsbUJBQW1CLENBQUMsTUFBTSxFQUFFO1lBQy9ELElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxNQUFNLEVBQUUsQ0FBQztTQUNuQztRQUNELElBQUksSUFBSSxDQUFDLG9CQUFvQixJQUFJLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxNQUFNLEVBQUU7WUFDakUsSUFBSSxDQUFDLG9CQUFvQixDQUFDLE1BQU0sRUFBRSxDQUFDO1NBQ3BDO1FBQ0QsSUFBSSxDQUFDLG1CQUFtQixHQUFHLElBQUksQ0FBQztRQUNoQyxJ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RyxPQUFPLDJCQUEyQixLQUFLLFFBQVEsQ0FBQyxDQUFDLENBQUMsMkJBQTJCLENBQUMsQ0FBQyxDQUFDLEdBQUcsMkJBQTJCLElBQUksQ0FBQztZQUNoSixJQUFJLENBQUMsbUJBQW1CLENBQUMsS0FBSyxDQUFDLFVBQVUsR0FBRyxZQUFZLENBQUMsQ0FBQyxDQUFDLG9CQUFvQixDQUFDLENBQUMsQ0FBQyxzQkFBc0IsQ0FBQztTQUMxRztRQUVELElBQUksSUFBSSxDQUFDLG9CQUFvQixFQUFFO1lBQzdCLG1GQUFtRjtZQUNuRixJQUFJLFlBQVksR0FBRyxTQUFTLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDO1lBQ2hELElBQUksWUFBWSxJQUFJLFNBQVMsRUFBRTtnQkFDN0IsWUFBWSxHQUFHLENBQUMsYUFBYSxDQUFDLHNCQUFzQixDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDO2FBQzFFO1lBQ0QsSUFBSSxDQUFDLG9CQUFvQixDQUFDLEtBQUssQ0FBQyxPQUFPLEdBQUcsWUFBWSxDQUFDO1lBRXZELG1GQUFtRjtZQUNuRixNQUFNLHFCQUFxQixHQUFHLE9BQU8sNEJBQTRCLEtBQUssUUFBUSxDQUFDLENBQUMsQ0FBQyw0QkFBNEIsQ0FBQyxDQUFDLENBQUMsR0FBRyw0QkFBNEIsSUFBSSxDQUFDO1lBQ3BKLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxLQUFLLENBQUMsVUFBVSxHQUFHLFlBQVksQ0FBQyxDQUFDLENBQUMscUJBQXFCLENBQUMsQ0FBQyxDQUFDLHVCQUF1QixDQUFDO1NBQzdHO1FBRUQsT0FBTyxTQUFTLENBQUM7SUFDbkIsQ0FBQztDQUNGLENBQUE7QUFqSFksMEJBQTBCO0lBY3hCLG1CQUFBLFFBQVEsRUFBRSxDQUFBO0dBZFosMEJBQTBCLENBaUh0QztTQWpIWSwwQkFBMEIiLCJzb3VyY2VzQ29udGVudCI6WyJcclxuaW1wb3J0IHsgT3B0aW9uYWwgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgVHJhbnNsYXRlU2VydmljZSB9IGZyb20gJ0BuZ3gtdHJhbnNsYXRlL2NvcmUnO1xyXG5pbXBvcnQgKiBhcyBET01QdXJpZnkgZnJvbSAnZG9tcHVyaWZ5JztcclxuXHJcbmltcG9ydCB7IEVtcHR5V2FybmluZywgR3JpZE9wdGlvbiB9IGZyb20gJy4uL21vZGVscy9pbmRleCc7XHJcblxyXG5leHBvcnQgY2xhc3MgU2xpY2tFbXB0eVdhcm5pbmdDb21wb25lbnQge1xyXG4gIHByaXZhdGUgX2dyaWQ6IGFueTtcclxuICBwcml2YXRlIF93YXJuaW5nTGVmdEVsZW1lbnQ6IEhUTUxEaXZFbGVtZW50IHwgbnVsbDtcclxuICBwcml2YXRlIF93YXJuaW5nUmlnaHRFbGVtZW50OiBIVE1MRGl2RWxlbWVudCB8IG51bGw7XHJcblxyXG4gIC8qKiBHZXR0ZXIgZm9yIHRoZSBHcmlkIE9wdGlvbnMgcHVsbGVkIHRocm91Z2ggdGhlIEdyaWQgT2JqZWN0ICovXHJcbiAgZ2V0IGdyaWRPcHRpb25zKCk6IEdyaWRPcHRpb24ge1xyXG4gICAgcmV0dXJuICh0aGlzLl9ncmlkICYmIHRoaXMuX2dyaWQuZ2V0T3B0aW9ucykgPyB0aGlzLl9ncmlkLmdldE9wdGlvbnMoKSA6IHt9O1xyXG4gIH1cclxuXHJcbiAgc2V0IGdyaWQoc2xpY2tHcmlkOiBhbnkpIHtcclxuICAgIHRoaXMuX2dyaWQgPSBzbGlja0dyaWQ7XHJcbiAgfVxyXG5cclxuICBjb25zdHJ1Y3RvcihAT3B0aW9uYWwoKSBwcml2YXRlIHRyYW5zbGF0ZT86IFRyYW5zbGF0ZVNlcnZpY2UpIHsgfVxyXG5cclxuICBkaXNwb3NlKCkge1xyXG4gICAgaWYgKHRoaXMuX3dhcm5pbmdMZWZ0RWxlbWVudCAmJiB0aGlzLl93YXJuaW5nTGVmdEVsZW1lbnQucmVtb3ZlKSB7XHJcbiAgICAgIHRoaXMuX3dhcm5pbmdMZWZ0RWxlbWVudC5yZW1vdmUoKTtcclxuICAgIH1cclxuICAgIGlmICh0aGlzLl93YXJuaW5nUmlnaHRFbGVtZW50ICYmIHRoaXMuX3dhcm5pbmdSaWdodEVsZW1lbnQucmVtb3ZlKSB7XHJcbiAgICAgIHRoaXMuX3dhcm5pbmdSaWdodEVsZW1lbnQucmVtb3ZlKCk7XHJcbiAgICB9XHJcbiAgICB0aGlzLl93YXJuaW5nTGVmdEVsZW1lbnQgPSBudWxsO1xyXG4gICAgdGhpcy5fd2FybmluZ1JpZ2h0RWxlbWVudCA9IG51bGw7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBEaXNwbGF5IGEgd2FybmluZyBvZiBlbXB0eSBkYXRhIHdoZW4gdGhlIGZpbHRlcmVkIGRhdGFzZXQgaXMgZW1wdHlcclxuICAgKiBOT1RFOiB0byBtYWtlIHRoaXMgY29kZSByZXVzYWJsZSwgeW91IGNvdWxkIChzaG91bGQpIG1vdmUgdGhpcyBjb2RlIGludG8gYSB1dGlsaXR5IHNlcnZpY2VcclxuICAgKiBAcGFyYW0gaXNTaG93aW5nIC0gYXJlIHdlIHNob3dpbmcgdGhlIG1lc3NhZ2U/XHJcbiAgICogQHBhcmFtIG9wdGlvbnMgLSBhbnkgc3R5bGluZyBvcHRpb25zIHlvdSdkIGxpa2UgdG8gcGFzcyBsaWtlIHRoZSB0ZXh0IGNvbG9yXHJcbiAgICovXHJcbiAgc2hvd0VtcHR5RGF0YU1lc3NhZ2UoaXNTaG93aW5nID0gdHJ1ZSwgb3B0aW9ucz86IEVtcHR5V2FybmluZyk6IGJvb2xlYW4ge1xyXG4gICAgaWYgKCF0aGlzLl9ncmlkIHx8ICF0aGlzLmdyaWRPcHRpb25zKSB7XHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuICAgIGNvbnN0IGdyaWRVaWQgPSB0aGlzLl9ncmlkICYmIHRoaXMuX2dyaWQuZ2V0VUlEKCk7XHJcbiAgICBjb25zdCBkZWZhdWx0TWVzc2FnZSA9ICdObyBkYXRhIHRvIGRpc3BsYXkuJztcclxuICAgIGNvbnN0IG1lcmdlZE9wdGlvbnM6IEVtcHR5V2FybmluZyA9IHsgbWVzc2FnZTogZGVmYXVsdE1lc3NhZ2UsIC4uLnRoaXMuZ3JpZE9wdGlvbnMuZW1wdHlEYXRhV2FybmluZywgLi4ub3B0aW9ucyB9O1xyXG4gICAgY29uc3QgZW1wdHlEYXRhQ2xhc3NOYW1lID0gbWVyZ2VkT3B0aW9ucyAmJiBtZXJnZWRPcHRpb25zLmNsYXNzTmFtZSB8fCAnc2xpY2stZW1wdHktZGF0YS13YXJuaW5nJztcclxuICAgIHRoaXMuX3dhcm5pbmdMZWZ0RWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3I8SFRNTERpdkVsZW1lbnQ+KGAuJHtncmlkVWlkfSAuJHtlbXB0eURhdGFDbGFzc05hbWV9YCk7XHJcbiAgICBjb25zdCBncmlkQ2FudmFzTGVmdEVsbSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3I8SFRNTERpdkVsZW1lbnQ+KGAuJHtncmlkVWlkfSAuZ3JpZC1jYW52YXMuZ3JpZC1jYW52YXMtbGVmdGApO1xyXG4gICAgY29uc3QgZ3JpZENhbnZhc1JpZ2h0RWxtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcjxIVE1MRGl2RWxlbWVudD4oYC4ke2dyaWRVaWR9IC5ncmlkLWNhbnZhcy5ncmlkLWNhbnZhcy1yaWdodGApO1xyXG4gICAgY29uc3QgbGVmdEVsZW1lbnRNYXJnaW5MZWZ0ID0gbWVyZ2VkT3B0aW9ucy5sZWZ0Vmlld3BvcnRNYXJnaW5MZWZ0IHx8IDA7XHJcbiAgICBjb25zdCByaWdodEVsZW1lbnRNYXJnaW5MZWZ0ID0gbWVyZ2VkT3B0aW9ucy5yaWdodFZpZXdwb3J0TWFyZ2luTGVmdCB8fCAwO1xyXG4gICAgY29uc3QgbGVmdEVsZW1lbnRGcm96ZW5NYXJnaW5MZWZ0ID0gbWVyZ2VkT3B0aW9ucy5mcm96ZW5MZWZ0Vmlld3BvcnRNYXJnaW5MZWZ0IHx8IDA7XHJcbiAgICBjb25zdCByaWdodEVsZW1lbnRGcm96ZW5NYXJnaW5MZWZ0ID0gbWVyZ2VkT3B0aW9ucy5mcm96ZW5SaWdodFZpZXdwb3J0TWFyZ2luTGVmdCB8fCAwO1xyXG4gICAgY29uc3QgaXNGcm96ZW5HcmlkID0gKHRoaXMuZ3JpZE9wdGlvbnMuZnJvemVuQ29sdW1uICE9PSB1bmRlZmluZWQgJiYgdGhpcy5ncmlkT3B0aW9ucy5mcm96ZW5Db2x1bW4gPj0gMCk7XHJcbiAgICBjb25zdCBsZWZ0Vmlld3BvcnRNYXJnaW5MZWZ0ID0gdHlwZW9mIGxlZnRFbGVtZW50TWFyZ2luTGVmdCA9PT0gJ3N0cmluZycgPyBsZWZ0RWxlbWVudE1hcmdpbkxlZnQgOiBgJHtsZWZ0RWxlbWVudE1hcmdpbkxlZnR9cHhgO1xyXG4gICAgY29uc3QgcmlnaHRWaWV3cG9ydE1hcmdpbkxlZnQgPSB0eXBlb2YgcmlnaHRFbGVtZW50TWFyZ2luTGVmdCA9PT0gJ3N0cmluZycgPyByaWdodEVsZW1lbnRNYXJnaW5MZWZ0IDogYCR7cmlnaHRFbGVtZW50TWFyZ2luTGVmdH1weGA7XHJcblxyXG4gICAgaWYgKCF0aGlzLl93YXJuaW5nTGVmdEVsZW1lbnQgJiYgIWlzU2hvd2luZykge1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gd2FybmluZyBtZXNzYWdlIGNvdWxkIGNvbWUgZnJvbSBhIHRyYW5zbGF0aW9uIGtleSBvciBieSB0aGUgd2FybmluZyBvcHRpb25zXHJcbiAgICBsZXQgd2FybmluZ01lc3NhZ2UgPSBtZXJnZWRPcHRpb25zLm1lc3NhZ2U7XHJcbiAgICBpZiAodGhpcy5ncmlkT3B0aW9ucy5lbmFibGVUcmFuc2xhdGUgJiYgdGhpcy50cmFuc2xhdGUgJiYgdGhpcy50cmFuc2xhdGUuaW5zdGFudCAmJiBtZXJnZWRPcHRpb25zICYmIG1lcmdlZE9wdGlvbnMubWVzc2FnZUtleSkge1xyXG4gICAgICB3YXJuaW5nTWVzc2FnZSA9IHRoaXMudHJhbnNsYXRlLmluc3RhbnQobWVyZ2VkT3B0aW9ucy5tZXNzYWdlS2V5KTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoIXRoaXMuX3dhcm5pbmdMZWZ0RWxlbWVudCAmJiBncmlkQ2FudmFzTGVmdEVsbSAmJiBncmlkQ2FudmFzUmlnaHRFbG0pIHtcclxuICAgICAgY29uc3Qgc2FuaXRpemVkT3B0aW9ucyA9IHRoaXMuZ3JpZE9wdGlvbnMgJiYgdGhpcy5ncmlkT3B0aW9ucy5zYW5pdGl6ZUh0bWxPcHRpb25zIHx8IHt9O1xyXG5cclxuICAgICAgLy8gc2FuaXRpemUgYW55IHVuYXV0aG9yaXplZCBodG1sIHRhZ3MgbGlrZSBzY3JpcHQgYW5kIG90aGVyc1xyXG4gICAgICAvLyBmb3IgdGhlIHJlbWFpbmluZyBhbGxvd2VkIHRhZ3Mgd2UnbGwgcGVybWl0IGFsbCBhdHRyaWJ1dGVzXHJcbiAgICAgIGNvbnN0IHNhbml0aXplZFRleHQgPSAoRE9NUHVyaWZ5LnNhbml0aXplKHdhcm5pbmdNZXNzYWdlLCBzYW5pdGl6ZWRPcHRpb25zKSB8fCAnJykudG9TdHJpbmcoKTtcclxuXHJcbiAgICAgIHRoaXMuX3dhcm5pbmdMZWZ0RWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICB0aGlzLl93YXJuaW5nTGVmdEVsZW1lbnQuY2xhc3NMaXN0LmFkZChlbXB0eURhdGFDbGFzc05hbWUpO1xyXG4gICAgICB0aGlzLl93YXJuaW5nTGVmdEVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnbGVmdCcpO1xyXG4gICAgICB0aGlzLl93YXJuaW5nTGVmdEVsZW1lbnQuaW5uZXJIVE1MID0gc2FuaXRpemVkVGV4dDtcclxuXHJcbiAgICAgIC8vIGNsb25lIHRoZSB3YXJuaW5nIGVsZW1lbnQgYW5kIGFkZCB0aGUgXCJyaWdodFwiIGNsYXNzIHRvIGl0IHNvIHdlIGNhbiBkaXN0aW5ndWlzaFxyXG4gICAgICB0aGlzLl93YXJuaW5nUmlnaHRFbGVtZW50ID0gdGhpcy5fd2FybmluZ0xlZnRFbGVtZW50LmNsb25lTm9kZSh0cnVlKSBhcyBIVE1MRGl2RWxlbWVudDtcclxuICAgICAgdGhpcy5fd2FybmluZ1JpZ2h0RWxlbWVudC5jbGFzc0xpc3QuYWRkKCdyaWdodCcpO1xyXG5cclxuICAgICAgLy8gYXBwZW5kIGJvdGggd2FybmluZyBlbGVtZW50cyB0byBib3RoIGxlZnQvcmlnaHQgY2FudmFzXHJcbiAgICAgIGdyaWRDYW52YXNSaWdodEVsbS5hcHBlbmRDaGlsZCh0aGlzLl93YXJuaW5nUmlnaHRFbGVtZW50KTtcclxuICAgICAgZ3JpZENhbnZhc0xlZnRFbG0uYXBwZW5kQ2hpbGQodGhpcy5fd2FybmluZ0xlZnRFbGVtZW50KTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBpZiB3ZSBkaWQgZmluZCB0aGUgU2xpY2stRW1wdHktV2FybmluZyBlbGVtZW50IHRoZW4gd2UnbGwgZGlzcGxheS9oaWRlIGF0IHRoZSBncmlkIHBvc2l0aW9uIHdpdGggc29tZSBtYXJnaW4gb2Zmc2V0cyAod2UgbmVlZCB0byBwb3NpdGlvbiB1bmRlciB0aGUgaGVhZGVyUm93IGFuZCBmaWx0ZXJSb3cpXHJcbiAgICAvLyB3aGVuIHVzaW5nIGEgZnJvemVuL3Bpbm5lZCBncmlkLCB3ZSBhbHNvIGhhdmUgZXh0cmEgb3B0aW9ucyB0byBoaWRlIGxlZnQvcmlnaHQgbWVzc2FnZVxyXG4gICAgaWYgKHRoaXMuX3dhcm5pbmdMZWZ0RWxlbWVudCkge1xyXG4gICAgICAvLyBkaXNwbGF5L2hpZGUgcmlnaHQvbGVmdCBtZXNzYWdlc1xyXG4gICAgICBsZXQgbGVmdERpc3BsYXkgPSBpc1Nob3dpbmcgPyAnYmxvY2snIDogJ25vbmUnO1xyXG4gICAgICBpZiAoaXNGcm96ZW5HcmlkICYmIGlzU2hvd2luZykge1xyXG4gICAgICAgIGxlZnREaXNwbGF5ID0gKG1lcmdlZE9wdGlvbnMuaGlkZUZyb3plbkxlZnRXYXJuaW5nKSA/ICdub25lJyA6ICdibG9jayc7XHJcbiAgICAgIH1cclxuICAgICAgdGhpcy5fd2FybmluZ0xlZnRFbGVtZW50LnN0eWxlLmRpc3BsYXkgPSBsZWZ0RGlzcGxheTtcclxuXHJcbiAgICAgIC8vIHVzZSBjb3JyZWN0IGxlZnQgbWFyZ2luIChkZWZhdWx0cyB0byA0MCUgb24gcmVndWxhciBncmlkIG9yIDEwcHggb24gZnJvemVuIGdyaWQpXHJcbiAgICAgIGNvbnN0IGxlZnRGcm96ZW5NYXJnaW5MZWZ0ID0gdHlwZW9mIGxlZnRFbGVtZW50RnJvemVuTWFyZ2luTGVmdCA9PT0gJ3N0cmluZycgPyBsZWZ0RWxlbWVudEZyb3plbk1hcmdpbkxlZnQgOiBgJHtsZWZ0RWxlbWVudEZyb3plbk1hcmdpbkxlZnR9cHhgO1xyXG4gICAgICB0aGlzLl93YXJuaW5nTGVmdEVsZW1lbnQuc3R5bGUubWFyZ2luTGVmdCA9IGlzRnJvemVuR3JpZCA/IGxlZnRGcm96ZW5NYXJnaW5MZWZ0IDogbGVmdFZpZXdwb3J0TWFyZ2luTGVmdDtcclxuICAgIH1cclxuXHJcbiAgICBpZiAodGhpcy5fd2FybmluZ1JpZ2h0RWxlbWVudCkge1xyXG4gICAgICAvLyB1c2UgY29ycmVjdCBsZWZ0IG1hcmdpbiAoZGVmYXVsdHMgdG8gNDAlIG9uIHJlZ3VsYXIgZ3JpZCBvciAxMHB4IG9uIGZyb3plbiBncmlkKVxyXG4gICAgICBsZXQgcmlnaHREaXNwbGF5ID0gaXNTaG93aW5nID8gJ2Jsb2NrJyA6ICdub25lJztcclxuICAgICAgaWYgKGlzRnJvemVuR3JpZCAmJiBpc1Nob3dpbmcpIHtcclxuICAgICAgICByaWdodERpc3BsYXkgPSAobWVyZ2VkT3B0aW9ucy5oaWRlRnJvemVuUmlnaHRXYXJuaW5nKSA/ICdub25lJyA6ICdibG9jayc7XHJcbiAgICAgIH1cclxuICAgICAgdGhpcy5fd2FybmluZ1JpZ2h0RWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gcmlnaHREaXNwbGF5O1xyXG5cclxuICAgICAgLy8gdXNlIGNvcnJlY3QgbGVmdCBtYXJnaW4gKGRlZmF1bHRzIHRvIDQwJSBvbiByZWd1bGFyIGdyaWQgb3IgMTBweCBvbiBmcm96ZW4gZ3JpZClcclxuICAgICAgY29uc3QgcmlnaHRGcm96ZW5NYXJnaW5MZWZ0ID0gdHlwZW9mIHJpZ2h0RWxlbWVudEZyb3plbk1hcmdpbkxlZnQgPT09ICdzdHJpbmcnID8gcmlnaHRFbGVtZW50RnJvemVuTWFyZ2luTGVmdCA6IGAke3JpZ2h0RWxlbWVudEZyb3plbk1hcmdpbkxlZnR9cHhgO1xyXG4gICAgICB0aGlzLl93YXJuaW5nUmlnaHRFbGVtZW50LnN0eWxlLm1hcmdpbkxlZnQgPSBpc0Zyb3plbkdyaWQgPyByaWdodEZyb3plbk1hcmdpbkxlZnQgOiByaWdodFZpZXdwb3J0TWFyZ2luTGVmdDtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gaXNTaG93aW5nO1xyXG4gIH1cclxufVxyXG4iXX0=