import * as tslib_1 from "tslib";
import { Injectable } from '@angular/core';
import { parseUtcDate, mapOperatorByFieldType, titleCase } from './utilities';
import { CaseType, FieldType, SortDirection, OperatorType } from './../models/index';
import { OdataQueryBuilderService } from './odataQueryBuilder.service';
const DEFAULT_ITEMS_PER_PAGE = 25;
const DEFAULT_PAGE_SIZE = 20;
let GridOdataService = class GridOdataService {
    constructor() {
        this._currentFilters = [];
        this._currentSorters = [];
        this.defaultOptions = {
            top: DEFAULT_ITEMS_PER_PAGE,
            orderBy: '',
            caseType: CaseType.pascalCase
        };
        this._odataService = new OdataQueryBuilderService();
    }
    /** Getter for the Column Definitions */
    get columnDefinitions() {
        return this._columnDefinitions;
    }
    /** Getter for the Odata Service */
    get odataService() {
        return this._odataService;
    }
    /** Getter for the Grid Options pulled through the Grid Object */
    get _gridOptions() {
        return (this._grid && this._grid.getOptions) ? this._grid.getOptions() : {};
    }
    init(serviceOptions, pagination, grid) {
        this._grid = grid;
        const mergedOptions = Object.assign({}, this.defaultOptions, serviceOptions);
        // unless user specifically set "enablePagination" to False, we'll add "top" property for the pagination in every other cases
        if (this._gridOptions && !this._gridOptions.enablePagination) {
            // save current pagination as Page 1 and page size as "top"
            this._odataService.options = Object.assign({}, mergedOptions, { top: null });
            this._currentPagination = null;
        }
        else {
            const topOption = (pagination && pagination.pageSize) ? pagination.pageSize : this.defaultOptions.top;
            this._odataService.options = Object.assign({}, mergedOptions, { top: topOption });
            this._currentPagination = {
                pageNumber: 1,
                pageSize: this._odataService.options.top || this.defaultOptions.top || DEFAULT_PAGE_SIZE,
            };
        }
        this.options = this._odataService.options;
        this.pagination = pagination;
        if (grid && grid.getColumns) {
            this._columnDefinitions = serviceOptions && serviceOptions.columnDefinitions || grid.getColumns();
            this._columnDefinitions = this._columnDefinitions.filter((column) => !column.excludeFromQuery);
        }
    }
    buildQuery() {
        return this._odataService.buildQuery();
    }
    clearFilters() {
        this._currentFilters = [];
        this.updateFilters([]);
    }
    clearSorters() {
        this._currentSorters = [];
        this.updateSorters([]);
    }
    updateOptions(serviceOptions) {
        this.options = Object.assign({}, this.options, serviceOptions);
        this._odataService.options = this.options;
    }
    removeColumnFilter(fieldName) {
        this._odataService.removeColumnFilter(fieldName);
    }
    /** Get the Filters that are currently used by the grid */
    getCurrentFilters() {
        return this._currentFilters;
    }
    /** Get the Pagination that is currently used by the grid */
    getCurrentPagination() {
        return this._currentPagination;
    }
    /** Get the Sorters that are currently used by the grid */
    getCurrentSorters() {
        return this._currentSorters;
    }
    /**
     * Mapper for mathematical operators (ex.: <= is "le", > is "gt")
     * @param string operator
     * @returns string map
     */
    mapOdataOperator(operator) {
        let map = '';
        switch (operator) {
            case '<':
                map = 'lt';
                break;
            case '<=':
                map = 'le';
                break;
            case '>':
                map = 'gt';
                break;
            case '>=':
                map = 'ge';
                break;
            case '<>':
            case '!=':
                map = 'ne';
                break;
            case '=':
            case '==':
            default:
                map = 'eq';
                break;
        }
        return map;
    }
    /*
     * Reset the pagination options
     */
    resetPaginationOptions() {
        this._odataService.updateOptions({
            skip: 0
        });
    }
    saveColumnFilter(fieldName, value, terms) {
        this._odataService.saveColumnFilter(fieldName, value, terms);
    }
    /*
     * FILTERING
     */
    processOnFilterChanged(event, args) {
        const gridOptions = this._gridOptions;
        const backendApi = gridOptions.backendServiceApi;
        if (backendApi === undefined) {
            throw new Error('Something went wrong in the GridOdataService, "backendServiceApi" is not initialized');
        }
        // keep current filters & always save it as an array (columnFilters can be an object when it is dealt by SlickGrid Filter)
        this._currentFilters = this.castFilterToColumnFilters(args.columnFilters);
        if (!args || !args.grid) {
            throw new Error('Something went wrong when trying create the GridOdataService, it seems that "args" is not populated correctly');
        }
        // loop through all columns to inspect filters & set the query
        this.updateFilters(args.columnFilters);
        this.resetPaginationOptions();
        return this._odataService.buildQuery();
    }
    /*
     * PAGINATION
     */
    processOnPaginationChanged(event, args) {
        const pageSize = +(args.pageSize || ((this.pagination) ? this.pagination.pageSize : DEFAULT_PAGE_SIZE));
        this.updatePagination(args.newPage, pageSize);
        // build the OData query which we will use in the WebAPI callback
        return this._odataService.buildQuery();
    }
    /*
     * SORTING
     */
    processOnSortChanged(event, args) {
        const sortColumns = (args.multiColumnSort) ? args.sortCols : new Array({ sortCol: args.sortCol, sortAsc: args.sortAsc });
        // loop through all columns to inspect sorters & set the query
        this.updateSorters(sortColumns);
        // build the OData query which we will use in the WebAPI callback
        return this._odataService.buildQuery();
    }
    /**
     * loop through all columns to inspect filters & update backend service filters
     * @param columnFilters
     */
    updateFilters(columnFilters, isUpdatedByPresetOrDynamically) {
        let searchBy = '';
        const searchByArray = [];
        const odataVersion = this._odataService && this._odataService.options && this._odataService.options.version || 2;
        // on filter preset load, we need to keep current filters
        if (isUpdatedByPresetOrDynamically) {
            this._currentFilters = this.castFilterToColumnFilters(columnFilters);
        }
        // loop through all columns to inspect filters
        for (const columnId in columnFilters) {
            if (columnFilters.hasOwnProperty(columnId)) {
                const columnFilter = columnFilters[columnId];
                // if user defined some "presets", then we need to find the filters from the column definitions instead
                let columnDef;
                if (isUpdatedByPresetOrDynamically && Array.isArray(this._columnDefinitions)) {
                    columnDef = this._columnDefinitions.find((column) => {
                        return column.id === columnFilter.columnId;
                    });
                }
                else {
                    columnDef = columnFilter.columnDef;
                }
                if (!columnDef) {
                    throw new Error('[GridOData Service]: Something went wrong in trying to get the column definition of the specified filter (or preset filters). Did you make a typo on the filter columnId?');
                }
                let fieldName = (columnDef.filter && columnDef.filter.queryField) || columnDef.queryFieldFilter || columnDef.queryField || columnDef.field || columnDef.name || '';
                const fieldType = columnDef.type || FieldType.string;
                let searchTerms = (columnFilter ? columnFilter.searchTerms : null) || [];
                let fieldSearchValue = (Array.isArray(searchTerms) && searchTerms.length === 1) ? searchTerms[0] : '';
                if (typeof fieldSearchValue === 'undefined') {
                    fieldSearchValue = '';
                }
                if (!fieldName) {
                    throw new Error(`GridOData filter could not find the field name to query the search, your column definition must include a valid "field" or "name" (optionally you can also use the "queryfield").`);
                }
                fieldSearchValue = '' + fieldSearchValue; // make sure it's a string
                const matches = fieldSearchValue.match(/^([<>!=\*]{0,2})(.*[^<>!=\*])([\*]?)$/); // group 1: Operator, 2: searchValue, 3: last char is '*' (meaning starts with, ex.: abc*)
                let operator = columnFilter.operator || ((matches) ? matches[1] : '');
                let searchValue = (!!matches) ? matches[2] : '';
                const lastValueChar = (!!matches) ? matches[3] : (operator === '*z' || operator === OperatorType.endsWith) ? '*' : '';
                const bypassOdataQuery = columnFilter.bypassBackendQuery || false;
                // no need to query if search value is empty
                if (fieldName && searchValue === '' && searchTerms.length <= 1) {
                    this.removeColumnFilter(fieldName);
                    continue;
                }
                if (Array.isArray(searchTerms) && searchTerms.length === 1 && typeof searchTerms[0] === 'string' && searchTerms[0].indexOf('..') > 0) {
                    searchTerms = searchTerms[0].split('..');
                    if (!operator) {
                        operator = OperatorType.rangeExclusive;
                    }
                }
                // escaping the search value
                searchValue = searchValue.replace(`'`, `''`); // escape single quotes by doubling them
                searchValue = encodeURIComponent(searchValue); // encode URI of the final search value
                // if we didn't find an Operator but we have a Column Operator inside the Filter (DOM Element), we should use its default Operator
                // multipleSelect is "IN", while singleSelect is "EQ", else don't map any operator
                if (!operator && columnDef.filter) {
                    operator = columnDef.filter.operator;
                }
                // if we still don't have an operator find the proper Operator to use by it's field type
                if (!operator) {
                    operator = mapOperatorByFieldType(columnDef.type || FieldType.string);
                }
                // extra query arguments
                if (bypassOdataQuery) {
                    // push to our temp array and also trim white spaces
                    if (fieldName) {
                        this.saveColumnFilter(fieldName, fieldSearchValue, searchTerms);
                    }
                }
                else {
                    searchBy = '';
                    // titleCase the fieldName so that it matches the WebApi names
                    if (this._odataService.options.caseType === CaseType.pascalCase) {
                        fieldName = titleCase(fieldName || '');
                    }
                    if (fieldType === FieldType.date) {
                        searchBy = this.filterBySearchDate(fieldName, operator, searchTerms, odataVersion);
                    }
                    else if (searchTerms && searchTerms.length > 1 && (operator === 'IN' || operator === 'NIN' || operator === 'NOTIN' || operator === 'NOT IN' || operator === 'NOT_IN')) {
                        // when having more than 1 search term (then check if we have a "IN" or "NOT IN" filter search)
                        const tmpSearchTerms = [];
                        if (operator === 'IN') {
                            // example:: (Stage eq "Expired" or Stage eq "Renewal")
                            for (let j = 0, lnj = searchTerms.length; j < lnj; j++) {
                                if (fieldType === FieldType.string || fieldType === FieldType.text || fieldType === FieldType.readonly) {
                                    const searchVal = encodeURIComponent(searchTerms[j].replace(`'`, `''`));
                                    tmpSearchTerms.push(`${fieldName} eq '${searchVal}'`);
                                }
                                else {
                                    // Single quote escape is not needed for non string type
                                    tmpSearchTerms.push(`${fieldName} eq ${searchTerms[j]}`);
                                }
                            }
                            searchBy = tmpSearchTerms.join(' or ');
                            if (!(typeof searchBy === 'string' && searchBy[0] === '(' && searchBy.slice(-1) === ')')) {
                                searchBy = `(${searchBy})`;
                            }
                        }
                        else {
                            // example:: (Stage ne "Expired" and Stage ne "Renewal")
                            for (let k = 0, lnk = searchTerms.length; k < lnk; k++) {
                                const searchVal = encodeURIComponent(searchTerms[k].replace(`'`, `''`));
                                tmpSearchTerms.push(`${fieldName} ne '${searchVal}'`);
                            }
                            searchBy = tmpSearchTerms.join(' and ');
                            if (!(typeof searchBy === 'string' && searchBy[0] === '(' && searchBy.slice(-1) === ')')) {
                                searchBy = `(${searchBy})`;
                            }
                        }
                    }
                    else if (operator === '*' || operator === 'a*' || operator === '*z' || lastValueChar === '*' || operator === OperatorType.startsWith || operator === OperatorType.endsWith) {
                        // first/last character is a '*' will be a startsWith or endsWith
                        searchBy = (operator === '*' || operator === '*z' || operator === OperatorType.endsWith) ? `endswith(${fieldName}, '${searchValue}')` : `startswith(${fieldName}, '${searchValue}')`;
                    }
                    else if (fieldType === FieldType.string || fieldType === FieldType.text || fieldType === FieldType.readonly) {
                        // string field needs to be in single quotes
                        if (operator === '' || operator === OperatorType.contains || operator === OperatorType.notContains) {
                            searchBy = this.odataQueryVersionWrapper('substring', odataVersion, fieldName, searchValue);
                            if (operator === OperatorType.notContains) {
                                searchBy = `not ${searchBy}`;
                            }
                        }
                        else if (operator === OperatorType.rangeExclusive || operator === OperatorType.rangeInclusive) {
                            // example:: (Duration >= 5 and Duration <= 10)
                            searchBy = this.filterBySearchTermRange(fieldName, operator, searchTerms);
                        }
                        else {
                            searchBy = `${fieldName} ${this.mapOdataOperator(operator)} '${searchValue}'`;
                        }
                    }
                    else {
                        if (operator === OperatorType.rangeExclusive || operator === OperatorType.rangeInclusive) {
                            // example:: (Duration >= 5 and Duration <= 10)
                            searchBy = this.filterBySearchTermRange(fieldName, operator, searchTerms);
                        }
                        else {
                            // any other field type (or undefined type)
                            searchValue = (fieldType === FieldType.number || fieldType === FieldType.boolean) ? searchValue : `'${searchValue}'`;
                            searchBy = `${fieldName} ${this.mapOdataOperator(operator)} ${searchValue}`;
                        }
                    }
                    // push to our temp array and also trim white spaces
                    if (searchBy !== '') {
                        searchByArray.push(searchBy.trim());
                        this.saveColumnFilter(fieldName || '', fieldSearchValue, searchValue);
                    }
                }
            }
        }
        // update the service options with filters for the buildQuery() to work later
        this._odataService.updateOptions({
            filter: (searchByArray.length > 0) ? searchByArray.join(' and ') : '',
            skip: undefined
        });
    }
    /**
     * Update the pagination component with it's new page number and size
     * @param newPage
     * @param pageSize
     */
    updatePagination(newPage, pageSize) {
        this._currentPagination = {
            pageNumber: newPage,
            pageSize,
        };
        // unless user specifically set "enablePagination" to False, we'll update pagination options in every other cases
        if (this._gridOptions && (this._gridOptions.enablePagination || !this._gridOptions.hasOwnProperty('enablePagination'))) {
            this._odataService.updateOptions({
                top: pageSize,
                skip: (newPage - 1) * pageSize
            });
        }
    }
    /**
     * loop through all columns to inspect sorters & update backend service orderBy
     * @param columnFilters
     */
    updateSorters(sortColumns, presetSorters) {
        let currentSorters = [];
        const odataSorters = [];
        if (!sortColumns && presetSorters) {
            // make the presets the current sorters, also make sure that all direction are in lowercase for OData
            currentSorters = presetSorters;
            currentSorters.forEach((sorter) => sorter.direction = sorter.direction.toLowerCase());
            // display the correct sorting icons on the UI, for that it requires (columnId, sortAsc) properties
            const tmpSorterArray = currentSorters.map((sorter) => {
                const columnDef = this._columnDefinitions.find((column) => column.id === sorter.columnId);
                odataSorters.push({
                    field: columnDef ? ((columnDef.queryFieldSorter || columnDef.queryField || columnDef.field) + '') : (sorter.columnId + ''),
                    direction: sorter.direction
                });
                // return only the column(s) found in the Column Definitions ELSE null
                if (columnDef) {
                    return {
                        columnId: sorter.columnId,
                        sortAsc: sorter.direction.toUpperCase() === SortDirection.ASC
                    };
                }
                return null;
            });
            // set the sort icons, but also make sure to filter out null values (that happens when columnDef is not found)
            if (Array.isArray(tmpSorterArray)) {
                this._grid.setSortColumns(tmpSorterArray);
            }
        }
        else if (sortColumns && !presetSorters) {
            // build the SortBy string, it could be multisort, example: customerNo asc, purchaserName desc
            if (sortColumns && sortColumns.length === 0) {
                // TODO fix this line
                // currentSorters = new Array(this.defaultOptions.orderBy); // when empty, use the default sort
            }
            else {
                if (sortColumns) {
                    for (const columnDef of sortColumns) {
                        if (columnDef.sortCol) {
                            let fieldName = (columnDef.sortCol.queryFieldSorter || columnDef.sortCol.queryField || columnDef.sortCol.field) + '';
                            let columnFieldName = (columnDef.sortCol.field || columnDef.sortCol.id) + '';
                            let queryField = (columnDef.sortCol.queryFieldSorter || columnDef.sortCol.queryField || columnDef.sortCol.field || '') + '';
                            if (this._odataService.options.caseType === CaseType.pascalCase) {
                                fieldName = titleCase(fieldName);
                                columnFieldName = titleCase(columnFieldName);
                                queryField = titleCase(queryField);
                            }
                            if (columnFieldName !== '') {
                                currentSorters.push({
                                    columnId: columnFieldName,
                                    direction: columnDef.sortAsc ? 'asc' : 'desc'
                                });
                            }
                            if (queryField !== '') {
                                odataSorters.push({
                                    field: queryField,
                                    direction: columnDef.sortAsc ? SortDirection.ASC : SortDirection.DESC
                                });
                            }
                        }
                    }
                }
            }
        }
        // transform the sortby array into a CSV string for OData
        currentSorters = currentSorters || [];
        const csvString = odataSorters.map((sorter) => {
            let str = '';
            if (sorter && sorter.field) {
                const sortField = (this._odataService.options.caseType === CaseType.pascalCase) ? titleCase(sorter.field) : sorter.field;
                str = `${sortField} ${sorter && sorter.direction && sorter.direction.toLowerCase() || ''}`;
            }
            return str;
        }).join(',');
        this._odataService.updateOptions({
            orderBy: csvString
        });
        // keep current Sorters and update the service options with the new sorting
        this._currentSorters = currentSorters;
        // build the OData query which we will use in the WebAPI callback
        return this._odataService.buildQuery();
    }
    //
    // private functions
    // -------------------
    /**
     * Cast provided filters (could be in multiple format) into an array of ColumnFilter
     * @param columnFilters
     */
    castFilterToColumnFilters(columnFilters) {
        // keep current filters & always save it as an array (columnFilters can be an object when it is dealt by SlickGrid Filter)
        const filtersArray = (typeof columnFilters === 'object') ? Object.keys(columnFilters).map(key => columnFilters[key]) : columnFilters;
        if (!Array.isArray(filtersArray)) {
            return [];
        }
        return filtersArray.map((filter) => {
            const tmpFilter = { columnId: filter.columnId || '' };
            if (filter.operator) {
                tmpFilter.operator = filter.operator;
            }
            if (Array.isArray(filter.searchTerms)) {
                tmpFilter.searchTerms = filter.searchTerms;
            }
            return tmpFilter;
        });
    }
    odataQueryVersionWrapper(queryType, version, fieldName, searchValue = '') {
        let query = '';
        switch (queryType) {
            case 'dateTime':
                query = version >= 4 ? searchValue : `DateTime'${searchValue}'`;
                break;
            case 'substring':
                query = version >= 4 ? `contains(${fieldName}, '${searchValue}')` : `substringof('${searchValue}', ${fieldName})`;
                break;
        }
        return query;
    }
    /**
     * Filter by a search date, the searchTerms might be a single value or range of dates (2 searchTerms OR 1 string separated by 2 dots "date1..date2")
     * Also depending on the OData version number, the output will be different, previous version must wrap dates with DateTime
     * - version 2-3:: Finish gt DateTime'2019-08-12T00:00:00Z'
     * - version 4:: Finish gt 2019-08-12T00:00:00Z
     */
    filterBySearchDate(fieldName, operator, searchTerms, version) {
        let query = '';
        let searchValues = [];
        if (Array.isArray(searchTerms) && searchTerms.length > 1) {
            searchValues = searchTerms;
            if (operator !== OperatorType.rangeExclusive && operator !== OperatorType.rangeInclusive && this._gridOptions.defaultFilterRangeOperator) {
                operator = this._gridOptions.defaultFilterRangeOperator;
            }
        }
        // single search value
        if (searchValues.length === 0 && Array.isArray(searchTerms) && searchTerms.length === 1 && searchTerms[0]) {
            const searchValue1 = this.odataQueryVersionWrapper('dateTime', version, fieldName, parseUtcDate(searchTerms[0], true));
            if (searchValue1) {
                return `${fieldName} ${this.mapOdataOperator(operator)} ${searchValue1}`;
            }
        }
        // multiple search value (date range)
        if (Array.isArray(searchValues) && searchValues.length === 2 && searchValues[0] && searchValues[1]) {
            // date field needs to be UTC and within DateTime function
            const searchValue1 = this.odataQueryVersionWrapper('dateTime', version, fieldName, parseUtcDate(searchValues[0], true));
            const searchValue2 = this.odataQueryVersionWrapper('dateTime', version, fieldName, parseUtcDate(searchValues[1], true));
            if (searchValue1 && searchValue2) {
                if (operator === OperatorType.rangeInclusive) {
                    // example:: (Finish >= DateTime'2019-08-11T00:00:00Z' and Finish <= DateTime'2019-09-12T00:00:00Z')
                    query = `(${fieldName} ge ${searchValue1} and ${fieldName} le ${searchValue2})`;
                }
                else if (operator === OperatorType.rangeExclusive) {
                    // example:: (Finish > DateTime'2019-08-11T00:00:00Z' and Finish < DateTime'2019-09-12T00:00:00Z')
                    query = `(${fieldName} gt ${searchValue1} and ${fieldName} lt ${searchValue2})`;
                }
            }
        }
        return query;
    }
    /**
     * Filter by a range of searchTerms (2 searchTerms OR 1 string separated by 2 dots "value1..value2")
     */
    filterBySearchTermRange(fieldName, operator, searchTerms) {
        let query = '';
        if (Array.isArray(searchTerms) && searchTerms.length === 2) {
            if (operator === OperatorType.rangeInclusive) {
                // example:: (Duration >= 5 and Duration <= 10)
                query = `(${fieldName} ge ${searchTerms[0]} and ${fieldName} le ${searchTerms[1]})`;
            }
            else if (operator === OperatorType.rangeExclusive) {
                // example:: (Duration > 5 and Duration < 10)
                query = `(${fieldName} gt ${searchTerms[0]} and ${fieldName} lt ${searchTerms[1]})`;
            }
        }
        return query;
    }
};
GridOdataService = tslib_1.__decorate([
    Injectable()
], GridOdataService);
export { GridOdataService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ3JpZC1vZGF0YS5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vYW5ndWxhci1zbGlja2dyaWQvIiwic291cmNlcyI6WyJhcHAvbW9kdWxlcy9hbmd1bGFyLXNsaWNrZ3JpZC9zZXJ2aWNlcy9ncmlkLW9kYXRhLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUFFLFlBQVksRUFBRSxzQkFBc0IsRUFBRSxTQUFTLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFDOUUsT0FBTyxFQUVMLFFBQVEsRUFTUixTQUFTLEVBTVQsYUFBYSxFQUViLFlBQVksRUFJYixNQUFNLG1CQUFtQixDQUFDO0FBQzNCLE9BQU8sRUFBRSx3QkFBd0IsRUFBRSxNQUFNLDZCQUE2QixDQUFDO0FBRXZFLE1BQU0sc0JBQXNCLEdBQUcsRUFBRSxDQUFDO0FBQ2xDLE1BQU0saUJBQWlCLEdBQUcsRUFBRSxDQUFDO0FBRzdCLElBQWEsZ0JBQWdCLEdBQTdCLE1BQWEsZ0JBQWdCO0lBOEIzQjtRQTdCUSxvQkFBZSxHQUFvQixFQUFFLENBQUM7UUFFdEMsb0JBQWUsR0FBb0IsRUFBRSxDQUFDO1FBTTlDLG1CQUFjLEdBQWdCO1lBQzVCLEdBQUcsRUFBRSxzQkFBc0I7WUFDM0IsT0FBTyxFQUFFLEVBQUU7WUFDWCxRQUFRLEVBQUUsUUFBUSxDQUFDLFVBQVU7U0FDOUIsQ0FBQztRQWtCQSxJQUFJLENBQUMsYUFBYSxHQUFHLElBQUksd0JBQXdCLEVBQUUsQ0FBQztJQUN0RCxDQUFDO0lBakJELHdDQUF3QztJQUN4QyxJQUFJLGlCQUFpQjtRQUNuQixPQUFPLElBQUksQ0FBQyxrQkFBa0IsQ0FBQztJQUNqQyxDQUFDO0lBRUQsbUNBQW1DO0lBQ25DLElBQUksWUFBWTtRQUNkLE9BQU8sSUFBSSxDQUFDLGFBQWEsQ0FBQztJQUM1QixDQUFDO0lBRUQsaUVBQWlFO0lBQ2pFLElBQVksWUFB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LENBQUMsQ0FBQyxHQUFHLENBQUM7YUFDckY7U0FDRjtRQUNELE9BQU8sS0FBSyxDQUFDO0lBQ2YsQ0FBQztDQUNGLENBQUE7QUFsa0JZLGdCQUFnQjtJQUQ1QixVQUFVLEVBQUU7R0FDQSxnQkFBZ0IsQ0Fra0I1QjtTQWxrQlksZ0JBQWdCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBwYXJzZVV0Y0RhdGUsIG1hcE9wZXJhdG9yQnlGaWVsZFR5cGUsIHRpdGxlQ2FzZSB9IGZyb20gJy4vdXRpbGl0aWVzJztcclxuaW1wb3J0IHtcclxuICBCYWNrZW5kU2VydmljZSxcclxuICBDYXNlVHlwZSxcclxuICBDb2x1bW4sXHJcbiAgQ29sdW1uRmlsdGVyLFxyXG4gIENvbHVtbkZpbHRlcnMsXHJcbiAgQ29sdW1uU29ydCxcclxuICBDdXJyZW50RmlsdGVyLFxyXG4gIEN1cnJlbnRQYWdpbmF0aW9uLFxyXG4gIEN1cnJlbnRTb3J0ZXIsXHJcbiAgRmlsdGVyQ2hhbmdlZEFyZ3MsXHJcbiAgRmllbGRUeXBlLFxyXG4gIEdyaWRPcHRpb24sXHJcbiAgT2RhdGFPcHRpb24sXHJcbiAgUGFnaW5hdGlvbixcclxuICBQYWdpbmF0aW9uQ2hhbmdlZEFyZ3MsXHJcbiAgU29ydENoYW5nZWRBcmdzLFxyXG4gIFNvcnREaXJlY3Rpb24sXHJcbiAgU29ydERpcmVjdGlvblN0cmluZyxcclxuICBPcGVyYXRvclR5cGUsXHJcbiAgT2RhdGFTb3J0aW5nT3B0aW9uLFxyXG4gIE9wZXJhdG9yU3RyaW5nLFxyXG4gIFNlYXJjaFRlcm1cclxufSBmcm9tICcuLy4uL21vZGVscy9pbmRleCc7XHJcbmltcG9ydCB7IE9kYXRhUXVlcnlCdWlsZGVyU2VydmljZSB9IGZyb20gJy4vb2RhdGFRdWVyeUJ1aWxkZXIuc2VydmljZSc7XHJcblxyXG5jb25zdCBERUZBVUxUX0lURU1TX1BFUl9QQUdFID0gMjU7XHJcbmNvbnN0IERFRkFVTFRfUEFHRV9TSVpFID0gMjA7XHJcblxyXG5ASW5qZWN0YWJsZSgpXHJcbmV4cG9ydCBjbGFzcyBHcmlkT2RhdGFTZXJ2aWNlIGltcGxlbWVudHMgQmFja2VuZFNlcnZpY2Uge1xyXG4gIHByaXZhdGUgX2N1cnJlbnRGaWx0ZXJzOiBDdXJyZW50RmlsdGVyW10gPSBbXTtcclxuICBwcml2YXRlIF9jdXJyZW50UGFnaW5hdGlvbjogQ3VycmVudFBhZ2luYXRpb247XHJcbiAgcHJpdmF0ZSBfY3VycmVudFNvcnRlcnM6IEN1cnJlbnRTb3J0ZXJbXSA9IFtdO1xyXG4gIHByaXZhdGUgX2NvbHVtbkRlZmluaXRpb25zOiBDb2x1bW5bXTtcclxuICBwcml2YXRlIF9ncmlkOiBhbnk7XHJcbiAgcHJpdmF0ZSBfb2RhdGFTZXJ2aWNlOiBPZGF0YVF1ZXJ5QnVpbGRlclNlcnZpY2U7XHJcbiAgb3B0aW9uczogUGFydGlhbDxPZGF0YU9wdGlvbj47XHJcbiAgcGFnaW5hdGlvbjogUGFnaW5hdGlvbiB8IHVuZGVmaW5lZDtcclxuICBkZWZhdWx0T3B0aW9uczogT2RhdGFPcHRpb24gPSB7XHJcbiAgICB0b3A6IERFRkFVTFRfSVRFTVNfUEVSX1BBR0UsXHJcbiAgICBvcmRlckJ5OiAnJyxcclxuICAgIGNhc2VUeXBlOiBDYXNlVHlwZS5wYXNjYWxDYXNlXHJcbiAgfTtcclxuXHJcbiAgLyoqIEdldHRlciBmb3IgdGhlIENvbHVtbiBEZWZpbml0aW9ucyAqL1xyXG4gIGdldCBjb2x1bW5EZWZpbml0aW9ucygpIHtcclxuICAgIHJldHVybiB0aGlzLl9jb2x1bW5EZWZpbml0aW9ucztcclxuICB9XHJcblxyXG4gIC8qKiBHZXR0ZXIgZm9yIHRoZSBPZGF0YSBTZXJ2aWNlICovXHJcbiAgZ2V0IG9kYXRhU2VydmljZSgpIHtcclxuICAgIHJldHVybiB0aGlzLl9vZGF0YVNlcnZpY2U7XHJcbiAgfVxyXG5cclxuICAvKiogR2V0dGVyIGZvciB0aGUgR3JpZCBPcHRpb25zIHB1bGxlZCB0aHJvdWdoIHRoZSBHcmlkIE9iamVjdCAqL1xyXG4gIHByaXZhdGUgZ2V0IF9ncmlkT3B0aW9ucygpOiBHcmlkT3B0aW9uIHtcclxuICAgIHJldHVybiAodGhpcy5fZ3JpZCAmJiB0aGlzLl9ncmlkLmdldE9wdGlvbnMpID8gdGhpcy5fZ3JpZC5nZXRPcHRpb25zKCkgOiB7fTtcclxuICB9XHJcblxyXG4gIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgdGhpcy5fb2RhdGFTZXJ2aWNlID0gbmV3IE9kYXRhUXVlcnlCdWlsZGVyU2VydmljZSgpO1xyXG4gIH1cclxuXHJcbiAgaW5pdChzZXJ2aWNlT3B0aW9uczogUGFydGlhbDxPZGF0YU9wdGlvbj4sIHBhZ2luYXRpb24/OiBQYWdpbmF0aW9uLCBncmlkPzogYW55KTogdm9pZCB7XHJcbiAgICB0aGlzLl9ncmlkID0gZ3JpZDtcclxuICAgIGNvbnN0IG1lcmdlZE9wdGlvbnMgPSB7IC4uLnRoaXMuZGVmYXVsdE9wdGlvbnMsIC4uLnNlcnZpY2VPcHRpb25zIH07XHJcblxyXG4gICAgLy8gdW5sZXNzIHVzZXIgc3BlY2lmaWNhbGx5IHNldCBcImVuYWJsZVBhZ2luYXRpb25cIiB0byBGYWxzZSwgd2UnbGwgYWRkIFwidG9wXCIgcHJvcGVydHkgZm9yIHRoZSBwYWdpbmF0aW9uIGluIGV2ZXJ5IG90aGVyIGNhc2VzXHJcbiAgICBpZiAodGhpcy5fZ3JpZE9wdGlvbnMgJiYgIXRoaXMuX2dyaWRPcHRpb25zLmVuYWJsZVBhZ2luYXRpb24pIHtcclxuICAgICAgLy8gc2F2ZSBjdXJyZW50IHBhZ2luYXRpb24gYXMgUGFnZSAxIGFuZCBwYWdlIHNpemUgYXMgXCJ0b3BcIlxyXG4gICAgICB0aGlzLl9vZGF0YVNlcnZpY2Uub3B0aW9ucyA9IHsgLi4ubWVyZ2VkT3B0aW9ucywgdG9wOiBudWxsIH07XHJcbiAgICAgIHRoaXMuX2N1cnJlbnRQYWdpbmF0aW9uID0gbnVsbDtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGNvbnN0IHRvcE9wdGlvbiA9IChwYWdpbmF0aW9uICYmIHBhZ2luYXRpb24ucGFnZVNpemUpID8gcGFnaW5hdGlvbi5wYWdlU2l6ZSA6IHRoaXMuZGVmYXVsdE9wdGlvbnMudG9wO1xyXG4gICAgICB0aGlzLl9vZGF0YVNlcnZpY2Uub3B0aW9ucyA9IHsgLi4ubWVyZ2VkT3B0aW9ucywgdG9wOiB0b3BPcHRpb24gfTtcclxuICAgICAgdGhpcy5fY3VycmVudFBhZ2luYXRpb24gPSB7XHJcbiAgICAgICAgcGFnZU51bWJlcjogMSxcclxuICAgICAgICBwYWdlU2l6ZTogdGhpcy5fb2RhdGFTZXJ2aWNlLm9wdGlvbnMudG9wIHx8IHRoaXMuZGVmYXVsdE9wdGlvbnMudG9wIHx8IERFRkFVTFRfUEFHRV9TSVpFLFxyXG4gICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMub3B0aW9ucyA9IHRoaXMuX29kYXRhU2VydmljZS5vcHRpb25zO1xyXG4gICAgdGhpcy5wYWdpbmF0aW9uID0gcGFnaW5hdGlvbjtcclxuXHJcbiAgICBpZiAoZ3JpZCAmJiBncmlkLmdldENvbHVtbnMpIHtcclxuICAgICAgdGhpcy5fY29sdW1uRGVmaW5pdGlvbnMgPSBzZXJ2aWNlT3B0aW9ucyAmJiBzZXJ2aWNlT3B0aW9ucy5jb2x1bW5EZWZpbml0aW9ucyB8fCBncmlkLmdldENvbHVtbnMoKTtcclxuICAgICAgdGhpcy5fY29sdW1uRGVmaW5pdGlvbnMgPSB0aGlzLl9jb2x1bW5EZWZpbml0aW9ucy5maWx0ZXIoKGNvbHVtbjogQ29sdW1uKSA9PiAhY29sdW1uLmV4Y2x1ZGVGcm9tUXVlcnkpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgYnVpbGRRdWVyeSgpOiBzdHJpbmcge1xyXG4gICAgcmV0dXJuIHRoaXMuX29kYXRhU2VydmljZS5idWlsZFF1ZXJ5KCk7XHJcbiAgfVxyXG5cclxuICBjbGVhckZpbHRlcnMoKSB7XHJcbiAgICB0aGlzLl9jdXJyZW50RmlsdGVycyA9IFtdO1xyXG4gICAgdGhpcy51cGRhdGVGaWx0ZXJzKFtdKTtcclxuICB9XHJcblxyXG4gIGNsZWFyU29ydGVycygpIHtcclxuICAgIHRoaXMuX2N1cnJlbnRTb3J0ZXJzID0gW107XHJcbiAgICB0aGlzLnVwZGF0ZVNvcnRlcnMoW10pO1xyXG4gIH1cclxuXHJcbiAgdXBkYXRlT3B0aW9ucyhzZXJ2aWNlT3B0aW9ucz86IFBhcnRpYWw8T2RhdGFPcHRpb24+KSB7XHJcbiAgICB0aGlzLm9wdGlvbnMgPSB7IC4uLnRoaXMub3B0aW9ucywgLi4uc2VydmljZU9wdGlvbnMgfTtcclxuICAgIHRoaXMuX29kYXRhU2VydmljZS5vcHRpb25zID0gdGhpcy5vcHRpb25zO1xyXG4gIH1cclxuXHJcbiAgcmVtb3ZlQ29sdW1uRmlsdGVyKGZpZWxkTmFtZTogc3RyaW5nKTogdm9pZCB7XHJcbiAgICB0aGlzLl9vZGF0YVNlcnZpY2UucmVtb3ZlQ29sdW1uRmlsdGVyKGZpZWxkTmFtZSk7XHJcbiAgfVxyXG5cclxuICAvKiogR2V0IHRoZSBGaWx0ZXJzIHRoYXQgYXJlIGN1cnJlbnRseSB1c2VkIGJ5IHRoZSBncmlkICovXHJcbiAgZ2V0Q3VycmVudEZpbHRlcnMoKTogQ3VycmVudEZpbHRlcltdIHtcclxuICAgIHJldHVybiB0aGlzLl9jdXJyZW50RmlsdGVycztcclxuICB9XHJcblxyXG4gIC8qKiBHZXQgdGhlIFBhZ2luYXRpb24gdGhhdCBpcyBjdXJyZW50bHkgdXNlZCBieSB0aGUgZ3JpZCAqL1xyXG4gIGdldEN1cnJlbnRQYWdpbmF0aW9uKCk6IEN1cnJlbnRQYWdpbmF0aW9uIHtcclxuICAgIHJldHVybiB0aGlzLl9jdXJyZW50UGFnaW5hdGlvbjtcclxuICB9XHJcblxyXG4gIC8qKiBHZXQgdGhlIFNvcnRlcnMgdGhhdCBhcmUgY3VycmVudGx5IHVzZWQgYnkgdGhlIGdyaWQgKi9cclxuICBnZXRDdXJyZW50U29ydGVycygpOiBDdXJyZW50U29ydGVyW10ge1xyXG4gICAgcmV0dXJuIHRoaXMuX2N1cnJlbnRTb3J0ZXJzO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogTWFwcGVyIGZvciBtYXRoZW1hdGljYWwgb3BlcmF0b3JzIChleC46IDw9IGlzIFwibGVcIiwgPiBpcyBcImd0XCIpXHJcbiAgICogQHBhcmFtIHN0cmluZyBvcGVyYXRvclxyXG4gICAqIEByZXR1cm5zIHN0cmluZyBtYXBcclxuICAgKi9cclxuICBtYXBPZGF0YU9wZXJhdG9yKG9wZXJhdG9yOiBzdHJpbmcpIHtcclxuICAgIGxldCBtYXAgPSAnJztcclxuICAgIHN3aXRjaCAob3BlcmF0b3IpIHtcclxuICAgICAgY2FzZSAnPCc6XHJcbiAgICAgICAgbWFwID0gJ2x0JztcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSAnPD0nOlxyXG4gICAgICAgIG1hcCA9ICdsZSc7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgJz4nOlxyXG4gICAgICAgIG1hcCA9ICdndCc7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgJz49JzpcclxuICAgICAgICBtYXAgPSAnZ2UnO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlICc8Pic6XHJcbiAgICAgIGNhc2UgJyE9JzpcclxuICAgICAgICBtYXAgPSAnbmUnO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlICc9JzpcclxuICAgICAgY2FzZSAnPT0nOlxyXG4gICAgICBkZWZhdWx0OlxyXG4gICAgICAgIG1hcCA9ICdlcSc7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIG1hcDtcclxuICB9XHJcblxyXG4gIC8qXHJcbiAgICogUmVzZXQgdGhlIHBhZ2luYXRpb24gb3B0aW9uc1xyXG4gICAqL1xyXG4gIHJlc2V0UGFnaW5hdGlvbk9wdGlvbnMoKSB7XHJcbiAgICB0aGlzLl9vZGF0YVNlcnZpY2UudXBkYXRlT3B0aW9ucyh7XHJcbiAgICAgIHNraXA6IDBcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgc2F2ZUNvbHVtbkZpbHRlcihmaWVsZE5hbWU6IHN0cmluZywgdmFsdWU6IHN0cmluZywgdGVybXM/OiBhbnlbXSkge1xyXG4gICAgdGhpcy5fb2RhdGFTZXJ2aWNlLnNhdmVDb2x1bW5GaWx0ZXIoZmllbGROYW1lLCB2YWx1ZSwgdGVybXMpO1xyXG4gIH1cclxuXHJcbiAgLypcclxuICAgKiBGSUxURVJJTkdcclxuICAgKi9cclxuICBwcm9jZXNzT25GaWx0ZXJDaGFuZ2VkKGV2ZW50OiBFdmVudCwgYXJnczogRmlsdGVyQ2hhbmdlZEFyZ3MpOiBzdHJpbmcge1xyXG4gICAgY29uc3QgZ3JpZE9wdGlvbnM6IEdyaWRPcHRpb24gPSB0aGlzLl9ncmlkT3B0aW9ucztcclxuICAgIGNvbnN0IGJhY2tlbmRBcGkgPSBncmlkT3B0aW9ucy5iYWNrZW5kU2VydmljZUFwaTtcclxuXHJcbiAgICBpZiAoYmFja2VuZEFwaSA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcignU29tZXRoaW5nIHdlbnQgd3JvbmcgaW4gdGhlIEdyaWRPZGF0YVNlcnZpY2UsIFwiYmFja2VuZFNlcnZpY2VBcGlcIiBpcyBub3QgaW5pdGlhbGl6ZWQnKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBrZWVwIGN1cnJlbnQgZmlsdGVycyAmIGFsd2F5cyBzYXZlIGl0IGFzIGFuIGFycmF5IChjb2x1bW5GaWx0ZXJzIGNhbiBiZSBhbiBvYmplY3Qgd2hlbiBpdCBpcyBkZWFsdCBieSBTbGlja0dyaWQgRmlsdGVyKVxyXG4gICAgdGhpcy5fY3VycmVudEZpbHRlcnMgPSB0aGlzLmNhc3RGaWx0ZXJUb0NvbHVtbkZpbHRlcnMoYXJncy5jb2x1bW5GaWx0ZXJzKTtcclxuXHJcbiAgICBpZiAoIWFyZ3MgfHwgIWFyZ3MuZ3JpZCkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1NvbWV0aGluZyB3ZW50IHdyb25nIHdoZW4gdHJ5aW5nIGNyZWF0ZSB0aGUgR3JpZE9kYXRhU2VydmljZSwgaXQgc2VlbXMgdGhhdCBcImFyZ3NcIiBpcyBub3QgcG9wdWxhdGVkIGNvcnJlY3RseScpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIGxvb3AgdGhyb3VnaCBhbGwgY29sdW1ucyB0byBpbnNwZWN0IGZpbHRlcnMgJiBzZXQgdGhlIHF1ZXJ5XHJcbiAgICB0aGlzLnVwZGF0ZUZpbHRlcnMoYXJncy5jb2x1bW5GaWx0ZXJzKTtcclxuXHJcbiAgICB0aGlzLnJlc2V0UGFnaW5hdGlvbk9wdGlvbnMoKTtcclxuICAgIHJldHVybiB0aGlzLl9vZGF0YVNlcnZpY2UuYnVpbGRRdWVyeSgpO1xyXG4gIH1cclxuXHJcbiAgLypcclxuICAgKiBQQUdJTkFUSU9OXHJcbiAgICovXHJcbiAgcHJvY2Vzc09uUGFnaW5hdGlvbkNoYW5nZWQoZXZlbnQ6IEV2ZW50LCBhcmdzOiBQYWdpbmF0aW9uQ2hhbmdlZEFyZ3MpIHtcclxuICAgIGNvbnN0IHBhZ2VTaXplID0gKyhhcmdzLnBhZ2VTaXplIHx8ICgodGhpcy5wYWdpbmF0aW9uKSA/IHRoaXMucGFnaW5hdGlvbi5wYWdlU2l6ZSA6IERFRkFVTFRfUEFHRV9TSVpFKSk7XHJcbiAgICB0aGlzLnVwZGF0ZVBhZ2luYXRpb24oYXJncy5uZXdQYWdlLCBwYWdlU2l6ZSk7XHJcblxyXG4gICAgLy8gYnVpbGQgdGhlIE9EYXRhIHF1ZXJ5IHdoaWNoIHdlIHdpbGwgdXNlIGluIHRoZSBXZWJBUEkgY2FsbGJhY2tcclxuICAgIHJldHVybiB0aGlzLl9vZGF0YVNlcnZpY2UuYnVpbGRRdWVyeSgpO1xyXG4gIH1cclxuXHJcbiAgLypcclxuICAgKiBTT1JUSU5HXHJcbiAgICovXHJcbiAgcHJvY2Vzc09uU29ydENoYW5nZWQoZXZlbnQ6IEV2ZW50LCBhcmdzOiBTb3J0Q2hhbmdlZEFyZ3MpIHtcclxuICAgIGNvbnN0IHNvcnRDb2x1bW5zID0gKGFyZ3MubXVsdGlDb2x1bW5Tb3J0KSA/IGFyZ3Muc29ydENvbHMgOiBuZXcgQXJyYXkoeyBzb3J0Q29sOiBhcmdzLnNvcnRDb2wsIHNvcnRBc2M6IGFyZ3Muc29ydEFzYyB9KTtcclxuXHJcbiAgICAvLyBsb29wIHRocm91Z2ggYWxsIGNvbHVtbnMgdG8gaW5zcGVjdCBzb3J0ZXJzICYgc2V0IHRoZSBxdWVyeVxyXG4gICAgdGhpcy51cGRhdGVTb3J0ZXJzKHNvcnRDb2x1bW5zKTtcclxuXHJcbiAgICAvLyBidWlsZCB0aGUgT0RhdGEgcXVlcnkgd2hpY2ggd2Ugd2lsbCB1c2UgaW4gdGhlIFdlYkFQSSBjYWxsYmFja1xyXG4gICAgcmV0dXJuIHRoaXMuX29kYXRhU2VydmljZS5idWlsZFF1ZXJ5KCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBsb29wIHRocm91Z2ggYWxsIGNvbHVtbnMgdG8gaW5zcGVjdCBmaWx0ZXJzICYgdXBkYXRlIGJhY2tlbmQgc2VydmljZSBmaWx0ZXJzXHJcbiAgICogQHBhcmFtIGNvbHVtbkZpbHRlcnNcclxuICAgKi9cclxuICB1cGRhdGVGaWx0ZXJzKGNvbHVtbkZpbHRlcnM6IENvbHVtbkZpbHRlcnMgfCBDdXJyZW50RmlsdGVyW10sIGlzVXBkYXRlZEJ5UHJlc2V0T3JEeW5hbWljYWxseT86IGJvb2xlYW4pIHtcclxuICAgIGxldCBzZWFyY2hCeSA9ICcnO1xyXG4gICAgY29uc3Qgc2VhcmNoQnlBcnJheTogc3RyaW5nW10gPSBbXTtcclxuICAgIGNvbnN0IG9kYXRhVmVyc2lvbiA9IHRoaXMuX29kYXRhU2VydmljZSAmJiB0aGlzLl9vZGF0YVNlcnZpY2Uub3B0aW9ucyAmJiB0aGlzLl9vZGF0YVNlcnZpY2Uub3B0aW9ucy52ZXJzaW9uIHx8IDI7XHJcblxyXG4gICAgLy8gb24gZmlsdGVyIHByZXNldCBsb2FkLCB3ZSBuZWVkIHRvIGtlZXAgY3VycmVudCBmaWx0ZXJzXHJcbiAgICBpZiAoaXNVcGRhdGVkQnlQcmVzZXRPckR5bmFtaWNhbGx5KSB7XHJcbiAgICAgIHRoaXMuX2N1cnJlbnRGaWx0ZXJzID0gdGhpcy5jYXN0RmlsdGVyVG9Db2x1bW5GaWx0ZXJzKGNvbHVtbkZpbHRlcnMpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIGxvb3AgdGhyb3VnaCBhbGwgY29sdW1ucyB0byBpbnNwZWN0IGZpbHRlcnNcclxuICAgIGZvciAoY29uc3QgY29sdW1uSWQgaW4gY29sdW1uRmlsdGVycykge1xyXG4gICAgICBpZiAoY29sdW1uRmlsdGVycy5oYXNPd25Qcm9wZXJ0eShjb2x1bW5JZCkpIHtcclxuICAgICAgICBjb25zdCBjb2x1bW5GaWx0ZXIgPSBjb2x1bW5GaWx0ZXJzW2NvbHVtbklkXTtcclxuXHJcbiAgICAgICAgLy8gaWYgdXNlciBkZWZpbmVkIHNvbWUgXCJwcmVzZXRzXCIsIHRoZW4gd2UgbmVlZCB0byBmaW5kIHRoZSBmaWx0ZXJzIGZyb20gdGhlIGNvbHVtbiBkZWZpbml0aW9ucyBpbnN0ZWFkXHJcbiAgICAgICAgbGV0IGNvbHVtbkRlZjogQ29sdW1uIHwgdW5kZWZpbmVkO1xyXG4gICAgICAgIGlmIChpc1VwZGF0ZWRCeVByZXNldE9yRHluYW1pY2FsbHkgJiYgQXJyYXkuaXNBcnJheSh0aGlzLl9jb2x1bW5EZWZpbml0aW9ucykpIHtcclxuICAgICAgICAgIGNvbHVtbkRlZiA9IHRoaXMuX2NvbHVtbkRlZmluaXRpb25zLmZpbmQoKGNvbHVtbjogQ29sdW1uKSA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiBjb2x1bW4uaWQgPT09IGNvbHVtbkZpbHRlci5jb2x1bW5JZDtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBjb2x1bW5EZWYgPSBjb2x1bW5GaWx0ZXIuY29sdW1uRGVmO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoIWNvbHVtbkRlZikge1xyXG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdbR3JpZE9EYXRhIFNlcnZpY2VdOiBTb21ldGhpbmcgd2VudCB3cm9uZyBpbiB0cnlpbmcgdG8gZ2V0IHRoZSBjb2x1bW4gZGVmaW5pdGlvbiBvZiB0aGUgc3BlY2lmaWVkIGZpbHRlciAob3IgcHJlc2V0IGZpbHRlcnMpLiBEaWQgeW91IG1ha2UgYSB0eXBvIG9uIHRoZSBmaWx0ZXIgY29sdW1uSWQ/Jyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsZXQgZmllbGROYW1lID0gKGNvbHVtbkRlZi5maWx0ZXIgJiYgY29sdW1uRGVmLmZpbHRlci5xdWVyeUZpZWxkKSB8fCBjb2x1bW5EZWYucXVlcnlGaWVsZEZpbHRlciB8fCBjb2x1bW5EZWYucXVlcnlGaWVsZCB8fCBjb2x1bW5EZWYuZmllbGQgfHwgY29sdW1uRGVmLm5hbWUgfHwgJyc7XHJcbiAgICAgICAgY29uc3QgZmllbGRUeXBlID0gY29sdW1uRGVmLnR5cGUgfHwgRmllbGRUeXBlLnN0cmluZztcclxuICAgICAgICBsZXQgc2VhcmNoVGVybXMgPSAoY29sdW1uRmlsdGVyID8gY29sdW1uRmlsdGVyLnNlYXJjaFRlcm1zIDogbnVsbCkgfHwgW107XHJcbiAgICAgICAgbGV0IGZpZWxkU2VhcmNoVmFsdWUgPSAoQXJyYXkuaXNBcnJheShzZWFyY2hUZXJtcykgJiYgc2VhcmNoVGVybXMubGVuZ3RoID09PSAxKSA/IHNlYXJjaFRlcm1zWzBdIDogJyc7XHJcbiAgICAgICAgaWYgKHR5cGVvZiBmaWVsZFNlYXJjaFZhbHVlID09PSAndW5kZWZpbmVkJykge1xyXG4gICAgICAgICAgZmllbGRTZWFyY2hWYWx1ZSA9ICcnO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKCFmaWVsZE5hbWUpIHtcclxuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgR3JpZE9EYXRhIGZpbHRlciBjb3VsZCBub3QgZmluZCB0aGUgZmllbGQgbmFtZSB0byBxdWVyeSB0aGUgc2VhcmNoLCB5b3VyIGNvbHVtbiBkZWZpbml0aW9uIG11c3QgaW5jbHVkZSBhIHZhbGlkIFwiZmllbGRcIiBvciBcIm5hbWVcIiAob3B0aW9uYWxseSB5b3UgY2FuIGFsc28gdXNlIHRoZSBcInF1ZXJ5ZmllbGRcIikuYCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmaWVsZFNlYXJjaFZhbHVlID0gJycgKyBmaWVsZFNlYXJjaFZhbHVlOyAvLyBtYWtlIHN1cmUgaXQncyBhIHN0cmluZ1xyXG4gICAgICAgIGNvbnN0IG1hdGNoZXMgPSBmaWVsZFNlYXJjaFZhbHVlLm1hdGNoKC9eKFs8PiE9XFwqXXswLDJ9KSguKltePD4hPVxcKl0pKFtcXCpdPykkLyk7IC8vIGdyb3VwIDE6IE9wZXJhdG9yLCAyOiBzZWFyY2hWYWx1ZSwgMzogbGFzdCBjaGFyIGlzICcqJyAobWVhbmluZyBzdGFydHMgd2l0aCwgZXguOiBhYmMqKVxyXG4gICAgICAgIGxldCBvcGVyYXRvciA9IGNvbHVtbkZpbHRlci5vcGVyYXRvciB8fCAoKG1hdGNoZXMpID8gbWF0Y2hlc1sxXSA6ICcnKTtcclxuICAgICAgICBsZXQgc2VhcmNoVmFsdWUgPSAoISFtYXRjaGVzKSA/IG1hdGNoZXNbMl0gOiAnJztcclxuICAgICAgICBjb25zdCBsYXN0VmFsdWVDaGFyID0gKCEhbWF0Y2hlcykgPyBtYXRjaGVzWzNdIDogKG9wZXJhdG9yID09PSAnKnonIHx8IG9wZXJhdG9yID09PSBPcGVyYXRvclR5cGUuZW5kc1dpdGgpID8gJyonIDogJyc7XHJcbiAgICAgICAgY29uc3QgYnlwYXNzT2RhdGFRdWVyeSA9IGNvbHVtbkZpbHRlci5ieXBhc3NCYWNrZW5kUXVlcnkgfHwgZmFsc2U7XHJcblxyXG4gICAgICAgIC8vIG5vIG5lZWQgdG8gcXVlcnkgaWYgc2VhcmNoIHZhbHVlIGlzIGVtcHR5XHJcbiAgICAgICAgaWYgKGZpZWxkTmFtZSAmJiBzZWFyY2hWYWx1ZSA9PT0gJycgJiYgc2VhcmNoVGVybXMubGVuZ3RoIDw9IDEpIHtcclxuICAgICAgICAgIHRoaXMucmVtb3ZlQ29sdW1uRmlsdGVyKGZpZWxkTmFtZSk7XHJcbiAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChBcnJheS5pc0FycmF5KHNlYXJjaFRlcm1zKSAmJiBzZWFyY2hUZXJtcy5sZW5ndGggPT09IDEgJiYgdHlwZW9mIHNlYXJjaFRlcm1zWzBdID09PSAnc3RyaW5nJyAmJiBzZWFyY2hUZXJtc1swXS5pbmRleE9mKCcuLicpID4gMCkge1xyXG4gICAgICAgICAgc2VhcmNoVGVybXMgPSBzZWFyY2hUZXJtc1swXS5zcGxpdCgnLi4nKTtcclxuICAgICAgICAgIGlmICghb3BlcmF0b3IpIHtcclxuICAgICAgICAgICAgb3BlcmF0b3IgPSBPcGVyYXRvclR5cGUucmFuZ2VFeGNsdXNpdmU7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBlc2NhcGluZyB0aGUgc2VhcmNoIHZhbHVlXHJcbiAgICAgICAgc2VhcmNoVmFsdWUgPSBzZWFyY2hWYWx1ZS5yZXBsYWNlKGAnYCwgYCcnYCk7IC8vIGVzY2FwZSBzaW5nbGUgcXVvdGVzIGJ5IGRvdWJsaW5nIHRoZW1cclxuICAgICAgICBzZWFyY2hWYWx1ZSA9IGVuY29kZVVSSUNvbXBvbmVudChzZWFyY2hWYWx1ZSk7IC8vIGVuY29kZSBVUkkgb2YgdGhlIGZpbmFsIHNlYXJjaCB2YWx1ZVxyXG5cclxuICAgICAgICAvLyBpZiB3ZSBkaWRuJ3QgZmluZCBhbiBPcGVyYXRvciBidXQgd2UgaGF2ZSBhIENvbHVtbiBPcGVyYXRvciBpbnNpZGUgdGhlIEZpbHRlciAoRE9NIEVsZW1lbnQpLCB3ZSBzaG91bGQgdXNlIGl0cyBkZWZhdWx0IE9wZXJhdG9yXHJcbiAgICAgICAgLy8gbXVsdGlwbGVTZWxlY3QgaXMgXCJJTlwiLCB3aGlsZSBzaW5nbGVTZWxlY3QgaXMgXCJFUVwiLCBlbHNlIGRvbid0IG1hcCBhbnkgb3BlcmF0b3JcclxuICAgICAgICBpZiAoIW9wZXJhdG9yICYmIGNvbHVtbkRlZi5maWx0ZXIpIHtcclxuICAgICAgICAgIG9wZXJhdG9yID0gY29sdW1uRGVmLmZpbHRlci5vcGVyYXRvcjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIGlmIHdlIHN0aWxsIGRvbid0IGhhdmUgYW4gb3BlcmF0b3IgZmluZCB0aGUgcHJvcGVyIE9wZXJhdG9yIHRvIHVzZSBieSBpdCdzIGZpZWxkIHR5cGVcclxuICAgICAgICBpZiAoIW9wZXJhdG9yKSB7XHJcbiAgICAgICAgICBvcGVyYXRvciA9IG1hcE9wZXJhdG9yQnlGaWVsZFR5cGUoY29sdW1uRGVmLnR5cGUgfHwgRmllbGRUeXBlLnN0cmluZyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBleHRyYSBxdWVyeSBhcmd1bWVudHNcclxuICAgICAgICBpZiAoYnlwYXNzT2RhdGFRdWVyeSkge1xyXG4gICAgICAgICAgLy8gcHVzaCB0byBvdXIgdGVtcCBhcnJheSBhbmQgYWxzbyB0cmltIHdoaXRlIHNwYWNlc1xyXG4gICAgICAgICAgaWYgKGZpZWxkTmFtZSkge1xyXG4gICAgICAgICAgICB0aGlzLnNhdmVDb2x1bW5GaWx0ZXIoZmllbGROYW1lLCBmaWVsZFNlYXJjaFZhbHVlLCBzZWFyY2hUZXJtcyk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHNlYXJjaEJ5ID0gJyc7XHJcblxyXG4gICAgICAgICAgLy8gdGl0bGVDYXNlIHRoZSBmaWVsZE5hbWUgc28gdGhhdCBpdCBtYXRjaGVzIHRoZSBXZWJBcGkgbmFtZXNcclxuICAgICAgICAgIGlmICh0aGlzLl9vZGF0YVNlcnZpY2Uub3B0aW9ucy5jYXNlVHlwZSA9PT0gQ2FzZVR5cGUucGFzY2FsQ2FzZSkge1xyXG4gICAgICAgICAgICBmaWVsZE5hbWUgPSB0aXRsZUNhc2UoZmllbGROYW1lIHx8ICcnKTtcclxuICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICBpZiAoZmllbGRUeXBlID09PSBGaWVsZFR5cGUuZGF0ZSkge1xyXG4gICAgICAgICAgICBzZWFyY2hCeSA9IHRoaXMuZmlsdGVyQnlTZWFyY2hEYXRlKGZpZWxkTmFtZSwgb3BlcmF0b3IsIHNlYXJjaFRlcm1zLCBvZGF0YVZlcnNpb24pO1xyXG4gICAgICAgICAgfSBlbHNlIGlmIChzZWFyY2hUZXJtcyAmJiBzZWFyY2hUZXJtcy5sZW5ndGggPiAxICYmIChvcGVyYXRvciA9PT0gJ0lOJyB8fCBvcGVyYXRvciA9PT0gJ05JTicgfHwgb3BlcmF0b3IgPT09ICdOT1RJTicgfHwgb3BlcmF0b3IgPT09ICdOT1QgSU4nIHx8IG9wZXJhdG9yID09PSAnTk9UX0lOJykpIHtcclxuICAgICAgICAgICAgLy8gd2hlbiBoYXZpbmcgbW9yZSB0aGFuIDEgc2VhcmNoIHRlcm0gKHRoZW4gY2hlY2sgaWYgd2UgaGF2ZSBhIFwiSU5cIiBvciBcIk5PVCBJTlwiIGZpbHRlciBzZWFyY2gpXHJcbiAgICAgICAgICAgIGNvbnN0IHRtcFNlYXJjaFRlcm1zID0gW107XHJcblxyXG4gICAgICAgICAgICBpZiAob3BlcmF0b3IgPT09ICdJTicpIHtcclxuICAgICAgICAgICAgICAvLyBleGFtcGxlOjogKFN0YWdlIGVxIFwiRXhwaXJlZFwiIG9yIFN0YWdlIGVxIFwiUmVuZXdhbFwiKVxyXG4gICAgICAgICAgICAgIGZvciAobGV0IGogPSAwLCBsbmogPSBzZWFyY2hUZXJtcy5sZW5ndGg7IGogPCBsbmo7IGorKykge1xyXG4gICAgICAgICAgICAgICAgaWYgKGZpZWxkVHlwZSA9PT0gRmllbGRUeXBlLnN0cmluZyB8fCBmaWVsZFR5cGUgPT09IEZpZWxkVHlwZS50ZXh0IHx8IGZpZWxkVHlwZSA9PT0gRmllbGRUeXBlLnJlYWRvbmx5KSB7XHJcbiAgICAgICAgICAgICAgICAgIGNvbnN0IHNlYXJjaFZhbCA9IGVuY29kZVVSSUNvbXBvbmVudChzZWFyY2hUZXJtc1tqXS5yZXBsYWNlKGAnYCwgYCcnYCkpO1xyXG4gICAgICAgICAgICAgICAgICB0bXBTZWFyY2hUZXJtcy5wdXNoKGAke2ZpZWxkTmFtZX0gZXEgJyR7c2VhcmNoVmFsfSdgKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgIC8vIFNpbmdsZSBxdW90ZSBlc2NhcGUgaXMgbm90IG5lZWRlZCBmb3Igbm9uIHN0cmluZyB0eXBlXHJcbiAgICAgICAgICAgICAgICAgIHRtcFNlYXJjaFRlcm1zLnB1c2goYCR7ZmllbGROYW1lfSBlcSAke3NlYXJjaFRlcm1zW2pdfWApO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICBzZWFyY2hCeSA9IHRtcFNlYXJjaFRlcm1zLmpvaW4oJyBvciAnKTtcclxuICAgICAgICAgICAgICBpZiAoISh0eXBlb2Ygc2VhcmNoQnkgPT09ICdzdHJpbmcnICYmIHNlYXJjaEJ5WzBdID09PSAnKCcgJiYgc2VhcmNoQnkuc2xpY2UoLTEpID09PSAnKScpKSB7XHJcbiAgICAgICAgICAgICAgICBzZWFyY2hCeSA9IGAoJHtzZWFyY2hCeX0pYDtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgLy8gZXhhbXBsZTo6IChTdGFnZSBuZSBcIkV4cGlyZWRcIiBhbmQgU3RhZ2UgbmUgXCJSZW5ld2FsXCIpXHJcbiAgICAgICAgICAgICAgZm9yIChsZXQgayA9IDAsIGxuayA9IHNlYXJjaFRlcm1zLmxlbmd0aDsgayA8IGxuazsgaysrKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBzZWFyY2hWYWwgPSBlbmNvZGVVUklDb21wb25lbnQoc2VhcmNoVGVybXNba10ucmVwbGFjZShgJ2AsIGAnJ2ApKTtcclxuICAgICAgICAgICAgICAgIHRtcFNlYXJjaFRlcm1zLnB1c2goYCR7ZmllbGROYW1lfSBuZSAnJHtzZWFyY2hWYWx9J2ApO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICBzZWFyY2hCeSA9IHRtcFNlYXJjaFRlcm1zLmpvaW4oJyBhbmQgJyk7XHJcbiAgICAgICAgICAgICAgaWYgKCEodHlwZW9mIHNlYXJjaEJ5ID09PSAnc3RyaW5nJyAmJiBzZWFyY2hCeVswXSA9PT0gJygnICYmIHNlYXJjaEJ5LnNsaWNlKC0xKSA9PT0gJyknKSkge1xyXG4gICAgICAgICAgICAgICAgc2VhcmNoQnkgPSBgKCR7c2VhcmNoQnl9KWA7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9IGVsc2UgaWYgKG9wZXJhdG9yID09PSAnKicgfHwgb3BlcmF0b3IgPT09ICdhKicgfHwgb3BlcmF0b3IgPT09ICcqeicgfHwgbGFzdFZhbHVlQ2hhciA9PT0gJyonIHx8IG9wZXJhdG9yID09PSBPcGVyYXRvclR5cGUuc3RhcnRzV2l0aCB8fCBvcGVyYXRvciA9PT0gT3BlcmF0b3JUeXBlLmVuZHNXaXRoKSB7XHJcbiAgICAgICAgICAgIC8vIGZpcnN0L2xhc3QgY2hhcmFjdGVyIGlzIGEgJyonIHdpbGwgYmUgYSBzdGFydHNXaXRoIG9yIGVuZHNXaXRoXHJcbiAgICAgICAgICAgIHNlYXJjaEJ5ID0gKG9wZXJhdG9yID09PSAnKicgfHwgb3BlcmF0b3IgPT09ICcqeicgfHwgb3BlcmF0b3IgPT09IE9wZXJhdG9yVHlwZS5lbmRzV2l0aCkgPyBgZW5kc3dpdGgoJHtmaWVsZE5hbWV9LCAnJHtzZWFyY2hWYWx1ZX0nKWAgOiBgc3RhcnRzd2l0aCgke2ZpZWxkTmFtZX0sICcke3NlYXJjaFZhbHVlfScpYDtcclxuICAgICAgICAgIH0gZWxzZSBpZiAoZmllbGRUeXBlID09PSBGaWVsZFR5cGUuc3RyaW5nIHx8IGZpZWxkVHlwZSA9PT0gRmllbGRUeXBlLnRleHQgfHwgZmllbGRUeXBlID09PSBGaWVsZFR5cGUucmVhZG9ubHkpIHtcclxuICAgICAgICAgICAgLy8gc3RyaW5nIGZpZWxkIG5lZWRzIHRvIGJlIGluIHNpbmdsZSBxdW90ZXNcclxuICAgICAgICAgICAgaWYgKG9wZXJhdG9yID09PSAnJyB8fCBvcGVyYXRvciA9PT0gT3BlcmF0b3JUeXBlLmNvbnRhaW5zIHx8IG9wZXJhdG9yID09PSBPcGVyYXRvclR5cGUubm90Q29udGFpbnMpIHtcclxuICAgICAgICAgICAgICBzZWFyY2hCeSA9IHRoaXMub2RhdGFRdWVyeVZlcnNpb25XcmFwcGVyKCdzdWJzdHJpbmcnLCBvZGF0YVZlcnNpb24sIGZpZWxkTmFtZSwgc2VhcmNoVmFsdWUpO1xyXG4gICAgICAgICAgICAgIGlmIChvcGVyYXRvciA9PT0gT3BlcmF0b3JUeXBlLm5vdENvbnRhaW5zKSB7XHJcbiAgICAgICAgICAgICAgICBzZWFyY2hCeSA9IGBub3QgJHtzZWFyY2hCeX1gO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIGlmIChvcGVyYXRvciA9PT0gT3BlcmF0b3JUeXBlLnJhbmdlRXhjbHVzaXZlIHx8IG9wZXJhdG9yID09PSBPcGVyYXRvclR5cGUucmFuZ2VJbmNsdXNpdmUpIHtcclxuICAgICAgICAgICAgICAvLyBleGFtcGxlOjogKER1cmF0aW9uID49IDUgYW5kIER1cmF0aW9uIDw9IDEwKVxyXG4gICAgICAgICAgICAgIHNlYXJjaEJ5ID0gdGhpcy5maWx0ZXJCeVNlYXJjaFRlcm1SYW5nZShmaWVsZE5hbWUsIG9wZXJhdG9yLCBzZWFyY2hUZXJtcyk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgc2VhcmNoQnkgPSBgJHtmaWVsZE5hbWV9ICR7dGhpcy5tYXBPZGF0YU9wZXJhdG9yKG9wZXJhdG9yKX0gJyR7c2VhcmNoVmFsdWV9J2A7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGlmIChvcGVyYXRvciA9PT0gT3BlcmF0b3JUeXBlLnJhbmdlRXhjbHVzaXZlIHx8IG9wZXJhdG9yID09PSBPcGVyYXRvclR5cGUucmFuZ2VJbmNsdXNpdmUpIHtcclxuICAgICAgICAgICAgICAvLyBleGFtcGxlOjogKER1cmF0aW9uID49IDUgYW5kIER1cmF0aW9uIDw9IDEwKVxyXG4gICAgICAgICAgICAgIHNlYXJjaEJ5ID0gdGhpcy5maWx0ZXJCeVNlYXJjaFRlcm1SYW5nZShmaWVsZE5hbWUsIG9wZXJhdG9yLCBzZWFyY2hUZXJtcyk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgLy8gYW55IG90aGVyIGZpZWxkIHR5cGUgKG9yIHVuZGVmaW5lZCB0eXBlKVxyXG4gICAgICAgICAgICAgIHNlYXJjaFZhbHVlID0gKGZpZWxkVHlwZSA9PT0gRmllbGRUeXBlLm51bWJlciB8fCBmaWVsZFR5cGUgPT09IEZpZWxkVHlwZS5ib29sZWFuKSA/IHNlYXJjaFZhbHVlIDogYCcke3NlYXJjaFZhbHVlfSdgO1xyXG4gICAgICAgICAgICAgIHNlYXJjaEJ5ID0gYCR7ZmllbGROYW1lfSAke3RoaXMubWFwT2RhdGFPcGVyYXRvcihvcGVyYXRvcil9ICR7c2VhcmNoVmFsdWV9YDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG5cclxuICAgICAgICAgIC8vIHB1c2ggdG8gb3VyIHRlbXAgYXJyYXkgYW5kIGFsc28gdHJpbSB3aGl0ZSBzcGFjZXNcclxuICAgICAgICAgIGlmIChzZWFyY2hCeSAhPT0gJycpIHtcclxuICAgICAgICAgICAgc2VhcmNoQnlBcnJheS5wdXNoKHNlYXJjaEJ5LnRyaW0oKSk7XHJcbiAgICAgICAgICAgIHRoaXMuc2F2ZUNvbHVtbkZpbHRlcihmaWVsZE5hbWUgfHwgJycsIGZpZWxkU2VhcmNoVmFsdWUsIHNlYXJjaFZhbHVlKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyB1cGRhdGUgdGhlIHNlcnZpY2Ugb3B0aW9ucyB3aXRoIGZpbHRlcnMgZm9yIHRoZSBidWlsZFF1ZXJ5KCkgdG8gd29yayBsYXRlclxyXG4gICAgdGhpcy5fb2RhdGFTZXJ2aWNlLnVwZGF0ZU9wdGlvbnMoe1xyXG4gICAgICBmaWx0ZXI6IChzZWFyY2hCeUFycmF5Lmxlbmd0aCA+IDApID8gc2VhcmNoQnlBcnJheS5qb2luKCcgYW5kICcpIDogJycsXHJcbiAgICAgIHNraXA6IHVuZGVmaW5lZFxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBVcGRhdGUgdGhlIHBhZ2luYXRpb24gY29tcG9uZW50IHdpdGggaXQncyBuZXcgcGFnZSBudW1iZXIgYW5kIHNpemVcclxuICAgKiBAcGFyYW0gbmV3UGFnZVxyXG4gICAqIEBwYXJhbSBwYWdlU2l6ZVxyXG4gICAqL1xyXG4gIHVwZGF0ZVBhZ2luYXRpb24obmV3UGFnZTogbnVtYmVyLCBwYWdlU2l6ZTogbnVtYmVyKSB7XHJcbiAgICB0aGlzLl9jdXJyZW50UGFnaW5hdGlvbiA9IHtcclxuICAgICAgcGFnZU51bWJlcjogbmV3UGFnZSxcclxuICAgICAgcGFnZVNpemUsXHJcbiAgICB9O1xyXG5cclxuICAgIC8vIHVubGVzcyB1c2VyIHNwZWNpZmljYWxseSBzZXQgXCJlbmFibGVQYWdpbmF0aW9uXCIgdG8gRmFsc2UsIHdlJ2xsIHVwZGF0ZSBwYWdpbmF0aW9uIG9wdGlvbnMgaW4gZXZlcnkgb3RoZXIgY2FzZXNcclxuICAgIGlmICh0aGlzLl9ncmlkT3B0aW9ucyAmJiAodGhpcy5fZ3JpZE9wdGlvbnMuZW5hYmxlUGFnaW5hdGlvbiB8fCAhdGhpcy5fZ3JpZE9wdGlvbnMuaGFzT3duUHJvcGVydHkoJ2VuYWJsZVBhZ2luYXRpb24nKSkpIHtcclxuICAgICAgdGhpcy5fb2RhdGFTZXJ2aWNlLnVwZGF0ZU9wdGlvbnMoe1xyXG4gICAgICAgIHRvcDogcGFnZVNpemUsXHJcbiAgICAgICAgc2tpcDogKG5ld1BhZ2UgLSAxKSAqIHBhZ2VTaXplXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogbG9vcCB0aHJvdWdoIGFsbCBjb2x1bW5zIHRvIGluc3BlY3Qgc29ydGVycyAmIHVwZGF0ZSBiYWNrZW5kIHNlcnZpY2Ugb3JkZXJCeVxyXG4gICAqIEBwYXJhbSBjb2x1bW5GaWx0ZXJzXHJcbiAgICovXHJcbiAgdXBkYXRlU29ydGVycyhzb3J0Q29sdW1ucz86IENvbHVtblNvcnRbXSwgcHJlc2V0U29ydGVycz86IEN1cnJlbnRTb3J0ZXJbXSkge1xyXG4gICAgbGV0IGN1cnJlbnRTb3J0ZXJzOiBDdXJyZW50U29ydGVyW10gPSBbXTtcclxuICAgIGNvbnN0IG9kYXRhU29ydGVyczogT2RhdGFTb3J0aW5nT3B0aW9uW10gPSBbXTtcclxuXHJcbiAgICBpZiAoIXNvcnRDb2x1bW5zICYmIHByZXNldFNvcnRlcnMpIHtcclxuICAgICAgLy8gbWFrZSB0aGUgcHJlc2V0cyB0aGUgY3VycmVudCBzb3J0ZXJzLCBhbHNvIG1ha2Ugc3VyZSB0aGF0IGFsbCBkaXJlY3Rpb24gYXJlIGluIGxvd2VyY2FzZSBmb3IgT0RhdGFcclxuICAgICAgY3VycmVudFNvcnRlcnMgPSBwcmVzZXRTb3J0ZXJzO1xyXG4gICAgICBjdXJyZW50U29ydGVycy5mb3JFYWNoKChzb3J0ZXIpID0+IHNvcnRlci5kaXJlY3Rpb24gPSBzb3J0ZXIuZGlyZWN0aW9uLnRvTG93ZXJDYXNlKCkgYXMgU29ydERpcmVjdGlvblN0cmluZyk7XHJcblxyXG4gICAgICAvLyBkaXNwbGF5IHRoZSBjb3JyZWN0IHNvcnRpbmcgaWNvbnMgb24gdGhlIFVJLCBmb3IgdGhhdCBpdCByZXF1aXJlcyAoY29sdW1uSWQsIHNvcnRBc2MpIHByb3BlcnRpZXNcclxuICAgICAgY29uc3QgdG1wU29ydGVyQXJyYXkgPSBjdXJyZW50U29ydGVycy5tYXAoKHNvcnRlcikgPT4ge1xyXG4gICAgICAgIGNvbnN0IGNvbHVtbkRlZiA9IHRoaXMuX2NvbHVtbkRlZmluaXRpb25zLmZpbmQoKGNvbHVtbjogQ29sdW1uKSA9PiBjb2x1bW4uaWQgPT09IHNvcnRlci5jb2x1bW5JZCk7XHJcblxyXG4gICAgICAgIG9kYXRhU29ydGVycy5wdXNoKHtcclxuICAgICAgICAgIGZpZWxkOiBjb2x1bW5EZWYgPyAoKGNvbHVtbkRlZi5xdWVyeUZpZWxkU29ydGVyIHx8IGNvbHVtbkRlZi5xdWVyeUZpZWxkIHx8IGNvbHVtbkRlZi5maWVsZCkgKyAnJykgOiAoc29ydGVyLmNvbHVtbklkICsgJycpLFxyXG4gICAgICAgICAgZGlyZWN0aW9uOiBzb3J0ZXIuZGlyZWN0aW9uXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vIHJldHVybiBvbmx5IHRoZSBjb2x1bW4ocykgZm91bmQgaW4gdGhlIENvbHVtbiBEZWZpbml0aW9ucyBFTFNFIG51bGxcclxuICAgICAgICBpZiAoY29sdW1uRGVmKSB7XHJcbiAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBjb2x1bW5JZDogc29ydGVyLmNvbHVtbklkLFxyXG4gICAgICAgICAgICBzb3J0QXNjOiBzb3J0ZXIuZGlyZWN0aW9uLnRvVXBwZXJDYXNlKCkgPT09IFNvcnREaXJlY3Rpb24uQVNDXHJcbiAgICAgICAgICB9O1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICAvLyBzZXQgdGhlIHNvcnQgaWNvbnMsIGJ1dCBhbHNvIG1ha2Ugc3VyZSB0byBmaWx0ZXIgb3V0IG51bGwgdmFsdWVzICh0aGF0IGhhcHBlbnMgd2hlbiBjb2x1bW5EZWYgaXMgbm90IGZvdW5kKVxyXG4gICAgICBpZiAoQXJyYXkuaXNBcnJheSh0bXBTb3J0ZXJBcnJheSkpIHtcclxuICAgICAgICB0aGlzLl9ncmlkLnNldFNvcnRDb2x1bW5zKHRtcFNvcnRlckFycmF5KTtcclxuICAgICAgfVxyXG4gICAgfSBlbHNlIGlmIChzb3J0Q29sdW1ucyAmJiAhcHJlc2V0U29ydGVycykge1xyXG4gICAgICAvLyBidWlsZCB0aGUgU29ydEJ5IHN0cmluZywgaXQgY291bGQgYmUgbXVsdGlzb3J0LCBleGFtcGxlOiBjdXN0b21lck5vIGFzYywgcHVyY2hhc2VyTmFtZSBkZXNjXHJcbiAgICAgIGlmIChzb3J0Q29sdW1ucyAmJiBzb3J0Q29sdW1ucy5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAvLyBUT0RPIGZpeCB0aGlzIGxpbmVcclxuICAgICAgICAvLyBjdXJyZW50U29ydGVycyA9IG5ldyBBcnJheSh0aGlzLmRlZmF1bHRPcHRpb25zLm9yZGVyQnkpOyAvLyB3aGVuIGVtcHR5LCB1c2UgdGhlIGRlZmF1bHQgc29ydFxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGlmIChzb3J0Q29sdW1ucykge1xyXG4gICAgICAgICAgZm9yIChjb25zdCBjb2x1bW5EZWYgb2Ygc29ydENvbHVtbnMpIHtcclxuICAgICAgICAgICAgaWYgKGNvbHVtbkRlZi5zb3J0Q29sKSB7XHJcbiAgICAgICAgICAgICAgbGV0IGZpZWxkTmFtZSA9IChjb2x1bW5EZWYuc29ydENvbC5xdWVyeUZpZWxkU29ydGVyIHx8IGNvbHVtbkRlZi5zb3J0Q29sLnF1ZXJ5RmllbGQgfHwgY29sdW1uRGVmLnNvcnRDb2wuZmllbGQpICsgJyc7XHJcbiAgICAgICAgICAgICAgbGV0IGNvbHVtbkZpZWxkTmFtZSA9IChjb2x1bW5EZWYuc29ydENvbC5maWVsZCB8fCBjb2x1bW5EZWYuc29ydENvbC5pZCkgKyAnJztcclxuICAgICAgICAgICAgICBsZXQgcXVlcnlGaWVsZCA9IChjb2x1bW5EZWYuc29ydENvbC5xdWVyeUZpZWxkU29ydGVyIHx8IGNvbHVtbkRlZi5zb3J0Q29sLnF1ZXJ5RmllbGQgfHwgY29sdW1uRGVmLnNvcnRDb2wuZmllbGQgfHwgJycpICsgJyc7XHJcbiAgICAgICAgICAgICAgaWYgKHRoaXMuX29kYXRhU2VydmljZS5vcHRpb25zLmNhc2VUeXBlID09PSBDYXNlVHlwZS5wYXNjYWxDYXNlKSB7XHJcbiAgICAgICAgICAgICAgICBmaWVsZE5hbWUgPSB0aXRsZUNhc2UoZmllbGROYW1lKTtcclxuICAgICAgICAgICAgICAgIGNvbHVtbkZpZWxkTmFtZSA9IHRpdGxlQ2FzZShjb2x1bW5GaWVsZE5hbWUpO1xyXG4gICAgICAgICAgICAgICAgcXVlcnlGaWVsZCA9IHRpdGxlQ2FzZShxdWVyeUZpZWxkKTtcclxuICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgIGlmIChjb2x1bW5GaWVsZE5hbWUgIT09ICcnKSB7XHJcbiAgICAgICAgICAgICAgICBjdXJyZW50U29ydGVycy5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgY29sdW1uSWQ6IGNvbHVtbkZpZWxkTmFtZSxcclxuICAgICAgICAgICAgICAgICAgZGlyZWN0aW9uOiBjb2x1bW5EZWYuc29ydEFzYyA/ICdhc2MnIDogJ2Rlc2MnXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgIGlmIChxdWVyeUZpZWxkICE9PSAnJykge1xyXG4gICAgICAgICAgICAgICAgb2RhdGFTb3J0ZXJzLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgICBmaWVsZDogcXVlcnlGaWVsZCxcclxuICAgICAgICAgICAgICAgICAgZGlyZWN0aW9uOiBjb2x1bW5EZWYuc29ydEFzYyA/IFNvcnREaXJlY3Rpb24uQVNDIDogU29ydERpcmVjdGlvbi5ERVNDXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyB0cmFuc2Zvcm0gdGhlIHNvcnRieSBhcnJheSBpbnRvIGEgQ1NWIHN0cmluZyBmb3IgT0RhdGFcclxuICAgIGN1cnJlbnRTb3J0ZXJzID0gY3VycmVudFNvcnRlcnMgfHwgW10gYXMgQ3VycmVudFNvcnRlcltdO1xyXG4gICAgY29uc3QgY3N2U3RyaW5nID0gb2RhdGFTb3J0ZXJzLm1hcCgoc29ydGVyKSA9PiB7XHJcbiAgICAgIGxldCBzdHIgPSAnJztcclxuICAgICAgaWYgKHNvcnRlciAmJiBzb3J0ZXIuZmllbGQpIHtcclxuICAgICAgICBjb25zdCBzb3J0RmllbGQgPSAodGhpcy5fb2RhdGFTZXJ2aWNlLm9wdGlvbnMuY2FzZVR5cGUgPT09IENhc2VUeXBlLnBhc2NhbENhc2UpID8gdGl0bGVDYXNlKHNvcnRlci5maWVsZCkgOiBzb3J0ZXIuZmllbGQ7XHJcbiAgICAgICAgc3RyID0gYCR7c29ydEZpZWxkfSAke3NvcnRlciAmJiBzb3J0ZXIuZGlyZWN0aW9uICYmIHNvcnRlci5kaXJlY3Rpb24udG9Mb3dlckNhc2UoKSB8fCAnJ31gO1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiBzdHI7XHJcbiAgICB9KS5qb2luKCcsJyk7XHJcblxyXG4gICAgdGhpcy5fb2RhdGFTZXJ2aWNlLnVwZGF0ZU9wdGlvbnMoe1xyXG4gICAgICBvcmRlckJ5OiBjc3ZTdHJpbmdcclxuICAgIH0pO1xyXG5cclxuICAgIC8vIGtlZXAgY3VycmVudCBTb3J0ZXJzIGFuZCB1cGRhdGUgdGhlIHNlcnZpY2Ugb3B0aW9ucyB3aXRoIHRoZSBuZXcgc29ydGluZ1xyXG4gICAgdGhpcy5fY3VycmVudFNvcnRlcnMgPSBjdXJyZW50U29ydGVycztcclxuXHJcbiAgICAvLyBidWlsZCB0aGUgT0RhdGEgcXVlcnkgd2hpY2ggd2Ugd2lsbCB1c2UgaW4gdGhlIFdlYkFQSSBjYWxsYmFja1xyXG4gICAgcmV0dXJuIHRoaXMuX29kYXRhU2VydmljZS5idWlsZFF1ZXJ5KCk7XHJcbiAgfVxyXG5cclxuICAvL1xyXG4gIC8vIHByaXZhdGUgZnVuY3Rpb25zXHJcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG4gIC8qKlxyXG4gICAqIENhc3QgcHJvdmlkZWQgZmlsdGVycyAoY291bGQgYmUgaW4gbXVsdGlwbGUgZm9ybWF0KSBpbnRvIGFuIGFycmF5IG9mIENvbHVtbkZpbHRlclxyXG4gICAqIEBwYXJhbSBjb2x1bW5GaWx0ZXJzXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBjYXN0RmlsdGVyVG9Db2x1bW5GaWx0ZXJzKGNvbHVtbkZpbHRlcnM6IENvbHVtbkZpbHRlcnMgfCBDdXJyZW50RmlsdGVyW10pOiBDdXJyZW50RmlsdGVyW10ge1xyXG4gICAgLy8ga2VlcCBjdXJyZW50IGZpbHRlcnMgJiBhbHdheXMgc2F2ZSBpdCBhcyBhbiBhcnJheSAoY29sdW1uRmlsdGVycyBjYW4gYmUgYW4gb2JqZWN0IHdoZW4gaXQgaXMgZGVhbHQgYnkgU2xpY2tHcmlkIEZpbHRlcilcclxuICAgIGNvbnN0IGZpbHRlcnNBcnJheTogQ29sdW1uRmlsdGVyW10gPSAodHlwZW9mIGNvbHVtbkZpbHRlcnMgPT09ICdvYmplY3QnKSA/IE9iamVjdC5rZXlzKGNvbHVtbkZpbHRlcnMpLm1hcChrZXkgPT4gY29sdW1uRmlsdGVyc1trZXldKSA6IGNvbHVtbkZpbHRlcnM7XHJcblxyXG4gICAgaWYgKCFBcnJheS5pc0FycmF5KGZpbHRlcnNBcnJheSkpIHtcclxuICAgICAgcmV0dXJuIFtdO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBmaWx0ZXJzQXJyYXkubWFwKChmaWx0ZXIpID0+IHtcclxuICAgICAgY29uc3QgdG1wRmlsdGVyOiBDdXJyZW50RmlsdGVyID0geyBjb2x1bW5JZDogZmlsdGVyLmNvbHVtbklkIHx8ICcnIH07XHJcbiAgICAgIGlmIChmaWx0ZXIub3BlcmF0b3IpIHtcclxuICAgICAgICB0bXBGaWx0ZXIub3BlcmF0b3IgPSBmaWx0ZXIub3BlcmF0b3I7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKEFycmF5LmlzQXJyYXkoZmlsdGVyLnNlYXJjaFRlcm1zKSkge1xyXG4gICAgICAgIHRtcEZpbHRlci5zZWFyY2hUZXJtcyA9IGZpbHRlci5zZWFyY2hUZXJtcztcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gdG1wRmlsdGVyO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIG9kYXRhUXVlcnlWZXJzaW9uV3JhcHBlcihxdWVyeVR5cGU6ICdkYXRlVGltZScgfCAnc3Vic3RyaW5nJywgdmVyc2lvbjogbnVtYmVyLCBmaWVsZE5hbWU6IHN0cmluZywgc2VhcmNoVmFsdWUgPSAnJyk6IHN0cmluZyB7XHJcbiAgICBsZXQgcXVlcnkgPSAnJztcclxuICAgIHN3aXRjaCAocXVlcnlUeXBlKSB7XHJcbiAgICAgIGNhc2UgJ2RhdGVUaW1lJzpcclxuICAgICAgICBxdWVyeSA9IHZlcnNpb24gPj0gNCA/IHNlYXJjaFZhbHVlIDogYERhdGVUaW1lJyR7c2VhcmNoVmFsdWV9J2A7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgJ3N1YnN0cmluZyc6XHJcbiAgICAgICAgcXVlcnkgPSB2ZXJzaW9uID49IDQgPyBgY29udGFpbnMoJHtmaWVsZE5hbWV9LCAnJHtzZWFyY2hWYWx1ZX0nKWAgOiBgc3Vic3RyaW5nb2YoJyR7c2VhcmNoVmFsdWV9JywgJHtmaWVsZE5hbWV9KWA7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gcXVlcnk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGaWx0ZXIgYnkgYSBzZWFyY2ggZGF0ZSwgdGhlIHNlYXJjaFRlcm1zIG1pZ2h0IGJlIGEgc2luZ2xlIHZhbHVlIG9yIHJhbmdlIG9mIGRhdGVzICgyIHNlYXJjaFRlcm1zIE9SIDEgc3RyaW5nIHNlcGFyYXRlZCBieSAyIGRvdHMgXCJkYXRlMS4uZGF0ZTJcIilcclxuICAgKiBBbHNvIGRlcGVuZGluZyBvbiB0aGUgT0RhdGEgdmVyc2lvbiBudW1iZXIsIHRoZSBvdXRwdXQgd2lsbCBiZSBkaWZmZXJlbnQsIHByZXZpb3VzIHZlcnNpb24gbXVzdCB3cmFwIGRhdGVzIHdpdGggRGF0ZVRpbWVcclxuICAgKiAtIHZlcnNpb24gMi0zOjogRmluaXNoIGd0IERhdGVUaW1lJzIwMTktMDgtMTJUMDA6MDA6MDBaJ1xyXG4gICAqIC0gdmVyc2lvbiA0OjogRmluaXNoIGd0IDIwMTktMDgtMTJUMDA6MDA6MDBaXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBmaWx0ZXJCeVNlYXJjaERhdGUoZmllbGROYW1lOiBzdHJpbmcsIG9wZXJhdG9yOiBPcGVyYXRvclR5cGUgfCBPcGVyYXRvclN0cmluZywgc2VhcmNoVGVybXM6IFNlYXJjaFRlcm1bXSwgdmVyc2lvbjogbnVtYmVyKTogc3RyaW5nIHtcclxuICAgIGxldCBxdWVyeSA9ICcnO1xyXG4gICAgbGV0IHNlYXJjaFZhbHVlczogU2VhcmNoVGVybVtdID0gW107XHJcbiAgICBpZiAoQXJyYXkuaXNBcnJheShzZWFyY2hUZXJtcykgJiYgc2VhcmNoVGVybXMubGVuZ3RoID4gMSkge1xyXG4gICAgICBzZWFyY2hWYWx1ZXMgPSBzZWFyY2hUZXJtcztcclxuICAgICAgaWYgKG9wZXJhdG9yICE9PSBPcGVyYXRvclR5cGUucmFuZ2VFeGNsdXNpdmUgJiYgb3BlcmF0b3IgIT09IE9wZXJhdG9yVHlwZS5yYW5nZUluY2x1c2l2ZSAmJiB0aGlzLl9ncmlkT3B0aW9ucy5kZWZhdWx0RmlsdGVyUmFuZ2VPcGVyYXRvcikge1xyXG4gICAgICAgIG9wZXJhdG9yID0gdGhpcy5fZ3JpZE9wdGlvbnMuZGVmYXVsdEZpbHRlclJhbmdlT3BlcmF0b3I7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyBzaW5nbGUgc2VhcmNoIHZhbHVlXHJcbiAgICBpZiAoc2VhcmNoVmFsdWVzLmxlbmd0aCA9PT0gMCAmJiBBcnJheS5pc0FycmF5KHNlYXJjaFRlcm1zKSAmJiBzZWFyY2hUZXJtcy5sZW5ndGggPT09IDEgJiYgc2VhcmNoVGVybXNbMF0pIHtcclxuICAgICAgY29uc3Qgc2VhcmNoVmFsdWUxID0gdGhpcy5vZGF0YVF1ZXJ5VmVyc2lvbldyYXBwZXIoJ2RhdGVUaW1lJywgdmVyc2lvbiwgZmllbGROYW1lLCBwYXJzZVV0Y0RhdGUoc2VhcmNoVGVybXNbMF0gYXMgc3RyaW5nLCB0cnVlKSk7XHJcbiAgICAgIGlmIChzZWFyY2hWYWx1ZTEpIHtcclxuICAgICAgICByZXR1cm4gYCR7ZmllbGROYW1lfSAke3RoaXMubWFwT2RhdGFPcGVyYXRvcihvcGVyYXRvcil9ICR7c2VhcmNoVmFsdWUxfWA7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyBtdWx0aXBsZSBzZWFyY2ggdmFsdWUgKGRhdGUgcmFuZ2UpXHJcbiAgICBpZiAoQXJyYXkuaXNBcnJheShzZWFyY2hWYWx1ZXMpICYmIHNlYXJjaFZhbHVlcy5sZW5ndGggPT09IDIgJiYgc2VhcmNoVmFsdWVzWzBdICYmIHNlYXJjaFZhbHVlc1sxXSkge1xyXG4gICAgICAvLyBkYXRlIGZpZWxkIG5lZWRzIHRvIGJlIFVUQyBhbmQgd2l0aGluIERhdGVUaW1lIGZ1bmN0aW9uXHJcbiAgICAgIGNvbnN0IHNlYXJjaFZhbHVlMSA9IHRoaXMub2RhdGFRdWVyeVZlcnNpb25XcmFwcGVyKCdkYXRlVGltZScsIHZlcnNpb24sIGZpZWxkTmFtZSwgcGFyc2VVdGNEYXRlKHNlYXJjaFZhbHVlc1swXSBhcyBzdHJpbmcsIHRydWUpKTtcclxuICAgICAgY29uc3Qgc2VhcmNoVmFsdWUyID0gdGhpcy5vZGF0YVF1ZXJ5VmVyc2lvbldyYXBwZXIoJ2RhdGVUaW1lJywgdmVyc2lvbiwgZmllbGROYW1lLCBwYXJzZVV0Y0RhdGUoc2VhcmNoVmFsdWVzWzFdIGFzIHN0cmluZywgdHJ1ZSkpO1xyXG5cclxuICAgICAgaWYgKHNlYXJjaFZhbHVlMSAmJiBzZWFyY2hWYWx1ZTIpIHtcclxuICAgICAgICBpZiAob3BlcmF0b3IgPT09IE9wZXJhdG9yVHlwZS5yYW5nZUluY2x1c2l2ZSkge1xyXG4gICAgICAgICAgLy8gZXhhbXBsZTo6IChGaW5pc2ggPj0gRGF0ZVRpbWUnMjAxOS0wOC0xMVQwMDowMDowMFonIGFuZCBGaW5pc2ggPD0gRGF0ZVRpbWUnMjAxOS0wOS0xMlQwMDowMDowMFonKVxyXG4gICAgICAgICAgcXVlcnkgPSBgKCR7ZmllbGROYW1lfSBnZSAke3NlYXJjaFZhbHVlMX0gYW5kICR7ZmllbGROYW1lfSBsZSAke3NlYXJjaFZhbHVlMn0pYDtcclxuICAgICAgICB9IGVsc2UgaWYgKG9wZXJhdG9yID09PSBPcGVyYXRvclR5cGUucmFuZ2VFeGNsdXNpdmUpIHtcclxuICAgICAgICAgIC8vIGV4YW1wbGU6OiAoRmluaXNoID4gRGF0ZVRpbWUnMjAxOS0wOC0xMVQwMDowMDowMFonIGFuZCBGaW5pc2ggPCBEYXRlVGltZScyMDE5LTA5LTEyVDAwOjAwOjAwWicpXHJcbiAgICAgICAgICBxdWVyeSA9IGAoJHtmaWVsZE5hbWV9IGd0ICR7c2VhcmNoVmFsdWUxfSBhbmQgJHtmaWVsZE5hbWV9IGx0ICR7c2VhcmNoVmFsdWUyfSlgO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIHF1ZXJ5O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmlsdGVyIGJ5IGEgcmFuZ2Ugb2Ygc2VhcmNoVGVybXMgKDIgc2VhcmNoVGVybXMgT1IgMSBzdHJpbmcgc2VwYXJhdGVkIGJ5IDIgZG90cyBcInZhbHVlMS4udmFsdWUyXCIpXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBmaWx0ZXJCeVNlYXJjaFRlcm1SYW5nZShmaWVsZE5hbWU6IHN0cmluZywgb3BlcmF0b3I6IE9wZXJhdG9yVHlwZSB8IE9wZXJhdG9yU3RyaW5nLCBzZWFyY2hUZXJtczogU2VhcmNoVGVybVtdKSB7XHJcbiAgICBsZXQgcXVlcnkgPSAnJztcclxuXHJcbiAgICBpZiAoQXJyYXkuaXNBcnJheShzZWFyY2hUZXJtcykgJiYgc2VhcmNoVGVybXMubGVuZ3RoID09PSAyKSB7XHJcbiAgICAgIGlmIChvcGVyYXRvciA9PT0gT3BlcmF0b3JUeXBlLnJhbmdlSW5jbHVzaXZlKSB7XHJcbiAgICAgICAgLy8gZXhhbXBsZTo6IChEdXJhdGlvbiA+PSA1IGFuZCBEdXJhdGlvbiA8PSAxMClcclxuICAgICAgICBxdWVyeSA9IGAoJHtmaWVsZE5hbWV9IGdlICR7c2VhcmNoVGVybXNbMF19IGFuZCAke2ZpZWxkTmFtZX0gbGUgJHtzZWFyY2hUZXJtc1sxXX0pYDtcclxuICAgICAgfSBlbHNlIGlmIChvcGVyYXRvciA9PT0gT3BlcmF0b3JUeXBlLnJhbmdlRXhjbHVzaXZlKSB7XHJcbiAgICAgICAgLy8gZXhhbXBsZTo6IChEdXJhdGlvbiA+IDUgYW5kIER1cmF0aW9uIDwgMTApXHJcbiAgICAgICAgcXVlcnkgPSBgKCR7ZmllbGROYW1lfSBndCAke3NlYXJjaFRlcm1zWzBdfSBhbmQgJHtmaWVsZE5hbWV9IGx0ICR7c2VhcmNoVGVybXNbMV19KWA7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBxdWVyeTtcclxuICB9XHJcbn1cclxuIl19