import * as tslib_1 from "tslib";
import { Injectable } from '@angular/core';
import { ExtensionName } from './../models/index';
import { ExtensionUtility } from '../extensions/extensionUtility';
import { ExtensionService } from './extension.service';
import { ResizerService } from './resizer.service';
import { unsubscribeAllObservables } from './utilities';
import { SharedService } from './shared.service';
let GroupingAndColspanService = class GroupingAndColspanService {
    constructor(extensionUtility, extensionService, resizerService, sharedService) {
        this.extensionUtility = extensionUtility;
        this.extensionService = extensionService;
        this.resizerService = resizerService;
        this.sharedService = sharedService;
        this.subscriptions = [];
        this._eventHandler = new Slick.EventHandler();
    }
    /** Getter of the SlickGrid Event Handler */
    get eventHandler() {
        return this._eventHandler;
    }
    /** Getter for the Grid Options pulled through the Grid Object */
    get _gridOptions() {
        return (this._grid && this._grid.getOptions) ? this._grid.getOptions() : {};
    }
    /** Getter for the Column Definitions pulled through the Grid Object */
    get _columnDefinitions() {
        return (this._grid && this._grid.getColumns) ? this._grid.getColumns() : [];
    }
    init(grid, dataView) {
        this._grid = grid;
        if (grid && this._gridOptions) {
            // When dealing with Pre-Header Grouping colspan, we need to re-create the pre-header in multiple occasions
            // for all these events, we have to trigger a re-create
            if (this._gridOptions.createPreHeaderPanel) {
                // on all following events, call the
                this._eventHandler.subscribe(grid.onSort, () => this.renderPreHeaderRowGroupingTitles());
                this._eventHandler.subscribe(grid.onColumnsResized, () => this.renderPreHeaderRowGroupingTitles());
                this._eventHandler.subscribe(grid.onColumnsReordered, () => this.renderPreHeaderRowGroupingTitles());
                this._eventHandler.subscribe(dataView.onRowCountChanged, () => this.renderPreHeaderRowGroupingTitles());
                this.subscriptions.push(this.resizerService.onGridAfterResize.subscribe(() => this.renderPreHeaderRowGroupingTitles()), this.sharedService.onHeaderMenuHideColumns.subscribe(() => this.delayRenderPreHeaderRowGroupingTitles(0)));
                this._eventHandler.subscribe(grid.onSetOptions, (_e, args) => {
                    // when user changes frozen columns dynamically (e.g. from header menu), we need to re-render the pre-header of the grouping titles
                    if (args && args.optionsBefore && args.optionsAfter && args.optionsBefore.frozenColumn !== args.optionsAfter.frozenColumn) {
                        this.delayRenderPreHeaderRowGroupingTitles(0);
                    }
                });
                // for both picker (columnPicker/gridMenu) we also need to re-create after hiding/showing columns
                const columnPickerExtension = this.extensionService.getExtensionByName(ExtensionName.columnPicker);
                if (columnPickerExtension && columnPickerExtension.instance && columnPickerExtension.instance.onColumnsChanged) {
                    this._eventHandler.subscribe(columnPickerExtension.instance.onColumnsChanged, () => this.renderPreHeaderRowGroupingTitles());
                }
                const gridMenuExtension = this.extensionService.getExtensionByName(ExtensionName.gridMenu);
                if (gridMenuExtension && gridMenuExtension.instance && gridMenuExtension.instance.onColumnsChanged && gridMenuExtension.instance.onMenuClose) {
                    this._eventHandler.subscribe(gridMenuExtension.instance.onColumnsChanged, () => this.renderPreHeaderRowGroupingTitles());
                    this._eventHandler.subscribe(gridMenuExtension.instance.onMenuClose, () => this.renderPreHeaderRowGroupingTitles());
                }
                // also not sure why at this point, but it seems that I need to call the 1st create in a delayed execution
                // probably some kind of timing issues and delaying it until the grid is fully ready fixes this problem
                this.delayRenderPreHeaderRowGroupingTitles(50);
            }
        }
    }
    dispose() {
        // unsubscribe all SlickGrid events
        this._eventHandler.unsubscribeAll();
        // also unsubscribe all Angular Subscriptions
        this.subscriptions = unsubscribeAllObservables(this.subscriptions);
    }
    /** call "renderPreHeaderRowGroupingTitles()" with a setTimeout delay */
    delayRenderPreHeaderRowGroupingTitles(delay = 0) {
        setTimeout(() => this.renderPreHeaderRowGroupingTitles(), delay);
    }
    /** Create or Render the Pre-Header Row Grouping Titles */
    renderPreHeaderRowGroupingTitles() {
        if (this._gridOptions && this._gridOptions.frozenColumn !== undefined && this._gridOptions.frozenColumn >= 0) {
            // Add column groups to left panel
            let $preHeaderPanel = $(this._grid.getPreHeaderPanelLeft());
            this.renderHeaderGroups($preHeaderPanel, 0, this._gridOptions.frozenColumn + 1);
            // Add column groups to right panel
            $preHeaderPanel = $(this._grid.getPreHeaderPanelRight());
            this.renderHeaderGroups($preHeaderPanel, this._gridOptions.frozenColumn + 1, this._columnDefinitions.length);
        }
        else {
            // regular grid (not a frozen grid)
            const $preHeaderPanel = $(this._grid.getPreHeaderPanel());
            this.renderHeaderGroups($preHeaderPanel, 0, this._columnDefinitions.length);
        }
    }
    renderHeaderGroups(preHeaderPanel, start, end) {
        preHeaderPanel.empty()
            .addClass('slick-header-columns')
            .css('left', '-1000px')
            .width(this._grid.getHeadersWidth());
        preHeaderPanel.parent().addClass('slick-header');
        const headerColumnWidthDiff = this._grid.getHeaderColumnWidthDiff();
        let colDef;
        let header;
        let lastColumnGroup = '';
        let widthTotal = 0;
        const frozenHeaderWidthCalcDifferential = this._gridOptions && this._gridOptions.frozenHeaderWidthCalcDifferential || 0;
        const isFrozenGrid = (this._gridOptions && (this._gridOptions.frozenColumn !== undefined && this._gridOptions.frozenColumn >= 0));
        for (let i = start; i < end; i++) {
            colDef = this._columnDefinitions[i];
            if (colDef) {
                if (lastColumnGroup === colDef.columnGroup && i > 0) {
                    widthTotal += colDef.width || 0;
                    if (header && header.width) {
                        header.width(widthTotal - headerColumnWidthDiff - frozenHeaderWidthCalcDifferential); // remove possible frozen border
                    }
                }
                else {
                    widthTotal = colDef.width || 0;
                    header = $(`<div class="ui-state-default slick-header-column ${isFrozenGrid ? 'frozen' : ''}" />`)
                        .html(`<span class="slick-column-name">${colDef.columnGroup || ''}</span>`)
                        .width(widthTotal - headerColumnWidthDiff)
                        .appendTo(preHeaderPanel);
                }
                lastColumnGroup = colDef.columnGroup || '';
            }
        }
    }
    /** Translate Column Group texts and re-render them afterward. */
    translateGroupingAndColSpan() {
        const currentColumnDefinitions = this._grid.getColumns();
        this.extensionUtility.translateItems(currentColumnDefinitions, 'columnGroupKey', 'columnGroup');
        this._grid.setColumns(currentColumnDefinitions);
        this.renderPreHeaderRowGroupingTitles();
    }
};
GroupingAndColspanService.ctorParameters = () => [
    { type: ExtensionUtility },
    { type: ExtensionService },
    { type: ResizerService },
    { type: SharedService }
];
GroupingAndColspanService = tslib_1.__decorate([
    Injectable()
], GroupingAndColspanService);
export { GroupingAndColspanService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ3JvdXBpbmdBbmRDb2xzcGFuLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9hbmd1bGFyLXNsaWNrZ3JpZC8iLCJzb3VyY2VzIjpbImFwcC9tb2R1bGVzL2FuZ3VsYXItc2xpY2tncmlkL3NlcnZpY2VzL2dyb3VwaW5nQW5kQ29sc3Bhbi5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRzNDLE9BQU8sRUFBeUMsYUFBYSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDekYsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sZ0NBQWdDLENBQUM7QUFDbEUsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDdkQsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQ25ELE9BQU8sRUFBRSx5QkFBeUIsRUFBRSxNQUFNLGFBQWEsQ0FBQztBQUN4RCxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFTakQsSUFBYSx5QkFBeUIsR0FBdEMsTUFBYSx5QkFBeUI7SUFLcEMsWUFBb0IsZ0JBQWtDLEVBQVUsZ0JBQWtDLEVBQVUsY0FBOEIsRUFBVSxhQUE0QjtRQUE1SixxQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQWtCO1FBQVUscUJBQWdCLEdBQWhCLGdCQUFnQixDQUFrQjtRQUFVLG1CQUFjLEdBQWQsY0FBYyxDQUFnQjtRQUFVLGtCQUFhLEdBQWIsYUFBYSxDQUFlO1FBRnhLLGtCQUFhLEdBQW1CLEVBQUUsQ0FBQztRQUd6QyxJQUFJLENBQUMsYUFBYSxHQUFHLElBQUksS0FBSyxDQUFDLFlBQVksRUFBRSxDQUFDO0lBQ2hELENBQUM7SUFFRCw0Q0FBNEM7SUFDNUMsSUFBSSxZQUFZO1FBQ2QsT0FBTyxJQUFJLENBQUMsYUFBYSxDQUFDO0lBQzVCLENBQUM7SUFFRCxpRUFBaUU7SUFDakUsSUFBWSxZQUFZO1FB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RSxLQUFLLENBQUMsVUFBVSxHQUFHLHFCQUFxQixDQUFDO3lCQUN6QyxRQUFRLENBQUMsY0FBYyxDQUFDLENBQUM7aUJBQzdCO2dCQUNELGVBQWUsR0FBRyxNQUFNLENBQUMsV0FBVyxJQUFJLEVBQUUsQ0FBQzthQUM1QztTQUNGO0lBQ0gsQ0FBQztJQUdELGlFQUFpRTtJQUNqRSwyQkFBMkI7UUFDekIsTUFBTSx3QkFBd0IsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLFVBQVUsRUFBRSxDQUFDO1FBQ3pELElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxjQUFjLENBQUMsd0JBQXdCLEVBQUUsZ0JBQWdCLEVBQUUsYUFBYSxDQUFDLENBQUM7UUFDaEcsSUFBSSxDQUFDLEtBQUssQ0FBQyxVQUFVLENBQUMsd0JBQXdCLENBQUMsQ0FBQztRQUNoRCxJQUFJLENBQUMsZ0NBQWdDLEVBQUUsQ0FBQztJQUMxQyxDQUFDO0NBQ0YsQ0FBQTs7WUF4SXVDLGdCQUFnQjtZQUE0QixnQkFBZ0I7WUFBMEIsY0FBYztZQUF5QixhQUFhOztBQUxySyx5QkFBeUI7SUFEckMsVUFBVSxFQUFFO0dBQ0EseUJBQXlCLENBNklyQztTQTdJWSx5QkFBeUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnO1xyXG5cclxuaW1wb3J0IHsgQ29sdW1uLCBHcmlkT3B0aW9uLCBTbGlja0V2ZW50SGFuZGxlciwgRXh0ZW5zaW9uTmFtZSB9IGZyb20gJy4vLi4vbW9kZWxzL2luZGV4JztcclxuaW1wb3J0IHsgRXh0ZW5zaW9uVXRpbGl0eSB9IGZyb20gJy4uL2V4dGVuc2lvbnMvZXh0ZW5zaW9uVXRpbGl0eSc7XHJcbmltcG9ydCB7IEV4dGVuc2lvblNlcnZpY2UgfSBmcm9tICcuL2V4dGVuc2lvbi5zZXJ2aWNlJztcclxuaW1wb3J0IHsgUmVzaXplclNlcnZpY2UgfSBmcm9tICcuL3Jlc2l6ZXIuc2VydmljZSc7XHJcbmltcG9ydCB7IHVuc3Vic2NyaWJlQWxsT2JzZXJ2YWJsZXMgfSBmcm9tICcuL3V0aWxpdGllcyc7XHJcbmltcG9ydCB7IFNoYXJlZFNlcnZpY2UgfSBmcm9tICcuL3NoYXJlZC5zZXJ2aWNlJztcclxuXHJcbi8vIHVzaW5nIGV4dGVybmFsIG5vbi10eXBlZCBqcyBsaWJyYXJpZXNcclxuZGVjbGFyZSBsZXQgJDogYW55O1xyXG5cclxuLy8gdXNpbmcgZXh0ZXJuYWwgbm9uLXR5cGVkIGpzIGxpYnJhcmllc1xyXG5kZWNsYXJlIGNvbnN0IFNsaWNrOiBhbnk7XHJcblxyXG5ASW5qZWN0YWJsZSgpXHJcbmV4cG9ydCBjbGFzcyBHcm91cGluZ0FuZENvbHNwYW5TZXJ2aWNlIHtcclxuICBwcml2YXRlIF9ldmVudEhhbmRsZXI6IFNsaWNrRXZlbnRIYW5kbGVyO1xyXG4gIHByaXZhdGUgX2dyaWQ6IGFueTtcclxuICBwcml2YXRlIHN1YnNjcmlwdGlvbnM6IFN1YnNjcmlwdGlvbltdID0gW107XHJcblxyXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgZXh0ZW5zaW9uVXRpbGl0eTogRXh0ZW5zaW9uVXRpbGl0eSwgcHJpdmF0ZSBleHRlbnNpb25TZXJ2aWNlOiBFeHRlbnNpb25TZXJ2aWNlLCBwcml2YXRlIHJlc2l6ZXJTZXJ2aWNlOiBSZXNpemVyU2VydmljZSwgcHJpdmF0ZSBzaGFyZWRTZXJ2aWNlOiBTaGFyZWRTZXJ2aWNlKSB7XHJcbiAgICB0aGlzLl9ldmVudEhhbmRsZXIgPSBuZXcgU2xpY2suRXZlbnRIYW5kbGVyKCk7XHJcbiAgfVxyXG5cclxuICAvKiogR2V0dGVyIG9mIHRoZSBTbGlja0dyaWQgRXZlbnQgSGFuZGxlciAqL1xyXG4gIGdldCBldmVudEhhbmRsZXIoKTogU2xpY2tFdmVudEhhbmRsZXIge1xyXG4gICAgcmV0dXJuIHRoaXMuX2V2ZW50SGFuZGxlcjtcclxuICB9XHJcblxyXG4gIC8qKiBHZXR0ZXIgZm9yIHRoZSBHcmlkIE9wdGlvbnMgcHVsbGVkIHRocm91Z2ggdGhlIEdyaWQgT2JqZWN0ICovXHJcbiAgcHJpdmF0ZSBnZXQgX2dyaWRPcHRpb25zKCk6IEdyaWRPcHRpb24ge1xyXG4gICAgcmV0dXJuICh0aGlzLl9ncmlkICYmIHRoaXMuX2dyaWQuZ2V0T3B0aW9ucykgPyB0aGlzLl9ncmlkLmdldE9wdGlvbnMoKSA6IHt9O1xyXG4gIH1cclxuXHJcbiAgLyoqIEdldHRlciBmb3IgdGhlIENvbHVtbiBEZWZpbml0aW9ucyBwdWxsZWQgdGhyb3VnaCB0aGUgR3JpZCBPYmplY3QgKi9cclxuICBwcml2YXRlIGdldCBfY29sdW1uRGVmaW5pdGlvbnMoKTogQ29sdW1uW10ge1xyXG4gICAgcmV0dXJuICh0aGlzLl9ncmlkICYmIHRoaXMuX2dyaWQuZ2V0Q29sdW1ucykgPyB0aGlzLl9ncmlkLmdldENvbHVtbnMoKSA6IFtdO1xyXG4gIH1cclxuXHJcbiAgaW5pdChncmlkOiBhbnksIGRhdGFWaWV3OiBhbnkpIHtcclxuICAgIHRoaXMuX2dyaWQgPSBncmlkO1xyXG5cclxuICAgIGlmIChncmlkICYmIHRoaXMuX2dyaWRPcHRpb25zKSB7XHJcbiAgICAgIC8vIFdoZW4gZGVhbGluZyB3aXRoIFByZS1IZWFkZXIgR3JvdXBpbmcgY29sc3Bhbiwgd2UgbmVlZCB0byByZS1jcmVhdGUgdGhlIHByZS1oZWFkZXIgaW4gbXVsdGlwbGUgb2NjYXNpb25zXHJcbiAgICAgIC8vIGZvciBhbGwgdGhlc2UgZXZlbnRzLCB3ZSBoYXZlIHRvIHRyaWdnZXIgYSByZS1jcmVhdGVcclxuICAgICAgaWYgKHRoaXMuX2dyaWRPcHRpb25zLmNyZWF0ZVByZUhlYWRlclBhbmVsKSB7XHJcbiAgICAgICAgLy8gb24gYWxsIGZvbGxvd2luZyBldmVudHMsIGNhbGwgdGhlXHJcbiAgICAgICAgdGhpcy5fZXZlbnRIYW5kbGVyLnN1YnNjcmliZShncmlkLm9uU29ydCwgKCkgPT4gdGhpcy5yZW5kZXJQcmVIZWFkZXJSb3dHcm91cGluZ1RpdGxlcygpKTtcclxuICAgICAgICB0aGlzLl9ldmVudEhhbmRsZXIuc3Vic2NyaWJlKGdyaWQub25Db2x1bW5zUmVzaXplZCwgKCkgPT4gdGhpcy5yZW5kZXJQcmVIZWFkZXJSb3dHcm91cGluZ1RpdGxlcygpKTtcclxuICAgICAgICB0aGlzLl9ldmVudEhhbmRsZXIuc3Vic2NyaWJlKGdyaWQub25Db2x1bW5zUmVvcmRlcmVkLCAoKSA9PiB0aGlzLnJlbmRlclByZUhlYWRlclJvd0dyb3VwaW5nVGl0bGVzKCkpO1xyXG4gICAgICAgIHRoaXMuX2V2ZW50SGFuZGxlci5zdWJzY3JpYmUoZGF0YVZpZXcub25Sb3dDb3VudENoYW5nZWQsICgpID0+IHRoaXMucmVuZGVyUHJlSGVhZGVyUm93R3JvdXBpbmdUaXRsZXMoKSk7XHJcbiAgICAgICAgdGhpcy5zdWJzY3JpcHRpb25zLnB1c2goXHJcbiAgICAgICAgICB0aGlzLnJlc2l6ZXJTZXJ2aWNlLm9uR3JpZEFmdGVyUmVzaXplLnN1YnNjcmliZSgoKSA9PiB0aGlzLnJlbmRlclByZUhlYWRlclJvd0dyb3VwaW5nVGl0bGVzKCkpLFxyXG4gICAgICAgICAgdGhpcy5zaGFyZWRTZXJ2aWNlLm9uSGVhZGVyTWVudUhpZGVDb2x1bW5zLnN1YnNjcmliZSgoKSA9PiB0aGlzLmRlbGF5UmVuZGVyUHJlSGVhZGVyUm93R3JvdXBpbmdUaXRsZXMoMCkpXHJcbiAgICAgICAgKTtcclxuXHJcbiAgICAgICAgdGhpcy5fZXZlbnRIYW5kbGVyLnN1YnNjcmliZShncmlkLm9uU2V0T3B0aW9ucywgKF9lLCBhcmdzKSA9PiB7XHJcbiAgICAgICAgICAvLyB3aGVuIHVzZXIgY2hhbmdlcyBmcm96ZW4gY29sdW1ucyBkeW5hbWljYWxseSAoZS5nLiBmcm9tIGhlYWRlciBtZW51KSwgd2UgbmVlZCB0byByZS1yZW5kZXIgdGhlIHByZS1oZWFkZXIgb2YgdGhlIGdyb3VwaW5nIHRpdGxlc1xyXG4gICAgICAgICAgaWYgKGFyZ3MgJiYgYXJncy5vcHRpb25zQmVmb3JlICYmIGFyZ3Mub3B0aW9uc0FmdGVyICYmIGFyZ3Mub3B0aW9uc0JlZm9yZS5mcm96ZW5Db2x1bW4gIT09IGFyZ3Mub3B0aW9uc0FmdGVyLmZyb3plbkNvbHVtbikge1xyXG4gICAgICAgICAgICB0aGlzLmRlbGF5UmVuZGVyUHJlSGVhZGVyUm93R3JvdXBpbmdUaXRsZXMoMCk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vIGZvciBib3RoIHBpY2tlciAoY29sdW1uUGlja2VyL2dyaWRNZW51KSB3ZSBhbHNvIG5lZWQgdG8gcmUtY3JlYXRlIGFmdGVyIGhpZGluZy9zaG93aW5nIGNvbHVtbnNcclxuICAgICAgICBjb25zdCBjb2x1bW5QaWNrZXJFeHRlbnNpb24gPSB0aGlzLmV4dGVuc2lvblNlcnZpY2UuZ2V0RXh0ZW5zaW9uQnlOYW1lKEV4dGVuc2lvbk5hbWUuY29sdW1uUGlja2VyKTtcclxuICAgICAgICBpZiAoY29sdW1uUGlja2VyRXh0ZW5zaW9uICYmIGNvbHVtblBpY2tlckV4dGVuc2lvbi5pbnN0YW5jZSAmJiBjb2x1bW5QaWNrZXJFeHRlbnNpb24uaW5zdGFuY2Uub25Db2x1bW5zQ2hhbmdlZCkge1xyXG4gICAgICAgICAgdGhpcy5fZXZlbnRIYW5kbGVyLnN1YnNjcmliZShjb2x1bW5QaWNrZXJFeHRlbnNpb24uaW5zdGFuY2Uub25Db2x1bW5zQ2hhbmdlZCwgKCkgPT4gdGhpcy5yZW5kZXJQcmVIZWFkZXJSb3dHcm91cGluZ1RpdGxlcygpKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IGdyaWRNZW51RXh0ZW5zaW9uID0gdGhpcy5leHRlbnNpb25TZXJ2aWNlLmdldEV4dGVuc2lvbkJ5TmFtZShFeHRlbnNpb25OYW1lLmdyaWRNZW51KTtcclxuICAgICAgICBpZiAoZ3JpZE1lbnVFeHRlbnNpb24gJiYgZ3JpZE1lbnVFeHRlbnNpb24uaW5zdGFuY2UgJiYgZ3JpZE1lbnVFeHRlbnNpb24uaW5zdGFuY2Uub25Db2x1bW5zQ2hhbmdlZCAmJiBncmlkTWVudUV4dGVuc2lvbi5pbnN0YW5jZS5vbk1lbnVDbG9zZSkge1xyXG4gICAgICAgICAgdGhpcy5fZXZlbnRIYW5kbGVyLnN1YnNjcmliZShncmlkTWVudUV4dGVuc2lvbi5pbnN0YW5jZS5vbkNvbHVtbnNDaGFuZ2VkLCAoKSA9PiB0aGlzLnJlbmRlclByZUhlYWRlclJvd0dyb3VwaW5nVGl0bGVzKCkpO1xyXG4gICAgICAgICAgdGhpcy5fZXZlbnRIYW5kbGVyLnN1YnNjcmliZShncmlkTWVudUV4dGVuc2lvbi5pbnN0YW5jZS5vbk1lbnVDbG9zZSwgKCkgPT4gdGhpcy5yZW5kZXJQcmVIZWFkZXJSb3dHcm91cGluZ1RpdGxlcygpKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIGFsc28gbm90IHN1cmUgd2h5IGF0IHRoaXMgcG9pbnQsIGJ1dCBpdCBzZWVtcyB0aGF0IEkgbmVlZCB0byBjYWxsIHRoZSAxc3QgY3JlYXRlIGluIGEgZGVsYXllZCBleGVjdXRpb25cclxuICAgICAgICAvLyBwcm9iYWJseSBzb21lIGtpbmQgb2YgdGltaW5nIGlzc3VlcyBhbmQgZGVsYXlpbmcgaXQgdW50aWwgdGhlIGdyaWQgaXMgZnVsbHkgcmVhZHkgZml4ZXMgdGhpcyBwcm9ibGVtXHJcbiAgICAgICAgdGhpcy5kZWxheVJlbmRlclByZUhlYWRlclJvd0dyb3VwaW5nVGl0bGVzKDUwKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgZGlzcG9zZSgpIHtcclxuICAgIC8vIHVuc3Vic2NyaWJlIGFsbCBTbGlja0dyaWQgZXZlbnRzXHJcbiAgICB0aGlzLl9ldmVudEhhbmRsZXIudW5zdWJzY3JpYmVBbGwoKTtcclxuXHJcbiAgICAvLyBhbHNvIHVuc3Vic2NyaWJlIGFsbCBBbmd1bGFyIFN1YnNjcmlwdGlvbnNcclxuICAgIHRoaXMuc3Vic2NyaXB0aW9ucyA9IHVuc3Vic2NyaWJlQWxsT2JzZXJ2YWJsZXModGhpcy5zdWJzY3JpcHRpb25zKTtcclxuICB9XHJcblxyXG4gIC8qKiBjYWxsIFwicmVuZGVyUHJlSGVhZGVyUm93R3JvdXBpbmdUaXRsZXMoKVwiIHdpdGggYSBzZXRUaW1lb3V0IGRlbGF5ICovXHJcbiAgZGVsYXlSZW5kZXJQcmVIZWFkZXJSb3dHcm91cGluZ1RpdGxlcyhkZWxheSA9IDApIHtcclxuICAgIHNldFRpbWVvdXQoKCkgPT4gdGhpcy5yZW5kZXJQcmVIZWFkZXJSb3dHcm91cGluZ1RpdGxlcygpLCBkZWxheSk7XHJcbiAgfVxyXG5cclxuICAvKiogQ3JlYXRlIG9yIFJlbmRlciB0aGUgUHJlLUhlYWRlciBSb3cgR3JvdXBpbmcgVGl0bGVzICovXHJcbiAgcmVuZGVyUHJlSGVhZGVyUm93R3JvdXBpbmdUaXRsZXMoKSB7XHJcbiAgICBpZiAodGhpcy5fZ3JpZE9wdGlvbnMgJiYgdGhpcy5fZ3JpZE9wdGlvbnMuZnJvemVuQ29sdW1uICE9PSB1bmRlZmluZWQgJiYgdGhpcy5fZ3JpZE9wdGlvbnMuZnJvemVuQ29sdW1uID49IDApIHtcclxuICAgICAgLy8gQWRkIGNvbHVtbiBncm91cHMgdG8gbGVmdCBwYW5lbFxyXG4gICAgICBsZXQgJHByZUhlYWRlclBhbmVsID0gJCh0aGlzLl9ncmlkLmdldFByZUhlYWRlclBhbmVsTGVmdCgpKTtcclxuICAgICAgdGhpcy5yZW5kZXJIZWFkZXJHcm91cHMoJHByZUhlYWRlclBhbmVsLCAwLCB0aGlzLl9ncmlkT3B0aW9ucy5mcm96ZW5Db2x1bW4gKyAxKTtcclxuXHJcbiAgICAgIC8vIEFkZCBjb2x1bW4gZ3JvdXBzIHRvIHJpZ2h0IHBhbmVsXHJcbiAgICAgICRwcmVIZWFkZXJQYW5lbCA9ICQodGhpcy5fZ3JpZC5nZXRQcmVIZWFkZXJQYW5lbFJpZ2h0KCkpO1xyXG4gICAgICB0aGlzLnJlbmRlckhlYWRlckdyb3VwcygkcHJlSGVhZGVyUGFuZWwsIHRoaXMuX2dyaWRPcHRpb25zLmZyb3plbkNvbHVtbiArIDEsIHRoaXMuX2NvbHVtbkRlZmluaXRpb25zLmxlbmd0aCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAvLyByZWd1bGFyIGdyaWQgKG5vdCBhIGZyb3plbiBncmlkKVxyXG4gICAgICBjb25zdCAkcHJlSGVhZGVyUGFuZWwgPSAkKHRoaXMuX2dyaWQuZ2V0UHJlSGVhZGVyUGFuZWwoKSk7XHJcbiAgICAgIHRoaXMucmVuZGVySGVhZGVyR3JvdXBzKCRwcmVIZWFkZXJQYW5lbCwgMCwgdGhpcy5fY29sdW1uRGVmaW5pdGlvbnMubGVuZ3RoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHJlbmRlckhlYWRlckdyb3VwcyhwcmVIZWFkZXJQYW5lbDogYW55LCBzdGFydDogbnVtYmVyLCBlbmQ6IG51bWJlcikge1xyXG4gICAgcHJlSGVhZGVyUGFuZWwuZW1wdHkoKVxyXG4gICAgICAuYWRkQ2xhc3MoJ3NsaWNrLWhlYWRlci1jb2x1bW5zJylcclxuICAgICAgLmNzcygnbGVmdCcsICctMTAwMHB4JylcclxuICAgICAgLndpZHRoKHRoaXMuX2dyaWQuZ2V0SGVhZGVyc1dpZHRoKCkpO1xyXG4gICAgcHJlSGVhZGVyUGFuZWwucGFyZW50KCkuYWRkQ2xhc3MoJ3NsaWNrLWhlYWRlcicpO1xyXG5cclxuICAgIGNvbnN0IGhlYWRlckNvbHVtbldpZHRoRGlmZiA9IHRoaXMuX2dyaWQuZ2V0SGVhZGVyQ29sdW1uV2lkdGhEaWZmKCk7XHJcblxyXG4gICAgbGV0IGNvbERlZjtcclxuICAgIGxldCBoZWFkZXI7XHJcbiAgICBsZXQgbGFzdENvbHVtbkdyb3VwID0gJyc7XHJcbiAgICBsZXQgd2lkdGhUb3RhbCA9IDA7XHJcbiAgICBjb25zdCBmcm96ZW5IZWFkZXJXaWR0aENhbGNEaWZmZXJlbnRpYWwgPSB0aGlzLl9ncmlkT3B0aW9ucyAmJiB0aGlzLl9ncmlkT3B0aW9ucy5mcm96ZW5IZWFkZXJXaWR0aENhbGNEaWZmZXJlbnRpYWwgfHwgMDtcclxuICAgIGNvbnN0IGlzRnJvemVuR3JpZCA9ICh0aGlzLl9ncmlkT3B0aW9ucyAmJiAodGhpcy5fZ3JpZE9wdGlvbnMuZnJvemVuQ29sdW1uICE9PSB1bmRlZmluZWQgJiYgdGhpcy5fZ3JpZE9wdGlvbnMuZnJvemVuQ29sdW1uID49IDApKTtcclxuXHJcbiAgICBmb3IgKGxldCBpID0gc3RhcnQ7IGkgPCBlbmQ7IGkrKykge1xyXG4gICAgICBjb2xEZWYgPSB0aGlzLl9jb2x1bW5EZWZpbml0aW9uc1tpXTtcclxuICAgICAgaWYgKGNvbERlZikge1xyXG4gICAgICAgIGlmIChsYXN0Q29sdW1uR3JvdXAgPT09IGNvbERlZi5jb2x1bW5Hcm91cCAmJiBpID4gMCkge1xyXG4gICAgICAgICAgd2lkdGhUb3RhbCArPSBjb2xEZWYud2lkdGggfHwgMDtcclxuICAgICAgICAgIGlmIChoZWFkZXIgJiYgaGVhZGVyLndpZHRoKSB7XHJcbiAgICAgICAgICAgIGhlYWRlci53aWR0aCh3aWR0aFRvdGFsIC0gaGVhZGVyQ29sdW1uV2lkdGhEaWZmIC0gZnJvemVuSGVhZGVyV2lkdGhDYWxjRGlmZmVyZW50aWFsKTsgLy8gcmVtb3ZlIHBvc3NpYmxlIGZyb3plbiBib3JkZXJcclxuICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgd2lkdGhUb3RhbCA9IGNvbERlZi53aWR0aCB8fCAwO1xyXG4gICAgICAgICAgaGVhZGVyID0gJChgPGRpdiBjbGFzcz1cInVpLXN0YXRlLWRlZmF1bHQgc2xpY2staGVhZGVyLWNvbHVtbiAke2lzRnJvemVuR3JpZCA/ICdmcm96ZW4nIDogJyd9XCIgLz5gKVxyXG4gICAgICAgICAgICAuaHRtbChgPHNwYW4gY2xhc3M9XCJzbGljay1jb2x1bW4tbmFtZVwiPiR7Y29sRGVmLmNvbHVtbkdyb3VwIHx8ICcnfTwvc3Bhbj5gKVxyXG4gICAgICAgICAgICAud2lkdGgod2lkdGhUb3RhbCAtIGhlYWRlckNvbHVtbldpZHRoRGlmZilcclxuICAgICAgICAgICAgLmFwcGVuZFRvKHByZUhlYWRlclBhbmVsKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgbGFzdENvbHVtbkdyb3VwID0gY29sRGVmLmNvbHVtbkdyb3VwIHx8ICcnO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuXHJcbiAgLyoqIFRyYW5zbGF0ZSBDb2x1bW4gR3JvdXAgdGV4dHMgYW5kIHJlLXJlbmRlciB0aGVtIGFmdGVyd2FyZC4gKi9cclxuICB0cmFuc2xhdGVHcm91cGluZ0FuZENvbFNwYW4oKSB7XHJcbiAgICBjb25zdCBjdXJyZW50Q29sdW1uRGVmaW5pdGlvbnMgPSB0aGlzLl9ncmlkLmdldENvbHVtbnMoKTtcclxuICAgIHRoaXMuZXh0ZW5zaW9uVXRpbGl0eS50cmFuc2xhdGVJdGVtcyhjdXJyZW50Q29sdW1uRGVmaW5pdGlvbnMsICdjb2x1bW5Hcm91cEtleScsICdjb2x1bW5Hcm91cCcpO1xyXG4gICAgdGhpcy5fZ3JpZC5zZXRDb2x1bW5zKGN1cnJlbnRDb2x1bW5EZWZpbml0aW9ucyk7XHJcbiAgICB0aGlzLnJlbmRlclByZUhlYWRlclJvd0dyb3VwaW5nVGl0bGVzKCk7XHJcbiAgfVxyXG59XHJcbiJdfQ==